{"version":3,"file":"player.7cf4169d2fc3c67016d6.js","mappings":";4BAEA,IAAIA,EAAoB,CAAC,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,OAC9HC,EAA2B,CAAC,IAAK,IAAK,IAAK,KAE3CC,EAAoB,EAAQ,MAEhCC,EAAOC,QAEP,SAAmBC,GACjB,IAAIC,EAAOD,EAAaE,aACxBD,EAAKE,iBAAmB,WACxBF,EAAKG,aAAe,EAEpB,IAAIC,EAASL,EAAaE,aACtBI,EAASN,EAAaO,oBAAoB,GAC1CC,EAAWR,EAAaS,sBAAsB,GAC9CC,EAAWV,EAAaW,qBAC5BD,EAASE,KAAO,WAChBF,EAASG,UAAUC,MAAQ,IAE3B,IAAIC,EAAMf,EAAaE,aACnBc,EAAMhB,EAAaE,aAEvBD,EAAKgB,QAAQD,GACbf,EAAKgB,QAAQF,GACbA,EAAIE,QAAQT,GACZF,EAAOW,QAAQP,GACfA,EAASO,QAAQZ,GACjBW,EAAIC,QAAQZ,GASZ,IAPA,IAAIa,EAAc,GACdC,EAAkB,GAClBC,EAAkB,GAClBC,EAAW,GACXC,EAAY,IAGPC,EAAI,EAAGA,EAAI3B,EAAyB4B,OAAQD,IAAK,CACxD,IAAIE,EAAWzB,EAAaW,qBAC5Bc,EAASb,KAAO,UAChBa,EAASZ,UAAUC,MAAQlB,EAAyB2B,GACpDJ,EAAgBO,KAAKD,GAEjBN,EAAgBI,EAAI,IACtBJ,EAAgBI,EAAI,GAAGN,QAAQQ,GAKnC,IAAK,IAAIE,EAAI,EAAGA,EAAI/B,EAAyB4B,OAAQG,IAAK,CACxD,IAAIC,EAAW5B,EAAaW,qBAC5BiB,EAAShB,KAAO,UAChBgB,EAASf,UAAUC,MAAQlB,EAAyB+B,GACpDP,EAAgBM,KAAKE,GAEjBR,EAAgBO,EAAI,IACtBP,EAAgBO,EAAI,GAAGV,QAAQW,GAInCT,EAAgBA,EAAgBK,OAAS,GAAGP,QAAQX,EAAQ,EAAG,GAC/Dc,EAAgBA,EAAgBI,OAAS,GAAGP,QAAQX,EAAQ,EAAG,GAG/D,IAAK,IAAIuB,EAAI,EAAGA,EAAIlC,EAAkB6B,OAAQK,IAAK,CACjD,IAAIC,EAAOjC,EAAkBG,GAC7B8B,EAAKC,UAAUjB,MAAQnB,EAAkBkC,GACrCA,EAAIlC,EAAkB6B,OAAS,GACjChB,EAASS,QAAQa,EAAM,GACvBA,EAAKb,QAAQE,EAAgB,MAE7BX,EAASS,QAAQa,EAAM,GACvBA,EAAKb,QAAQG,EAAgB,KAE/BF,EAAYQ,KAAKI,GAmCnB,OAhCAE,OAAOC,iBAAiBhC,EAAM,CAC5BoB,SAAU,CACRa,IAAK,WACH,OAAOb,GAETc,IAAK,SAAUrB,GACbO,EAAWP,EACXsB,MAGJd,UAAW,CACTY,IAAK,WACH,OAAOZ,GAGTa,IAAK,SAAUrB,GACbQ,EAAYR,EACZsB,QAKNA,IAEAnC,EAAKgB,QAAUZ,EAAOY,QAAQoB,KAAKhC,GACnCJ,EAAKqC,WAAajC,EAAOiC,WAAWD,KAAKhC,GACzCJ,EAAKc,IAAMA,EAAIwB,KACftC,EAAKe,IAAMA,EAAIuB,KAGftC,EAAKiB,YAAcA,EAEZjB,EAIP,SAASmC,IACP,IAAK,IAAII,EAAI,EAAGA,EAAItB,EAAYM,OAAQgB,IACtCtB,EAAYsB,GAAGC,UAAU3B,MAAQO,EACjCH,EAAYsB,GAAGlB,UAAUR,MAAQQ,cCnHvCxB,EAAOC,QAEP,SAA4B2C,GAC1B,IAAIzC,EAAOyC,EAAQC,YAAY,GAE3BtC,EAASqC,EAAQ/B,qBAIrBN,EAAOuC,EAAE9B,OAAS,mBAElBT,EAAOO,KAAO,UACdX,EAAKqB,UAAYjB,EAAOQ,UAExB,IAAIgC,EAAWH,EAAQxC,aAWvB,OAVAD,EAAKwC,UAAYI,EAASN,KAE1BtC,EAAKgB,QAAQZ,GACbA,EAAOY,QAAQ4B,GACfA,EAAS5B,QAAQhB,GAEjBA,EAAKqB,UAAUR,MAAQ,IACvBb,EAAK8B,UAAUjB,MAAQ,GACvBb,EAAKwC,UAAU3B,MAAQ,GAEhBb,mBCrB+DH,EAAOC,QAAoS,SAAU+C,EAAEC,EAAEC,EAAErB,GAAG,SAASsB,EAAEC,EAAEC,GAAG,IAAIH,EAAEE,GAAG,CAAC,IAAIH,EAAEG,GAAG,CAAmE,GAAGV,EAAE,OAAOA,EAAEU,GAAE,GAAI,IAAIE,EAAE,IAAIC,MAAM,uBAAuBH,EAAE,KAAK,MAAOE,EAAEE,KAAK,mBAAoBF,EAAG,IAAI7B,EAAEyB,EAAEE,GAAG,CAACnD,QAAQ,IAAIgD,EAAEG,GAAG,GAAGK,KAAKhC,EAAExB,SAAQ,SAAS+C,GAAoB,OAAOG,EAAlBF,EAAEG,GAAG,GAAGJ,IAAgBA,KAAIvB,EAAEA,EAAExB,QAAQ+C,EAAEC,EAAEC,EAAErB,GAAG,OAAOqB,EAAEE,GAAGnD,QAAkD,IAA1C,IAAIyC,OAAE,EAA4CU,EAAE,EAAEA,EAAEvB,EAAEH,OAAO0B,IAAID,EAAEtB,EAAEuB,IAAI,OAAOD,EAA1b,CAA8b,CAAC,EAAE,CAAC,SAASO,EAAQ1D,EAAOC,IAC70B,SAAW0D,GACX,aACA,IAEIC,EAyCAC,EA3CAC,EAAWH,EAAOI,kBAAoBJ,EAAOK,uBAK/C,GAAIF,EAAU,CACZ,IAAIG,EAAS,EACTC,EAAW,IAAIJ,EAASK,GACxBC,EAAUT,EAAOU,SAASC,eAAe,IAC7CJ,EAASK,QAAQH,EAAS,CACxBI,eAAe,IAEjBZ,EAAgB,WACdQ,EAAQK,KAAQR,IAAWA,EAAS,QAEjC,GAAKN,EAAOe,mBAAiD,IAA1Bf,EAAOgB,eAO/Cf,EADS,aAAcD,GAAU,uBAAwBA,EAAOU,SAASO,cAAc,UACvE,WAId,IAAIC,EAAWlB,EAAOU,SAASO,cAAc,UAC7CC,EAASC,mBAAqB,WAC5BX,IAEAU,EAASC,mBAAqB,KAC9BD,EAASE,WAAWC,YAAYH,GAChCA,EAAW,MAEblB,EAAOU,SAASY,gBAAgBC,YAAYL,IAG9B,WACdM,WAAWhB,EAAU,QAvBwD,CAC/E,IAAIiB,EAAU,IAAIzB,EAAOgB,eACzBS,EAAQC,MAAMC,UAAYnB,EAC1BP,EAAgB,WACdwB,EAAQG,MAAMC,YAAY,IAyBhC,IAAIC,EAAQ,GAEZ,SAAStB,IAEP,IAAIzB,EAAGgD,EADP7B,GAAW,EAGX,IADA,IAAI8B,EAAMF,EAAM/D,OACTiE,GAAK,CAIV,IAHAD,EAAWD,EACXA,EAAQ,GACR/C,GAAK,IACIA,EAAIiD,GACXD,EAAShD,KAEXiD,EAAMF,EAAM/D,OAEdmC,GAAW,EAGb7D,EAAOC,QACP,SAAmB2F,GACQ,IAArBH,EAAM7D,KAAKgE,IAAgB/B,GAC7BD,OAIDH,KAAKoC,UAAuB,IAAX,EAAAC,EAAyB,EAAAA,EAAyB,oBAATC,KAAuBA,KAAyB,oBAAXC,OAAyBA,OAAS,KAClI,IAAI,EAAE,CAAC,SAAStC,EAAQ1D,EAAOC,GACjC,aACA,IAAIgG,EAAYvC,EAAQ,GAGxB,SAASwC,KAET,IAAIC,EAAW,GAEXC,EAAW,CAAC,YACZC,EAAY,CAAC,aACbC,EAAU,CAAC,WAIf,SAASC,EAAQC,GACf,GAAwB,mBAAbA,EACT,MAAM,IAAIC,UAAU,+BAEtBZ,KAAKa,MAAQJ,EACbT,KAAKJ,MAAQ,GACbI,KAAKc,aAAU,EACXH,IAAaN,GACfU,EAAsBf,KAAMW,GAsBhC,SAASK,EAAUC,EAASC,EAAaC,GACvCnB,KAAKiB,QAAUA,EACY,mBAAhBC,IACTlB,KAAKkB,YAAcA,EACnBlB,KAAKoB,cAAgBpB,KAAKqB,oBAEF,mBAAfF,IACTnB,KAAKmB,WAAaA,EAClBnB,KAAKsB,aAAetB,KAAKuB,mBAgB7B,SAASC,EAAOP,EAASQ,EAAMtG,GAC7BiF,GAAU,WACR,IAAIsB,EACJ,IACEA,EAAcD,EAAKtG,GACnB,MAAOgC,GACP,OAAOmD,EAASqB,OAAOV,EAAS9D,GAE9BuE,IAAgBT,EAClBX,EAASqB,OAAOV,EAAS,IAAIL,UAAU,uCAEvCN,EAASsB,QAAQX,EAASS,MAoChC,SAASG,EAAQC,GAEf,IAAIC,EAAOD,GAAOA,EAAIC,KACtB,GAAID,IAAuB,iBAARA,GAAmC,mBAARA,IAAuC,mBAATC,EAC1E,OAAO,WACLA,EAAKC,MAAMF,EAAKG,YAKtB,SAASlB,EAAsBb,EAAMgC,GAEnC,IAAI9D,GAAS,EACb,SAAS+D,EAAQhH,GACXiD,IAGJA,GAAS,EACTkC,EAASqB,OAAOzB,EAAM/E,IAGxB,SAASiH,EAAUjH,GACbiD,IAGJA,GAAS,EACTkC,EAASsB,QAAQ1B,EAAM/E,IAOzB,IAAIkH,EAASC,GAJb,WACEJ,EAASE,EAAWD,MAIA,UAAlBE,EAAOE,QACTJ,EAAQE,EAAOlH,OAInB,SAASmH,EAASb,EAAMtG,GACtB,IAAIqH,EAAM,GACV,IACEA,EAAIrH,MAAQsG,EAAKtG,GACjBqH,EAAID,OAAS,UACb,MAAOpF,GACPqF,EAAID,OAAS,QACbC,EAAIrH,MAAQgC,EAEd,OAAOqF,EAvJTrI,EAAOC,QAAUsG,EAcjBA,EAAQ+B,UAAiB,MAAI,SAAUtB,GACrC,OAAOnB,KAAK+B,KAAK,KAAMZ,IAEzBT,EAAQ+B,UAAUV,KAAO,SAAUb,EAAaC,GAC9C,GAA2B,mBAAhBD,GAA8BlB,KAAKa,QAAUL,GAChC,mBAAfW,GAA6BnB,KAAKa,QAAUN,EACnD,OAAOP,KAET,IAAIiB,EAAU,IAAIjB,KAAK0C,YAAYrC,GAQnC,OAPIL,KAAKa,QAAUJ,EAEjBe,EAAOP,EADQjB,KAAKa,QAAUL,EAAYU,EAAcC,EAC9BnB,KAAKc,SAE/Bd,KAAKJ,MAAM7D,KAAK,IAAIiF,EAAUC,EAASC,EAAaC,IAG/CF,GAaTD,EAAUyB,UAAUrB,cAAgB,SAAUjG,GAC5CmF,EAASsB,QAAQ5B,KAAKiB,QAAS9F,IAEjC6F,EAAUyB,UAAUpB,mBAAqB,SAAUlG,GACjDqG,EAAOxB,KAAKiB,QAASjB,KAAKkB,YAAa/F,IAEzC6F,EAAUyB,UAAUnB,aAAe,SAAUnG,GAC3CmF,EAASqB,OAAO3B,KAAKiB,QAAS9F,IAEhC6F,EAAUyB,UAAUlB,kBAAoB,SAAUpG,GAChDqG,EAAOxB,KAAKiB,QAASjB,KAAKmB,WAAYhG,IAmBxCmF,EAASsB,QAAU,SAAU1B,EAAM/E,GACjC,IAAIkH,EAASC,EAAST,EAAS1G,GAC/B,GAAsB,UAAlBkH,EAAOE,OACT,OAAOjC,EAASqB,OAAOzB,EAAMmC,EAAOlH,OAEtC,IAAI+G,EAAWG,EAAOlH,MAEtB,GAAI+G,EACFnB,EAAsBb,EAAMgC,OACvB,CACLhC,EAAKW,MAAQL,EACbN,EAAKY,QAAU3F,EAGf,IAFA,IAAI0B,GAAK,EACLiD,EAAMI,EAAKN,MAAM/D,SACZgB,EAAIiD,GACXI,EAAKN,MAAM/C,GAAGuE,cAAcjG,GAGhC,OAAO+E,GAETI,EAASqB,OAAS,SAAUzB,EAAMyC,GAChCzC,EAAKW,MAAQN,EACbL,EAAKY,QAAU6B,EAGf,IAFA,IAAI9F,GAAK,EACLiD,EAAMI,EAAKN,MAAM/D,SACZgB,EAAIiD,GACXI,EAAKN,MAAM/C,GAAGyE,aAAaqB,GAE7B,OAAOzC,GAsDTQ,EAAQkB,QACR,SAAiBzG,GACf,OAAIA,aAAiB6E,KACZ7E,EAEFmF,EAASsB,QAAQ,IAAI5B,KAAKK,GAAWlF,IAG9CuF,EAAQiB,OACR,SAAgBiB,GACd,IAAI3B,EAAU,IAAIjB,KAAKK,GACvB,OAAOC,EAASqB,OAAOV,EAAS2B,IAGlClC,EAAQmC,IACR,SAAaC,GACX,IAAI5C,EAAOF,KACX,GAAiD,mBAA7C3D,OAAOoG,UAAUM,SAASnF,KAAKkF,GACjC,OAAO9C,KAAK2B,OAAO,IAAIf,UAAU,qBAGnC,IAAId,EAAMgD,EAASjH,OACfuC,GAAS,EACb,IAAK0B,EACH,OAAOE,KAAK4B,QAAQ,IAQtB,IALA,IAAIoB,EAAS,IAAIC,MAAMnD,GACnBoD,EAAW,EACXrG,GAAK,EACLoE,EAAU,IAAIjB,KAAKK,KAEdxD,EAAIiD,GACXqD,EAAYL,EAASjG,GAAIA,GAE3B,OAAOoE,EACP,SAASkC,EAAYhI,EAAO0B,GAC1BqD,EAAK0B,QAAQzG,GAAO4G,MAMpB,SAAwBqB,GACtBJ,EAAOnG,GAAKuG,IACNF,IAAapD,GAAQ1B,IACzBA,GAAS,EACTkC,EAASsB,QAAQX,EAAS+B,OAVW,SAAUL,GAC5CvE,IACHA,GAAS,EACTkC,EAASqB,OAAOV,EAAS0B,SAajCjC,EAAQ2C,KACR,SAAcP,GACZ,IAAI5C,EAAOF,KACX,GAAiD,mBAA7C3D,OAAOoG,UAAUM,SAASnF,KAAKkF,GACjC,OAAO9C,KAAK2B,OAAO,IAAIf,UAAU,qBAGnC,IAakBzF,EAbd2E,EAAMgD,EAASjH,OACfuC,GAAS,EACb,IAAK0B,EACH,OAAOE,KAAK4B,QAAQ,IAMtB,IAHA,IAAI/E,GAAK,EACLoE,EAAU,IAAIjB,KAAKK,KAEdxD,EAAIiD,GAIK3E,EAHP2H,EAASjG,GAIlBqD,EAAK0B,QAAQzG,GAAO4G,MAAK,SAAUuB,GAC5BlF,IACHA,GAAS,EACTkC,EAASsB,QAAQX,EAASqC,OAE3B,SAAUX,GACNvE,IACHA,GAAS,EACTkC,EAASqB,OAAOV,EAAS0B,OAV/B,OAAO1B,IAgBP,CAAC,EAAI,IAAI,EAAE,CAAC,SAASpD,EAAQ1D,EAAOC,IACtC,SAAW0D,GACX,aAC8B,mBAAnBA,EAAO4C,UAChB5C,EAAO4C,QAAU7C,EAAQ,MAGxBD,KAAKoC,UAAuB,IAAX,EAAAC,EAAyB,EAAAA,EAAyB,oBAATC,KAAuBA,KAAyB,oBAAXC,OAAyBA,OAAS,KAClI,CAAC,EAAI,IAAI,EAAE,CAAC,SAAStC,EAAQ1D,EAAOC,GACtC,aAEA,IAAImJ,EAA4B,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAwB,SAAU3B,GAAO,cAAcA,GAAS,SAAUA,GAAO,OAAOA,GAAyB,mBAAX0B,QAAyB1B,EAAIY,cAAgBc,QAAU1B,IAAQ0B,OAAOf,UAAY,gBAAkBX,GA2BtQ,IAAI4B,EAvBJ,WAEI,IACI,GAAyB,oBAAdC,UACP,OAAOA,UAEX,GAA+B,oBAApBC,gBACP,OAAOA,gBAEX,GAA4B,oBAAjBC,aACP,OAAOA,aAEX,GAA0B,oBAAfC,WACP,OAAOA,WAEX,GAA2B,oBAAhBC,YACP,OAAOA,YAEb,MAAO5G,GACL,QAIE6G,GAwCV,SAASC,EAAWC,EAAOC,GAEvBD,EAAQA,GAAS,GACjBC,EAAaA,GAAc,GAC3B,IACI,OAAO,IAAIC,KAAKF,EAAOC,GACzB,MAAOhH,GACL,GAAe,cAAXA,EAAEkH,KACF,MAAMlH,EAIV,IAFA,IACImH,EAAU,IADuB,oBAAhBC,YAA8BA,YAAuC,oBAAlBC,cAAgCA,cAA0C,oBAAnBC,eAAiCA,eAAiBC,mBAExK7H,EAAI,EAAGA,EAAIqH,EAAMrI,OAAQgB,GAAK,EACnCyH,EAAQK,OAAOT,EAAMrH,IAEzB,OAAOyH,EAAQM,QAAQT,EAAWlJ,OAMnB,oBAAZyF,SAGP7C,EAAQ,GAEZ,IAAIgH,EAAYnE,QAEhB,SAASoE,EAAgB7D,EAAS8D,GAC1BA,GACA9D,EAAQc,MAAK,SAAUM,GACnB0C,EAAS,KAAM1C,MAChB,SAAUM,GACToC,EAASpC,MAKrB,SAASqC,EAAoB/D,EAAS8D,EAAUE,GACpB,mBAAbF,GACP9D,EAAQc,KAAKgD,GAGY,mBAAlBE,GACPhE,EAAe,MAAEgE,GAIzB,SAASC,EAAaC,GAOlB,MALmB,iBAARA,IACPC,QAAQC,KAAKF,EAAM,2CACnBA,EAAMG,OAAOH,IAGVA,EAGX,SAASI,IACL,GAAItD,UAAUpG,QAAqD,mBAApCoG,UAAUA,UAAUpG,OAAS,GACxD,OAAOoG,UAAUA,UAAUpG,OAAS,GAO5C,IAAI2J,EAA4B,mCAC5BC,OAAgB,EAChBC,EAAa,GACb3C,EAAW1G,OAAOoG,UAAUM,SAG5B4C,EAAY,WACZC,EAAa,YAOjB,SAASC,EAAwBC,GAI7B,IAHA,IAAIjK,EAASiK,EAAIjK,OACbkK,EAAM,IAAIC,YAAYnK,GACtBoK,EAAM,IAAIC,WAAWH,GAChBlJ,EAAI,EAAGA,EAAIhB,EAAQgB,IACxBoJ,EAAIpJ,GAAKiJ,EAAIK,WAAWtJ,GAE5B,OAAOkJ,EA4CX,SAASK,EAAkB1C,GACvB,MAA6B,kBAAlB+B,EACAZ,EAAUjD,QAAQ6D,GA5BjC,SAAyC/B,GACrC,OAAO,IAAImB,GAAU,SAAUjD,GAC3B,IAAIyE,EAAM3C,EAAI4C,YAAYd,EAA2BI,GACjDW,EAAOtC,EAAW,CAAC,KACvBoC,EAAIG,YAAYhB,GAA2BiB,IAAIF,EAAM,OAErDF,EAAIK,QAAU,SAAUvJ,GAGpBA,EAAEwJ,iBACFxJ,EAAEyJ,kBACFhF,GAAQ,IAGZyE,EAAIQ,WAAa,WACb,IAAIC,EAAgBC,UAAUC,UAAUC,MAAM,iBAC1CC,EAAcH,UAAUC,UAAUC,MAAM,UAG5CrF,EAAQsF,IAAgBJ,GAAiBK,SAASL,EAAc,GAAI,KAAO,QAEzE,OAAE,WACR,OAAO,KAQJM,CAAgC1D,GAAK3B,MAAK,SAAU5G,GAEvD,OADAsK,EAAgBtK,KAKxB,SAASkM,EAAgBC,GACrB,IAAIC,EAAY7B,EAAW4B,EAAOjD,MAG9BmD,EAAoB,GAExBA,EAAkBvG,QAAU,IAAI4D,GAAU,SAAUjD,EAASD,GACzD6F,EAAkB5F,QAAUA,EAC5B4F,EAAkB7F,OAASA,KAI/B4F,EAAUE,mBAAmB1L,KAAKyL,GAG7BD,EAAUG,QAGXH,EAAUG,QAAUH,EAAUG,QAAQ3F,MAAK,WACvC,OAAOyF,EAAkBvG,WAH7BsG,EAAUG,QAAUF,EAAkBvG,QAQ9C,SAAS0G,EAAkBL,GACvB,IAGIE,EAHY9B,EAAW4B,EAAOjD,MAGAoD,mBAAmBG,MAIrD,GAAIJ,EAEA,OADAA,EAAkB5F,UACX4F,EAAkBvG,QAIjC,SAAS4G,EAAiBP,EAAQQ,GAC9B,IAGIN,EAHY9B,EAAW4B,EAAOjD,MAGAoD,mBAAmBG,MAIrD,GAAIJ,EAEA,OADAA,EAAkB7F,OAAOmG,GAClBN,EAAkBvG,QAIjC,SAAS8G,EAAeT,EAAQU,GAC5B,OAAO,IAAInD,GAAU,SAAUjD,EAASD,GAGpC,GAFA+D,EAAW4B,EAAOjD,MAAQqB,EAAW4B,EAAOjD,OA6NzC,CAEH4D,QAAS,GAETC,GAAI,KAEJR,QAAS,KAETD,mBAAoB,IAnOhBH,EAAOY,GAAI,CACX,IAAIF,EAIA,OAAOpG,EAAQ0F,EAAOY,IAHtBb,EAAgBC,GAChBA,EAAOY,GAAGC,QAMlB,IAAIC,EAAS,CAACd,EAAOjD,MAEjB2D,GACAI,EAAOrM,KAAKuL,EAAOe,SAGvB,IAAIC,EAAU5E,EAAI6E,KAAKvG,MAAM0B,EAAK0E,GAE9BJ,IACAM,EAAQE,gBAAkB,SAAUrL,GAChC,IAAI+K,EAAKI,EAAQjG,OACjB,IACI6F,EAAGO,kBAAkBnB,EAAOoB,WACxBvL,EAAEwL,YAAc,GAEhBT,EAAGO,kBAAkBjD,GAE3B,MAAOoD,GACL,GAAgB,oBAAZA,EAAGvE,KAGH,MAAMuE,EAFNxD,QAAQC,KAAK,iBAAmBiC,EAAOjD,KAA1B,oCAA4ElH,EAAEwL,WAAa,eAAiBxL,EAAE0L,WAAa,sBAAwBvB,EAAOoB,UAAY,wBAQnMJ,EAAQQ,QAAU,SAAU3L,GACxBA,EAAEwJ,iBACFhF,EAAO2G,EAAQ3F,QAGnB2F,EAAQS,UAAY,WAChB,IAAIb,EAAKI,EAAQjG,OACjB6F,EAAGc,gBAAkB,SAAU7L,GAM3BA,EAAE8L,OAAOd,SAEbvG,EAAQsG,GACRP,EAAkBL,OAK9B,SAAS4B,EAAuB5B,GAC5B,OAAOS,EAAeT,GAAQ,GAGlC,SAAS6B,EAAuB7B,GAC5B,OAAOS,EAAeT,GAAQ,GAGlC,SAAS8B,EAAiB9B,EAAQ+B,GAC9B,IAAK/B,EAAOY,GACR,OAAO,EAGX,IAAIoB,GAAchC,EAAOY,GAAGqB,iBAAiBC,SAASlC,EAAOoB,WACzDe,EAAcnC,EAAOe,QAAUf,EAAOY,GAAGG,QACzCqB,EAAYpC,EAAOe,QAAUf,EAAOY,GAAGG,QAY3C,GAVIoB,IAGInC,EAAOe,UAAYgB,GACnBjE,QAAQC,KAAK,iBAAmBiC,EAAOjD,KAA1B,uCAA8EiD,EAAOY,GAAGG,QAAU,eAAiBf,EAAOe,QAAU,KAGrJf,EAAOe,QAAUf,EAAOY,GAAGG,SAG3BqB,GAAaJ,EAAY,CAIzB,GAAIA,EAAY,CACZ,IAAIK,EAAarC,EAAOY,GAAGG,QAAU,EACjCsB,EAAarC,EAAOe,UACpBf,EAAOe,QAAUsB,GAIzB,OAAO,EAGX,OAAO,EAqBX,SAASC,EAAYC,GAEjB,OAAO5F,EAAW,CADF4B,EAAwBiE,KAAKD,EAAYjL,QAC1B,CAAE3D,KAAM4O,EAAY5O,OAIvD,SAAS8O,EAAe5O,GACpB,OAAOA,GAASA,EAAM6O,4BAO1B,SAASC,EAAYlF,GACjB,IAAI7E,EAAOF,KAEPiB,EAAUf,EAAKgK,aAAanI,MAAK,WACjC,IAAIwF,EAAY7B,EAAWxF,EAAKiK,QAAQ9F,MAExC,GAAIkD,GAAaA,EAAUG,QACvB,OAAOH,EAAUG,WAKzB,OADA1C,EAAoB/D,EAAS8D,EAAUA,GAChC9D,EA2CX,SAASmJ,EAAkB9C,EAAQ+C,EAAMtF,EAAUuF,QAC/BC,IAAZD,IACAA,EAAU,GAGd,IACI,IAAIE,EAAKlD,EAAOY,GAAG5B,YAAYgB,EAAOoB,UAAW2B,GACjDtF,EAAS,KAAMyF,GACjB,MAAO1C,GACL,GAAIwC,EAAU,KAAOhD,EAAOY,IAAmB,sBAAbJ,EAAIzD,MAA6C,kBAAbyD,EAAIzD,MACtE,OAAOQ,EAAUjD,UAAUG,MAAK,WAC5B,IAAKuF,EAAOY,IAAmB,kBAAbJ,EAAIzD,OAA6BiD,EAAOY,GAAGqB,iBAAiBC,SAASlC,EAAOoB,YAAcpB,EAAOe,SAAWf,EAAOY,GAAGG,QAMpI,OAJIf,EAAOY,KACPZ,EAAOe,QAAUf,EAAOY,GAAGG,QAAU,GAGlCc,EAAuB7B,MAEnCvF,MAAK,WACJ,OAzDhB,SAAuBuF,GACnBD,EAAgBC,GAKhB,IAHA,IAAIC,EAAY7B,EAAW4B,EAAOjD,MAC9B4D,EAAUV,EAAUU,QAEfpL,EAAI,EAAGA,EAAIoL,EAAQpM,OAAQgB,IAAK,CACrC,IAAI4N,EAASxC,EAAQpL,GACjB4N,EAAON,QAAQjC,KACfuC,EAAON,QAAQjC,GAAGC,QAClBsC,EAAON,QAAQjC,GAAK,MAK5B,OAFAZ,EAAOY,GAAK,KAELgB,EAAuB5B,GAAQvF,MAAK,SAAUmG,GAEjD,OADAZ,EAAOY,GAAKA,EACRkB,EAAiB9B,GAEV6B,EAAuB7B,GAE3BY,KACRnG,MAAK,SAAUmG,GAGdZ,EAAOY,GAAKX,EAAUW,GAAKA,EAC3B,IAAK,IAAIrL,EAAI,EAAGA,EAAIoL,EAAQpM,OAAQgB,IAChCoL,EAAQpL,GAAGsN,QAAQjC,GAAKA,KAEtB,OAAE,SAAUJ,GAElB,MADAD,EAAiBP,EAAQQ,GACnBA,KA0BS4C,CAAcpD,GAAQvF,MAAK,WAC9BqI,EAAkB9C,EAAQ+C,EAAMtF,EAAUuF,EAAU,SAElD,MAAEvF,GAGhBA,EAAS+C,IA+lBjB,IAAI6C,EAAe,CACfC,QAAS,eACTC,aA9kBJ,SAAsBC,GAClB,IAAI5K,EAAOF,KACPsH,EAAS,CACTY,GAAI,MAGR,GAAI4C,EACA,IAAK,IAAIjO,KAAKiO,EACVxD,EAAOzK,GAAKiO,EAAQjO,GAK5B,IAAI0K,EAAY7B,EAAW4B,EAAOjD,MAG7BkD,IACDA,EA/BG,CAEHU,QAAS,GAETC,GAAI,KAEJR,QAAS,KAETD,mBAAoB,IAyBpB/B,EAAW4B,EAAOjD,MAAQkD,GAI9BA,EAAUU,QAAQlM,KAAKmE,GAGlBA,EAAKgK,aACNhK,EAAKgK,WAAahK,EAAK6K,MACvB7K,EAAK6K,MAAQd,GAIjB,IAAIe,EAAe,GAEnB,SAASC,IAGL,OAAOpG,EAAUjD,UAGrB,IAAK,IAAIsJ,EAAI,EAAGA,EAAI3D,EAAUU,QAAQpM,OAAQqP,IAAK,CAC/C,IAAIT,EAASlD,EAAUU,QAAQiD,GAC3BT,IAAWvK,GAEX8K,EAAajP,KAAK0O,EAAOP,aAAoB,MAAEe,IAKvD,IAAIhD,EAAUV,EAAUU,QAAQkD,MAAM,GAItC,OAAOtG,EAAUhC,IAAImI,GAAcjJ,MAAK,WAGpC,OAFAuF,EAAOY,GAAKX,EAAUW,GAEfgB,EAAuB5B,MAC/BvF,MAAK,SAAUmG,GAEd,OADAZ,EAAOY,GAAKA,EACRkB,EAAiB9B,EAAQpH,EAAKkL,eAAe/C,SAEtCc,EAAuB7B,GAE3BY,KACRnG,MAAK,SAAUmG,GACdZ,EAAOY,GAAKX,EAAUW,GAAKA,EAC3BhI,EAAKiK,QAAU7C,EAEf,IAAK,IAAI+D,EAAI,EAAGA,EAAIpD,EAAQpM,OAAQwP,IAAK,CACrC,IAAIZ,EAASxC,EAAQoD,GACjBZ,IAAWvK,IAEXuK,EAAON,QAAQjC,GAAKZ,EAAOY,GAC3BuC,EAAON,QAAQ9B,QAAUf,EAAOe,cAsgB5CiD,SApiCJ,WACI,IAGI,IAAK5H,IAAQA,EAAI6E,KACb,OAAO,EAMX,IAAIgD,EAAmC,oBAAjBC,cAAgC,4BAA4BC,KAAK1E,UAAUC,aAAe,SAASyE,KAAK1E,UAAUC,aAAe,aAAayE,KAAK1E,UAAU2E,UAE/KC,EAA4B,mBAAVC,QAAsE,IAA9CA,MAAM7I,WAAW8I,QAAQ,gBAQvE,QAASN,GAAYI,IAAkC,oBAAdhI,WAKlB,oBAAhBmI,YACT,MAAO3O,GACL,OAAO,GAwgCD4O,GACVC,QAvdJ,SAAiBvI,EAAUsB,GACvB,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACdqI,EAAkBlK,EAAKiK,QAASxE,GAAW,SAAUmC,EAAKxB,GACtD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IACImE,EADQ3F,EAAYE,YAAYtG,EAAKiK,QAAQzB,WACjCwD,aACZC,EAAkB,EAEtBF,EAAIlD,UAAY,WACZ,IAAIqD,EAASH,EAAI5J,OAEjB,GAAI+J,EAAQ,CACR,IAAIjR,EAAQiR,EAAOjR,MACf4O,EAAe5O,KACfA,EAAQyO,EAAYzO,IAExB,IAAIkH,EAASoB,EAAStI,EAAOiR,EAAOjH,IAAKgH,UAK1B,IAAX9J,EACAT,EAAQS,GAER+J,EAAiB,gBAGrBxK,KAIRqK,EAAInD,QAAU,WACVnH,EAAOsK,EAAItJ,QAEjB,MAAOxF,GACLwE,EAAOxE,UAGT,MAAEwE,MAKhB,OAFAmD,EAAgB7D,EAAS8D,GAElB9D,GAsaPoL,QAlgBJ,SAAiBlH,EAAKJ,GAClB,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACdqI,EAAkBlK,EAAKiK,QAASxE,GAAW,SAAUmC,EAAKxB,GACtD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IACImE,EADQ3F,EAAYE,YAAYtG,EAAKiK,QAAQzB,WACjCnM,IAAI4I,GAEpB8G,EAAIlD,UAAY,WACZ,IAAI5N,EAAQ8Q,EAAI5J,YACFkI,IAAVpP,IACAA,EAAQ,MAER4O,EAAe5O,KACfA,EAAQyO,EAAYzO,IAExByG,EAAQzG,IAGZ8Q,EAAInD,QAAU,WACVnH,EAAOsK,EAAItJ,QAEjB,MAAOxF,GACLwE,EAAOxE,UAGT,MAAEwE,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GA6dPqL,QApaJ,SAAiBnH,EAAKhK,EAAO4J,GACzB,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3C,IAAI2F,EACJpH,EAAK6K,QAAQhJ,MAAK,WAEd,OADAuF,EAASpH,EAAKiK,QACe,kBAAzBpH,EAASnF,KAAKzC,GACPiL,EAAkBkB,EAAOY,IAAInG,MAAK,SAAUwK,GAC/C,OAAIA,EACOpR,GA7TVoL,EA+TkBpL,EA9T5B,IAAI0J,GAAU,SAAUjD,EAASD,GACpC,IAAI6K,EAAS,IAAIC,WACjBD,EAAO1D,QAAUnH,EACjB6K,EAAOE,UAAY,SAAUvP,GACzB,IAAIwP,EAASC,KAAKzP,EAAE8L,OAAO5G,QAAU,IACrCT,EAAQ,CACJoI,6BAA6B,EAC7BpL,KAAM+N,EACN1R,KAAMsL,EAAKtL,QAGnBuR,EAAOK,mBAAmBtG,OAZlC,IAAqBA,KAkUFpL,KACR4G,MAAK,SAAU5G,GACdiP,EAAkBlK,EAAKiK,QAASvE,GAAY,SAAUkC,EAAKxB,GACvD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IAAIgF,EAAQxG,EAAYE,YAAYtG,EAAKiK,QAAQzB,WAMnC,OAAVvN,IACAA,OAAQoP,GAGZ,IAAI0B,EAAMa,EAAMrG,IAAItL,EAAOgK,GAE3BmB,EAAYO,WAAa,gBAOP0D,IAAVpP,IACAA,EAAQ,MAGZyG,EAAQzG,IAEZmL,EAAYI,QAAUJ,EAAYwC,QAAU,WACxC,IAAIhB,EAAMmE,EAAItJ,MAAQsJ,EAAItJ,MAAQsJ,EAAI3F,YAAY3D,MAClDhB,EAAOmG,IAEb,MAAO3K,GACLwE,EAAOxE,UAGT,MAAEwE,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GAuWP8L,WApWJ,SAAoB5H,EAAKJ,GACrB,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACdqI,EAAkBlK,EAAKiK,QAASvE,GAAY,SAAUkC,EAAKxB,GACvD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IAMImE,EANQ3F,EAAYE,YAAYtG,EAAKiK,QAAQzB,WAMzB,OAAEvD,GAC1BmB,EAAYO,WAAa,WACrBjF,KAGJ0E,EAAYwC,QAAU,WAClBnH,EAAOsK,EAAItJ,QAKf2D,EAAYI,QAAU,WAClB,IAAIoB,EAAMmE,EAAItJ,MAAQsJ,EAAItJ,MAAQsJ,EAAI3F,YAAY3D,MAClDhB,EAAOmG,IAEb,MAAO3K,GACLwE,EAAOxE,UAGT,MAAEwE,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GA2TP+L,MAxTJ,SAAejI,GACX,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACdqI,EAAkBlK,EAAKiK,QAASvE,GAAY,SAAUkC,EAAKxB,GACvD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IACImE,EADQ3F,EAAYE,YAAYtG,EAAKiK,QAAQzB,WACjCsE,QAEhB1G,EAAYO,WAAa,WACrBjF,KAGJ0E,EAAYI,QAAUJ,EAAYwC,QAAU,WACxC,IAAIhB,EAAMmE,EAAItJ,MAAQsJ,EAAItJ,MAAQsJ,EAAI3F,YAAY3D,MAClDhB,EAAOmG,IAEb,MAAO3K,GACLwE,EAAOxE,UAGT,MAAEwE,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GA2RPpF,OAxRJ,SAAgBkJ,GACZ,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACdqI,EAAkBlK,EAAKiK,QAASxE,GAAW,SAAUmC,EAAKxB,GACtD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IACImE,EADQ3F,EAAYE,YAAYtG,EAAKiK,QAAQzB,WACjCuE,QAEhBhB,EAAIlD,UAAY,WACZnH,EAAQqK,EAAI5J,SAGhB4J,EAAInD,QAAU,WACVnH,EAAOsK,EAAItJ,QAEjB,MAAOxF,GACLwE,EAAOxE,UAGT,MAAEwE,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GA4PPkE,IAzPJ,SAAa9H,EAAG0H,GACZ,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GACvCtE,EAAI,EACJuE,EAAQ,MAKZ1B,EAAK6K,QAAQhJ,MAAK,WACdqI,EAAkBlK,EAAKiK,QAASxE,GAAW,SAAUmC,EAAKxB,GACtD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IAAIgF,EAAQxG,EAAYE,YAAYtG,EAAKiK,QAAQzB,WAC7CwE,GAAW,EACXjB,EAAMa,EAAMK,gBAEhBlB,EAAIlD,UAAY,WACZ,IAAIqD,EAASH,EAAI5J,OACZ+J,EAOK,IAAN/O,GAKK6P,EAFLtL,EAAQwK,EAAOjH,MAKX+H,GAAW,EACXd,EAAOgB,QAAQ/P,IAdnBuE,EAAQ,OAsBhBqK,EAAInD,QAAU,WACVnH,EAAOsK,EAAItJ,QAEjB,MAAOxF,GACLwE,EAAOxE,UAGT,MAAEwE,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GAgMPoM,KA7LJ,SAActI,GACV,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACdqI,EAAkBlK,EAAKiK,QAASxE,GAAW,SAAUmC,EAAKxB,GACtD,GAAIwB,EACA,OAAOnG,EAAOmG,GAGlB,IACI,IACImE,EADQ3F,EAAYE,YAAYtG,EAAKiK,QAAQzB,WACjCyE,gBACZE,EAAO,GAEXpB,EAAIlD,UAAY,WACZ,IAAIqD,EAASH,EAAI5J,OAEZ+J,GAKLiB,EAAKtR,KAAKqQ,EAAOjH,KACjBiH,EAAiB,YALbxK,EAAQyL,IAQhBpB,EAAInD,QAAU,WACVnH,EAAOsK,EAAItJ,QAEjB,MAAOxF,GACLwE,EAAOxE,UAGT,MAAEwE,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GAwJPqM,aArJJ,SAAsBxC,EAAS/F,GAC3BA,EAAWQ,EAAYvD,MAAMhC,KAAMiC,WAEnC,IAAIsL,EAAgBvN,KAAKwN,UACzB1C,EAA6B,mBAAZA,GAA0BA,GAAW,IACzCzG,OACTyG,EAAQzG,KAAOyG,EAAQzG,MAAQkJ,EAAclJ,KAC7CyG,EAAQpC,UAAYoC,EAAQpC,WAAa6E,EAAc7E,WAG3D,IACIzH,EADAf,EAAOF,KAEX,GAAK8K,EAAQzG,KAEN,CACH,IAEIoJ,EAFc3C,EAAQzG,OAASkJ,EAAclJ,MAAQnE,EAAKiK,QAAQjC,GAExCrD,EAAUjD,QAAQ1B,EAAKiK,QAAQjC,IAAMgB,EAAuB4B,GAAS/I,MAAK,SAAUmG,GAC9G,IAAIX,EAAY7B,EAAWoF,EAAQzG,MAC/B4D,EAAUV,EAAUU,QACxBV,EAAUW,GAAKA,EACf,IAAK,IAAIrL,EAAI,EAAGA,EAAIoL,EAAQpM,OAAQgB,IAChCoL,EAAQpL,GAAGsN,QAAQjC,GAAKA,EAE5B,OAAOA,KAsDPjH,EAnDC6J,EAAQpC,UAmDC+E,EAAU1L,MAAK,SAAUmG,GAC/B,GAAKA,EAAGqB,iBAAiBC,SAASsB,EAAQpC,WAA1C,CAIA,IAAIG,EAAaX,EAAGG,QAAU,EAE9BhB,EAAgByD,GAEhB,IAAIvD,EAAY7B,EAAWoF,EAAQzG,MAC/B4D,EAAUV,EAAUU,QAExBC,EAAGC,QACH,IAAK,IAAItL,EAAI,EAAGA,EAAIoL,EAAQpM,OAAQgB,IAAK,CACrC,IAAI4N,EAASxC,EAAQpL,GACrB4N,EAAON,QAAQjC,GAAK,KACpBuC,EAAON,QAAQ9B,QAAUQ,EAwB7B,OArBwB,IAAIhE,GAAU,SAAUjD,EAASD,GACrD,IAAIsK,EAAMvI,EAAI6E,KAAKuC,EAAQzG,KAAMwE,GAEjCoD,EAAInD,QAAU,SAAUhB,GACXmE,EAAI5J,OACV8F,QACHxG,EAAOmG,IAGXmE,EAAIzD,gBAAkB,WACTyD,EAAI5J,OACVqL,kBAAkB5C,EAAQpC,YAGjCuD,EAAIlD,UAAY,WACZ,IAAIb,EAAK+D,EAAI5J,OACb6F,EAAGC,QACHvG,EAAQsG,OAISnG,MAAK,SAAUmG,GACpCX,EAAUW,GAAKA,EACf,IAAK,IAAIgD,EAAI,EAAGA,EAAIjD,EAAQpM,OAAQqP,IAAK,CACrC,IAAIyC,EAAW1F,EAAQiD,GACvByC,EAASxD,QAAQjC,GAAKA,EACtBP,EAAkBgG,EAASxD,aAEzB,OAAE,SAAUrC,GAElB,MADCD,EAAiBiD,EAAShD,IAAQjD,EAAUjD,WAAkB,OAAE,eAC3DkG,SAnGJ2F,EAAU1L,MAAK,SAAUmG,GAC/Bb,EAAgByD,GAEhB,IAAIvD,EAAY7B,EAAWoF,EAAQzG,MAC/B4D,EAAUV,EAAUU,QAExBC,EAAGC,QACH,IAAK,IAAItL,EAAI,EAAGA,EAAIoL,EAAQpM,OAAQgB,IACnBoL,EAAQpL,GACdsN,QAAQjC,GAAK,KA6BxB,OA1BoB,IAAIrD,GAAU,SAAUjD,EAASD,GACjD,IAAIsK,EAAMvI,EAAIkK,eAAe9C,EAAQzG,MAErC4H,EAAInD,QAAU,WACV,IAAIZ,EAAK+D,EAAI5J,OACT6F,GACAA,EAAGC,QAEPxG,EAAOsK,EAAItJ,QAGfsJ,EAAI4B,UAAY,WAGZzI,QAAQC,KAAK,sCAAwCyF,EAAQzG,KAAO,4CAGxE4H,EAAIlD,UAAY,WACZ,IAAIb,EAAK+D,EAAI5J,OACT6F,GACAA,EAAGC,QAEPvG,EAAQsG,OAIKnG,MAAK,SAAUmG,GAChCX,EAAUW,GAAKA,EACf,IAAK,IAAIrL,EAAI,EAAGA,EAAIoL,EAAQpM,OAAQgB,IAEhC8K,EADcM,EAAQpL,GACIsN,YAExB,OAAE,SAAUrC,GAElB,MADCD,EAAiBiD,EAAShD,IAAQjD,EAAUjD,WAAkB,OAAE,eAC3DkG,aA7DlB7G,EAAU4D,EAAUlD,OAAO,qBAyH/B,OADAmD,EAAgB7D,EAAS8D,GAClB9D,IAyBX,IAAI6M,EAAa,mEAGbC,EAAyB,gCAEzBC,EAAoB,YACpBC,EAA2BD,EAAkBnS,OAG7CqS,EAAmB,OACnBC,EAAY,OACZC,EAAiB,OACjBC,EAAkB,OAClBC,EAAyB,OACzBC,EAAkB,OAClBC,EAAkB,OAClBC,EAAmB,OACnBC,EAAmB,OACnBC,EAAoB,OACpBC,EAAoB,OACpBC,EAAgCZ,EAA2BC,EAAiBrS,OAE5EiT,EAAazS,OAAOoG,UAAUM,SAElC,SAASgM,EAAeC,GAEpB,IAEInS,EAEAoS,EAAUC,EAAUC,EAAUC,EAJ9BC,EAAyC,IAA1BL,EAAiBnT,OAChCiE,EAAMkP,EAAiBnT,OAEvByT,EAAI,EAG8C,MAAlDN,EAAiBA,EAAiBnT,OAAS,KAC3CwT,IACsD,MAAlDL,EAAiBA,EAAiBnT,OAAS,IAC3CwT,KAIR,IAAIE,EAAS,IAAIvJ,YAAYqJ,GACzBG,EAAQ,IAAItJ,WAAWqJ,GAE3B,IAAK1S,EAAI,EAAGA,EAAIiD,EAAKjD,GAAK,EACtBoS,EAAWnB,EAAWjC,QAAQmD,EAAiBnS,IAC/CqS,EAAWpB,EAAWjC,QAAQmD,EAAiBnS,EAAI,IACnDsS,EAAWrB,EAAWjC,QAAQmD,EAAiBnS,EAAI,IACnDuS,EAAWtB,EAAWjC,QAAQmD,EAAiBnS,EAAI,IAGnD2S,EAAMF,KAAOL,GAAY,EAAIC,GAAY,EACzCM,EAAMF,MAAmB,GAAXJ,IAAkB,EAAIC,GAAY,EAChDK,EAAMF,MAAmB,EAAXH,IAAiB,EAAe,GAAXC,EAEvC,OAAOG,EAKX,SAASE,EAAeF,GAEpB,IAEI1S,EAFA2S,EAAQ,IAAItJ,WAAWqJ,GACvBG,EAAe,GAGnB,IAAK7S,EAAI,EAAGA,EAAI2S,EAAM3T,OAAQgB,GAAK,EAE/B6S,GAAgB5B,EAAW0B,EAAM3S,IAAM,GACvC6S,GAAgB5B,GAAuB,EAAX0B,EAAM3S,KAAW,EAAI2S,EAAM3S,EAAI,IAAM,GACjE6S,GAAgB5B,GAA2B,GAAf0B,EAAM3S,EAAI,KAAY,EAAI2S,EAAM3S,EAAI,IAAM,GACtE6S,GAAgB5B,EAA0B,GAAf0B,EAAM3S,EAAI,IASzC,OANI2S,EAAM3T,OAAS,GAAM,EACrB6T,EAAeA,EAAaC,UAAU,EAAGD,EAAa7T,OAAS,GAAK,IAC7D2T,EAAM3T,OAAS,GAAM,IAC5B6T,EAAeA,EAAaC,UAAU,EAAGD,EAAa7T,OAAS,GAAK,MAGjE6T,EAyIX,IAAIE,EAAwB,CACxBC,UApIJ,SAAmB1U,EAAO4J,GACtB,IAAI+K,EAAY,GAShB,GARI3U,IACA2U,EAAYhB,EAAWlR,KAAKzC,IAO5BA,IAAwB,yBAAd2U,GAAwC3U,EAAMoU,QAA4C,yBAAlCT,EAAWlR,KAAKzC,EAAMoU,SAAqC,CAG7H,IAAIA,EACAQ,EAAS/B,EAET7S,aAAiB6K,aACjBuJ,EAASpU,EACT4U,GAAU7B,IAEVqB,EAASpU,EAAMoU,OAEG,uBAAdO,EACAC,GAAU3B,EACW,wBAAd0B,EACPC,GAAU1B,EACW,+BAAdyB,EACPC,GAAUzB,EACW,wBAAdwB,EACPC,GAAUxB,EACW,yBAAduB,EACPC,GAAUtB,EACW,wBAAdqB,EACPC,GAAUvB,EACW,yBAAdsB,EACPC,GAAUrB,EACW,0BAAdoB,EACPC,GAAUpB,EACW,0BAAdmB,EACPC,GAAUnB,EAEV7J,EAAS,IAAIrH,MAAM,wCAI3BqH,EAASgL,EAASN,EAAeF,SAC9B,GAAkB,kBAAdO,EAA+B,CAEtC,IAAIE,EAAa,IAAIvD,WAErBuD,EAAWC,OAAS,WAEhB,IAAIC,EAtIO,uBAsIkB/U,EAAMF,KAAO,IAAMwU,EAAezP,KAAKqC,QAEpE0C,EAASiJ,gBAAgCkC,IAG7CF,EAAWG,kBAAkBhV,QAE7B,IACI4J,EAASqL,KAAKC,UAAUlV,IAC1B,MAAOgC,GACLiI,QAAQzC,MAAM,8CAA+CxH,GAE7D4J,EAAS,KAAM5H,KAqEvBmT,YAxDJ,SAAqBnV,GAIjB,GAAIA,EAAMwU,UAAU,EAAG1B,KAA8BD,EACjD,OAAOoC,KAAKG,MAAMpV,GAMtB,IAGIqV,EAHAxB,EAAmB7T,EAAMwU,UAAUd,GACnC5T,EAAOE,EAAMwU,UAAU1B,EAA0BY,GAKrD,GAAI5T,IAASkT,GAAaJ,EAAuBtC,KAAKuD,GAAmB,CACrE,IAAIyB,EAAUzB,EAAiB/H,MAAM8G,GACrCyC,EAAWC,EAAQ,GACnBzB,EAAmBA,EAAiBW,UAAUc,EAAQ,GAAG5U,QAE7D,IAAI0T,EAASR,EAAeC,GAI5B,OAAQ/T,GACJ,KAAKiT,EACD,OAAOqB,EACX,KAAKpB,EACD,OAAOlK,EAAW,CAACsL,GAAS,CAAEtU,KAAMuV,IACxC,KAAKpC,EACD,OAAO,IAAIsC,UAAUnB,GACzB,KAAKlB,EACD,OAAO,IAAInI,WAAWqJ,GAC1B,KAAKjB,EACD,OAAO,IAAIqC,kBAAkBpB,GACjC,KAAKhB,EACD,OAAO,IAAIqC,WAAWrB,GAC1B,KAAKd,EACD,OAAO,IAAIoC,YAAYtB,GAC3B,KAAKf,EACD,OAAO,IAAIsC,WAAWvB,GAC1B,KAAKb,EACD,OAAO,IAAIqC,YAAYxB,GAC3B,KAAKZ,EACD,OAAO,IAAIqC,aAAazB,GAC5B,KAAKX,EACD,OAAO,IAAIqC,aAAa1B,GAC5B,QACI,MAAM,IAAI7R,MAAM,gBAAkBzC,KAO1C8T,eAAgBA,EAChBU,eAAgBA,GAapB,SAASyB,EAAc9T,EAAGkK,EAAQvC,EAAUE,GACxC7H,EAAE+T,WAAW,8BAAgC7J,EAAOoB,UAAvC,+CAAwG,GAAI3D,EAAUE,GAyCvI,SAASmM,EAAchU,EAAGkK,EAAQ+J,EAAcC,EAAMvM,EAAUE,GAC5D7H,EAAE+T,WAAWE,EAAcC,EAAMvM,GAAU,SAAU3H,EAAGuF,GAChDA,EAAMhF,OAASgF,EAAM4O,WACrBnU,EAAE+T,WAAW,iEAAuE,CAAC7J,EAAOoB,YAAY,SAAUtL,EAAGoU,GAC5GA,EAAQC,KAAK5V,OAOdoJ,EAAc7H,EAAGuF,GAJjBuO,EAAc9T,EAAGkK,GAAQ,WACrBlK,EAAE+T,WAAWE,EAAcC,EAAMvM,EAAUE,KAC5CA,KAIRA,GAEHA,EAAc7H,EAAGuF,KAEtBsC,GA6EP,SAASyM,EAASvM,EAAKhK,EAAO4J,EAAU4M,GACpC,IAAIzR,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,gBAIAwI,IAAVpP,IACAA,EAAQ,MAIZ,IAAIyW,EAAgBzW,EAEhBmM,EAASpH,EAAKiK,QAClB7C,EAAOuK,WAAWhC,UAAU1U,GAAO,SAAUA,EAAOwH,GAC5CA,EACAhB,EAAOgB,GAEP2E,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5BgU,EAAchU,EAAGkK,EAAQ,0BAA4BA,EAAOoB,UAAnC,8BAAmF,CAACvD,EAAKhK,IAAQ,WACtHyG,EAAQgQ,MACT,SAAUxU,EAAGuF,GACZhB,EAAOgB,SAEZ,SAAUmP,GAGT,GAAIA,EAASnU,OAASmU,EAASC,UAAW,CAQtC,GAAIJ,EAAc,EAEd,YADA/P,EAAQ8P,EAAS1P,MAAM9B,EAAM,CAACiF,EAAKyM,EAAe7M,EAAU4M,EAAc,KAG9EhQ,EAAOmQ,aAKjB,MAAEnQ,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,EAmIX,SAAS+Q,GAAiB9J,GACtB,OAAO,IAAIrD,GAAU,SAAUjD,EAASD,GACpCuG,EAAG5B,aAAY,SAAUlJ,GACrBA,EAAE+T,WAAW,8FAAoG,IAAI,SAAU/T,EAAGoU,GAG9H,IAFA,IAAIS,EAAa,GAERpV,EAAI,EAAGA,EAAI2U,EAAQC,KAAK5V,OAAQgB,IACrCoV,EAAWlW,KAAKyV,EAAQC,KAAKS,KAAKrV,GAAGwH,MAGzCzC,EAAQ,CACJsG,GAAIA,EACJ+J,WAAYA,OAEjB,SAAU7U,EAAGuF,GACZhB,EAAOgB,SAEZ,SAAUmP,GACTnQ,EAAOmQ,SAwEnB,IAAIK,GAAgB,CAChBvH,QAAS,gBACTC,aArZJ,SAAwBC,GACpB,IAAI5K,EAAOF,KACPsH,EAAS,CACTY,GAAI,MAGR,GAAI4C,EACA,IAAK,IAAIjO,KAAKiO,EACVxD,EAAOzK,GAA2B,iBAAfiO,EAAQjO,GAAkBiO,EAAQjO,GAAGkG,WAAa+H,EAAQjO,GAIrF,IAAIuV,EAAgB,IAAIvN,GAAU,SAAUjD,EAASD,GAGjD,IACI2F,EAAOY,GAAKsD,aAAalE,EAAOjD,KAAMiB,OAAOgC,EAAOe,SAAUf,EAAO+K,YAAa/K,EAAOgL,MAC3F,MAAOnV,GACL,OAAOwE,EAAOxE,GAIlBmK,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5B8T,EAAc9T,EAAGkK,GAAQ,WACrBpH,EAAKiK,QAAU7C,EACf1F,OACD,SAAUxE,EAAGuF,GACZhB,EAAOgB,QAEZhB,MAIP,OADA2F,EAAOuK,WAAajC,EACbwC,GAqXP9G,SA1oB+B,mBAAjBE,aA2oBdQ,QAjUJ,SAAmBvI,EAAUsB,GACzB,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACd,IAAIuF,EAASpH,EAAKiK,QAElB7C,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5BgU,EAAchU,EAAGkK,EAAQ,iBAAmBA,EAAOoB,UAAW,IAAI,SAAUtL,EAAGoU,GAI3E,IAHA,IAAIC,EAAOD,EAAQC,KACf5V,EAAS4V,EAAK5V,OAETgB,EAAI,EAAGA,EAAIhB,EAAQgB,IAAK,CAC7B,IAAIqV,EAAOT,EAAKS,KAAKrV,GACjBwF,EAAS6P,EAAK/W,MAYlB,GARIkH,IACAA,EAASiF,EAAOuK,WAAWvB,YAAYjO,SAO5B,KAJfA,EAASoB,EAASpB,EAAQ6P,EAAK/M,IAAKtI,EAAI,IAMpC,YADA+E,EAAQS,GAKhBT,OACD,SAAUxE,EAAGuF,GACZhB,EAAOgB,YAGT,MAAEhB,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GAyRPoL,QAhWJ,SAAmBlH,EAAKJ,GACpB,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACd,IAAIuF,EAASpH,EAAKiK,QAClB7C,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5BgU,EAAchU,EAAGkK,EAAQ,iBAAmBA,EAAOoB,UAAY,yBAA0B,CAACvD,IAAM,SAAU/H,EAAGoU,GACzG,IAAInP,EAASmP,EAAQC,KAAK5V,OAAS2V,EAAQC,KAAKS,KAAK,GAAG/W,MAAQ,KAI5DkH,IACAA,EAASiF,EAAOuK,WAAWvB,YAAYjO,IAG3CT,EAAQS,MACT,SAAUjF,EAAGuF,GACZhB,EAAOgB,YAGT,MAAEhB,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GAsUPqL,QAhOJ,SAAmBnH,EAAKhK,EAAO4J,GAC3B,OAAO2M,EAAS1P,MAAMhC,KAAM,CAACmF,EAAKhK,EAAO4J,EAAU,KAgOnDgI,WA7NJ,SAAsB5H,EAAKJ,GACvB,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACd,IAAIuF,EAASpH,EAAKiK,QAClB7C,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5BgU,EAAchU,EAAGkK,EAAQ,eAAiBA,EAAOoB,UAAY,iBAAkB,CAACvD,IAAM,WAClFvD,OACD,SAAUxE,EAAGuF,GACZhB,EAAOgB,YAGT,MAAEhB,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GA2MP+L,MAtMJ,SAAiBjI,GACb,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACd,IAAIuF,EAASpH,EAAKiK,QAClB7C,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5BgU,EAAchU,EAAGkK,EAAQ,eAAiBA,EAAOoB,UAAW,IAAI,WAC5D9G,OACD,SAAUxE,EAAGuF,GACZhB,EAAOgB,YAGT,MAAEhB,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GAsLPpF,OAjLJ,SAAkBkJ,GACd,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACd,IAAIuF,EAASpH,EAAKiK,QAClB7C,EAAOY,GAAG5B,aAAY,SAAUlJ,GAE5BgU,EAAchU,EAAGkK,EAAQ,+BAAiCA,EAAOoB,UAAW,IAAI,SAAUtL,EAAGoU,GACzF,IAAInP,EAASmP,EAAQC,KAAKS,KAAK,GAAGhW,EAClC0F,EAAQS,MACT,SAAUjF,EAAGuF,GACZhB,EAAOgB,YAGT,MAAEhB,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GA+JPkE,IArJJ,SAAe9H,EAAG0H,GACd,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACd,IAAIuF,EAASpH,EAAKiK,QAClB7C,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5BgU,EAAchU,EAAGkK,EAAQ,mBAAqBA,EAAOoB,UAAY,wBAAyB,CAACrL,EAAI,IAAI,SAAUD,EAAGoU,GAC5G,IAAInP,EAASmP,EAAQC,KAAK5V,OAAS2V,EAAQC,KAAKS,KAAK,GAAG/M,IAAM,KAC9DvD,EAAQS,MACT,SAAUjF,EAAGuF,GACZhB,EAAOgB,YAGT,MAAEhB,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GAoIPoM,KAjIJ,SAAgBtI,GACZ,IAAI7E,EAAOF,KAEPiB,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3CzB,EAAK6K,QAAQhJ,MAAK,WACd,IAAIuF,EAASpH,EAAKiK,QAClB7C,EAAOY,GAAG5B,aAAY,SAAUlJ,GAC5BgU,EAAchU,EAAGkK,EAAQ,mBAAqBA,EAAOoB,UAAW,IAAI,SAAUtL,EAAGoU,GAG7E,IAFA,IAAInE,EAAO,GAEFxQ,EAAI,EAAGA,EAAI2U,EAAQC,KAAK5V,OAAQgB,IACrCwQ,EAAKtR,KAAKyV,EAAQC,KAAKS,KAAKrV,GAAGsI,KAGnCvD,EAAQyL,MACT,SAAUjQ,EAAGuF,GACZhB,EAAOgB,YAGT,MAAEhB,MAIhB,OADAmD,EAAgB7D,EAAS8D,GAClB9D,GA2GPqM,aA/EJ,SAAwBxC,EAAS/F,GAC7BA,EAAWQ,EAAYvD,MAAMhC,KAAMiC,WAEnC,IAAIsL,EAAgBvN,KAAKwN,UACzB1C,EAA6B,mBAAZA,GAA0BA,GAAW,IACzCzG,OACTyG,EAAQzG,KAAOyG,EAAQzG,MAAQkJ,EAAclJ,KAC7CyG,EAAQpC,UAAYoC,EAAQpC,WAAa6E,EAAc7E,WAG3D,IACIzH,EADAf,EAAOF,KAsDX,OADA8E,EAhDI7D,EAHC6J,EAAQzG,KAGC,IAAIQ,GAAU,SAAUjD,GAC9B,IAAIsG,EAGAA,EAFA4C,EAAQzG,OAASkJ,EAAclJ,KAE1BnE,EAAKiK,QAAQjC,GAEbsD,aAAaV,EAAQzG,KAAM,GAAI,GAAI,GAGvCyG,EAAQpC,UAIT9G,EAAQ,CACJsG,GAAIA,EACJ+J,WAAY,CAACnH,EAAQpC,aAJzB9G,EAAQoQ,GAAiB9J,OAO9BnG,MAAK,SAAUwQ,GACd,OAAO,IAAI1N,GAAU,SAAUjD,EAASD,GACpC4Q,EAAcrK,GAAG5B,aAAY,SAAUlJ,GACnC,SAASoV,EAAU9J,GACf,OAAO,IAAI7D,GAAU,SAAUjD,EAASD,GACpCvE,EAAE+T,WAAW,wBAA0BzI,EAAW,IAAI,WAClD9G,OACD,SAAUxE,EAAGuF,GACZhB,EAAOgB,SAMnB,IADA,IAAI8P,EAAa,GACR5V,EAAI,EAAGiD,EAAMyS,EAAcN,WAAWpW,OAAQgB,EAAIiD,EAAKjD,IAC5D4V,EAAW1W,KAAKyW,EAAUD,EAAcN,WAAWpV,KAGvDgI,EAAUhC,IAAI4P,GAAY1Q,MAAK,WAC3BH,OACM,OAAE,SAAUzE,GAClBwE,EAAOxE,SAEZ,SAAU2U,GACTnQ,EAAOmQ,YA5CTjN,EAAUlD,OAAO,qBAkDNoD,GAClB9D,IA4BX,SAASyR,GAAc5H,EAAS6H,GAC5B,IAAIC,EAAY9H,EAAQzG,KAAO,IAK/B,OAHIyG,EAAQpC,YAAciK,EAAcjK,YACpCkK,GAAa9H,EAAQpC,UAAY,KAE9BkK,EAqBX,SAASC,KACL,OAlBJ,WACI,IAAIC,EAAsB,4BAE1B,IAII,OAHAC,aAAazG,QAAQwG,GAAqB,GAC1CC,aAAahG,WAAW+F,IAEjB,EACT,MAAO3V,GACL,OAAO,GASH6V,IAA+BD,aAAalX,OAAS,EA6QjE,IAAIoX,GAAsB,CACtBrI,QAAS,sBACTC,aA3QJ,SAAwBC,GACpB,IACIxD,EAAS,GACb,GAAIwD,EACA,IAAK,IAAIjO,KAAKiO,EACVxD,EAAOzK,GAAKiO,EAAQjO,GAM5B,OAFAyK,EAAOsL,UAAYF,GAAc5H,EARtB9K,KAQoCoL,gBAE1CyH,MAVM7S,KAcNmK,QAAU7C,EACfA,EAAOuK,WAAajC,EAEb/K,EAAUjD,WANNiD,EAAUlD,UAgQrB2J,SAtTJ,WACI,IACI,MAA+B,oBAAjByH,cAAgC,YAAaA,gBAEzDA,aAAazG,QACjB,MAAOnP,GACL,OAAO,GAgTD+V,GACVlH,QAxMJ,SAAmBvI,EAAUsB,GACzB,IAAI7E,EAAOF,KAEPiB,EAAUf,EAAK6K,QAAQhJ,MAAK,WAc5B,IAbA,IAAIuF,EAASpH,EAAKiK,QACdyI,EAAYtL,EAAOsL,UACnBO,EAAkBP,EAAU/W,OAC5BA,EAASkX,aAAalX,OAQtBsQ,EAAkB,EAEbtP,EAAI,EAAGA,EAAIhB,EAAQgB,IAAK,CAC7B,IAAIsI,EAAM4N,aAAa5N,IAAItI,GAC3B,GAA+B,IAA3BsI,EAAI0G,QAAQ+G,GAAhB,CAGA,IAAIzX,EAAQ4X,aAAa1G,QAAQlH,GAYjC,GANIhK,IACAA,EAAQmM,EAAOuK,WAAWvB,YAAYnV,SAK5B,KAFdA,EAAQsI,EAAStI,EAAOgK,EAAIwK,UAAUwD,GAAkBhH,MAGpD,OAAOhR,OAMnB,OADA2J,EAAgB7D,EAAS8D,GAClB9D,GAgKPoL,QAlOJ,SAAmBlH,EAAKJ,GACpB,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAUf,EAAK6K,QAAQhJ,MAAK,WAC5B,IAAIuF,EAASpH,EAAKiK,QACd9H,EAAS0Q,aAAa1G,QAAQ/E,EAAOsL,UAAYzN,GAUrD,OAJI9C,IACAA,EAASiF,EAAOuK,WAAWvB,YAAYjO,IAGpCA,KAIX,OADAyC,EAAgB7D,EAAS8D,GAClB9D,GA8MPqL,QAnFJ,SAAmBnH,EAAKhK,EAAO4J,GAC3B,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAUf,EAAK6K,QAAQhJ,MAAK,gBAGdwI,IAAVpP,IACAA,EAAQ,MAIZ,IAAIyW,EAAgBzW,EAEpB,OAAO,IAAI0J,GAAU,SAAUjD,EAASD,GACpC,IAAI2F,EAASpH,EAAKiK,QAClB7C,EAAOuK,WAAWhC,UAAU1U,GAAO,SAAUA,EAAOwH,GAChD,GAAIA,EACAhB,EAAOgB,QAEP,IACIoQ,aAAazG,QAAQhF,EAAOsL,UAAYzN,EAAKhK,GAC7CyG,EAAQgQ,GACV,MAAOzU,GAGU,uBAAXA,EAAEkH,MAA4C,+BAAXlH,EAAEkH,MACrC1C,EAAOxE,GAEXwE,EAAOxE,aAQ3B,OADA2H,EAAgB7D,EAAS8D,GAClB9D,GA8CP8L,WAtGJ,SAAsB5H,EAAKJ,GACvB,IAAI7E,EAAOF,KAEXmF,EAAMD,EAAaC,GAEnB,IAAIlE,EAAUf,EAAK6K,QAAQhJ,MAAK,WAC5B,IAAIuF,EAASpH,EAAKiK,QAClB4I,aAAahG,WAAWzF,EAAOsL,UAAYzN,MAI/C,OADAL,EAAgB7D,EAAS8D,GAClB9D,GA4FP+L,MA1PJ,SAAiBjI,GACb,IAAI7E,EAAOF,KACPiB,EAAUf,EAAK6K,QAAQhJ,MAAK,WAG5B,IAFA,IAAI6Q,EAAY1S,EAAKiK,QAAQyI,UAEpB/V,EAAIkW,aAAalX,OAAS,EAAGgB,GAAK,EAAGA,IAAK,CAC/C,IAAIsI,EAAM4N,aAAa5N,IAAItI,GAEI,IAA3BsI,EAAI0G,QAAQ+G,IACZG,aAAahG,WAAW5H,OAMpC,OADAL,EAAgB7D,EAAS8D,GAClB9D,GA4OPpF,OAnHJ,SAAkBkJ,GACd,IACI9D,EADOjB,KACQqN,OAAOtL,MAAK,SAAUsL,GACrC,OAAOA,EAAKxR,UAIhB,OADAiJ,EAAgB7D,EAAS8D,GAClB9D,GA6GPkE,IAjKJ,SAAe9H,EAAG0H,GACd,IAAI7E,EAAOF,KACPiB,EAAUf,EAAK6K,QAAQhJ,MAAK,WAC5B,IACIM,EADAiF,EAASpH,EAAKiK,QAElB,IACI9H,EAAS0Q,aAAa5N,IAAI9H,GAC5B,MAAOsF,GACLN,EAAS,KAQb,OAJIA,IACAA,EAASA,EAAOsN,UAAUrI,EAAOsL,UAAU/W,SAGxCwG,KAIX,OADAyC,EAAgB7D,EAAS8D,GAClB9D,GA8IPoM,KA3IJ,SAAgBtI,GACZ,IAAI7E,EAAOF,KACPiB,EAAUf,EAAK6K,QAAQhJ,MAAK,WAK5B,IAJA,IAAIuF,EAASpH,EAAKiK,QACdtO,EAASkX,aAAalX,OACtBwR,EAAO,GAEFxQ,EAAI,EAAGA,EAAIhB,EAAQgB,IAAK,CAC7B,IAAIuW,EAAUL,aAAa5N,IAAItI,GACW,IAAtCuW,EAAQvH,QAAQvE,EAAOsL,YACvBvF,EAAKtR,KAAKqX,EAAQzD,UAAUrI,EAAOsL,UAAU/W,SAIrD,OAAOwR,KAIX,OADAvI,EAAgB7D,EAAS8D,GAClB9D,GA0HPqM,aAhDJ,SAAwBxC,EAAS/F,GAI7B,GAHAA,EAAWQ,EAAYvD,MAAMhC,KAAMiC,aAEnC6I,EAA6B,mBAAZA,GAA0BA,GAAW,IACzCzG,KAAM,CACf,IAAIkJ,EAAgBvN,KAAKwN,SACzB1C,EAAQzG,KAAOyG,EAAQzG,MAAQkJ,EAAclJ,KAC7CyG,EAAQpC,UAAYoC,EAAQpC,WAAa6E,EAAc7E,UAG3D,IACIzH,EADAf,EAAOF,KAuBX,OADA8E,EAjBI7D,EAHC6J,EAAQzG,KAGC,IAAIQ,GAAU,SAAUjD,GACzBkJ,EAAQpC,UAGT9G,EAAQ8Q,GAAc5H,EAAS5K,EAAKkL,iBAFpCxJ,EAAQkJ,EAAQzG,KAAO,QAI5BtC,MAAK,SAAU6Q,GACd,IAAK,IAAI/V,EAAIkW,aAAalX,OAAS,EAAGgB,GAAK,EAAGA,IAAK,CAC/C,IAAIsI,EAAM4N,aAAa5N,IAAItI,GAEI,IAA3BsI,EAAI0G,QAAQ+G,IACZG,aAAahG,WAAW5H,OAb1BN,EAAUlD,OAAO,qBAmBNoD,GAClB9D,IAsBPoS,GAAW,SAAkBC,EAAOC,GAGpC,IAFA,IAAIzT,EAAMwT,EAAMzX,OACZgB,EAAI,EACDA,EAAIiD,GAAK,CACZ,IAR2B0T,EAQbF,EAAMzW,OARU4W,EAQNF,IAPG,iBAANC,GAA+B,iBAANC,GAAkBC,MAAMF,IAAME,MAAMD,GAQ9E,OAAO,EAEX5W,IAXQ,IAAmB2W,EAAGC,EAclC,OAAO,GAGPE,GAAU1Q,MAAM0Q,SAAW,SAAUC,GACrC,MAA+C,mBAAxCvX,OAAOoG,UAAUM,SAASnF,KAAKgW,IAKtCC,GAAiB,GAEjBC,GAAgB,GAEhBC,GAAiB,CACjBC,UAAWrJ,EACXsJ,OAAQ9B,GACR+B,aAAcjB,IAGdkB,GAAqB,CAACJ,GAAeC,UAAUpJ,QAASmJ,GAAeE,OAAOrJ,QAASmJ,GAAeG,aAAatJ,SAEnHwJ,GAAwB,CAAC,gBAEzBC,GAAiB,CAAC,QAAS,UAAW,UAAW,MAAO,OAAQ,SAAU,aAAc,WAAWC,OAAOF,IAE1GG,GAAgB,CAChBlC,YAAa,GACbmC,OAAQL,GAAmBhJ,QAC3B9G,KAAM,cAGNiO,KAAM,QACN5J,UAAW,gBACXL,QAAS,GAGb,SAASoM,GAAcC,EAAqBC,GACxCD,EAAoBC,GAAiB,WACjC,IAAIC,EAAQ3S,UACZ,OAAOyS,EAAoB3J,QAAQhJ,MAAK,WACpC,OAAO2S,EAAoBC,GAAe3S,MAAM0S,EAAqBE,OAKjF,SAASC,KACL,IAAK,IAAIhY,EAAI,EAAGA,EAAIoF,UAAUpG,OAAQgB,IAAK,CACvC,IAAI+W,EAAM3R,UAAUpF,GAEpB,GAAI+W,EACA,IAAK,IAAIkB,KAAQlB,EACTA,EAAImB,eAAeD,KACfnB,GAAQC,EAAIkB,IACZ7S,UAAU,GAAG6S,GAAQlB,EAAIkB,GAAM3J,QAE/BlJ,UAAU,GAAG6S,GAAQlB,EAAIkB,IAO7C,OAAO7S,UAAU,GAGrB,IA4SI+S,GAAiB,IA5SH,WACd,SAASC,EAAYnK,GAGjB,IAAK,IAAIoK,KAvnEjB,SAAyBC,EAAUC,GAAe,KAAMD,aAAoBC,GAAgB,MAAM,IAAIxU,UAAU,qCAqnExGyU,CAAgBrV,KAAMiV,GAEIlB,GACtB,GAAIA,GAAegB,eAAeG,GAAgB,CAC9C,IAAIV,EAAST,GAAemB,GACxBI,EAAad,EAAO5J,QACxB5K,KAAKkV,GAAiBI,EAEjBzB,GAAeyB,IAIhBtV,KAAKuV,aAAaf,GAK9BxU,KAAKoL,eAAiByJ,GAAO,GAAIN,IACjCvU,KAAKwV,QAAUX,GAAO,GAAI7U,KAAKoL,eAAgBN,GAC/C9K,KAAKyV,WAAa,KAClBzV,KAAK0V,YAAc,KACnB1V,KAAK2V,QAAS,EACd3V,KAAKmK,QAAU,KAEfnK,KAAK4V,+BACL5V,KAAK6V,UAAU7V,KAAKwV,QAAQhB,QAAe,OAAE,eA0QjD,OAjQAS,EAAYxS,UAAU+K,OAAS,SAAgB1C,GAI3C,GAA0E,iBAAlD,IAAZA,EAA0B,YAAcvH,EAAQuH,IAAwB,CAGhF,GAAI9K,KAAK2V,OACL,OAAO,IAAIjY,MAAM,wDAGrB,IAAK,IAAIb,KAAKiO,EAAS,CAKnB,GAJU,cAANjO,IACAiO,EAAQjO,GAAKiO,EAAQjO,GAAGiZ,QAAQ,MAAO,MAGjC,YAANjZ,GAAyC,iBAAfiO,EAAQjO,GAClC,OAAO,IAAIa,MAAM,sCAGrBsC,KAAKwV,QAAQ3Y,GAAKiO,EAAQjO,GAK9B,QAAI,WAAYiO,KAAWA,EAAQ0J,QACxBxU,KAAK6V,UAAU7V,KAAKwV,QAAQhB,QAIpC,MAAuB,iBAAZ1J,EACP9K,KAAKwV,QAAQ1K,GAEb9K,KAAKwV,SAQpBP,EAAYxS,UAAU8S,aAAe,SAAsBQ,EAAchR,EAAUE,GAC/E,IAAIhE,EAAU,IAAI4D,GAAU,SAAUjD,EAASD,GAC3C,IACI,IAAI2T,EAAaS,EAAanL,QAC1BoL,EAAkB,IAAItY,MAAM,wFAIhC,IAAKqY,EAAanL,QAEd,YADAjJ,EAAOqU,GAKX,IADA,IAAIC,EAAgB5B,GAAeC,OAAO,gBACjCzX,EAAI,EAAGiD,EAAMmW,EAAcpa,OAAQgB,EAAIiD,EAAKjD,IAAK,CACtD,IAAIqZ,EAAmBD,EAAcpZ,GAKrC,KADkBwW,GAASe,GAAuB8B,IAC/BH,EAAaG,KAAgE,mBAAnCH,EAAaG,GAEtE,YADAvU,EAAOqU,IAKe,WAU1B,IATA,IAAIG,EAA8B,SAAqCC,GACnE,OAAO,WACH,IAAIzT,EAAQ,IAAIjF,MAAM,UAAY0Y,EAAa,6CAC3CnV,EAAU4D,EAAUlD,OAAOgB,GAE/B,OADAmC,EAAgB7D,EAASgB,UAAUA,UAAUpG,OAAS,IAC/CoF,IAINoV,EAAK,EAAGC,EAAOlC,GAAsBvY,OAAQwa,EAAKC,EAAMD,IAAM,CACnE,IAAIE,EAAuBnC,GAAsBiC,GAC5CN,EAAaQ,KACdR,EAAaQ,GAAwBJ,EAA4BI,KAK7EC,GAEA,IAAIC,EAAmB,SAA0BC,GACzC7C,GAAeyB,IACflQ,QAAQuR,KAAK,kCAAoCrB,GAErDzB,GAAeyB,GAAcS,EAC7BjC,GAAcwB,GAAcoB,EAI5B9U,KAGA,aAAcmU,EACVA,EAAazK,UAA6C,mBAA1ByK,EAAazK,SAC7CyK,EAAazK,WAAWvJ,KAAK0U,EAAkB9U,GAE/C8U,IAAmBV,EAAazK,UAGpCmL,GAAiB,GAEvB,MAAOtZ,GACLwE,EAAOxE,OAKf,OADA6H,EAAoB/D,EAAS8D,EAAUE,GAChChE,GAGXgU,EAAYxS,UAAU+R,OAAS,WAC3B,OAAOxU,KAAK4K,SAAW,MAG3BqK,EAAYxS,UAAUmU,UAAY,SAAmBtB,EAAYvQ,EAAUE,GACvE,IAAI4R,EAAmBhD,GAAeyB,GAAczQ,EAAUjD,QAAQiS,GAAeyB,IAAezQ,EAAUlD,OAAO,IAAIjE,MAAM,sBAG/H,OADAsH,EAAoB6R,EAAkB9R,EAAUE,GACzC4R,GAGX5B,EAAYxS,UAAUqU,cAAgB,SAAuB/R,GACzD,IAAIgS,EAAoBlS,EAAUjD,QAAQgO,GAE1C,OADA5K,EAAoB+R,EAAmBhS,GAChCgS,GAGX9B,EAAYxS,UAAUsI,MAAQ,SAAehG,GACzC,IAAI7E,EAAOF,KAEPiB,EAAUf,EAAKuV,WAAW1T,MAAK,WAK/B,OAJoB,OAAhB7B,EAAKyV,SACLzV,EAAKyV,OAASzV,EAAKwV,eAGhBxV,EAAKyV,UAIhB,OADA3Q,EAAoB/D,EAAS8D,EAAUA,GAChC9D,GAGXgU,EAAYxS,UAAUoT,UAAY,SAAmBmB,EAASjS,EAAUE,GACpE,IAAI/E,EAAOF,KAEN2T,GAAQqD,KACTA,EAAU,CAACA,IAGf,IAAIC,EAAmBjX,KAAKkX,qBAAqBF,GAEjD,SAASG,IACLjX,EAAKsV,QAAQhB,OAAStU,EAAKsU,SAG/B,SAAS4C,EAAqB5C,GAK1B,OAJAtU,EAAKmX,QAAQ7C,GACb2C,IAEAjX,EAAKyV,OAASzV,EAAK2K,aAAa3K,EAAKsV,SAC9BtV,EAAKyV,OA+BhB,IAAI2B,EAAuC,OAApBtX,KAAKyV,WAAsBzV,KAAKyV,WAAkB,OAAE,WACvE,OAAO5Q,EAAUjD,aAChBiD,EAAUjD,UAqBf,OAnBA5B,KAAKyV,WAAa6B,EAAiBvV,MAAK,WACpC,IAAIuT,EAAa2B,EAAiB,GAIlC,OAHA/W,EAAKiK,QAAU,KACfjK,EAAKyV,OAAS,KAEPzV,EAAK0W,UAAUtB,GAAYvT,MAAK,SAAUyS,GAC7CtU,EAAK0K,QAAU4J,EAAO5J,QACtBuM,IACAjX,EAAK0V,+BACL1V,EAAKwV,YAzCb,SAAoBuB,GAChB,OAAO,WACH,IAAIM,EAAqB,EAmBzB,OAjBA,SAASC,IACL,KAAOD,EAAqBN,EAAiBpb,QAAQ,CACjD,IAAIyZ,EAAa2B,EAAiBM,GAMlC,OALAA,IAEArX,EAAKiK,QAAU,KACfjK,EAAKyV,OAAS,KAEPzV,EAAK0W,UAAUtB,GAAYvT,KAAKqV,GAA6B,MAAEI,GAG1EL,IACA,IAAIxU,EAAQ,IAAIjF,MAAM,sCAEtB,OADAwC,EAAKuV,WAAa5Q,EAAUlD,OAAOgB,GAC5BzC,EAAKuV,WAGT+B,IAoBYC,CAAWR,SAE5B,OAAE,WACRE,IACA,IAAIxU,EAAQ,IAAIjF,MAAM,sCAEtB,OADAwC,EAAKuV,WAAa5Q,EAAUlD,OAAOgB,GAC5BzC,EAAKuV,cAGhBzQ,EAAoBhF,KAAKyV,WAAY1Q,EAAUE,GACxCjF,KAAKyV,YAGhBR,EAAYxS,UAAUiV,SAAW,SAAkBpC,GAC/C,QAASxB,GAAcwB,IAG3BL,EAAYxS,UAAU4U,QAAU,SAAiBM,GAC7C9C,GAAO7U,KAAM2X,IAGjB1C,EAAYxS,UAAUyU,qBAAuB,SAA8BF,GAEvE,IADA,IAAIC,EAAmB,GACdpa,EAAI,EAAGiD,EAAMkX,EAAQnb,OAAQgB,EAAIiD,EAAKjD,IAAK,CAChD,IAAIyY,EAAa0B,EAAQna,GACrBmD,KAAK0X,SAASpC,IACd2B,EAAiBlb,KAAKuZ,GAG9B,OAAO2B,GAGXhC,EAAYxS,UAAUmT,6BAA+B,WAKjD,IAAK,IAAI/Y,EAAI,EAAGiD,EAAMuU,GAAexY,OAAQgB,EAAIiD,EAAKjD,IAClD4X,GAAczU,KAAMqU,GAAexX,KAI3CoY,EAAYxS,UAAUmV,eAAiB,SAAwB9M,GAC3D,OAAO,IAAImK,EAAYnK,IAGpBmK,EArSO,IA8SlB9a,EAAOC,QAAU4a,IAEf,CAAC,EAAI,KAAK,GAAG,CAAC,GAxvFmW,CAwvF/V,wBC9vFpB,aAEkB,0BAAd,EAMI,SAAU6C,GAChB,aAEA,IA4BIC,EAgGAC,EA9GAC,EAAW,CACbC,SAAU,WACVC,eAAgB,SAAUC,GACxB,OAAOA,EAAMC,eAEfC,cAAe,SAAUhU,GACvB,OAAOA,GAAQ,QAEjBiU,mBAAoB,SAAUC,GAC5B,OAAOA,EAAKC,eAAe1C,QAAQ,0BAA2B,OAEhE2C,YAAQlO,GAINmO,EAAU,GA0FVC,EAAM,CACRC,IAzFQ,SAAUC,GAClB,IAAKA,IAAeA,EAAWC,UAC7B,MAAM,IAAIlY,UAAU,iCAEtBkX,EAAWe,GAsFX7W,MAnFU,SAAU+W,EAAQvL,GAC5B,IAAKuL,IAAWA,EAAOC,SACrB,MAAM,IAAIpY,UAAU,4BAItB,IAAIqY,EAAkBF,EAAOG,cACzB7U,EAAO0U,EAAO1U,MAAQ,GACtB8U,EAAST,EAAQrU,IAASqU,EAAQ,KAAOV,EAsE7C,OAlBKU,EAAQrU,KACX0U,EAAOG,cAlDT,SAAuB9C,EAAYgD,EAAUC,GAC3C,IAAIC,EAAiBL,EAAgB7C,EAAYgD,EAAUC,GACvDvO,EAAU4N,EAAQW,IAAeX,EAAQ,IAEzCa,GAAmD,IAApCzO,EAAQmN,SAASpM,QAAQ,MACxC2N,GAA+C,IAApC1O,EAAQmN,SAASpM,QAAQ,MACpC4N,GAA8C,IAApC3O,EAAQmN,SAASpM,QAAQ,MAEvC,OAAO,WAML,IALA,IAAI6N,EAAU,GAEV7d,EAASoG,UAAUpG,OACnByV,EAAOrO,MAAMpH,GACbsJ,EAAM,EACHA,EAAMtJ,EAAQsJ,IACnBmM,EAAKnM,GAAOlD,UAAUkD,GAIxB,GAAId,IAASqU,EAAQW,GAAa,CAEhC,IAAIM,EAAY7O,EAAQwN,mBAAmB,IAAIsB,MAC3CzB,EAAQrN,EAAQoN,eAAe9B,GAC/ByD,EAAQ/O,EAAQuN,cAAcgB,GAG9BvO,EAAQ2N,OACViB,GAAW5O,EAAQ2N,OAAON,EAAO0B,EAAOF,IAExCD,GAAW5O,EAAQmN,SACfsB,IACFG,EAAUA,EAAQ5D,QAAQ,KAAM6D,IAE9BH,IAAUE,EAAUA,EAAQ5D,QAAQ,KAAMqC,IAC1CsB,IAASC,EAAUA,EAAQ5D,QAAQ,KAAM+D,KAG3CvI,EAAKzV,QAA6B,iBAAZyV,EAAK,GAE7BA,EAAK,GAAKoI,EAAU,IAAMpI,EAAK,GAE/BA,EAAKwI,QAAQJ,GAIjBJ,EAAetX,WAAMuI,EAAW+G,OASpC9D,EAASA,GAAU,IACRyK,WAAUzK,EAAOiL,YAASlO,GAErCmO,EAAQrU,GA1GE,SAAU4E,GAIpB,IAHA,IAEI9D,EAFAtI,EAAI,EACJhB,EAASoG,UAAUpG,OAEhBgB,EAAIhB,EAAQgB,IACjB,IAAKsI,KAAOlD,UAAUpF,GAChBR,OAAOoG,UAAUsS,eAAenX,KAAKqE,UAAUpF,GAAIsI,KACrD8D,EAAO9D,GAAOlD,UAAUpF,GAAGsI,IAIjC,OAAO8D,EA+FS8Q,CAAM,GAAIZ,EAAQ3L,GAElCuL,EAAOC,SAASD,EAAOiB,YAElBlC,GACHiB,EAAO1T,KACL,+NAIG0T,IAoBT,OAVIlB,IACFE,EAAOF,EAAKoC,OACZtB,EAAIuB,WAAa,WAIf,OAHIrC,EAAKoC,SAAWtB,IAClBd,EAAKoC,OAASlC,GAETY,IAIJA,IAjJS,uDCFlB,SAMC,SAAUd,EAAMsC,GACb,kBAEqB,0BAAjB,EAMA,WAIJ,IAAIC,EAAO,aACPC,EAAgB,YAChBC,SAAena,SAAWka,UAA0Bla,OAAO4G,YAAcsT,GACzE,kBAAkB5O,KAAKtL,OAAO4G,UAAUC,WAGxCuT,EAAa,CACb,QACA,QACA,OACA,OACA,SAIJ,SAASC,EAAW1Y,EAAKsU,GACrB,IAAIqE,EAAS3Y,EAAIsU,GACjB,GAA2B,mBAAhBqE,EAAO/d,KACd,OAAO+d,EAAO/d,KAAKoF,GAEnB,IACI,OAAO4Y,SAASjY,UAAU/F,KAAKkB,KAAK6c,EAAQ3Y,GAC9C,MAAO3E,GAEL,OAAO,WACH,OAAOud,SAASjY,UAAUT,MAAMA,MAAMyY,EAAQ,CAAC3Y,EAAKG,cAOpE,SAAS0Y,IACDvV,QAAQwV,MACJxV,QAAQwV,IAAI5Y,MACZoD,QAAQwV,IAAI5Y,MAAMoD,QAASnD,WAG3ByY,SAASjY,UAAUT,MAAMA,MAAMoD,QAAQwV,IAAK,CAACxV,QAASnD,aAG1DmD,QAAQyV,OAAOzV,QAAQyV,QAK/B,SAASC,EAAW1E,GAKhB,MAJmB,UAAfA,IACAA,EAAa,cAGNhR,UAAYiV,IAEG,UAAfjE,GAA0BkE,EAC1BK,OACwBpQ,IAAxBnF,QAAQgR,GACRoE,EAAWpV,QAASgR,QACJ7L,IAAhBnF,QAAQwV,IACRJ,EAAWpV,QAAS,OAEpBgV,GAMf,SAASW,EAAsB5C,EAAOkB,GAElC,IAAK,IAAIxc,EAAI,EAAGA,EAAI0d,EAAW1e,OAAQgB,IAAK,CACxC,IAAIuZ,EAAamE,EAAW1d,GAC5BmD,KAAKoW,GAAevZ,EAAIsb,EACpBiC,EACApa,KAAKkZ,cAAc9C,EAAY+B,EAAOkB,GAI9CrZ,KAAK4a,IAAM5a,KAAKgb,MAKpB,SAASC,EAAgC7E,EAAY+B,EAAOkB,GACxD,OAAO,kBACQjU,UAAYiV,IACnBU,EAAsBnd,KAAKoC,KAAMmY,EAAOkB,GACxCrZ,KAAKoW,GAAYpU,MAAMhC,KAAMiC,aAOzC,SAASiZ,EAAqB9E,EAAY+B,EAAOkB,GAE7C,OAAOyB,EAAW1E,IACX6E,EAAgCjZ,MAAMhC,KAAMiC,WAGvD,SAASkZ,EAAO9W,EAAM+W,EAAcC,GAClC,IACIC,EADApb,EAAOF,KAEXob,EAA+B,MAAhBA,EAAuB,OAASA,EAE/C,IAAIG,EAAa,WAyBjB,SAASC,IACL,IAAIC,EAEJ,UAAWtb,SAAWka,GAAkBkB,EAAxC,CAEA,IACIE,EAActb,OAAO4S,aAAawI,GACpC,MAAOG,IAGT,UAAWD,IAAgBpB,EACvB,IACI,IAAIsB,EAASxb,OAAO3B,SAASmd,OACzBC,EAAWD,EAAO9P,QAClBgQ,mBAAmBN,GAAc,MACnB,IAAdK,IACAH,EAAc,WAAWK,KAAKH,EAAOxQ,MAAMyQ,IAAW,IAE5D,MAAOF,IAQb,YAJiCnR,IAA7BrK,EAAK6b,OAAON,KACZA,OAAclR,GAGXkR,GAlDS,iBAATpX,EACTkX,GAAc,IAAMlX,EACK,iBAATA,IAChBkX,OAAahR,GAwEfrK,EAAKmE,KAAOA,EAEZnE,EAAK6b,OAAS,CAAE,MAAS,EAAG,MAAS,EAAG,KAAQ,EAAG,KAAQ,EACvD,MAAS,EAAG,OAAU,GAE1B7b,EAAKgZ,cAAgBmC,GAAWH,EAEhChb,EAAK8Z,SAAW,WACZ,OAAOsB,GAGXpb,EAAK8Y,SAAW,SAAUb,EAAO6D,GAI7B,GAHqB,iBAAV7D,QAA2D5N,IAArCrK,EAAK6b,OAAO5D,EAAMC,iBAC/CD,EAAQjY,EAAK6b,OAAO5D,EAAMC,kBAET,iBAAVD,GAAsBA,GAAS,GAAKA,GAASjY,EAAK6b,OAAOE,QAUhE,KAAM,6CAA+C9D,EAJrD,GALAmD,EAAenD,GACC,IAAZ6D,GAtFZ,SAAgCE,GAC5B,IAAIC,GAAa5B,EAAW2B,IAAa,UAAU9D,cAEnD,UAAWjY,SAAWka,GAAkBkB,EAAxC,CAGA,IAEI,YADApb,OAAO4S,aAAawI,GAAcY,GAEpC,MAAOT,IAGT,IACIvb,OAAO3B,SAASmd,OACdE,mBAAmBN,GAAc,IAAMY,EAAY,IACvD,MAAOT,MAwEDU,CAAuBjE,GAE3B4C,EAAsBnd,KAAKsC,EAAMiY,EAAO9T,UAC7Be,UAAYiV,GAAiBlC,EAAQjY,EAAK6b,OAAOE,OACxD,MAAO,oCAOnB/b,EAAKmc,gBAAkB,SAAUlE,GAC7BiD,EAAejD,EACVqD,KACDtb,EAAK8Y,SAASb,GAAO,IAI7BjY,EAAKoc,WAAa,WACdpc,EAAK8Y,SAASoC,GAAc,GA3DhC,WACI,UAAWjb,SAAWka,GAAkBkB,EAAxC,CAGA,IAEI,YADApb,OAAO4S,aAAahG,WAAWwO,GAEjC,MAAOG,IAGT,IACIvb,OAAO3B,SAASmd,OACdE,mBAAmBN,GAAc,2CACrC,MAAOG,MA+CTa,IAGJrc,EAAKsc,UAAY,SAASR,GACtB9b,EAAK8Y,SAAS9Y,EAAK6b,OAAOU,MAAOT,IAGrC9b,EAAKwc,WAAa,SAASV,GACvB9b,EAAK8Y,SAAS9Y,EAAK6b,OAAOE,OAAQD,IAItC,IAAIW,EAAenB,IACC,MAAhBmB,IACAA,EAAevB,GAEnBlb,EAAK8Y,SAAS2D,GAAc,GAS9B,IAAIC,EAAgB,IAAIzB,EAEpB0B,EAAiB,GACrBD,EAAc9D,UAAY,SAAmBzU,GACzC,GAAqB,iBAATA,GAAqC,iBAATA,GAA+B,KAATA,EAC5D,MAAM,IAAIzD,UAAU,kDAGtB,IAAImY,EAAS8D,EAAexY,GAK5B,OAJK0U,IACHA,EAAS8D,EAAexY,GAAQ,IAAI8W,EAClC9W,EAAMuY,EAAc5C,WAAY4C,EAAc1D,gBAE3CH,GAIX,IAAI+D,SAAe3c,SAAWka,EAAiBla,OAAOya,SAAMrQ,EAiB5D,OAhBAqS,EAAc1C,WAAa,WAMvB,cALW/Z,SAAWka,GACfla,OAAOya,MAAQgC,IAClBzc,OAAOya,IAAMkC,GAGVF,GAGXA,EAAcG,WAAa,WACvB,OAAOF,GAIXD,EAAuB,QAAIA,EAEpBA,IA9Rc,kCAHzB,KCLII,EAA2B,GAG/B,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqB3S,IAAjB4S,EACH,OAAOA,EAAa/iB,QAGrB,IAAID,EAAS6iB,EAAyBE,GAAY,CAGjD9iB,QAAS,IAOV,OAHAgjB,EAAoBF,GAAUtf,KAAKzD,EAAOC,QAASD,EAAQA,EAAOC,QAAS6iB,GAGpE9iB,EAAOC,QCpBf6iB,EAAoB5f,EAAKlD,IACxB,IAAIkjB,EAASljB,GAAUA,EAAOmjB,WAC7B,IAAOnjB,EAAiB,QACxB,IAAM,EAEP,OADA8iB,EAAoBM,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRJ,EAAoBM,EAAI,CAACnjB,EAAS+f,KACjC,IAAI,IAAIhV,KAAOgV,EACX8C,EAAoB1f,EAAE4c,EAAYhV,KAAS8X,EAAoB1f,EAAEnD,EAAS+K,IAC5E9I,OAAOohB,eAAerjB,EAAS+K,EAAK,CAAEuY,YAAY,EAAMnhB,IAAK4d,EAAWhV,MCJ3E8X,EAAoBhd,EAAI,WACvB,GAA0B,iBAAf0d,WAAyB,OAAOA,WAC3C,IACC,OAAO3d,MAAQ,IAAI0a,SAAS,cAAb,GACd,MAAOvd,GACR,GAAsB,iBAAXgD,OAAqB,OAAOA,QALjB,GCAxB8c,EAAoB1f,EAAI,CAACuE,EAAK8b,IAAUvhB,OAAOoG,UAAUsS,eAAenX,KAAKkE,EAAK8b,sBCE3E,MAAMC,EAAgB,KAC5B,MAAM,IAAIngB,MAAM,6EAIhByC,OAAe2d,YAAc,CAC7BC,4BAA6BF,EAC7BG,2BAA4BH,GCRtB,MAAMI,EAAoB,KAEhC,MAAMC,EAAa,GAEnB,MAAO,CACNC,OAAQD,EACRE,QAAUlM,IAEM,IADDgM,EAAMrS,QAAQqG,KAE3BgM,EAAMniB,KAAKmW,IACJ,GAITnF,WAAamF,IACZ,MAAMmM,EAAQH,EAAMrS,QAAQqG,GAC5B,OAAImM,GAAS,IACZH,EAAMI,OAAOD,EAAO,IACb,IAITE,WAAY,IAAML,EAAMriB,OAAS,EACjC2iB,SAAU,IAAMN,ICTX,SAASO,IAEf,MAAMC,EAAYT,IACZU,EAAmBV,IAkBzB,MAAO,CACNW,WAAYF,EAAUP,OACtBU,kBAAmBF,EAAiBR,OACpCW,OAbD,SAAgBxN,GACfoN,EACEF,WACAO,SAAQC,GAAYA,EAAS1N,KAC/BqN,EACEH,WACAO,SAAQC,GAAYA,EAAS1N,KAC/BqN,EAAiBJ,cAOjBU,YApBoBD,GAAwBN,EAAUN,QAAQY,GAqB9DE,mBApB2BF,GAAwBL,EAAiBP,QAAQY,GAqB5EG,eAnBuBH,GAAwBN,EAAU3R,WAAWiS,GAoBpEI,sBAnB8BJ,GAAwBL,EAAiB5R,WAAWiS,ICxBpF,MCKMK,EAAc,CACnBC,YAAa,SACbrkB,KAAM,SACNskB,QAAS,EACTC,IAAK,IAGAC,EAAe,CACpBC,OAAQ,CACPJ,YAAa,SACbrkB,KAAM,SACNskB,QAAS,EACTI,KAAM,OACNH,IAAK,OACLI,KAAM,GAEP1kB,UAAW,CACVokB,YAAa,YACbrkB,KAAM,SACNskB,QAAS,IACTI,IAAK,EACLH,IAAK,KACLI,KAAM,KAEP9iB,UAAW,CACVwiB,YAAa,YACbrkB,KAAM,SACNskB,QAAS,IAEV3iB,KAAM,CACL0iB,YAAa,aACbrkB,KAAM,SACNskB,QAAS,EACTI,KAAM,kBACNH,IAAK,oBAKP,IAAIK,EAAmB,EAChB,MAAMC,EAA4B,CAAmC7kB,EAASoJ,EAAO,MAAMpJ,cAAiB4kB,MAClHxjB,OAAO0jB,QAAQC,EAAkB/kB,GAAMglB,YACrCC,QAAO,CAACC,GAAMhb,EAAKhK,MACnB,IAAMglB,EAAK,CAAChb,GAAMiL,KAAKG,MAAMH,KAAKC,UAAUlV,EAAMokB,aAClD,CACClb,KAAAA,EACApJ,KAAAA,EACAP,OAAQ,kBAICslB,EAAmD,CAC/D,SAAY,CACXV,YAAa,WACbW,WAAY,CACXG,QAAS,CACRd,YAAa,UACbxU,QAAS,CACR,GAAM,KACN,GAAM,KACN,IAAO,MACP,IAAO,MACP,IAAO,MACP,KAAQ,OACR,KAAQ,OACR,KAAQ,OACR,KAAQ,OACR,MAAS,QACT,MAAS,SAEV7P,KAAM,SACNskB,QAAS,OAEVc,YAAa,CACZf,YAAa,cACbE,IAAK,EACLG,KAAM,IACNC,KAAM,EACN3kB,KAAM,SACNskB,SAAU,IAEXe,YAAa,CACZhB,YAAa,cACbE,IAAK,EACLG,KAAM,IACNC,KAAM,EACN3kB,KAAM,SACNskB,SAAU,KAEXgB,sBAAuB,CACtBjB,YAAa,wBACbrkB,KAAM,SACNskB,QAAS,MAOZ,WAAc,CACbD,YAAa,aACbW,WAAY,CACXO,OAAQ,CACPlB,YAAa,SACbM,KAAM,KACN3kB,KAAM,SACNskB,QAAS,MAEVkB,KAAM,CACLnB,YAAa,OACbE,IAAK,GACLG,IAAK,EACLC,KAAM,EACN3kB,KAAM,SACNskB,QAAS,IAEVmB,MAAO,CACNpB,YAAa,QACbE,IAAK,GACLG,IAAK,EACLC,KAAM,EACN3kB,KAAM,SACNskB,QAAS,IAEVoB,QAAS,CACRrB,YAAa,UACbrkB,KAAM,SACNskB,QAAS,KAEVqB,UAAW,CACVtB,YAAa,YACbE,IAAK,EACLG,KAAM,IACNC,KAAM,EACN3kB,KAAM,SACNskB,SAAU,MAIb,UAAa,CACZD,YAAa,YACbW,WAAY,CACXY,IAAK,CACJvB,YAAa,MAEbrkB,KAAM,SACNskB,QDtJ0B,6FC2J7B,MAAS,CACRD,YAAa,QACbW,WAAY,CACXa,QAAS,CACRxB,YAAa,UACbrkB,KAAM,SACNskB,QAAS,IAEVwB,SAAU,CACTzB,YAAa,WACbrkB,KAAM,SACNskB,QAAS,GACTC,IAAK,KAIR,KAAQ,CACPF,YAAa,OACbW,WAAY,CACXe,QAAS,CACR1B,YAAa,UACbrkB,KAAM,SACNskB,QAAS,IAEV0B,UAAW,CACV3B,YAAa,aACbrkB,KAAM,eACNskB,QAAS,mBAIZ,OAAU,CACTD,YAAa,SACbW,WAAY,CACXiB,OAAQ7B,EACR8B,aAAc,CACb7B,YAAa,gBACbrkB,KAAM,SACNskB,QAAS,EACTI,IAAK,EACLH,IAAK,KAIR,QAAW,CACVF,YAAa,UACbW,WAAY,CACXmB,SAAU,CACT9B,YAAa,WACbrkB,KAAM,UACNskB,QAAS,CACR/L,EAAG,EACHC,EAAG,EACH4N,EAAG,IAGLC,MAAO,CACNhC,YAAa,QACbC,QAAS,EACTtkB,KAAM,SACNukB,IAAK,KAEN+B,aAAc,CACbjC,YAAa,gBACbrkB,KAAM,SAGNskB,QAAS,OACTzU,QAAS,CACR,kBAAmB,OACnB,cAAe,eAGjB0W,cAAe,CACdlC,YAAa,iBACbrkB,KAAM,SACNskB,QAAS,UACTzU,QAAS,CACR,QAAW,UACX,YAAe,cACf,OAAU,WAGZ2W,YAAa,CACZnC,YAAa,eACbrkB,KAAM,SACNskB,QAAS,EACTC,IAAK,KAENkC,YAAa,CACZpC,YAAa,eACbrkB,KAAM,SACNskB,QAAS,IACTC,IAAK,KAENmC,QAAS,CACRrC,YAAa,UACbrkB,KAAM,SACNskB,QAAS,GACTC,IAAK,OAIR,OAAU,CACTF,YAAa,SACbW,WAAY,IACRR,EACHmC,WAAY,CACXtC,YAAa,cACbrkB,KAAM,SACNskB,QAAS,UACTzU,QAAS,CACR,WAAY,UACZ,YAAa,WACb,YAAa,WACb,WAAY,UACZ,YAAa,WACb,aAAc,YACd,QAAW,UACX,MAAS,YAKb,OAAU,CACTwU,YAAa,SACbW,WAAY,CACXc,SAAU,CACTzB,YAAa,WACbrkB,KAAM,SACNskB,QAAS,EACTC,IAAK,GAENqC,SAAU,CACTvC,YAAa,YACbrkB,KAAM,SACNskB,QAAS,IACTC,IAAK,GAENgB,OAAQ,CACPlB,YAAa,SACbM,KAAM,KACN3kB,KAAM,SACNskB,QAAS,MAEVuC,MAAO,CACNxC,YAAa,QACbrkB,KAAM,SACNskB,QAAS,GACTC,IAAK,GAENuC,SAAU,IACNtC,EAAavkB,UAChBokB,YAAa,YACbC,QAAS,KAEVyC,YAAa,CACZ1C,YAAa,eACbrkB,KAAM,SACNskB,QAAS,GACTC,IAAK,GAENyC,SAAU,IACNxC,EAAavkB,UAChBokB,YAAa,YACbC,QAAS,KAEV2C,YAAa,CACZ5C,YAAa,eACbrkB,KAAM,SACNskB,QAAS,GACTC,IAAK,KAIR,SAAY,CACXF,YAAa,WACbW,WAAY,CACXvkB,SAAU,CACT4jB,YAAa,YACbrkB,KAAM,SACNskB,QAAS,GACTC,IAAK,GAEN7jB,UAAW,CACV2jB,YAAa,YACbrkB,KAAM,SACNskB,QAAS,IACTK,KAAM,GACNJ,IAAK,KAENqC,SAAU,CACTvC,YAAa,WACbrkB,KAAM,SACNskB,QAAS,IACTC,IAAK,GAEN2C,YAAa,IACT1C,EAAavkB,UAChBokB,YAAa,YACbC,QAAS,KAEV6C,YAAa,IACT3C,EAAavkB,UAChBokB,YAAa,YACbC,QAAS,KAEVyC,YAAa,IACTvC,EAAa3iB,UAChBwiB,YAAa,gBAMd4C,YAAa,IACTzC,EAAa3iB,UAChBwiB,YAAa,gBAEd1iB,KAAM,IACFyiB,EACHC,YAAa,OACbC,QAAS,OCxXA8C,EAAoB,CAACC,EAAkB5nB,EAAS4nB,KAAU,CACtEA,MAAAA,EACA5nB,OAAAA,EACAY,QAAUinB,GAAgC7nB,EAAOY,QAAQinB,EAAMD,OAC/DE,cAAe,KACdF,EAAM3lB,aACNjC,EAAOiC,wDCRT,IAAI8lB,EAAmB,EAEhB,MAAMC,EAAsB,IAAMD,EAG5BE,EAAiBC,IAA8BA,GAAQhJ,KAAKiJ,OAASJ,EAClF,UCuBiB,QAAjB,EAAAtiB,OAAO2iB,kBAAU,QAAjB3iB,OAAO2iB,WAAe,CAAEC,GAbD,MACtB,MAAMC,EAAW,GACjB,OAAO,IAAIC,MAAM,GAAI,CACpB1mB,IAAG,CAAC0M,EAAQqG,EAAG4T,IACPF,EAAS1T,GAEjB9S,IAAG,CAACyM,EAAQqG,EAAG6T,EAAUD,KACxBF,EAAS1T,GAAe6T,GACjB,MAKkBC,KAErB,MACP,EAD0BjjB,OAAO2iB,iBC1BjC,QAAa,KACb,UAAe,IAAY,CAC1B7K,SAAU,gBACVK,mBAAoB,SAAUC,GAE7B,OADmB,IAAIqB,KAAK,EAAcrB,EAAK8K,YAC7B7K,eAAe1C,QAAQ,0BAA2B,SAYxD,QAAd,eAAc,QAAd,MAAmB,IACf,IACHwN,YAVmB,CAACnL,EAAgC6D,GAAmB,KACvE3f,OAAO2G,OAAO,kBAAyB+b,SAAShG,GAAWA,EAAOC,SAASb,EAAO6D,MAUlFuH,cAPqB,KACrBlnB,OAAO2G,OAAO,kBAAyB+b,SAAShG,GAAWA,EAAOuD,kBAS5D,MACP,EADmB,MC3BbkH,EAAc,kCAEdvJ,EAAS,yCACTwJ,EAAkB,IAAIC,IAAIzJ,GAChCwJ,EAAgBE,SAAW,uCAC3B,MAAMC,EAAqBH,EAAgB1gB,WAE9B8gB,EAAY1e,IAExB,IACC,IAAI0b,EAAM,IAAI6C,IAAIve,GAKdA,EAAI2e,WAAWN,KAClB3C,EAAIkD,SAAWN,EAAgBM,SAC/BlD,EAAImD,KAAOP,EAAgBO,KAC3BnD,EAAI8C,SAAWF,EAAgBE,SAC/B9C,EAAIoD,OAAS,GACb9e,EAAM0b,EAAI9d,YAEV,MAAOmhB,GAKR/e,EAAM,GAAG8U,IAAS4B,mBAAmB1W,KAEtC,OAAOA,GC3BKgf,EAA6B,CAAC9f,EAAO,cAIjD,IAAI+f,EAA4BC,OAAO9b,KAAKlE,GAgC5C,MA9BsB,CACrBgI,QAASiY,MAAOnf,IACf,MAAMof,QAAcH,EACd9gB,QAAiBihB,EAAMtd,MAAM,IAAIud,QAAQX,EAAS1e,KACxD,OAAK7B,EAGEA,EAASiD,OAFR,MAIT+F,QAASgY,MAAOnf,EAAKsf,KACpB,MAAMF,QAAcH,QACdG,EAAM9d,IACX,IAAI+d,QAAQX,EAAS1e,IACrB,IAAIuf,SAASD,EAAK,CAAEE,QAAS,CAAE,iBAAkBF,EAAInS,KAAKvP,gBAG5DgK,WAAYuX,MAAOnf,IAClB,MAAMof,QAAcH,QACdG,EAAMK,OAAO,IAAIJ,QAAQX,EAAS1e,MAEzC6H,MAAOsX,gBACcF,QACdC,OAAOO,OAAOvgB,GACpB+f,EAAYC,OAAO9b,KAAKlE,IAEzBwgB,QAASP,UACR,MAAMC,QAAcH,EACpB,aAAcG,EAAMlX,QAAQyX,KAAKC,IAAYC,ODHrB7f,ECGgC4f,EAAQlE,KDD1DiD,WAAW7J,GAClB9U,EAAM8f,mBAAmB9f,EAAIwK,UAAUsK,EAAOpe,SACpCsJ,EAAI2e,WAAWF,KACzBze,EAAM8f,mBAAmB9f,EAAIwK,UAAUiU,EAAmB/nB,SAC1DsJ,EAAM,GAAGqe,IAAcre,KAEjBA,EARkB,IAACA,+BE7BpB,MCKD4T,EAAS,YAAc,mBAEhBmM,EAAwB,CAAC7gB,EAAO,cAC5C,IAAI8gB,EAiBJ,MAZI,cAAejlB,MAClB6Y,EAAOpC,KAAK,uCAAuCtS,KACnD8gB,EDfuC,EAAC9gB,EAAO,cAChD,MAAMoG,EAAS,mBAA2B,CACzCpG,KAAAA,EACAmQ,OAAQ,cACRnM,QAAS,IAIJ+c,EAAetd,IACpB,GAAIA,EACH,MAAM,IAAIpK,MAAM,sBAAsBoK,MAWxC,MAPsB,CACrBuE,QAASiY,MAAOnf,SAAcsF,EAAO4B,QAAQwX,EAAS1e,GAAMigB,GAC5D9Y,QAASgY,MAAOnf,EAAKsf,UAAcha,EAAO6B,QAAQuX,EAAS1e,GAAMsf,EAAKW,GACtErY,WAAYuX,MAAOnf,SAAcsF,EAAOsC,WAAW8W,EAAS1e,GAAMigB,GAClEpY,MAAOvC,EAAOuC,MACd6X,QAASpa,EAAO4C,OCJLgY,CAA0BhhB,GACjC,WAAYnE,MACfikB,EAA2B9f,GAAM2I,UAGlC+L,EAAOpC,KAAK,yCAAyCtS,KACrD8gB,EAAWhB,EAA2B9f,IAIhC8gB,GAIR,EAD+BD,IC1B/B,EANoB,KACnB,MAAMrE,EAAM6C,IAAI4B,gBAAgB,IAAIlhB,OAC7BmhB,GAAM1E,EAAI9d,WAAWyiB,MAAM,KAAKC,UAEvC,OADA/B,IAAIgC,gBAAgB7E,GACb0E,SCOR,MAAM,EAAS,YAAc,UAGhBI,EAAY,IAuRR,QAAjB,kBAAiB,QAAjB,SArRqB,wBACpB,EAAOhP,KAAK,kBAGZ,MAAMiP,EAAQ,IAAIC,gBAAgBjK,SAASqI,QAG3C,IAAI6B,EAIAC,EAGAC,EAAe,KAClB,QAAwB,IAAbD,EACV,MAAMroB,MACL,+DAMCuoB,EAAY,GAGZC,EAAe,CAAC/gB,EAAaghB,EAAoB,MACpDH,IACA,IAAI7qB,EAAQ8qB,EAAU,GAAGF,KAAY5gB,KACrC,YAAqB,IAAVhK,EACHgrB,EAEDhrB,GAIJirB,EAAe,CAACjhB,EAAahK,KAChC6qB,IACAC,EAAU,GAAGF,KAAY5gB,KAAShK,EAC3BA,GAIJkR,EAAUiY,MAAOnf,EAAaghB,EAAoB,MACrDH,IACA,IAEI7qB,EAFAkrB,EAAiBC,IACjBpU,QAAa,UAAwB,UAAU6T,KAAY5gB,KAY/D,OAVa,OAAT+M,EACH/W,EAAQiV,KAAKG,YAAY,IAAImU,SAASxS,GAAMqU,SAE5CprB,EAAQgrB,QAEF,UACL,UAAUJ,KAAY5gB,IAAO,IAAIf,KAAK,CAACgM,KAAKC,UAAUlV,MAAAA,EAAAA,EAAS,QAGjEkrB,IACOD,EAAajhB,EAAKhK,IAItBmR,EAAUgY,MAAOnf,EAAahK,EAAYqrB,GAAkB,KAC/DR,IACA,IAAIK,EAAiBC,IACjBG,QAAiBpa,EAAQlH,GAC7BihB,EAAajhB,EAAKhK,GAClB,MAAMurB,QAAqB,UAG1B,UAAUX,KAAY5gB,IAAO,IAAIf,KAAK,CAACgM,KAAKC,UAAUlV,MAAAA,EAAAA,EAAS,OAShE,OAPIqrB,GAAUC,IAAatrB,IAC1B,EAAOwb,KAAK,4BAA4BxR,aAAeshB,WAAkBtrB,MACzEqD,SAASmoB,cAAc,IAAIC,YAAY,0BAA2B,CAAEC,OAAQ,CAC3E,CAAC1hB,GAAMhK,OAGTkrB,IACOK,GAIR,MAAMI,EAAgC,GAGhCR,EAAiB,KACtB,IAAID,EACAplB,EAAU,IAAIP,SAAekB,GAAYykB,EAAiBzkB,IAE9D,OADAklB,EAAa/qB,KAAKkF,GACX,KACNolB,IACAS,EAAaxI,OAAOwI,EAAajb,QAAQ5K,GAAU,KAI/CuM,EAAS,CAEduZ,aAAuC,QAAzB,EAAAnB,EAAMrpB,IAAI,uBAAe,QAAI,QAG3CyqB,aAAuC,QAAzB,EAAApB,EAAMrpB,IAAI,uBAAe,QAAI,iBAG3C0qB,SAA+B,QAArB,EAAArB,EAAMrpB,IAAI,mBAAW,QAAI,MAGnC2qB,WAAmC,QAAvB,EAAAtB,EAAMrpB,IAAI,qBAAa,QAAI,QAAcuZ,QAAQ,OAAQ,MAGrEqR,WAAmC,QAAvB,EAAAvB,EAAMrpB,IAAI,qBAAa,QAAI,iBAGvC6qB,OAA2B,QAAnB,EAAAxB,EAAMrpB,IAAI,iBAAS,QAAI,MAG/B8qB,iBAAkB,IAGlBC,kBAAgC,QAAb,EAAAnnB,OAAOonB,cAAM,QAC/BpnB,OAAOgZ,SAAWhZ,OAASA,OAAOgZ,OAAS,KAI5CqO,KAAMlD,MAAOvnB,EAAU,UAAW0qB,EAAgB,YACjD1B,EAA8B,QAAnB,EAAAhpB,MAAAA,EAAAA,EAAWgpB,SAAQ,QAAI,UAClC,MAAMM,EAAiBC,IAEjBoB,EAAY,CACjBC,oBAAqBtb,EAAQ,iBAC7BiT,kBAAmBjT,EAAQ,eAC3Bub,gBAAiBvb,EAAQ,aACzBwb,YAAaxb,EAAQ,SACrByb,sBAAuBzb,EAAQ,kBAAmB,GAClD0b,kBAAmB1b,EAAQ,cAAe,GAC1C2b,6BAA8B3b,EAAQ,yBAA0B,WAG3D3L,QAAQmC,IACbxG,OAAO0jB,QAAQ0H,GAAe3C,KAAI,EAAE3f,EAAKhK,KAAWmR,EAAQnH,EAAKhK,GAAO,MAMzE,IAAI0lB,EAAM,GAAGrT,EAAOuZ,sBAAsBvZ,EAAOwZ,uBAC7CiB,EAAO,CACVtD,QAAS,CACRuD,OAAQ,mBACRC,cAAe,eAAe9b,EAAQ,aAGpC/I,QAAiBsI,MAAMiV,EAAKoH,GAChC,GAAI3kB,EAAS8kB,GAAI,CAChB,IAAIxpB,QAAa0E,EAAS+kB,OAE1B7a,EAAO2Z,WAAavoB,EAAK+kB,eAEnBrX,EAAQ,gBAAiB1N,EAAK+oB,eAAe,SAC7Crb,EAAQ,cAAe1N,EAAK0pB,cAAc,SAC1Chc,EAAQ,YAAa1N,EAAK2pB,YAAY,SACtCjc,EAAQ,QAAS1N,EAAKipB,OAAO,GAEnC,MAAMW,EAAgBnsB,OAAOgR,KAAKqa,GAAWxH,QAAO,CAACC,EAAKhb,KACzD,IAAIhK,EAAQ+qB,EAAa/gB,GAIzB,OAHIhK,IAAUusB,EAAUviB,KACvBgb,EAAIhb,GAAOhK,GAELglB,IACL,IAEH,EAAOxJ,KAAK,kBAAmB6R,GAC/BhqB,SAASmoB,cACR,IAAIC,YAAY,0BAA2B,CAAEC,OAAQ2B,UAGtD,EAAOnjB,KAAK,QAAQ/B,EAASf,iCAE9B8jB,KAIDoC,KAAMnE,gBACC5jB,QAAQgoB,WAAW5B,IAI1B,mBAEC,OADAhB,MAAAA,IAAAA,EAAkB,IAAI6C,cACf7C,GAER,iBAAiB3qB,GAChB,QAA6B,IAAlB2qB,EACV,MAAMpoB,MAAM,8DAEbooB,EAAgB3qB,GAIjB,oBACC,OAAO+qB,EAAa,kBAIrB,iBAEC,OADA,EAAO7gB,KAAK,sDACLmI,EAAO8R,aAIf,kBACC,OAAO4G,EAAa,gBAIrB,sBACC,OAAOA,EAAa,oBAErB,oBAAoB/qB,GAGnB,GAAc,KAFdA,EAAQytB,OAAOztB,IAEf,CAGA,GAAIytB,OAAOlV,MAAMvY,IAAUA,EAnOL,GAmO0BA,EAAQwqB,EACvD,MAAMjoB,MAAM,6BAA6BvC,MAE1CmR,EAAQ,kBAAmBnR,KAI5B,kBACC,OAAO+qB,EAAa,gBAErB,gBAAgB/qB,GAEf,GADAA,EAAQytB,OAAOztB,GACXytB,OAAOlV,MAAMvY,IAAUA,EA/OL,GA+O0BA,EAAQwqB,EACvD,MAAMjoB,MAAM,yBAAyBvC,MAEtCmR,EAAQ,cAAenR,IAIxB,gBACC,OAAO+qB,EAAa,cAErB,cAAc/qB,GACbmR,EAAQ,YAAanR,IAItB,YACC,OAAO+qB,EAAa,UAErB,UAAU/qB,GACLA,IAAUqS,EAAOqa,OAEpBra,EAAOga,KAAKzB,EAAU,CAAE8B,MAAO1sB,KAKjC,6BACC,OAAO+qB,EAAa,2BAErB,2BAA2B/qB,GAE1B,GADAA,EAAQytB,OAAOztB,GACXytB,OAAOlV,MAAMvY,IAAUA,GAAS,EACnC,MAAMuC,MAAM,mCAAmCvC,KAEhDmR,EAAQ,yBAA0BnR,KAIpC,OAAOqS,GAGcqb,IAEf,MAAMrb,EAAS,SACtB,ICnSMsb,EAAY3tB,GAAoB,IAAVA,EAEf4tB,EAAuB,CAACC,EAA2C,OAC/EA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,YAAakJ,IACnDE,gBACVF,EAAOtuB,YAAS6P,GAGjB,MAAMjQ,EAAO,IAAI6uB,aAAa,eAAqBH,GAEnD,IAAII,EACAC,EAEAC,EACAC,EAEJ,MAAMC,EAAqC,CAC1CR,OAAAA,EACAS,SAAU,CACTnJ,YAAamE,GAAOnqB,EAAKgmB,YAAcmE,EACvCpE,YAAaoE,GAAOnqB,EAAK+lB,YAAcoE,EACvClE,sBAAuBkE,GAAOnqB,EAAKimB,sBAAwBkE,EAC3DrE,QAASqE,GAAOnqB,EAAK8lB,QAAUqE,MAE7BpC,EAAkB/nB,GACrBovB,QAAS,KACD,IACHF,EAAOG,sBACPH,EAAOI,sBAGZD,iBAAkB,KACjB,MAAME,EAAgB,IAAI3jB,WAAW5L,EAAKwvB,mBAM1C,OALAxvB,EAAKyvB,qBAAqBF,GAC1BP,EAAoB,CACnBO,cAAAA,EACAC,kBAAmBxvB,EAAKwvB,mBAElBR,GAERM,kBAAmB,KAClB,MAAMI,EAAiB,IAAIhZ,aAAa1W,EAAK8lB,SAM7C,OALA9lB,EAAK2vB,uBAAuBD,GAC5BT,EAAqB,CACpBS,eAAAA,EACA5J,QAAS9lB,EAAK8lB,SAERmJ,GAER,eAIC,OAFCD,MAAAA,OAAiB,EAAjBA,EAAmBO,cAAcK,KAAKpB,MACtCS,MAAAA,OAAkB,EAAlBA,EAAoBS,eAAeE,KAAKpB,KAG1C,eACC,MAAO,IACHQ,KACAC,IAGLD,kBAAAA,EACAC,mBAAAA,EACAY,mBAAqBC,IAChBA,IACHf,EAA4Be,GAI7B,MAAMC,EAAS,KACdjB,EAAyBkB,sBAAsBD,GAC/C,MAAMR,EAAgB,IAAI3jB,WAAW5L,EAAKwvB,mBACpCE,EAAiB,IAAIhZ,aAAa1W,EAAK8lB,SAC7C9lB,EAAKyvB,qBAAqBF,GAC1BvvB,EAAK2vB,uBAAuBD,GAC5BX,EAA0B,CACzBQ,cAAAA,EACAG,eAAAA,EACA5J,QAAS9lB,EAAK8lB,QACd0J,kBAAmBxvB,EAAKwvB,qBAI1BQ,sBAAsBD,IAEvBE,kBAAmB,KAClBC,qBAAqBpB,GACrBA,EAAyB,IAG3B,OAAOI,GC/FD,MAAMiB,EAMZ/nB,YAAY6iB,EAAO3mB,GAClBoB,KAAKpB,KAAOA,EACZoB,KAAKulB,GAAKA,EACVvlB,KAAK0qB,KAAO,KACZ1qB,KAAK2qB,KAAO,MAIP,MAAMC,EAQZloB,YAAYmoB,EAAgBC,EAAAA,GAP5B,KAAAC,MAAgB,EAKhB,KAAAC,UAA0C,IAAIC,IAG7CjrB,KAAKkrB,KAAO,KACZlrB,KAAKmrB,KAAO,KACZnrB,KAAK6qB,MAAQA,EAGd,WACC,OAAO7qB,KAAK+qB,MAGb,SAASzY,GACRtS,KAAK+qB,MAAQzY,EAETtS,KAAK+qB,MAAQ/qB,KAAK6qB,OACrB7qB,KAAKorB,oBAIP7uB,IAAIgpB,GACH,MAAMjrB,EAAO0F,KAAKgrB,UAAUzuB,IAAIgpB,GAEhC,GAAIjrB,EAAM,CACT,MAAM+wB,EAAcrrB,KAAKsrB,WAAWhxB,GAEpC,OAAI+wB,EACIA,EAAYzsB,KAGb,KAGR,OAAO,KAGR2sB,OAAOhG,GACN,IAAKvlB,KAAKkrB,KACT,OAAO,KAGR,MAAM5wB,EAAO0F,KAAKgrB,UAAUzuB,IAAIgpB,GAEhC,IAAKjrB,EACJ,OAAO,KAGR,MAAMkxB,EAAWlxB,EAAKqwB,KAChBc,EAAWnxB,EAAKowB,KAGtB,OAAIc,GAAYC,GACfD,EAASd,KAAOe,EAChBA,EAASd,KAAOa,EAChBxrB,KAAKgrB,UAAUpG,OAAOW,GACtBvlB,KAAKsS,OAEEhY,GAIJkxB,IAAaC,GAChBD,EAASd,KAAO,KAChB1qB,KAAKmrB,KAAOK,EACZxrB,KAAKgrB,UAAUpG,OAAOW,GACtBvlB,KAAKsS,OAEEhY,IAIHkxB,GAAYC,GAChBA,EAASd,KAAO,KAChB3qB,KAAKkrB,KAAOO,EACZzrB,KAAKgrB,UAAUpG,OAAOW,GACtBvlB,KAAKsS,OAEEhY,GAIHkxB,GAAaC,EASX,MARNzrB,KAAKkrB,KAAO,KACZlrB,KAAKmrB,KAAO,KACZnrB,KAAKgrB,UAAUpG,OAAOW,GACtBvlB,KAAKsS,OAEEhY,GAMToxB,IAAInG,GACH,QAAIvlB,KAAKgrB,UAAUU,IAAInG,GAOxBlY,OACC,OAAOpK,MAAM0oB,KAAK3rB,KAAKgrB,UAAU3d,QAGlCie,WAAWhxB,GACV,MAAMsxB,EAAa5rB,KAAKurB,OAAOjxB,EAAKirB,IAEpC,OAAIqG,EACa5rB,KAAK6rB,cAAcD,EAAWrG,GAAIqG,EAAWhtB,MAKvD,KAGRitB,cAActG,EAAO3mB,GACpB,GAAIoB,KAAKgrB,UAAUU,IAAInG,GAGtB,OAFavlB,KAAKsrB,WAAWtrB,KAAKgrB,UAAUzuB,IAAIgpB,IAKjD,GAAIvlB,KAAKkrB,KAAM,CACd,IAAIY,EAAU9rB,KAAKkrB,KACnB,MAAMa,EAAU,IAAItB,EAAqBlF,EAAI3mB,GAS7C,OAPAmtB,EAAQrB,KAAOoB,EACfC,EAAQpB,KAAO,KACfmB,EAAQnB,KAAOoB,EACf/rB,KAAKkrB,KAAOa,EACZ/rB,KAAKgrB,UAAUxuB,IAAI+oB,EAAIwG,GACvB/rB,KAAKsS,OAEEyZ,EACD,CACN,MAAMC,EAAU,IAAIvB,EAAqBlF,EAAI3mB,GAU7C,OATAoB,KAAKkrB,KAAOc,EAEPhsB,KAAKmrB,OACTnrB,KAAKmrB,KAAOa,GAGbhsB,KAAKgrB,UAAUxuB,IAAI+oB,EAAIyG,GACvBhsB,KAAKsS,OAEE0Z,GAKTZ,oBACC,MAAMa,EAAgBjsB,KAAKsS,KAAOtS,KAAK6qB,MAEvC7qB,KAAKksB,YAAYD,GAIlBC,YAAYD,EAAgB,GAC3B,IAAK,IAAIpvB,EAAI,EAAGA,EAAIovB,EAAepvB,IAClCmD,KAAKmsB,iBAIPA,iBACC,IAAKnsB,KAAKmrB,KACT,OAAO,KAGR,IAAIiB,EAAWpsB,KAAKmrB,KAChBkB,EAAcrsB,KAAKmrB,KAavB,OAXAnrB,KAAKgrB,UAAUpG,OAAOyH,EAAY9G,IAClCvlB,KAAKsS,OACL+Z,EAAcA,EAAY1B,KAEtB0B,EACHA,EAAY3B,KAAO,KAEnB1qB,KAAKkrB,KAAO,KAEblrB,KAAKmrB,KAAOkB,EAELD,GCnMT,MAAM,EAAS,YAAc,YAI7B,SAASE,IACR,MAAM/H,EAAQ,IAAIqG,EAHLE,EAAAA,GAKb,IAAIyB,GAAS,EAEb,MAAMC,EAAYrxB,IACboxB,IAAWpxB,GAASA,GACvB,EAAO6f,MAAM,wBAEduR,EAASpxB,GAyEV,MAAO,CACN,cACC,OAAOoxB,GAERC,SAAAA,EACAjI,MAAAA,EACAhoB,IA5ED,SAAa4I,GAGZ,OAFYof,EAAMhoB,IAAIsnB,EAAS1e,KAMxB,MAsEP3I,IAnED,SAAa2I,EAAQhK,GAIpB,OAHAqxB,GAAS,GACTjI,EAAMsH,cAAchI,EAAS1e,GAAoBhK,IAE1C,GAgEPsxB,cA7DD,SAAuBC,GAItB,OAHAF,GAAS,GACTjI,EAAM2H,YAAYQ,IAEX,GA0DPC,YAvDD,SAAqBxnB,GAEpB,OADAqnB,GAAS,GACFjI,EAAMgH,OAAO1H,EAAS1e,KAsD7BynB,UAnDD,WAEC,OADAJ,GAAS,GACFjI,EAAM4H,kBAkDbT,IA/CD,SAAavmB,GACZ,OAAOof,EAAMmH,IAAI7H,EAAS1e,KA+C1BmN,KA5CD,WACC,OAAOiS,EAAMjS,MA4CbjF,KAzCD,WACC,OAAOkX,EAAMlX,QAyCbL,MAtCD,WACCwf,GAAS,GACT,MAAM3B,EAAQtG,EAAMsG,MACpBtG,EAAMsG,MAAQ,EACdtG,EAAMjS,KAAO,EACbiS,EAAMsG,MAAQA,GAkCdgC,OA/BD,WACC,GAAmB,IAAftI,EAAMjS,KACT,OAAOlC,KAAKC,UAAU,IAEvB,MAAMgY,EAAO,GACb,IAAI/tB,EAAOiqB,EAAM4G,KACjB,KAAO7wB,GACN+tB,EAAKtsB,KAAK,CACTwpB,GAAIjrB,EAAKirB,GACT3mB,KAAMtE,EAAKsE,OAEZtE,EAAOA,EAAKqwB,KAEb,OAAOva,KAAKC,UAAUgY,KAkCxB,UCvHO,SAASyE,EAAYtd,EAAOud,EAAW,GAC7C,GAAc,IAAVvd,EAAa,MAAO,UAExB,MACMwd,EAAKD,EAAW,EAAI,EAAIA,EAGxBlwB,EAAIowB,KAAKC,MAAMD,KAAKrS,IAAIpL,GAASyd,KAAKrS,IAJlC,MAMV,OAAOuS,YAAY3d,EAAQyd,KAAKG,IANtB,IAM6BvwB,IAAIwwB,QAAQL,IAAO,IAJ5C,CAAC,QAAS,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAIInwB,GAKhE,MAUMywB,EAAgB,CAAC9P,EAAW+P,EAAWC,EAA8BP,KAAKQ,SAC/EjQ,GAAK+P,EAAI/P,GAAKgQ,IASTE,GAPUT,KAAKU,GACCV,KAAKU,GAMLC,GAFF,KAEqBA,GACnCC,EAAgBC,GAFF,IAEmBA,wcCtCzBC,WAOnB,aAA6B,kCAAdC,EAAc,qBAAdA,EAAc,gBAY3B,OAZ2B,gBAuB7BC,IAAM,SAACC,GAA4B,2BAAhBC,EAAgB,6BAAhBA,EAAgB,kBACjC,MAAuB,mBAAZD,EAIF,EAAKE,WAAW1xB,KAAK,EAAMwxB,GAGb,iBAAZA,EAEF,EAAKG,mBAAmBH,IAIjCA,EAAUA,EAAQpJ,IAAI,EAAKwJ,gBAAgB5xB,KAAK,IACzC,EAAK2xB,mBACVH,EAAQhO,OAAO,EAAKqO,qBAAqB7xB,KAAK,EAAMyxB,OArClDH,EAAanyB,OAAS,GAAKoH,MAAM0Q,QAAQqa,EAAa,MACxDA,EAAeA,EAAa,IAI9BhuB,KAAKguB,aAAeA,EAAalJ,KAAI,SAAA0J,GACnC,MAA8B,mBAAhBA,EAA6BA,IAAgBA,KAItDxuB,KAAKiuB,iDAuCHQ,EAAaxW,GAA4B,2BAAfyW,EAAe,6BAAfA,EAAe,kBAClD,OAAO1uB,KAAKiuB,IAAZ,EAAkBQ,EAAAA,WAAAA,EAAAA,CAAYxW,GAAZ,OAAyByW,kDAWxBA,EAAeC,EAAaC,GAC/C,IAAMC,EAAe7uB,KAAK8uB,sBACxBJ,EAAcK,QACdJ,GAEF,MAAO,GAAGra,OAAOqa,EAAaE,EAAcD,2CAS9B1e,GAGd,OAAOlQ,KAAKguB,aAAa9N,QAFd,SAAC8O,EAAKC,GAAN,OACTA,EAAUC,SAAWD,EAAUC,SAASF,GAAOA,IACb9e,iDAUhB2e,EAAcF,GAKlC,OAAO3uB,KAAKguB,aAAa9N,QAJd,SAAC8O,EAAKC,GAAN,OACTA,EAAUE,eACNF,EAAUE,eAAeH,EAAKL,GAC9BK,IAC8BH,8CASnBO,GAGjB,OAAOpvB,KAAKguB,aAAa9N,QAFd,SAAC8O,EAAKC,GAAN,OACTA,EAAUI,YAAcJ,EAAUI,YAAYL,GAAOA,IACnBI,SAlHnBrB,GCJrB,IAAM/V,GAAW,CACfsX,UAAW,GACXC,YAAa,GACbC,QAAQ,GA0CV,SA/B+B,eAACvH,EAAD,uDAAQjQ,GAAR,MAAsB,CACnDmX,eADmD,SACpCN,EAAcF,GAE3B,GAAI1rB,MAAM0Q,QAAQkb,GAAe,CAC/B,IAAMY,EAAcZ,EAAahzB,OAC3ByzB,EAAYrH,EAAKqH,UACjBC,EAActH,EAAKsH,YACnBC,EAASvH,EAAKuH,OAGdE,EAASf,EAAY1nB,MAAM,kBAOjC,GALE4nB,EADEa,EACab,EAAac,KAAKL,EAAYI,EAAO,IAErCb,EAAac,KAAKL,EAAY,KAG3CC,GAAeE,EAAc,EAAG,CAClC,IAAMG,EAAiBf,EAAagB,YAAYP,GAChDT,EACEA,EAAa1jB,MAAM,EAAGykB,IACrBJ,EAASF,EAAY,IACtB,IACAC,EACAV,EAAa1jB,MAAMykB,EAAiB,IAG1C,OAAOf,8HChBX,SApB+B,eAAC5zB,EAAD,uDAAQ,UAAR,MAAuB,CACpDo0B,YADoD,SACxCD,GACV,GAAa,YAATn0B,EAAoB,CAEtB,IAAMgM,EAAQmoB,EAAUnoB,MAAM,qBACxByoB,EAASzoB,GAASgmB,KAAKtN,IAAL,MAAAsN,KAAA,GAAYhmB,EAAM6d,KAAI,SAAAgL,GAAA,OAAMA,EAAGj0B,YACvD,GAAI6zB,EAAQ,CACV,IAAMK,EAAS,IAAIC,OAAJ,MAAiBN,EAAjB,IAA4B,MAC3C,OAAON,EAAUtZ,QAAQia,EAAQ,IAEnC,OAAOX,EAET,GAAa,QAATn0B,EAEF,OAAOm0B,EAAUtZ,QAAQ,cAAe,IAE1C,MAAM,IAAIpY,MAAJ,iBAA2BzC,MCIrC,GApB8B,eAACg1B,EAAD,uDAAQ,GAAR,MAAgB,CAC5CZ,YAD4C,SAChCD,GACV,GAAa,KAATa,EACF,OAAOb,EAAUc,OAKnB,GAAa,WAFbD,EAAOA,EAAKE,gBAEqB,SAATF,EACtB,OAAOb,EAAUtZ,QAAQ,OAAQ,IAGnC,GAAa,QAATma,GAA2B,UAATA,EACpB,OAAOb,EAAUtZ,QAAQ,OAAQ,IAGnC,MAAM,IAAIpY,MAAJ,uBAAiCuyB,MChBxB,IAAIlC,GACrBqC,GAAuB,CAAEd,UAAW,MACpCe,GACAC,ICHoB,IAAIvC,GACxBqC,GAAuB,CAAEd,UAAW,IAAKC,YAAa,QACtDc,GACAC,ICHmB,IAAIvC,GACvBqC,GAAuB,CAAEd,UAAW,IAAKC,YAAa,OACtDc,GACAC,ICKF,SAb+B,SAAAC,GAAA,MAAY,CACzCpB,eADyC,SAC1BN,EAAcF,GAC3B,GAAe,MAAX4B,GAAsC,iBAAZA,EAK5B,MAAM,IAAI7yB,MAAM,uDAElB,MAN8B,iBAAjBmxB,GAA6BA,EAAaxb,SAASkd,KAC5D1B,EAAeA,EAAarJ,MAAM+K,IAK/B1B,KCTX,IAAM2B,GAAe,SAAAhd,GAAA,OACd,MAALA,IAAcoV,OAAOlV,MAAMF,IAAmB,kBAANA,GAc1C,MCAA,GARa,IAAIua,GACf0C,GAAuB,ODLkB,iBAAO,CAChDtB,eADgD,SACjCN,GACb,OAAI5rB,MAAM0Q,QAAQkb,GACTA,EAAa6B,OAAOF,IAEzBA,GAAa3B,GACRA,EAEF,OCDTuB,GACAC,GACAC,ICKF,GAjBuC,SAACK,EAAaC,GAAd,MAA+B,CACpEzB,eADoE,SACrDN,EAAcF,GAC3B,GAAmB,MAAfgC,GAAsC,MAAfC,EACzB,MAAM,IAAIlzB,MACR,iEAKJ,OAAoB,MAAhBmxB,EACKA,EAEAA,EAAa9rB,WAAW+S,QAAQ6a,EAAaC,MCLzC,IAAI7C,GACnB0C,GAAuB,MACvBL,GACAC,GACAC,GACAO,GAA+B,KAAM,SACrCA,GAA+B,KAAM,QACrCA,GAA+B,KAAM,QACrCA,GAA+B,KAAM,UACrCA,GAA+B,KAAM,UACrCA,GAA+B,KAAM,WCAvC,SAXiC,SAACF,EAAaC,GAAd,MAA+B,CAC9DvB,YAD8D,SAClDD,GACV,GAAmB,MAAfuB,GAAsC,MAAfC,EACzB,MAAM,IAAIlzB,MACR,2DAGJ,OAAO0xB,EAAUtZ,QAAQ6a,EAAaC,MCJ1C,GALgB,IAAI7C,GAClB+C,GAAyB,kBAAmB,KAC5CR,ICFkB,IAAIvC,GACtB+C,GAAyB,aAAc,IACvCR,ICDwB,IAAIvC,GAC5BqC,GAAuB,CAAEd,UAAW,MACpCwB,GAAyB,WAAY,KACrCR,ICH0B,IAAIvC,GAC9BqC,GAAuB,CAAEd,UAAW,IAAKC,YAAa,OACtDuB,GAAyB,WAAY,KACrCR,ICH2B,IAAIvC,GAC/BqC,GAAuB,CAAEd,UAAW,IAAKC,YAAa,QACtDuB,GAAyB,WAAY,KACrCR,ICHkB,IAAIvC,GACtBqC,GACAC,GACAC,ICHyB,IAAIvC,GAC7BqC,GACAU,GAAyB,WAAY,KACrCR,ICJkB,IAAIvC,GACtBsC,GACAC,ICFmB,IAAIvC,GACvBsC,GAAuB,OACvBC,IAGF,MCYM,GAAS,YAAc,qBAOvBS,GAAgB,cCnBtB,MAAM,GAAS,YAAc,gBA8EH,QAA1B,aAAcC,oBAAY,YAAZA,aAxEa,GAC1BC,YAAAA,GACU,MACV,GAAOta,KAAK,wBAEZsa,MAAAA,IAAAA,EAAgB9wB,OAAOyL,OAGnB7E,UAAUmqB,UACTnqB,UAAUmqB,QAAQlV,SACrBjV,UAAUmqB,QAAQlV,UAAUja,MAAK,SAASovB,GACrCA,EACH,GAAOxa,KACN,8EAGD,GAAOA,KACN,6EAKoB2N,WACvB,GAAIvd,UAAUmqB,QAAQE,SAAU,CAC/B,MAAMA,QAAiBrqB,UAAUmqB,QAAQE,WACzC,GAAOza,KAAK,kBAAkBmW,EAAYsE,EAASC,UACnD,GAAO1a,KAAK,EAAO;qBACFmW,EAAYsE,EAASE;SACjCF,EAASE,MAAQF,EAASC,MAAQ,KAAKhE,QAAQ;SAItDkE,IAGD,MAAMC,EAAgBtM,EAAsB,cAEtCuM,EC5C6B,EAACvpB,EAAwBwpB,GAAkB,KAE9E,MAAMrsB,EAAOqsB,EACVpN,YACAA,SAAYlf,QAAQC,KAAK,+BAc5B,MAAO,CAXNgH,QAAShH,EACTiH,QAASjH,EACT2H,MAAO3H,EACP0H,WAAY1H,EACZwf,QAAS,KACRxf,IACA,MAAMgI,EAAiB,GACvB,OAAO,IAAI3M,SAAQkB,GAAWA,EAAQyL,SAIdnF,ID0BHypB,CAAqB,CAC3CtlB,QAASiY,MAAOnf,IACf6rB,EAAaY,SAASzsB,GACtB,MAAM7B,QAAiB2tB,EAAY9rB,GACnC,GAAwB,MAApB7B,EAASf,OACZ,MAAM,IAAI7E,MAAM,iBAAiB4F,KAElC,aADmBA,EAASiD,UAG3B,GAEGsrB,ED5BgC,CAACC,IACvC,MAAMC,EAAkBzN,MAAO7iB,UACxBf,QAAQmC,IAAIivB,EAAqBhN,IAAIrjB,KAGtCuwB,EAAyB1N,MAC9B7iB,EACAwwB,EACAC,KAEA,MAAMC,EAAWL,EAAqB3mB,MAAM8mB,EAAYC,GAAUpN,IAAIrjB,SAChEf,QAAQmC,IAAIsvB,IAGnB,IAAIC,EAEJ,MAAMC,EAAc,iBAEdC,EAAWhO,MAAOrb,UACvB,IAAIspB,EACJ,GAAqB,QAAjB,EAAAxrB,UAAUmqB,eAAO,eAAEE,SAAU,CAChC,MAAMA,QAAiBrqB,UAAUmqB,QAAQE,WAGzC,GADAmB,EAAWtpB,GADKmoB,EAASE,MAAQF,EAASC,OAEtCkB,EAAW,EAEd,OAED,IAAIC,EAAU,EACV31B,EAAI,EACR,KAAO21B,EAAUD,GAAU,CAC1B,MAAME,EAAcL,EAASxF,YAC7B,IAAI6F,EAEG,CACN,GAAOzX,MAAM,wCACb,MAHA,GAAOA,MAAM,qBAAqByX,EAAYlN,YAKzCrd,EAAG6E,WAAW0lB,EAAYlN,IAChCiN,GAAWC,EAAY7zB,KAAK0T,KAC5BzV,GAAK,EAEFA,EAAI,GACP,GAAOwI,KAAK,EAAM;eACPxI,2CAA2CiwB,EAAY0F;uBAC/C1F,EAAYsE,EAASC;sBACtB,EAAO;SACpBvE,EAAYsE,EAASE;WACnBF,EAASE,MAAQF,EAASC,MAAQ,KAAKhE,QAAQ;;SAOnDnlB,EAAgB,CACrBmE,QAASiY,MAAOnf,IACf,IAAK,IAAItI,EAAI,EAAGA,EAAIi1B,EAAqBj2B,OAAQgB,IAAK,CACrD,MAAMqV,QAAa4f,EAAqBj1B,GAAGwP,QAAQlH,GACnD,GAAI+M,EAMH,OALA8f,GAAuB1N,MAAOpc,UACvBoqB,EAASvB,UACT7oB,EAAGoE,QAAQnH,EAAK+M,GACtBkgB,EAAS51B,IAAI2I,EAAK,CAAEmN,KAAMJ,EAAKI,KAAMqH,UAAWgJ,QAC9C,EAAG9lB,GACCqV,EAGT,OAAO,MAER5F,QAAS,CAACnH,EAAK+M,KAAW,MAAM,IAAIxU,MAAM,qBAC1CqP,WAAYuX,MAAOnf,UACZ4sB,GAAgBzN,MAAOpc,SAAaA,EAAG6E,WAAW5H,KACxDitB,EAASzF,YAAYxnB,IAEtB6H,MAAOsX,gBACAyN,GAAiB7pB,GAAOA,EAAG8E,UACjColB,EAASplB,SAEV6X,QAASP,UACR,MAAMjX,EAAO,IAAIqlB,IAEjB,aADMX,GAAgBzN,MAAOpc,UAAcA,EAAG2c,WAAW9F,SAAS5Z,GAAQkI,EAAKslB,IAAIxtB,OAC5ElC,MAAM0oB,KAAKte,KAyDpB,MArDaiX,WAWZ8N,OAToB9N,WACnB,MAAM/d,QAAaurB,EAAqB,GAAGzlB,QAAQgmB,GACnD,OAAa,OAAT9rB,GACH,GAAOoQ,KAAK,yBACL,MAER,GAAOA,KAAK,kCxBXR,SAAkB0R,GACxB,MAAMuK,EAAWtG,IAIjB,OAHAlc,KAAKG,MAAM8X,GAAMtJ,SAAQzkB,IACxBs4B,EAASp2B,IAAIlC,EAAKirB,GAAIjrB,EAAKsE,SAErBg0B,EwBOEC,OAAe,IAAInO,SAASne,GAAMggB,UAEzBuM,GAGQxO,WACxB,MAAMyO,EAAUX,EAAS/kB,OAEnB2lB,SADkB9qB,EAAG2c,WACG6L,QAAQvrB,GAC9BA,IAAQktB,IAAgBU,EAAQ1f,SAASlO,KAEjD6tB,EAAYjU,SAAQuF,MAAOnf,IAC1B,MAAM+M,QAAahK,EAAGmE,QAAQlH,GAC9BitB,EAAS51B,IAAI2I,EAAK,CAAEmN,KAAMJ,EAAKI,KAAMqH,UAAWgJ,MAChD,GAAO3H,MAAM,EAAM;;aAEV7V;UAGN6tB,EAAYn3B,QACf,GAAO8a,KAAK,EAAO;gBACPqc,EAAYn3B;;QAK1Bo3B,GAaA,GAAOtc,KAAK,0CACZxW,OAAO+yB,aAXgB5O,UACtB,GAAI8N,EAASe,QAAS,CACrB,MAAMjrB,EAAK4pB,EAAqB,GAC1BvrB,EAAO,IAAInC,KAAK,CAACguB,EAASvF,iBAC1ByF,EAASvB,IACf,GAAO/V,MAAM,qCAAqCoX,EAAS9f,oBACrDpK,EAAGoE,QAAQ+lB,EAAa9rB,GAC9B6rB,EAAS5F,UAAS,MAIe,MAEpChF,GAEOtf,GC/GmBkrB,CAAwB,CAEjD5B,EACAC,IAGKT,EAAe,CACpBpsB,QAAUO,GAA+B0sB,EAAkBxlB,QAAQlH,GAInEysB,SAAWzsB,MAEXkuB,eAAgB7B,EAChB8B,gBAAiB7B,EAEjB8B,mBAAoB1B,GAGrB,OAAOb,GAKuBwC,IAExB,MAAMxC,GAAe,kBEnFfyC,GAAmB,CAACzK,EAAuC,MACvEA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,QAASkJ,GAE1D,MAAM1G,EAAQ,4BACRlnB,EAAM,4BACNC,EAAM,4BAKNmuB,EAAiC,CACtCR,OAAAA,KACG3G,EAAkBC,EAAOlnB,GAC5Bs4B,eAAgB5O,GACfzpB,EAAIC,QAAQwpB,EAAIkE,EAAO/H,WAAWqB,OACnCqR,OAASx4B,IACRC,EAAIwB,KAAKzB,MAAQA,EACjBE,EAAIuB,KAAKzB,MAAQ,EAAIA,GAEtBy4B,OAAQ,IAAMx4B,EAAIwB,KAAKzB,MACvBsuB,SAAU,CACT,QAAYhF,GAAQ+E,EAAOmK,OAAOlP,IAEnCoP,OAAQvR,EACRwR,KAAM14B,EACN24B,KAAM14B,GAOP,OAJAinB,EAAMhnB,QAAQF,GACdknB,EAAMhnB,QAAQD,GACdmuB,EAAOmK,OAAO3K,EAAOhI,SAEdwI,GChCKwK,GAAsB,CAAChL,EAA0C,MAC7EA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,WAAYkJ,GAE7D,MAAMiL,EAAS,IAAIC,WAAW,eAAqB,CAClD3S,aAAcyH,EAAOzH,aACrBC,cAAewH,EAAOxH,cACtB2S,cAAenL,EAAOrH,QACtByS,YAAapL,EAAOvH,YACpBC,YAAasH,EAAOtH,cAGf8H,EAAS,CACdR,OAAAA,KACG3G,EAAkB4R,GACrBI,YAAcC,IACbL,EAAOM,UAAUp5B,MAAQm5B,EAAI9gB,GAAK,EAClCygB,EAAOO,UAAUr5B,MAAQm5B,EAAI7gB,GAAK,EAClCwgB,EAAOQ,UAAUt5B,MAAQm5B,EAAIjT,GAAK,GAEnCqT,YAAa,KAAM,CAAGlhB,EAAGygB,EAAOM,UAAUp5B,MAAOsY,EAAGwgB,EAAOO,UAAUr5B,MAAOkmB,EAAG4S,EAAOQ,UAAUt5B,QAKhGw5B,YAAa,SAAUC,EAAkBC,GACxCZ,EAAOM,UAAUO,wBAChBb,EAAOM,UAAUp5B,MAAQy5B,EAAOphB,EAAIqhB,EACpC,2BAAkCA,GAEnCZ,EAAOO,UAAUM,wBAChBb,EAAOO,UAAUr5B,MAAQy5B,EAAOnhB,EAAIohB,EACpC,2BAAkCA,GAEnCZ,EAAOQ,UAAUK,wBAChBb,EAAOQ,UAAUt5B,MAAQy5B,EAAOvT,EAAIwT,EACpC,2BAAkCA,IAGpCpL,SAAU,CACT,SAAahF,GAAQ+E,EAAO6K,YAAY5P,IAEzCnqB,KAAM25B,GAKP,OAFAzK,EAAO6K,YAAYrL,EAAO5H,UAEnBoI,GCpDKuL,GAAQnH,GACpB,IAAIltB,SAAQkB,GAAWtC,WAAWsC,EAASgsB,KCY/B+E,GAAM,CAACqC,EAAcC,KAAiB,CAClDzhB,EAAGwhB,EAAGxhB,EAAIyhB,EAAGzhB,EACbC,EAAGuhB,EAAGvhB,EAAIwhB,EAAGxhB,EACb4N,EAAG2T,EAAG3T,EAAI4T,EAAG5T,IAGD,GAAU6T,GACtBjI,KAAKkI,KAAKD,EAAE1hB,EAAI0hB,EAAE1hB,EAAI0hB,EAAEzhB,EAAIyhB,EAAEzhB,EAAIyhB,EAAE7T,EAAI6T,EAAE7T,GAE9B+T,GAAW,CAACF,EAAazQ,KAAgB,CACrDjR,EAAG0hB,EAAE1hB,EAAIiR,EACThR,EAAGyhB,EAAEzhB,EAAIgR,EACTpD,EAAG6T,EAAE7T,EAAIoD,IChBJ,GAAS,YAAc,qBAEvB,GAAO,CAACjH,EAAG+P,EAAGnwB,IAAMogB,GAAK+P,EAAI/P,GAAKpgB,EAElCi4B,GAA4D,CACjEC,OAASl4B,GAAcA,EACvBm4B,OAASn4B,GAAc,EAAI6vB,KAAKuI,IAAIp4B,EAAI6vB,KAAKU,GAAK,IAClD8H,QAAUr4B,GAAc6vB,KAAKyI,IAAIt4B,EAAI6vB,KAAKU,GAAK,KCRnCgI,GAAqB,CAAC3M,EAAyC,aAC3EA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,UAAWkJ,IACjDE,gBACVF,EAAOtuB,YAAS6P,GAEjB,MAAMjQ,EAAO,IAAIs7B,SAAS,eAAqB,CAAEh5B,KAAMosB,EAAO9H,SAWxD0E,EAAQ,IAAIC,gBAAgBjK,SAASqI,QACrC4R,EAAoBjN,OAAuC,QAAhC,EAAAhD,EAAMrpB,IAAI,8BAAsB,QAAI,MAM/Du5B,EAAgB5U,IACrB,MAAM6U,EAA6B7U,EAAS2U,EAA9BA,EACd,OAAIE,IAASF,EACL,EAGA5I,KAAKG,IAAI,GAAI2I,EAAO,KAsC7B,MA5ByC,CACxC/M,OAAAA,KACG3G,EAAkB/nB,GACrB,YAAc,OAROsC,EAQatC,EAAKsC,KAAKzB,MANrC,EADM,GAAK8xB,KAAK+I,MAAMp5B,IACTi5B,EAFA,IAACj5B,GASrB,UAAU6nB,GACTnqB,EAAKsC,KAAKq5B,sBAAsB,4BAChC37B,EAAKsC,KAAKzB,MAAQ26B,EAAarR,IAEhCyR,YAAa5R,MAAOG,EAAK0R,EAAenN,EAAO7H,aAAciV,KD5B9B,EAACC,EAAmB5R,EAAa6R,EAAevV,EAAkBqV,KAClGA,MAAAA,IAAAA,EAAc,WACG,IAAbrV,IACHA,EAxBgC,MAyBjC,MAAM/d,EAAS,GACTuzB,EAAUF,EAAMl7B,MAGhBq7B,EAAQnB,GAASe,GACvB,IAAK,IAAIv5B,EAAI,EAAGA,EAHG,GAGaA,IAAK,CACpC,MAAMO,EAAIo5B,EAAM35B,EAAI,IACpBmG,EAAOjH,KAAK,GAAKw6B,EAAS9R,EAAKrnB,IAEhCi5B,EAAMJ,sBAAsBK,GAC5B,IACCD,EAAMI,oBAAoBzzB,EAAQszB,EAAOvV,GACxC,MAAOpe,GACR,IAAI,wEAAwE8I,KAAK9I,EAAM+zB,SAGtF,MAAM/zB,EAFN,GAAOA,MAAMA,KCWbg0B,CACCr8B,EAAKsC,KACLk5B,EAAarR,GACb,2BACA0R,EACAC,SAEKrB,GAAoB,IAAfoB,IAEZ1M,SAAU,CACT,OAAWhF,GAAQnqB,EAAKsC,KAAKzB,MAAQspB,EACrC,aAAgBA,GAAOuE,EAAO7H,aAAesD,KCrDhD,MAAMmS,GAOLl0B,YAAY3F,GACXiD,KAAKqE,KAAO,SACZrE,KAAKjD,QAAUA,EACfiD,KAAKsiB,MAAQtiB,KAAKjD,QAAQxC,aAC1ByF,KAAKwpB,OAAS,KACdxpB,KAAK62B,UAAW,EAChB72B,KAAKtF,OAASsF,KAAKjD,QAAQxC,aAC3ByF,KAAK82B,QACL92B,KAAK+2B,SAGND,QACC92B,KAAKwpB,OAASxpB,KAAKjD,QAAQxC,aAG5Bw8B,SACC/2B,KAAKsiB,MAAMhnB,QAAQ0E,KAAKwpB,QACxBxpB,KAAKwpB,OAAOluB,QAAQ0E,KAAKtF,QAG1BY,QAAQ07B,GACPh3B,KAAKtF,OAAOY,QAAQ07B,IA+CtB,MAAMC,GAWLv0B,YAAY3F,EAAuBH,EAAO,GACzCoD,KAAKjD,QAAUA,EACfiD,KAAKtF,OAASsF,KAAKjD,QAAQxC,aAC3ByF,KAAKtF,OAAOkC,KAAKzB,MAAQyB,EACzBoD,KAAKk3B,SAAW,GAChBl3B,KAAKm3B,SAAW,EAChBn3B,KAAKpD,KAAOA,EACZoD,KAAKo3B,QAAU,EACfp3B,KAAKq3B,OAAS,KACdr3B,KAAKs3B,SAAWt3B,KAAKtF,OAAOkC,KAAKzB,MACjC6E,KAAKu3B,SAAW,KAGjBC,GAAGL,GACFn3B,KAAKm3B,SAAWA,EAAW,IAC3Bn3B,KAAKs2B,MAAMt2B,KAAKjD,QAAQ06B,aAGzBC,IAAIC,GACH,OAAO33B,KAAK43B,KAAK53B,KAAKjD,QAAQ06B,aAG/BnB,MAAMuB,GACL73B,KAAKtF,OAAOkC,KAAKzB,MAAQ,EACzB6E,KAAKtF,OAAOkC,KAAKk7B,eAAe,EAAGD,GACnC73B,KAAKtF,OAAOkC,KAAKm7B,gBAAgB,EAAGF,EAAM73B,KAAKwgB,OAAS,MACxDxgB,KAAKtF,OAAOkC,KAAKm7B,gBAAgB/3B,KAAKg4B,QAAUh4B,KAAKm3B,SAAUU,EAAO73B,KAAKwgB,OAAQxgB,KAAK8hB,OAGzF8V,KAAKC,GACJ73B,KAAKg4B,QAAUh4B,KAAKtF,OAAOkC,KAAKzB,MAChC6E,KAAKtF,OAAOkC,KAAKq5B,sBAAsB4B,GACvC73B,KAAKtF,OAAOkC,KAAKk7B,eAAe93B,KAAKg4B,QAASH,GAC9C73B,KAAKtF,OAAOkC,KAAKm7B,gBAAgB,EAAGF,EAAM73B,KAAK2gB,QAAU,MAG1D,WAAWxlB,GACV6E,KAAKo3B,QAAUj8B,EAGhB,aACC,OAAO6E,KAAKo3B,QAGb,UAAUj8B,GACT6E,KAAKq3B,OAASl8B,EAGf,YACC,OAAO6E,KAAKq3B,OAGb,YAAYl8B,GACX6E,KAAKpD,KAAOzB,EACZ6E,KAAKs3B,SAGN,cACC,OAAOt3B,KAAKpD,KAGb,YAAYzB,GACX6E,KAAKu3B,SAAWp8B,EAGjB,cACC,OAAO6E,KAAKu3B,SAGbj8B,QAAQ07B,GACPh3B,KAAKtF,OAAOY,QAAQ07B,IAyFtB,MAAMiB,WArFN,MASCv1B,YAAY3F,EAAuB9B,EAAuB,WAAY2B,EAAO,IAC5EoD,KAAKjD,QAAUA,EACfiD,KAAK/E,KAAOA,EACZ+E,KAAK7E,OAAS,EACd6E,KAAKpD,KAAOA,EACZoD,KAAKtF,OAASsF,KAAKjD,QAAQxC,aAC3ByF,KAAKk3B,SAAW,GAChBl3B,KAAKtF,OAAOkC,KAAKzB,MAAQ6E,KAAKpD,KAC9BoD,KAAKk4B,YAAc,IAAIjB,GAAmBj3B,KAAKjD,SAC/CiD,KAAKk4B,YAAY58B,QAAQ0E,KAAKtF,QAG/B8sB,OACC,MAAM2Q,EAAMn4B,KAAKjD,QAAQq7B,mBACzBD,EAAIl9B,KAAO+E,KAAK/E,KAChBk9B,EAAI78B,QAAQ0E,KAAKk4B,YAAYx9B,QAC7By9B,EAAI7B,MAAMt2B,KAAKjD,QAAQ06B,aACvBz3B,KAAKk3B,SAASn7B,KAAKo8B,GAGpBX,GAAGG,GACF33B,KAAK7E,MAAQw8B,EAAUx8B,MACvB6E,KAAKk3B,SAASnY,SAASoZ,IACtBA,EAAIj9B,UAAUC,MAAQw8B,EAAUz8B,aAEjC8E,KAAKk4B,YAAYV,GAAGG,EAAUR,UAAYQ,GAG3CD,IAAIC,GACH33B,KAAKk4B,YAAYR,IAAIC,GACrB33B,KAAKk3B,SAASnY,SAASoZ,IACtBA,EAAIP,KAAK53B,KAAKjD,QAAQ06B,YAAyC,EAA3Bz3B,KAAKk4B,YAAYvX,YAIvDrlB,QAAQ07B,GACPh3B,KAAKtF,OAAOY,QAAQ07B,GAGrB,WAAW77B,GACV6E,KAAKk3B,SAASnY,SAAQzP,GAAKA,EAAEoQ,OAAOvkB,MAAQA,IAG7C,WAAWA,GACV6E,KAAKk4B,YAAY1X,OAASrlB,EAG3B,aACC,OAAO6E,KAAKk4B,YAAY1X,OAGzB,UAAUrlB,GACT6E,KAAKk4B,YAAYpW,MAAQ3mB,EAG1B,YACC,OAAO6E,KAAKk4B,YAAYpW,MAGzB,YAAY3mB,GACX6E,KAAKk4B,YAAYF,QAAU78B,EAG5B,cACC,OAAO6E,KAAKk4B,YAAYF,QAGzB,YAAY78B,GACX6E,KAAKk4B,YAAYvX,QAAUxlB,EAG5B,cACC,OAAO6E,KAAKk4B,YAAYvX,UAQzBje,YAAY3F,EAASH,GACpBy7B,MAAMt7B,EAASH,GACfoD,KAAKs4B,QAAU,EAGhB,aACC,OAAOt4B,KAAKs4B,SAAW,EAExB,WAAWn9B,GACV6E,KAAKs4B,QAAUn9B,EAGhBqsB,OACC,MAAM+Q,EAAU,IAAIvnB,aAAahR,KAAKnE,OAASmE,KAAKjD,QAAQy7B,YACtDC,EAAU,IAAIznB,aAAahR,KAAKnE,OAASmE,KAAKjD,QAAQy7B,YAC5D,IAAK,IAAI37B,EAAI,EAAGA,EAAImD,KAAKnE,OAASmE,KAAKjD,QAAQy7B,WAAY37B,IAC1D07B,EAAQ17B,GAAK,EAAK,EAAIowB,KAAKQ,SAC3BgL,EAAQ57B,GAAK,EAAK,EAAIowB,KAAKQ,SAE5B,MAAMle,EAASvP,KAAKjD,QAAQ27B,aAAa,EAAG14B,KAAKnE,OAASmE,KAAKjD,QAAQy7B,WAAYx4B,KAAKjD,QAAQy7B,YAChGjpB,EAAOopB,cAAcJ,EAAS,GAC9BhpB,EAAOopB,cAAcF,EAAS,GAE9B,MAAMN,EAAMn4B,KAAKjD,QAAQ67B,qBACzBT,EAAI5oB,OAASA,EACb4oB,EAAIU,MAAO,EACXV,EAAIW,UAAY,EAChBX,EAAIY,QAAU,EACdZ,EAAI7B,MAAMt2B,KAAKjD,QAAQ06B,aACvBU,EAAI78B,QAAQ0E,KAAKk4B,YAAYx9B,QAC7BsF,KAAKk3B,SAASn7B,KAAKo8B,GAGpBX,GAAGG,GACF33B,KAAK7E,MAAQw8B,EAAUx8B,MACvB6E,KAAKk4B,YAAYV,GAAGG,EAAUR,UAAYQ,IAK5C,MAAMqB,WAAsBpC,GAE3Bl0B,YAAY3F,EAAS9B,EAAyB,UAAWg+B,EAAS,IAAMn8B,EAAY,IACnFu7B,MAAMt7B,GACNiD,KAAKqE,KAAO,SACZrE,KAAKwpB,OAAOtuB,UAAUC,MAAQ89B,EAC9Bj5B,KAAKwpB,OAAOvsB,EAAE9B,MAAQ2B,EACtBkD,KAAKwpB,OAAOvuB,KAAOA,EAGpB67B,QACC92B,KAAKwpB,OAASxpB,KAAKjD,QAAQ/B,qBAC3BgF,KAAKwpB,OAAOluB,QAAQ0E,KAAKtF,QACzBsF,KAAK+2B,UAKA,MAAMmC,WAA8BtC,GAa1Cl0B,YAAY3F,GACXs7B,MAAMt7B,GACNiD,KAAKqE,KAAO,iBAIJyyB,OAAM,SAAE/V,EAAQ,SAAEc,EAAQ,OAAErB,EAAM,MAAEsB,GAKzC,IACHf,MAAAA,IAAAA,EAAa,GACbc,MAAAA,IAAAA,EAAa,KACbrB,MAAAA,IAAAA,EAAW,MACXsB,MAAAA,IAAAA,EAAU,IAEV9hB,KAAKwpB,OAASxpB,KAAKjD,QAAQo8B,kBAE3Bn5B,KAAK+gB,SAAWA,EAChB/gB,KAAKwgB,OAASA,EACdxgB,KAAK8hB,MAAQA,EACb9hB,KAAK2gB,QAAUI,EAEf/gB,KAAK6hB,SAAW7hB,KAAKjD,QAAQC,YAAY+jB,GACzC/gB,KAAK6hB,SAASzlB,UAAU07B,eAAejW,EAAU7hB,KAAKjD,QAAQ06B,aAE9Dz3B,KAAKo5B,SAAW,GAEhB,IAAK,IAAIv8B,EAAI,EAAGA,EAAI,EAAGA,IACtBmD,KAAKo5B,SAASr9B,KAAKiE,KAAKjD,QAAQC,YAAY+jB,IAE7C/gB,KAAKo5B,SAAStU,KAAI,CAAC1nB,EAAGP,KACjBmD,KAAKo5B,SAASv8B,EAAI,IACrBO,EAAE9B,QAAQ0E,KAAKo5B,SAASv8B,EAAI,IAE7BO,EAAEhB,UAAU07B,eAAe,KAASj7B,GAAKglB,EAAW,GAAK7hB,KAAKjD,QAAQ06B,gBAGvEz3B,KAAKq5B,aAAer5B,KAAKjD,QAAQxC,aACjCyF,KAAKo5B,SAASp5B,KAAKo5B,SAASv9B,OAAS,GAAGP,QAAQ0E,KAAKq5B,cAErDr5B,KAAKq5B,aAAaz8B,KAAKzB,MAAQ,GAE/B6E,KAAKq5B,aAAa/9B,QAAQ0E,KAAKtF,QAE/BsF,KAAK5E,IAAM4E,KAAKjD,QAAQxC,aACxByF,KAAK5E,IAAIwB,KAAKzB,MAAQ,EAEtB6E,KAAKsiB,MAAMhnB,QAAQ0E,KAAK5E,KACxB4E,KAAK5E,IAAIE,QAAQ0E,KAAK6hB,UACtB7hB,KAAK5E,IAAIE,QAAQ0E,KAAKo5B,SAAS,IAC/Bp5B,KAAK6hB,SAASvmB,QAAQ0E,KAAKwpB,QAC3BxpB,KAAKwpB,OAAOluB,QAAQ0E,KAAKtF,QAI1B4+B,YAAW,SAAEvX,EAAQ,YAAEC,EAAW,SAAEC,EAAQ,YAAEC,GAK1C,IACHH,MAAAA,IAAAA,EAAa,KACbC,MAAAA,IAAAA,EAAgB,IAChBC,MAAAA,IAAAA,EAAa,KACbC,MAAAA,IAAAA,EAAgB,IAEhB,MAAMqX,EAAc,IAAIC,oBAAoB,EAAGx5B,KAAKjD,QAAQy7B,WAAax4B,KAAK+gB,SAAU/gB,KAAKjD,QAAQy7B,YACrGe,EAAY1yB,WAAc0I,GACzBvP,KAAKwpB,OAAOja,OAASA,EAAOkqB,eAE7B,MAAMC,EAAU,IAAIzB,GAAasB,EAAa,GACxCI,EAAe,IAAIX,GAAcO,EAAa,UAAWxX,EAAUC,GACnE4X,EAAe,IAAIZ,GAAcO,EAAa,WAAYtX,EAAUC,GAE1EwX,EAAQlS,OACRkS,EAAQp+B,QAAQs+B,EAAatX,OAC7BsX,EAAat+B,QAAQq+B,EAAarX,OAClCqX,EAAar+B,QAAQi+B,EAAYvC,aACjC0C,EAAQlZ,OAASxgB,KAAKwgB,OACtBkZ,EAAQ5X,MAAQ9hB,KAAK8hB,MACrB4X,EAAQ/Y,QAAU3gB,KAAK2gB,QAEvB4Y,EAAYM,iBAEZH,EAAQlC,GAAG,CAAEt8B,UAAW,IAAKi8B,SAAU,IACvC73B,YAAW,IAAMo6B,EAAQhC,OAAO,IAGjC,cAAcv8B,GACb,MAAM2+B,EAAK3+B,EAAQ,EACnB6E,KAAK+gB,SAAW5lB,EAChB6E,KAAKwgB,OAAS,EACdxgB,KAAK8hB,MAAQ,EACb9hB,KAAK2gB,QAAUmZ,EACf95B,KAAKs5B,wCC/ZA,MCFMS,GAA+C,CAC3D,OAAUpE,GACV,SAAY5M,EACZ,WCXqC,CAACC,EAA6C,OACnFA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,cAAekJ,IACrDE,gBACVF,EAAOtuB,YAAS6P,GAGjB,MAAMjQ,EAAO,IAAI0/B,uBAAuB,eAAqBhR,GAO7D,MAL6C,CAC5CA,OAAAA,EACAS,SAAU,MACPpH,EAAkB/nB,KDCtB,UEVoCgqB,MAAO0E,EAA4C,MACvFA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,aAAckJ,GAC/D,MAAMziB,QAAayqB,GAAapsB,QAAQokB,EAAOnI,KACzCoZ,QAAoB1zB,EAAK0zB,cACzBC,QAAoB,+BAAoCD,GAExD3/B,EAAO,iCASb,OARAA,EAAKiV,OAAS2qB,EAEC,IACX7X,EAAkB/nB,GACrB0uB,OAAAA,EACAS,SAAU,KFDX,KAAQgK,GACR,MGdiCzK,IACjCA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,SAAUkJ,GAC3D,MAAM1uB,EAAO,2BAEZ0lB,EAAkBma,MAAMla,WAAWc,SAASvB,KAE7CllB,EAAK8B,UAAUjB,MAAQ6tB,EAAOjI,SAE9B,MAAMqZ,EAAe,4BAerB,OAdAA,EAAax9B,KAAKzB,MAAQ6tB,EAAOlI,QAEjCxmB,EAAKgB,QAAQ8+B,GACbA,EAAa9+B,QAAQhB,GAEN,CAEd0uB,OAAAA,KACG3G,EAAkB+X,EAAc9/B,GACnCmvB,SAAU,CACT,SAAYhF,GAAOnqB,EAAK8B,UAAUjB,MAAQspB,EAC1C,QAAWA,GAAO2V,EAAax9B,KAAKzB,MAAQspB,KHL9C,QAAWuP,GACX,OIhBkChL,IAClCA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,UAAWkJ,GAI5D,MAAM1uB,EAAO,oCACbA,EAAKW,KAAO+tB,EAAOpH,WACnBtnB,EAAK2C,EAAE9B,MAAQ6tB,EAAOlsB,UACtBxC,EAAKolB,OAAOvkB,MAAQ6tB,EAAOtJ,OAC3BplB,EAAKsC,KAAKzB,MAAQ6tB,EAAOpsB,KACzBtC,EAAKY,UAAUC,MAAQ6tB,EAAO9tB,UAE9B,MAAMonB,EAAQ,4BACR5nB,EAAS,4BAef,OAbA4nB,EAAMhnB,QAAQhB,GACdA,EAAKgB,QAAQZ,GACE,CACdsuB,OAAAA,KACG3G,EAAkBC,EAAO5nB,GAC5B+uB,SAAU,CACT,WAAchF,GAAOnqB,EAAKW,KAAOwpB,EACjC,UAAaA,GAAOnqB,EAAK2C,EAAE9B,MAAQspB,EACnC,OAAUA,GAAOnqB,EAAKolB,OAAOvkB,MAAQspB,EACrC,KAAQA,GAAOnqB,EAAKsC,KAAKzB,MAAQspB,EACjC,UAAaA,GAAOnqB,EAAKY,UAAUC,MAAQspB,KJR7C,OKhBkCuE,IAClCA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,UAAWkJ,GAE5D,MAAMqR,EAAS,IAAInB,GAAsB,gBAUzC,OATAmB,EAAOvD,MAAM,IAAK9N,IAClBqR,EAAOf,WAAW,IAAKtQ,IAER,CACdA,OAAAA,KACG3G,EAAkBgY,EAAO/X,MAAO+X,EAAO3/B,QAC1C+uB,SAAU,KLOX,SDRoCT,IACpCA,EAAS3sB,OAAO4sB,OAAOnJ,EAA0B,YAAakJ,GAE9D,MAAMnH,EAAW,2BAEhB7B,EAAkBsa,SAASra,WAAW4B,SAASrC,KAEhDqC,EAASzlB,UAAUjB,MAAQ6tB,EAAOnH,SAElC,MAAMwY,EAAS,KAAS,gBACxBA,EAAOj/B,IAAID,MAAQ,EACnBk/B,EAAOh/B,IAAIF,MAAQ,EACnBk/B,EAAO3+B,SAAWstB,EAAOttB,SACzB2+B,EAAO1+B,UAAYqtB,EAAOrtB,UAE1B,MAAM4+B,EAAK,oCACXA,EAAGt/B,KAAO,WACVs/B,EAAGr/B,UAAUC,MAAQ6tB,EAAO5G,YAC5BmY,EAAGt9B,EAAE9B,MAAQ6tB,EAAO9G,YAEpB,MAAMsY,EAAK,oCACXA,EAAGv/B,KAAO,UACVu/B,EAAGt/B,UAAUC,MAAQ6tB,EAAO7G,YAC5BqY,EAAGv9B,EAAE9B,MAAQ6tB,EAAOhH,YAEpB,MAAMtnB,EAAS,4BAsBf,OArBAA,EAAOkC,KAAKzB,MAAQ6tB,EAAOpsB,KAE3BilB,EAASvmB,QAAQ++B,GACjBA,EAAO/+B,QAAQi/B,GACfA,EAAGj/B,QAAQk/B,GACXA,EAAGl/B,QAAQZ,GAEI,CACdsuB,OAAAA,KACG3G,EAAkBR,EAAUnnB,GAC/B+uB,SAAU,CACT5H,SAAU4C,GAAO5C,EAASzlB,UAAUjB,MAAQspB,EAC5C9oB,UAAW8oB,GAAO4V,EAAO1+B,UAAY8oB,EACrC/oB,SAAU+oB,GAAO4V,EAAO3+B,SAAW+oB,EACnCrC,YAAaqC,GAAO8V,EAAGr/B,UAAUC,MAAQspB,EACzCvC,YAAauC,GAAO8V,EAAGt9B,EAAE9B,MAAQspB,EACjCtC,YAAasC,GAAO+V,EAAGt/B,UAAUC,MAAQspB,EACzCzC,YAAayC,GAAO+V,EAAGv9B,EAAE9B,MAAQspB,EACjC7nB,KAAM6nB,GAAO/pB,EAAOkC,KAAKzB,MAAQspB,MOxD9B,GAAS,YAAc,aAQhBgW,GAAkB,KAC9B,MAAMC,EAAa1W,GAAiBA,EAAO,IAAIA,IAAS,GAExD,MAAO,CAGN2W,0BAA4BC,IAC3B,MAAMC,EAAWD,EAAK9kB,QAAQka,OAAO,mCAAoC,MAAM,iBAAsB0K,EAAU,eAG/G,OAFIG,IAAaD,GAChB,GAAO5f,MAAM,gCAAgC4f,QAAWC,KAClDA,GAGRC,cAAe,CAACF,EAAcG,EAAoB,KAC1C,GAAG,oBAZW,CAACA,GAAsBA,EAAY,GAAGA,KAAe,GAYvCC,CAAeD,KAAa,iBAAsBL,EAAU,eAAoBE,IAGpHK,YAAcC,GACN,GAAG,kBAAuB,eAAoBR,EAAU,aAAkBQ,MAO3DT,KClCzB,IAAIU,GACAC,GAAsB,IAAO,GAC7B,GAAS,YAAc,iBACvBC,GAAS,EACTC,GAAS,IAAIrQ,IAQbsQ,GAAc,KACjBD,GAAOvc,SAAQ,CAACyc,EAAOjW,KACtB,IAAI,MAAE+Q,EAAK,IAAEmF,EAAG,SAAE12B,GAAay2B,EAC3B3Y,GAAM,IAAIjJ,MAAOyJ,UACrB,GAAIiT,EAAQzT,IACXyY,GAAO1W,OAAOW,QAEK,IAARkW,GAAuBA,EAAM5Y,EAAM,KAC7C,IACC9d,IACC,MAAM5H,GACP,GAAOwF,MAAM,sCAAsC4iB,IAAMpoB,EAAGq+B,OAK5C,IAAhBF,GAAOhpB,KACVopB,UACmC,IAAlBP,KACjBA,GAAgBh7B,OAAOb,WAAWi8B,GAAaH,MAItCO,GAAsBpW,IAChC+V,GAAO1W,OAAOW,IAGJqW,GAAmB,CAAC72B,EAAqBo1B,EAAetP,UACrC,IAAlBsQ,IACVU,KAED,IACIvF,GADM,IAAI1c,MAAOyJ,UACH8W,EACdsB,EAAM5Q,EAAQyL,EAAQzL,OAAQtgB,EAC9Bgb,EAAK8V,KAET,OADAC,GAAO9+B,IAAI+oB,EAAI,CAAE+Q,MAAAA,EAAOmF,IAAAA,EAAK12B,SAAAA,IACtBwgB,GAGGsW,GAAoB,UACD,IAAlBV,KACVA,GAAgBh7B,OAAOb,WAAWi8B,GAAaH,MAItCM,GAAmB,KAC7BP,QAAgB5wB,EAChBpK,OAAO27B,aAAaX,KClDrB,MAAM,GAAS,YAAc,eCNhBY,GAAgDC,IAE5D,MAAMC,EAAkC,GAGxC,MAAO,CAENC,eAAiB/2B,GAAY82B,EAAO92B,GACpCg3B,YAAch3B,IACR82B,EAAO92B,KACX82B,EAAO92B,GAAO62B,EAAW72B,IACnB82B,EAAO92B,gBCVjB,MAAM,GAAS,YAAc,qBA4CE,QAA/B,aAAci3B,yBAAiB,YAAjBA,kBApCyB,MACtC,GAAOzlB,KAAK,6BACZ,MAAM0lB,EAAYN,GAA6Ctd,GACzD6d,EAAe7d,IACrBte,OAAOo8B,iBAAiB,WAAWC,UAClC,IAAI,QAAE9F,EAAO,OAAE1N,EAAM,MAAEnB,GAAU2U,EAAM59B,KACvC,GAAIipB,IAAU,mBACb,OAED,IAAI4U,EAAM,CAAE/F,QAAAA,EAAS1N,OAAAA,GACrBsT,EAAaxd,OAAO2d,GACiB,QAArC,EAAAJ,EAAUH,eAAeO,EAAI/F,gBAAQ,SAAE5X,OAAO2d,MAG/C,MAAML,EAAoB,CACzBC,UAAY3F,GAAoB2F,EAAUF,YAAYzF,GACtD4F,aAAAA,EACAI,YAAa,CAAChG,EAAiB1N,KAC9B,IAAK,oBACJ,OAGD,IAAIyT,EAAM,CAAE/F,QAAAA,EAAS1N,OAAAA,EAAQnB,MAAO,oBACpC,gCAAqC4U,EAAK,OAQ5C,OAJAL,EAAkBC,UAAU,uBAAuBpd,aACjDwd,IAAoB,QAAeA,EAAIzT,OAAOnB,SAGzCuU,GAK4BO,IAE7B,MAAMP,GAAoB,oCChDjC,MAAM,GAAS,YAAc,eAE7B,MAAMQ,GAILl6B,YAAY2B,EAAc2a,GACzBhf,KAAK0e,UAAY,GACbM,GACHhf,KAAK0e,UAAU3iB,KAAKijB,GAErBhf,KAAK68B,UAAY,cAAcx4B,IAGhC4a,YAAYD,GAIX,OAHAhf,KAAK0e,UAAU3iB,KAAKijB,GACpBxgB,SAAS+9B,iBAAiBv8B,KAAK68B,UAAW7d,GAEnC,KACNxgB,SAASs+B,oBAAoB98B,KAAK68B,UAAW7d,IAI/C4F,SACC5kB,KAAK0e,UAAUK,SAASC,IACvBxgB,SAASs+B,oBAAoB98B,KAAK68B,UAAW7d,aAEvC+d,GAAO/8B,KAAK68B,WAGpBG,SAASnW,GACR,MAAM2V,EAAQ,IAAI5V,YAAY5mB,KAAK68B,UAAW,CAC7ChW,OAAQA,MAAAA,EAAAA,EAAU,OAEnBroB,SAASmoB,cAAc6V,GACvBJ,GAAkBM,YAAY,2BAA4B,CACzDG,UAAW78B,KAAK68B,UAChBI,YAAapW,KAUC,QAAjB,mBAAiB,SAAjB,SAAsB,IACf,MAAMkW,GAA2B,SA8Cf,QAAzB,aAAcG,mBAAW,YAAXA,YA5CY,MACzB,GAAOvmB,KAAK,uBAEZylB,GAAkBC,UAAU,4BAA4Bpd,aACtDwd,IACA,MAAMD,EAAQ,IAAI5V,YAAY6V,EAAIzT,OAAO6T,UAAW,CACnDhW,OAAQ4V,EAAIzT,OAAOiU,aAAe,OAEnCz+B,SAASmoB,cAAc6V,MAIzB,IAAIL,EAAeU,SAEG,IADTE,GAAOF,KAElBE,GAAOF,GAAa,IAAID,GAAgBC,IAElCE,GAAOF,IAGf,MAAO,CACNlK,IAAK,CAACkK,EAAmB7d,KACxB,MAAMwd,EAAQL,EAAYU,GAC1B,YAAiBtyB,IAAbyU,EACIwd,EAAMvd,YAAYD,GAEnB,QAGR4F,OAASiY,IACHE,GAAOF,IAGZE,GAAOF,GAAWjY,UAGnBoY,SAAU,CAACH,EAAmBhW,KAC7BsV,EAAYU,GAAWG,SAASnW,MAOLsW,IAEvB,MAAMD,GAAc,iBAK3BA,GAAYvK,IAAI,gBC/FhBuK,GAAYvK,IAAI,mBAChBuK,GAAYvK,IAAI,kBAEhB,MAAM,GAAS,YAAc,eCTYj1B,MAOEA,MAOAA,MAQpC,MAAM0/B,WAAoB1/B,MAChCgF,YAAYH,GACX81B,QACAr4B,KAAKqE,KAAO,cACZrE,KAAK02B,QAAU,sBAAsBn0B,YAGE7E,MC3BzC,MAAM,GAAS,YAAc,iBCAhB,GAAgB+mB,GAC5BrU,KAAKG,MAAMH,KAAKC,UAAUoU,IAEd4Y,GAAe,CAACC,EAAkB7Y,IAC9C0I,WAAW1I,IAAQ6Y,EACPC,GAAoB9Y,GAChC4Y,GAAa,EAAG5Y,GACJ+Y,GAAmB/Y,GAC/B4Y,GAAa,EAAG5Y,GAEJgZ,GAA6BvtB,GACjB,IAAxBqtB,GAAiBrtB,GAqBLwtB,GAAyB1U,IAAgD,OACrF2U,MAAO3U,EAAO3kB,KACdu5B,eAAgBC,GAA8B7U,GAC9C/tB,MAtBgCA,EAsBT+tB,EAAO/tB,KAtBqCA,GAAQ,OAuB3E6iC,WAAY9U,EAAO+U,cACnBC,UAAWC,GAAejV,EAAOzD,IACjC2Y,cAAeC,GAA6BnV,IAzBb,IAAC/tB,GA4BpB4iC,GAAiC7U,IAC7C,MAAMoV,EAAiBX,GAA0BzU,EAAOqV,UAClDC,EAAiBb,GAA0BzU,EAAOuV,UAClDC,EAAQxV,EAAOyV,eACf5F,EAlBkB,EAACuF,EAAwBE,IACjDF,EAAiB,GACdE,EAAiB,GACjBrR,KAAKyR,IAAIJ,EAAiBF,GAAkB,KAelCO,CAAUP,EAAgBE,GAEvC,MAAO,CACNE,MAAAA,EACA3F,KAAAA,EACA+F,OAJc/F,GA5BW,CAAC7P,GACX,YAAhBA,EAAO/tB,OAEsB,WAA1B+tB,EAAOyV,iBAEqB,IAA3BzV,EAAO6V,iBAuBYC,CAAY9V,GAKlCoV,eAAAA,EACAE,eAAAA,EACAS,eAAgB/V,EAAOgW,yBAA2B,QAAU,MAC5DC,gBAAiBxB,GAA0BzU,EAAOkW,iBAClDC,gBAAiB1B,GAA0BzU,EAAOoW,iBAClDC,iBAAkBrW,EAAOsW,SAAWtW,EAAOsW,SAASxa,IAAIya,IAA8B,KAI3EpB,GAAgCnV,UAE5C,GADuB,QAAvB,EAAAA,EAAOwW,wBAAgB,QAAvBxW,EAAOwW,kBAAqB,GACvBxW,EAAOwW,iBAEZ,MAAO,CACNC,QAASlC,GAAiBvU,EAAO0W,cACjCC,QAASpC,GAAiBvU,EAAO4W,cACjCC,SAAUtC,GAAiBvU,EAAO8W,WAClCC,SAAUxC,GAAiBvU,EAAOgX,WAClC1e,MAAOic,GAAiBvU,EAAO1H,SAIpBie,GAA8BvW,IAA8C,OACxFiX,eA3DoBxb,EA2DOuE,EAAOkX,OAAO,GA1DjC,IAARzb,IAA8B,IAARA,GA0DmB,MACzCpgB,KAAM2kB,EAAO3kB,KACb0c,SAAU0c,GAA0BzU,EAAOlpB,KAC3C+gB,IAAKmI,EAAOnI,IACZsf,SAAUC,GAAcpX,EAAOqX,MAAQrX,EAAOzD,IAC9C+a,QAAS9C,GAAgBxU,EAAOuX,UAChCC,QAAShD,GAAgBxU,EAAOyX,WAjEb,IAAChc,GA2ERwZ,GAAkB1Y,GAC9BA,GAAMqD,OAAOrD,EAAGzP,QAAQ,KAAK,KACjBsqB,GAAiB7a,GAC7BA,GAAMqD,OAAOrD,EAAGzP,QAAQ,KAAK,KC/FjB4qB,GAAoB,CAAC5b,EAAyBkZ,IAC1D,IAAIlZ,EAAI6b,UACNjQ,QAAO,EAAEvrB,EAAK5G,KAAaA,EAAQy/B,YAAcA,IAEvC4C,GAAmB,CAAC9b,EAAwBqb,IACxD,IAAIrb,EAAI6b,UACNjQ,QAAO,EAAEvrB,EAAK07B,KAAYA,EAAOV,WAAaA,ICV3C,GAA+BriB,YC0BrCof,GAAYvK,IAAI,gBAEhB,MAAM,GAAS,YAAc,sBAE7B,IAAImO,GAAa,EACbC,GAAoB,EACpBC,GAAgB,EAepB,MC3CaC,GAAmB,KAC/B,MAAMnc,EAAM,IAAImG,IACViW,EAAWziB,IAEjB,MAAO,CACNkiB,OAAQ,IAAM7b,EACdvoB,IAAK,IAAMuoB,EACXuF,OAAQ,IAAM6W,EAASpiB,OAAOgG,GAC9Boc,SAAAA,EACAC,OAASC,IACRA,EAAOtc,GACPoc,EAASpiB,OAAOgG,IAEjBuc,UAAYD,IACPA,EAAOtc,IACVoc,EAASpiB,OAAOgG,MCZPwc,GAAmB,EAAGrnB,OAAAA,GAAkB,MACpDA,EAASA,GAAUgT,KAAKQ,SAASJ,QAAQ,GACzC,IAAIxwB,EAAI,EACR,MAAO,CACNw+B,OAAQ,IAAM,GAAGphB,KAAUpd,QCKvB,GAAS,YAAc,qBAG7BqgC,GAAYvK,IAAI,eCNhBuK,GAAYvK,IAAI,cAOT,MAAM4O,GAAqB,EAAGC,YAAAA,EAAaC,WAAAA,MACjDA,EAAaA,GAAcH,KAE3B,MAAMI,EAAYT,KAEZU,EDgBgC,GAAGH,YAAAA,EAAaC,WAAAA,EAAYC,UAAAA,MAClE,MAAM,aAAEE,GAAiBJ,EACzBC,EAAaA,MAAAA,EAAAA,EAAcH,KAE3B,MAAMO,EAAS,CACdC,sBAAuB,EAAG9Y,OAAAA,EAAQ+Y,UAAAA,EAAWC,OAAAA,EAAQC,OAAAA,MACpD,MAAMrjC,EAAoB,IACtBoqB,EACH9H,OAAQ,EAAsB8H,EAAOsX,QAAStX,EAAOwX,SACrD0B,KAAMT,EAAWpG,SACjB0G,UAAWA,MAAAA,EAAAA,EAAa,KAGzB,OAAOF,EAAOM,oBAAoB,CAAEvjC,KAAAA,EAAMojC,OAAAA,EAAQC,OAAAA,KAEnDE,oBAAqB,EAAGvjC,KAAAA,EAAMojC,OAAAA,EAAQC,OAAAA,EAAQG,YAAAA,oBAC7C,MAAMC,EAAST,EAAaS,OAAOzjC,EAAKk/B,YACxCkE,MAAAA,IAAAA,EAAWJ,EAAapY,OAAO6Y,MAAAA,OAAM,EAANA,EAAQ7Y,SACf,QAApB5qB,EAAKk/B,aACRkE,OAASz3B,GACV03B,MAAAA,IAAAA,EAAWL,EAAaU,cACxB,MAAM,YAAEC,EAAW,OAAErhB,EAAM,UAAE6gB,GAAcnjC,EAG3C,IAAI4jC,EACAC,EAIJ,GAPS,QAAT,EAAA7jC,EAAKsjC,YAAI,QAATtjC,EAAKsjC,KAAST,EAAWpG,UAOrBkH,EAAa,CAChB,MAAMvZ,EAA+B,QAAtB,EAAAqZ,MAAAA,OAAM,EAANA,EAAQK,sBAAc,QAAId,EAAae,cAAcD,eACpED,EAAazO,GAAoBhL,GACjCyZ,EAAWnnC,QAAQ2mC,GACnBA,EAASQ,EAIV,GAAIF,GAAeP,EAAQ,CAC1B,MAAMhZ,EAA+B,QAAtB,EAAAqZ,MAAAA,OAAM,EAANA,EAAQO,sBAAc,QAAIhB,EAAae,cAAcC,eACpEJ,EAAaxO,GAAoBhL,GACjCwZ,EAAWlnC,QAAQ0mC,GAGnBQ,EAAWnO,YAAY,CAAE7gB,EAAG,EAAGC,EAAG,EAAG4N,EAAG,GAAOkhB,EAAYnhB,YAC3D4gB,EAASQ,EAGV,IAAIK,EAAYZ,EAGhB,GAAID,EAAQ,CACX,MAAMc,EAAarP,KACnBqP,EAAWhP,KAAKx4B,QAAQ0mC,EAAO1f,OAC/BwgB,EAAW/O,KAAKz4B,QAAQ2mC,EAAO3f,OAC/B,MAAMygB,EAAyB,QAAf,EAAAV,MAAAA,OAAM,EAANA,EAAQU,eAAO,QAAInB,EAAae,cAAcI,QACxDC,EAAyB,QAAf,EAAAX,MAAAA,OAAM,EAANA,EAAQW,eAAO,QAAIpB,EAAae,cAAcK,QAC9DF,EAAWhP,KAAKl3B,KAAKzB,MAAQ4nC,EAC7BD,EAAW/O,KAAKn3B,KAAKzB,MAAQ6nC,EAC7BH,EAAYC,EAGb,MAAMG,EAAczB,EAAY0B,kBAAkBtkC,EAAKiiB,IAAKgiB,EAAWT,EAAalhB,GAEpF,IAAIiiB,EAEJ,MAAMC,EAAkC,IACpCxkC,EACHykC,OAAO,EACPC,WAAW,EACXL,YAAAA,EACAM,UAAW9kB,IACX+kB,QAASlf,gBACR,GAAK8e,EAAeC,MAApB,CAqBA,GAVA,GAAOroB,MAAM,EAAM;;eAETooB,EAAe/+B;eACf++B,EAAelB;cAChBtjC,EAAKiiB;QAEd8a,GAAmBwH,GACnBC,EAAeC,OAAQ,EAEvBJ,EAAYM,UAAUpkB,eAAeikB,EAAeI,SAChDP,EAAYQ,QAAS,CAExB,MAAMC,EAAWN,EAAerB,UAAYqB,EAAeriB,SAC3D,IAAI8B,EAAM,IACVqa,GAAYF,SAAS,aAAc,CAClCgB,UAAWoF,EAAepF,UAC1B2F,gBAAiBP,EAAeO,gBAChCxD,SAAUiD,EAAejD,SACzByD,WAAY3W,KAAKtN,IAAIsN,KAAKzN,IAAIkkB,EAAW7gB,EAAK,GAAI,MAAS,UAGtDogB,EAAYrL,OAIlB/U,EAAM,IACD+d,GAAiBc,EAAW0B,EAAejD,UAAUjW,MACzD,EAAE,CAAE2W,KACHA,EAAOqB,OAASkB,EAAelB,MAC5BrB,EAAOkB,WAAalf,GACpBA,EAAMge,EAAOkB,UAAYlB,EAAO9f,UAKhC8f,EAAO7C,YAAcoF,EAAepF,WACpC6C,EAAO8C,kBAAoBP,EAAeO,mBAE9CzG,GAAYF,SAAS,aAAc,CAClCgB,UAAWoF,EAAepF,UAC1B2F,gBAAiBP,EAAeO,gBAChCxD,SAAUiD,EAAejD,SACzByD,WAAY,IAIfpB,MAAAA,GAAAA,EAAYhgB,gBACZigB,MAAAA,GAAAA,EAAYjgB,gBAEZkf,EAAUP,QAAOrc,GAAOA,EAAIF,OAAOhmB,EAAKsjC,QAER,IAA5BR,EAAUf,SAASruB,OACE,QAAxB,yBAAwB,SAAEslB,QAE3BwL,EAAeG,UAAUzkB,cA9DxB,GAAOzZ,KAAK,EAAM;;gBAER+9B,EAAe/+B;gBACf++B,EAAelB;eAChBtjC,EAAKiiB;WAgEjBoiB,EAAYM,UAAUtkB,YAAYmkB,EAAeI,SAEjD,MAAMK,EAAeC,UAQpB,GAPA,GAAO9oB,MAAM,EAAM;;cAETooB,EAAe/+B;cACf++B,EAAelB;aAChBtjC,EAAKiiB;OAGV1gB,OAAO4jC,OAAQ,CAClB,MAAMlhB,EAAM,IAEZ1iB,OAAO4jC,OAAOC,cAAc,CAC3B/oC,KAAM,QACNy7B,QAAS,gBACTve,MAAO,OACPvZ,KAAM,IACFA,EACHqlC,WAAYrqB,KAAKiJ,MACjBqhB,QAAStlC,EAAKmjC,UAAYnjC,EAAKmiB,SAC/B4B,cAAeE,EACfshB,yBAA0BvlC,EAAKmjC,UAAYlf,EAC3CuhB,0BAA2BxqB,KAAKiJ,MAAQA,EACxCH,oBAAqBA,OAKxB,GAAI6f,EAAa,CAChB,IAAIxhB,EAAWniB,EAAKmiB,SAAW,IAG3BsjB,EAAW9B,EAAYnhB,SAC3B,MAAM,SAAE+V,GAAaoL,EAUrB,QAToBh4B,IAAhBu5B,IAGHO,EAAW1R,GAAI0R,EAAUjP,GAAS+B,EAAU2M,IAC5C/iB,GAAY+iB,GAEbrB,EAAWpO,YAAYgQ,GACvB5B,EAAW9N,YAAYwC,EAAUpW,QAEdxW,IAAfi4B,EAA0B,CAC7B,MAAM3f,EAAM,2BzBhL4B,EAACyhB,EAAkBD,EAAoBlN,EAAoB4K,EAAmBhhB,EAAkBwjB,EAAa,MAC1J,MAAMvhC,EAAS,IAAIC,MAAcshC,GACjC,IAAK,IAAI1nC,EAAI,EAAGA,EAAI0nC,EAAY1nC,IAAK,CACpC,MAGM2nC,EAAM7R,GAAI0R,EAAUjP,GAAS+B,EAFlBpW,GADHlkB,GAAK0nC,EAAa,MAKhCvhC,EAAOnG,GAAK,GAAO2nC,GAEpBF,EAAK7N,oBAAoBzzB,EAAQ++B,EAAWhhB,IyBuKvC0jB,CAA+BjC,EAAWloC,KAAKm6B,UAAW4P,EAAUlN,EAAUtU,EAAK9B,IAI7D,QAAxB,yBAAwB,SAAEuV,QAC1B2M,EAAYyB,KAAKZ,GACjBV,EAAeE,WAAY,EAC3B5B,EAAUrX,SAENzrB,EAAKo/B,YAAcp/B,EAAK+lC,kBAI3BnmC,SAASmoB,cACR,IAAIC,YAAY,wCAAyC,CAAEC,OAAQjoB,KAGpEs+B,GAAYF,SAAS,cAAe,CACnCgB,UAAWp/B,EAAKo/B,UAChB2F,gBAAiB/kC,EAAK+kC,gBACtBxD,SAAUvhC,EAAKuhC,SACfyD,WAAYhlC,EAAKmjC,UAAYnjC,EAAKmiB,SAAW,OAK1C8B,EAAM,IAkDZ,OAhDI1iB,OAAO4jC,QACV5jC,OAAO4jC,OAAOC,cAAc,CAC3B/oC,KAAM,QACNy7B,QAAS,wBACTve,MAAO,OACPvZ,KAAM,IACFA,EACHqlC,WAAYrqB,KAAKiJ,MACjBqhB,QAAStlC,EAAKmjC,UAAYnjC,EAAKmiB,SAC/B4B,cAAeE,EACfshB,yBAA0BvlC,EAAKmjC,UAAYlf,EAC3CuhB,0BAA2BxqB,KAAKiJ,MAAQA,EACxCH,oBAAqBA,OAMpBqf,GAAalf,EAAM,KACtB,GAAO7H,MAAM,EAAM;yDACkC,EAAsB6H,EAAMkf;cACvEnjC,EAAKyF;cACLzF,EAAKsjC;OAEf2B,EAAY,EAAqBhhB,EAAMkf,KAG/BA,GAAalf,GACrB,GAAO7H,MAAM,EAAM;;cAETpc,EAAKyF;cACLzF,EAAKsjC;OAEf2B,MAIAV,EAAcvH,GAAiBiI,EAAa9B,EAAYlf,EAAKjkB,EAAKmiB,UAClE,GAAO/F,MAAM,EAAM;gDACyB,EAAsB+mB,EAAYlf;cACpEjkB,EAAKyF;cACLzF,EAAKsjC;qBACEiB;QAIlBzB,EAAUP,QAAOrc,GAChBA,EAAItoB,IAAIoC,EAAKsjC,KAAMkB,KACbA,IAGT,OAAOvB,GC5RmB+C,CAAwB,CAAEpD,YAAAA,EAAaC,WAAAA,EAAYC,UAAAA,IAKvEmD,EAAe,CACpB/f,IAAK4c,EACLoD,WAAY,IAAMpD,EAAUf,SAC5BoE,uBAAwB5E,GACvBS,GAAiBc,EAAWvB,MAC1BwB,EACHqD,aAAe9C,GACdR,EAAUnlC,MAAMA,IAAI2lC,GAAMsB,UAC3ByB,YAAc9E,IAEb,MAAMtd,EAAM,IACZ,IAAI6gB,EAUJ,OATAmB,EAAaE,uBAAuB5E,GAAUzP,QAAO,EAAE,CAAEmQ,KACxDA,EAAOkB,WAAalf,GAAOA,EAAMge,EAAOkB,UAAYlB,EAAO9f,WAC1DhC,SAAQ,EAAE,CAAE8hB,MACb,MAAMqE,EAAerE,EAAOkB,UAAYlB,EAAO9f,WAC1C2iB,GAAYwB,EAAexB,KAC/BA,EAAWwB,MAINjY,KAAKtN,IAAIsN,KAAKzN,IAAIkkB,EAAW7gB,EAAK,GAAI,MAAS,GAEvDsiB,mCAAqCxB,IACpC,IAAIkB,EAAaC,aAAa9hC,UAC5B0tB,QAAQmQ,GAAWA,EAAO8C,kBAAoBA,IAC9C5kB,SAAS8hB,GAAWA,EAAO2C,aAE9B4B,2BAA6BjF,IAC5B0E,EAAaE,uBAAuB5E,GAAUphB,SAAQ,EAAE,CAAE8hB,MACpDA,EAAO7C,WAAc6C,EAAO8C,iBAChC9C,EAAO2C,cAIV6B,uBAAyBC,IACxB5D,EAAUf,SAASpkC,IAAI+oC,GAAY9B,WAEpC+B,eAAgB,IACR7kC,QAAQmC,IAAI,IAAI6+B,EAAUf,UAAU7b,KAAI,EAAE,CAAE+b,KAAYA,EAAO2C,aAEvEgC,2BAA6B3E,IACrB,CACNlnB,UAAW,IACXypB,eAAgB,IACZ,GAAoCvC,GACvCkB,UAAW,KAEZ0D,cAAe5E,IAGjB6E,WAAaC,GACZd,EAAa/C,sBAAsB,CAAE9Y,OAAQ,GAAoC2c,KAClFC,iBAAkB,CAACD,EAAgC5D,IAClD8C,EAAa/C,sBAAsB,CAAE9Y,OAAQ,GAAoC2c,GAAa5D,UAAAA,IAC/F8D,qBAAsB,CAACF,EAAgC7H,EAAiC,OAAQiE,IAC/F8C,EAAa/C,sBAAsB,CAAE9Y,OAAQ,IAAK,GAAoC2c,GAAa7H,WAAAA,GAAciE,UAAAA,IAClH+D,WAAY,EAAGvgB,GAAAA,KACdsf,EAAaO,2BAA2Bxc,OAAOrD,KAGjD,OAAOsf,GCtFR3H,GAAYvK,IAAI,oBCchBuK,GAAYvK,IAAI,sBAChBuK,GAAYvK,IAAI,eAST,MAAMoT,GAAsB,EAAGC,WAAAA,EAAYxE,YAAAA,EAAaqD,aAAAA,EAAcpD,WAAAA,MAC5EA,EAAaA,GAAcH,KAC3BuD,EAAeA,GAAgBtD,GAAmB,CAAEC,YAAAA,EAAaC,WAAAA,IAEjE,MAAMwE,EAAahF,KAEbiF,EDzBkC,GAAGD,WAAAA,MAE3C,MAAME,EAAmB,IAAIlb,IAgB7B,MAde,CACdkb,iBAAAA,EACAC,mBAAoB,CAACpI,EAAmB7iC,KACnCgrC,EAAiB5pC,IAAIyhC,KAAe7iC,IAExCgrC,EAAiB3pC,IAAIwhC,EAAW7iC,GAChCulC,GAAkBuF,EAAYjI,GAC5Bjf,SAAQ,EAAE,CAAExgB,KAAaA,EAAQ8nC,UAAUlrC,KAC7C+hC,GAAYF,SAAS,mBAAoB,CACxCgB,UAAAA,EACA9c,OAAQ/lB,QCWiBmrC,CAA0B,CAAEL,WAAAA,IAClDM,EC3B4B,GAAG/E,YAAAA,MACrC,MAAM,aAAEI,GAAiBJ,EACzB,IAAItgB,EAAS,EACb,MAAMslB,EAAW/nB,IAmCjB,MAlCe,CACd+nB,SAAAA,EAEAH,UAAY5hB,IACXvD,EAASuD,EACT+hB,EAAS1nB,OAAOoC,IAEjBulB,oBAAqB,CACpBrrC,EACAC,EACAqrC,EACAld,KAEA,MAAMmd,EAAahR,KACbiR,EAAajR,KACnBgR,EAAWxrC,MAAQ+lB,EACnB0lB,EAAWzrC,MAAQ+lB,EACnB9lB,EAAIE,QAAQqrC,GACZtrC,EAAIC,QAAQsrC,GACZD,EAAWrrC,QAAQkuB,GACfkd,GACHE,EAAWtrC,QAAQorC,GACnBA,EAAYprC,QAAQsmC,EAAaU,eAEjCsE,EAAWtrC,QAAQsmC,EAAaU,cAEjC,MAAMuE,EAAgB3lB,IACrBylB,EAAWzQ,YAAYhV,GACvB0lB,EAAW1Q,YAAYhV,IAGxB,OADAslB,EAASvnB,YAAY4nB,GACd,IAAML,EAASrnB,eAAe0nB,MDRjBC,CAAoB,CAAEtF,YAAAA,IAEtCuF,EE3B6B,KAAa,MAEhD,MAAMC,EAA6C,IAAI/b,IAEjDgc,EAA4BjJ,IACjC,GAAIgJ,EAAiBtb,IAAIsS,GACxB,OAAOgJ,EAAiBzqC,IAAIyhC,GAC7B,MAAMkJ,EAA0B,GAEhC,OADAF,EAAiBxqC,IAAIwhC,EAAWkJ,GACzBA,GAGFrF,EAAS,CACdsF,uBAAwB1oB,IACxBuoB,iBAAAA,EACAI,eAAiBC,IAChB,IAAI,cAAEH,GAAkBG,EACxB,MAAM,UAAErJ,EAAS,eAAEJ,EAAc,KAAE3iC,EAAI,WAAEqsC,GAAeD,GAClD,iBAAEhI,EAAgB,MAAEb,GAAUZ,EAEpC,GAAIyB,EAAiBxjC,QAAU,EAC9B,OAAOwjC,EAER,MAAMkI,OAA4Bh9B,IAAf+8B,EAChBra,KAAKQ,O5DiEuB,EAAC+Z,EAAO,KAC5B,IAATA,IAAYA,EAAO,GAChB,KACN,MAAMh0B,EAAuB,IAAnByZ,KAAKyI,IAAI8R,KACnB,OAAOh0B,EAAIyZ,KAAKC,MAAM1Z,K4DpElBi0B,CAAmBH,GAEtB,GAAc,WAAV9I,EACH,M5DqCsB,EAAIkJ,EAAyC7rC,KACtE,MAAMoK,EAAM,IAAIhD,M4DtEqB,I5DuErC,IAAK,IAAIpG,EAAI,EAAGA,EAAIoJ,EAAIpK,OAAQgB,IAC/BoJ,EAAIpJ,GAKqB,EAAIoJ,EAAUshC,EAAata,KAAKQ,SAC1DxnB,EAAIgnB,KAAKC,MAAMqa,IAAethC,EAAIpK,S4D7CxB8rC,CAAYtI,EAAkBkI,G5DyCxC,OAAOthC,G4D1CG2hC,GAKR,GADAV,MAAAA,IAAAA,EAAkBD,EAAyBjJ,IACvCkJ,EAAcrrC,QAAUwjC,EAAiBxjC,OAAQ,CACpD,MAAMgsC,EAAOX,EAAcA,EAAcrrC,OAAS,GAClDgmC,EAAOiG,mBAAmB9J,GAC1B6D,EAAOkG,oBAAoB/J,EAAW6J,GAGvC,IAAIG,EAAc,IAAI3I,GAEtB,MAAM4I,EAAaf,EAAcrrC,OAAS,EACvCqrC,EAAcA,EAAcrrC,OAAS,QACrC0O,EAEH,GAAc,YAAVi0B,E5DnCqB,EAAClrB,EAAcka,EAA8BP,KAAKQ,UAC7E,IAAK,IAAI5wB,EAAIyW,EAAMzX,OAAS,EAAGgB,EAAI,EAAGA,IAAK,CAC1C,MAAMqO,EAAI+hB,KAAKC,MAAMM,KAAkB3wB,EAAI,IACrCqrC,EAAO50B,EAAMzW,GACnByW,EAAMzW,GAAKyW,EAAMpI,GACjBoI,EAAMpI,GAAKg9B,I4D+BT,CAAqBF,EAAaT,GAC9BS,EAAY,GAAG7H,WAAa8H,GAC/BD,EAAYjsC,KAAKisC,EAAYjZ,cAE9B,GAAIkZ,EAAY,CACf,MAAME,GAAaH,EAAYn8B,QAC9Bm8B,EAAYI,MAAKvH,GAChBA,EAAOV,WAAa8H,KACnB,GAAKD,EAAYnsC,OACpBmsC,E5DsBsB,EAAI/hC,EAAUoY,KACxC,MAAMqM,EAAO,GACb,IAAK,IAAI7tB,EAAI,EAAGA,EAAIoJ,EAAIpK,OAAQgB,IAAK,CACpC,MAAMwrC,GAAMxrC,EAAIwhB,GAASpY,EAAIpK,OAC7B6uB,EAAK3uB,KAAKkK,EAAIoiC,IAEf,OAAO3d,G4D5BW4d,CAAYN,EAAaG,GAWzC,MAPa,YAATltC,IACH+sC,EAAcA,EACZtX,QAAOmQ,IAAWqG,EAAc7zB,SAASwtB,EAAOV,YAClD6H,EAAY1pB,OAAO,GACnBujB,EAAOkG,oBAAoB/J,EAAWgK,EAAY,GAAG7H,WAG/C6H,GAERF,mBAAqB9J,IACpBiJ,EAAyBjJ,GACvBniC,OAAS,EACXgmC,EAAOsF,uBACLroB,OAAOkoB,IAEVuB,sBAAuB,KACtBvB,EAAiBh6B,QACjB60B,EAAOsF,uBACLroB,OAAOkoB,IAEVe,oBAAqB,CAAC/J,EAAmBmC,KACxC,MAAM+G,EAAgBD,EAAyBjJ,GAE1CkJ,EAAc7zB,SAAS8sB,IAC3B+G,EAAcnrC,KAAKokC,GACpB0B,EAAOsF,uBACLroB,OAAOkoB,KAGX,OAAOnF,GF7DgB2G,GACjBC,ENaiC,GACvCzC,WAAAA,EAAYxE,YAAAA,EAAaqD,aAAAA,EACzBpD,WAAAA,EAAYwE,WAAAA,EAAYc,eAAAA,EACxBR,cAAAA,EAAeL,oBAAAA,MAEf,MAAM,aAAEtE,GAAiBJ,EAEnBkH,EAA8BpkB,MAAO0E,IAC1C,MAAM1lB,QAAiB0iC,EACrB2C,oBAAoB,8CAA+C,CACnEluB,OAAQ,OACRmuB,KAAMx4B,KAAKC,UAAU2Y,KAEvB,GAAwB,MAApB1lB,EAASf,OACZ,MAAM,IAAI7E,MAAM,iBAAiB4F,EAASf,UAC3C,aAAae,EAAS+kB,QA2BvB,IAAIwgB,GAA2B,EAE/B,MAAMhH,EAAS,CACdgH,gBAAAA,EACArhB,KAAM,EAAGshB,QAAAA,GAAU,GAAU,MAC5B,GAAOnyB,KAAK,qBAAqBmyB,KACjCD,EAAkBC,GAEnBC,mBAAqBC,IACpB,MAAMC,EAAWD,EAAYE,aAAaC,eAAeH,EAAYE,aAAaC,eAAettC,OAAS,GAC1G,IAAIutC,EAAYH,EAASlH,UACyB,QAA9CiH,EAAYpL,eAAemB,iBAC9BqK,GAAaH,EAASloB,UACvB,MAAMsoB,EFxF+B,GAAGnH,KAAAA,EAAMgH,aAAAA,KAAiBlgB,KACjE,GAAUA,GEuFiBsgB,CAAyBN,GAOlD,OANAK,EAAiBzL,eAAe2L,kBAAmB,EACnDF,EAAiBzL,eAAe4L,iBAAkB,EAElDH,EAAiBnC,cAAgB8B,EAAYE,aAAaC,eACxDrkB,KAAI+b,GAAUA,EAAOV,WACvBkJ,EAAiBtH,UAAYqH,EACtBC,GAERI,aAAcnlB,MAAO0E,KACpBA,EAAS,GAAUA,IACZ4U,eAAe8L,qBAAuB3C,EAAeK,eAAepe,GAC3E,MAAMggB,QACGN,EAA4B1f,GAGrC,IAAI,UAAE+Y,EAAS,aAAEmH,GAAiBF,EAClC,QAAkBz+B,IAAdw3B,EAAyB,CAC5B,MAAMkH,EAAWC,EAAaC,eAAeD,EAAaC,eAAettC,OAAS,GAC1DotC,EAASlH,UAAYkH,EAASloB,UAC5B,IAAkBghB,GAEhC,IACX38B,QAAQC,KAAK,qGACb08B,OAAYx3B,GAMd,OAHAw3B,MAAAA,IAAAA,EAAc,KACdmH,EAAaC,eACXpqB,SAAQ7M,GAAQA,EAAK6vB,WAAaA,IAC7BiH,GAERW,uBAAwBrlB,MAAO0E,IAC9B,MAAMggB,QAAoBnH,EAAO4H,aAAazgB,GAC9C,OAAO6Y,EAAO+H,qBAAqBZ,IAEpCY,qBAAsB,CAAChrC,EAAoBirC,GAAgB,WAC1D,MAAMhnB,EAAM,IAENtkB,EAAU,IACZK,EACHykC,OAAO,GAKR,IAAIyG,EACqD,IADlC,gDACIvrC,EAAQy/B,WAAWniC,QAC1C+C,EAAKsqC,aAAaC,eAAejf,MAAK2W,IAAWA,EAAO8D,oBAExDkE,IACHtqC,EAAQwrC,SAAWhhB,KAGpB,IAAIsZ,EAAST,EAAaS,OAAOzjC,EAAKk/B,iBACvBvzB,IAAX83B,IACH,GAAOh9B,KAAK,EAAM;;;cAGRzG,EAAKk/B;;eAEJv/B,EAAQo/B;YACXp/B,EAAQy/B;cACNz/B,EAAQ2jC;OAElBG,EAAST,EAAaS,OAAO,QAG9B,MAAM2H,EAAYrU,KACZsU,EAAYtU,KASlB,GAPAp3B,EAAQ8nC,UAAanlB,IACpB8oB,EAAU9T,YAAYhV,GACtB+oB,EAAU/T,YAAYhV,SAGA3W,IAAnBhM,EAAQ2iB,QACXglB,EAAoBE,mBAAmB7nC,EAAQy/B,UAAWz/B,EAAQ2iB,QAC/DglB,EAAoBC,iBAAiBza,IAAIntB,EAAQy/B,WAAY,CAChE,MAAM9c,EAASglB,EAAoBC,iBAAiB5pC,IAAIgC,EAAQy/B,WAChEgM,EAAU7uC,MAAQ+lB,EAClB+oB,EAAU9uC,MAAQ+lB,EAGnB,MAAMgpB,EAAgC,QAApBtrC,EAAKk/B,WACtBnI,KACEiM,EAAapY,OAAO6Y,EAAO7Y,QAC9B,IAAI2gB,EACc,YAAdvrC,EAAK3D,KACRkvC,EAA8B5D,EAAcE,oBAAoBuD,EAAWC,EAAW1rC,EAAQwrC,SAAUG,IAExGF,EAAU1uC,QAAQ4uC,GACd3rC,EAAQwrC,UACXE,EAAU3uC,QAAQiD,EAAQwrC,UAC1BxrC,EAAQwrC,SAASzuC,QAAQsmC,EAAaU,eAEtC2H,EAAU3uC,QAAQsmC,EAAaU,eAIjC,MAAMF,EAA2BxjC,EAAKwrC,UACnC,CACDC,OAAQzrC,EAAKwrC,UACbE,QAAS1rC,EAAKwrC,gBACX7/B,EAIL,IAAIggC,EA6GJ,GA/GAhsC,EAAQisC,qBAAuB,IAAIvf,IACnC1sB,EAAQksC,uBAAyB,IAAIxf,IAErC1sB,EAAQ2qC,aAAaC,eAAepqB,SAAS4mB,MACvC4E,GAAkB5E,EAAW5D,UAAYwI,KAC7CA,EAAiB5E,EAAW5D,WAE7B,MAAM2I,EAAc,KAGnB,GAAIb,GAAQlE,EAAW5D,UAAYlf,EAAK,CACvC,MAAM8nB,GAAY,IAAkBhF,EAAW5D,WAAa,IAC5D,GAAOprB,KAAK,EAAM;;6BAEKpY,EAAQksC,uBAAuBn4B;4BAChCq4B;;gBAEZhF,EAAWthC;gBACXshC,EAAWzD;;iBAEV3jC,EAAQo/B;cACXp/B,EAAQy/B;gBACNz/B,EAAQ2jC;aAEZ,CACNpB,IAAc,EAEd,IAAI8J,GAAc,IAAkBjF,EAAW5D,WAAa,IAC5DhB,GpD9HC,SAAiBvkC,EAAKquC,EAAU,EAAGC,EAAY,GACrD,IAAKtuC,IAAQA,EAAIgH,OAAOC,UACvB,MAAM/F,MAAM,kCAEb,IAAIqtC,EAAMF,EACNG,EAASF,EACb,IAAK,IAAIt3B,KAAKhX,EACbwuC,GAAU,EACVD,EAAMA,IAAQC,EAAS,GAAKA,GAAUx3B,EAAIw3B,EAE3C,OAAOD,EoDoHkB,CAAgB,CAACH,GAAa7J,GAAmBD,IACrEE,GAAgB/T,KAAKzN,IAAIorB,EAAY5J,IACrC,GAAOrqB,KAAK,EAAM;;6BAEKpY,EAAQksC,uBAAuBn4B;2BACjCwuB;iBACV8J;qBACI7J;qBACAC;;gBAEL2E,EAAWthC;gBACXshC,EAAWzD;;iBAEV3jC,EAAQo/B;cACXp/B,EAAQy/B;gBACNz/B,EAAQ2jC;SAInByD,EAAW3H,UAAYz/B,EAAQy/B,UAE/Bz/B,EAAQksC,uBAAuB7lB,OAAO+gB,EAAWzD,MACjD,MAAMrB,EAASgE,EAAa1C,oBAAoB,CAC/CC,YAAAA,EACAxjC,KAAM+mC,EACN3D,OAAQgI,EACR/H,OAAQgI,IAETpJ,EAAOoC,YAAYgI,OAAOhsB,aAAY,IACrC8nB,EAAegB,oBAAoBxpC,EAAQy/B,UAAW6C,EAAOV,YAC9DU,EAAO0C,UAAUtkB,aAAY,IAnMJ,EAAC1gB,EAA2B2sC,KACxD3sC,EAAQisC,qBAAqB5lB,OAAOsmB,GAEnC3sC,EAAQ8kC,OAC8B,IAAtC9kC,EAAQisC,qBAAqBl4B,MACW,IAAxC/T,EAAQksC,uBAAuBn4B,OAE/B/T,MAAAA,GAAAA,EAASilC,YA6LN2H,CAAqB5sC,EAASsiC,EAAOqB,QACtC3jC,EAAQisC,qBAAqBhuC,IAAIqkC,EAAOqB,KAAMrB,IAazCuK,EAAYzF,EAAW5D,UAAYsJ,IACrCD,EAAYvoB,GACftkB,EAAQksC,uBAAuBjuC,IAAImpC,EAAWzD,KAAM,IAChDyD,EACH2F,UAAW1P,GACV8O,EACAU,EAAYvoB,EACZwoB,IAAuB1F,EAAW5kB,YAGpC,GAAO/F,MAAM,EAAM;mCACWowB,EAAYvoB,GAAO;2BAC3BtkB,EAAQksC,uBAAuBn4B;yBACjCwuB;;eAEV6E,EAAWthC;eACXshC,EAAWzD;;gBAEV3jC,EAAQo/B;aACXp/B,EAAQy/B;eACNz/B,EAAQ2jC;SAKlBwI,OAGF,GAAO1vB,MAAM,EAAM;;0BAEIzc,EAAQksC,uBAAuBn4B;wBACjC/T,EAAQisC,qBAAqBl4B;;cAEvC1T,EAAK++B;WACR/+B,EAAKo/B;aACHp/B,EAAKsjC;MAGW,QAAtB,EAAA3jC,EAAQq/B,sBAAc,eAAEgB,OAAQ,CACnC,MAAM2M,EAAchtC,EAAQ2qC,aAAaC,eAAe,GACxD5qC,EAAQisC,qBAAqBjuC,IAAIgvC,EAAYrJ,MAAMe,YACjDgI,OAAOhsB,aAAY,IAhPH,CAAC1gB,IACrB,IAAKA,EAAQ8kC,MACZ,OACD,MAAMra,EAAS6Y,EAAOkH,mBAAmBxqC,GACzCsjC,EAAO8H,uBAAuB3gB,IA4ODwiB,CAAajtC,KA0DzC,OAvDAA,EAAQilC,QAAUlf,UACjB,IAAK/lB,EAAQ8kC,MAOZ,YANA,GAAOh+B,KAAK,EAAM;;gBAEP9G,EAAQo/B;aACXp/B,EAAQy/B;eACNz/B,EAAQ2jC;QAInB,GAAOlnB,MAAM,EAAM;;eAERzc,EAAQo/B;YACXp/B,EAAQy/B;cACNz/B,EAAQ2jC;OAElB3jC,EAAQ8kC,OAAQ,EAChB8G,MAAAA,GAAAA,IACA5rC,EAAQksC,uBAAuB1rB,SAAS0sB,IACvC9P,GAAmB8P,EAAiBH,cAErC/sC,EAAQksC,uBAAuBz9B,cACzBtM,QAAQmC,IAAI,IAAItE,EAAQisC,sBAC5B1lB,KAAI,EAAE,CAAE+b,KAAYA,EAAO2C,aAG7B,MAAMkI,EAAiB,cACF,QAAhB,EAAAntC,EAAQwrC,gBAAQ,eAAE4B,WACrB,GAAO3wB,MAAM,EAAM;;iBAERzc,EAAQo/B;cACXp/B,EAAQy/B;gBACNz/B,EAAQ2jC;SAElB5iC,WAAWosC,EAAgB,OAE3B1B,EAAUxnB,gBACVynB,EAAUznB,gBACM,QAAhB,EAAAjkB,EAAQwrC,gBAAQ,SAAEvnB,gBAClByjB,EAAW9E,QAAOrc,GAAOA,EAAIF,OAAOhmB,EAAKsjC,UAG3CwJ,KAGDzF,EAAW9E,QAAOrc,GAAOA,EAAItoB,IAAIoC,EAAKsjC,KAAM3jC,KAGxCurC,GACH5M,GAAYF,SAAS,eAAgB,CACpCgB,UAAWz/B,EAAQy/B,UACnB4N,kBAAmB3e,KAAKzN,IAAI+qB,EAAiB1nB,EAAK,KAI7CtkB,GAERstC,8BA7TqC7iB,IAA2B,IAC7DA,EACHkZ,KAAMT,EAAWpG,SACjB6N,cAAc,KAAAnrB,6BAA4BiL,EAAQyY,KA2TlDqK,6BAA8BpD,GAE/B,OAAO7G,GM/VoBkK,CAAyB,CACnD/F,WAAAA,EAAYxE,YAAAA,EAAaqD,aAAAA,EACzBpD,WAAAA,EAAYwE,WAAAA,EAAYc,eAAAA,EACxBR,cAAAA,EAAeL,oBAAAA,IAGVrE,EAAS,IACX4G,KACAvC,EACHa,eAAAA,EACAR,cAAAA,EACAyF,YAAa,IAAM/F,EAAWtF,SAC9B7b,IAAKmhB,EACLgG,kBAAoB/J,GACnB+D,EAAW9E,QAAOrc,GAAOA,EAAIvoB,IAAI2lC,GAAMsB,YACxC0I,yBAA0BlO,GACzB0C,GAAkBuF,EAAYjI,GAE7BtN,QAAO,EAAExM,EAAG3lB,KACZA,EAAQ2qC,aAAaC,eAAejf,MAAK2W,IAAWA,EAAO8D,sBAE7DM,YAAcjH,IAEb,IACI0F,EADA7gB,EAAM,IAWV,OATAgf,EAAOqK,yBAAyBlO,GAAWjf,SAAQ,EAAEmF,EAAG3lB,MACvD,IAAIsiC,EAAStiC,EAAQ2qC,aAAaC,eAAef,MAC/C9qC,GAAMA,EAAEykC,WAAalf,GAAOvlB,EAAEykC,UAAYzkC,EAAEyjB,SAAW8B,IAErDge,KAAY6C,GAAY7C,EAAOkB,UAAYlB,EAAO9f,SAAW2iB,KAChEA,EAAW7C,EAAOkB,UAAYlB,EAAO9f,aAIhCkM,KAAKtN,IAAIsN,KAAKzN,IAAIkkB,EAAW7gB,EAAK,GAAI,MAAS,GAEvDspB,uBAAwB,CAACnO,EAAmBoO,GAAgB,KAC3D1L,GAAkBuF,EAAYjI,GAC5Bjf,SAAQ,EAAE,CAAExgB,KAAaA,EAAQilC,YAC/B4I,GACHlP,GAAYF,SAAS,cAAe,CACnCgB,UAAAA,EACA4F,WAAY/B,EAAOoD,YAAYjH,MAIlCqO,gBAAiB,KAChB,IAAIC,EAAoB,IAAI5Z,IAC5B,OAAOhyB,QAAQmC,IAAI,IAAIojC,EAAWtF,UAAU7b,KAAI,EAAE,CAAEvmB,MAC9C+tC,EAAK5gB,IAAIntB,EAAQy/B,aACrBsO,EAAK3Z,IAAIp0B,EAAQy/B,WACjBd,GAAYF,SAAS,cAAe,CACnCgB,UAAWz/B,EAAQy/B,UACnB4F,WAAY/B,EAAOoD,YAAY1mC,EAAQy/B,cAGlCz/B,EAAQilC,eAGjB4C,mBAAoB,CAACpI,EAAmB9c,IACvCglB,EAAoBE,mBAAmBpI,EAAW9c,GACnDqrB,iBAAmBpxC,GAClBorC,EAAcF,UAAUlrC,GACzBqxC,YAAcjuC,GACbsjC,EAAO8H,uBAAuB,GAA+BprC,IAC9DkuC,eAAiBhrC,GAChBwkC,EAAW1pC,MAAMwiB,QAAQtd,GAE1BirC,4BAA6BpoB,MAAO/lB,EAA8BouC,EAAe,KAChF,MAAMC,EAAc,GAA+BruC,GAC7CsuC,QAAyBhL,EAAOiL,qBAAqBF,EAAaD,GAMxE,MALiB,CAChBhzB,UAAW,IACXkzB,iBAAAA,EACAE,eAAgBxuC,IAIlBuuC,qBAAsBxoB,MAAO0E,EAAwB2jB,EAAe,KACnE,IAAIK,QAAqBvE,EAAmBgB,aAAazgB,GACzD,MAAMikB,EAAY,CAACD,GACnB,IAAK,IAAInwC,EAAI,EAAGA,EAAI8vC,EAAc9vC,IAAK,CACtC,MAAMqwC,EAAazE,EAAmBM,mBAAmBiE,GACzDA,QAAqBvE,EAAmBgB,aAAayD,GACrDD,EAAUlxC,KAAKixC,GAEhB,OAAOC,IAgCT,OA5BAzuC,SAAS+9B,iBAAiB,yCAA0CC,IACnE,IAMI2Q,EANAxH,EAAanJ,EAAM3V,OAGnB+c,EAAa+B,EAAW5D,UAAY4D,EAAW5kB,SAAW,IAI9D8gB,EAAOqK,yBAAyBvG,EAAW3H,WAAWjf,SAAQ,EAAEmF,EAAG3lB,MAClE,IAAI6uC,EAAa7uC,EAAQ2qC,aAAaC,eAAef,MACnD9qC,GAAMA,EAAEykC,UAAY4D,EAAW5D,WAAazkC,EAAE4kC,OAASyD,EAAWzD,OAEhEkL,KAAgBD,GAAiBC,EAAWrL,UAAYoL,KAC3DA,EAAgBC,EAAWrL,cAG7B4D,EAAW0H,uBAAyBF,EACjCA,EAAgB,IAChBvJ,EAEH1G,GAAYF,SAAS,cAAe,CACnCgB,UAAW2H,EAAW3H,UACtB2F,gBAAiBgC,EAAWhC,gBAC5BC,WAAAA,EACAyJ,uBAAwB1H,EAAW0H,4BAI9BxL,GGpJF,GAAS,YAAc,gBCYhByL,GAAuB,CAACC,EAAuC,KAC3ElxC,OAAO2G,OAAOuqC,GACZC,SAAQjvC,GACRlC,OAAOgR,KAAK9O,EAAQkvC,UAOVC,GAA4B7M,IAAQ,CAChDqB,KAAKrB,EAAOqB,KACZ79B,KAAKw8B,EAAOx8B,KACZ87B,SAASU,EAAOtb,GAChBrE,OAAO2f,EAAO3f,OACd6gB,UAAyB,IAAflB,EAAOvK,MACjBvV,SAAuC,KAA7B8f,EAAOpF,IAAMoF,EAAOvK,OAC9BwH,WAAW+C,EAAOxG,OAClB4F,gBAAgBY,EAAOzf,SACvBmhB,YAAY1B,EAAOzf,UAAY,CAC9BA,SAASusB,GAAe9M,EAAOzf,UAC/B+V,SAASwW,GAAe9M,EAAO1J,WAEhCtW,IAAIggB,EAAOhgB,IACX8iB,gBAAgB9C,EAAO+M,kBACvBjJ,oBAAoB9D,EAAOgN,qBAGtBF,GAAkBrZ,IACvB,CAAE9gB,EAAE8gB,EAAI,GAAG7gB,EAAE6gB,EAAI,GAAGjT,EAAEiT,EAAI,KCtCrB,GAAS,YAAc,qBCM7B4I,GAAYvK,IAAI,gBAChBuK,GAAYvK,IAAI,kBAEhB,MAAM,GAAS,YAAc,UA2HZ,QAAjB,mBAAiB,SAAjB,SAhH4B,MAC3B,GAAOhc,KAAK,kBACZ,MAAMm3B,EAAYrT,KACZsT,EHnBqB,GAAED,UAAAA,EAAU10B,SAAAA,MAKvC,IACI40B,EAEAC,EAHAC,EAAU,EAEVrtC,EAAqB,OAGzB,MAAMstC,EAAkBpS,GAAqEtd,GAEvFojB,EAAS,CACd,YAAc,OAAOhhC,GACrB,UAAUutC,GACTvtC,EAAQutC,EACRvM,EAAOwM,cAAcvvB,OAAOje,IAG7BvF,QAASgpB,SACR,IAAI5jB,SAAc,CAACkB,EAASD,KAC3BkgC,EAAOhhC,MAAQ,aACf,MAAMggB,EAAMitB,EAAU7S,YAAY,2BAClCgT,EAAK,IAAIK,UAAUztB,GACnBotB,EAAGM,QAAU,KACZ1M,EAAOhhC,MAAQ,OAGfqtC,EAAUjhB,KAAKtN,IACdsN,KAAKzN,IA1BiB,EA0Bb0uB,EA5BU,KACJ,KA+BhBA,GAAWjhB,KAAKtN,IAAI/F,KAAKiJ,MAAQmrB,EAAcE,IAAY,EAC3D,GAAOv3B,KACN,mCAAmC,EAAqBu3B,eAEzD5uC,WAAWuiC,EAAOvmC,QAAS4yC,GAG3BF,OAAezjC,GAEhB0jC,EAAGnlC,QAAW0zB,IACb76B,IACqB,UAAjBkgC,EAAOhhC,QACVghC,EAAOhhC,MAAQ,SAEhBghC,EAAO1/B,QAAQ2c,OAAO0d,GACtByR,EAAG9lC,SAEJ8lC,EAAGxuC,UAAY+8B,IACO,WAAjBqF,EAAOhhC,QACVghC,EAAOhhC,MAAQ,UAEhB,MAAMjC,EAAOwR,KAAKG,MAAMisB,EAAM59B,MAC9B,GAAOoc,MAAM,+BAAgCpc,GAC7CijC,EAAOxF,UAAUvd,OAAOlgB,GACxBijC,EAAO2M,eAAe5vC,EAAK83B,SAAS5X,OAAOlgB,EAAKoqB,SAEjDilB,EAAGQ,OAAUjS,IACZ56B,IACAosC,EAAep0B,KAAKiJ,MACpBgf,EAAO6M,KAAK,CACXhY,QAAQ,WACRnO,WAAY,YACZV,MAAO,cAKXwU,UAAU5d,IACV+vB,eAAeL,EAAgBhS,YAE/BwS,UAAW,UACCpkC,IAAP0jC,GACH,GAAOt3B,KAAK,eACZu3B,EAAU,EACVD,EAAG9lC,SAEH,GAAOwO,KAAK,wCAGd+3B,KAAoC9vC,IACnC,GAAOoc,MAAM,2BAA4Bpc,GACzCqvC,EAAGS,KAAKt+B,KAAKC,UAAUzR,KAExBuD,QAAQsc,IACR4vB,cAAc5vB,KAGTmwB,EAAyC,CAC9CC,KAAO7lB,GAAW6Y,EAAO6M,KAAK,CAAEhY,QAAS,OAAQ1N,OAAAA,IAEjDrmB,MAAQqmB,GAAW,GAAOrmB,MAAMqmB,EAAO0N,SAEvCoY,yBAA0B,EAAG/T,UAAAA,EAAWgU,gBAAAA,MACvC,MAAOC,EAAQhrB,GAAQ+qB,EAAgBvpB,MAAM,KAC7C,aAAoB,GAAGuV,KAAaiU,IAChChrB,IAAM,SAAgBA,GAC1B,GAAOrN,KAAK,EAAO;gCACUm3B,EAAU7S,YAAY;MAEnD4G,EAAO8M,cAcT,OAVAtyC,OAAO0jB,QAAQ6uB,GACb7vB,SAAQ,EAAE5Z,EAAI1D,KACdogC,EAAO2M,eAAerpC,GAAK8Z,YAAYxd,KAEzCy7B,GAAYvK,IAAI,gBAAiB6J,KAC5BA,EAAM3V,OAAOe,WAAa4U,EAAM3V,OAAOgB,QAC1Cga,EAAO8M,eAIF9M,GGjGcoN,CAAa,CAAEnB,UAAAA,IAC9BtM,ElBlBA,UAA2B,UACjCsM,GACS,IAETA,EAAYA,GAAarT,KAEzB,MAAMmH,EmBfgC,MACtC,MAAMsN,EAAmC,GACzC,IAAIC,EAA+B,KAEnC,MAAMtN,EAAS,CACduN,aAAc3wB,IACd+I,KAAMlD,MAAO+qB,GAAa,KACtBA,QACIxN,EAAOyN,SCVoD,CACpE,QAAW,CACV,CACC,KAAQ,WACR,OAAU,gBACV,KAAQ,YACR,IAAO,kGAER,CACC,QAAW,IACX,eAAiB,EACjB,aAAgB,GAChB,aAAgB,IAChB,KAAQ,WACR,sBAAyB,GACzB,KAAQ,YAET,CACC,KAAQ,WACR,OAAU,gBACV,KAAQ,YACR,IAAO,yFAER,CACC,KAAQ,gBACR,OAAU,gBACV,KAAQ,YACR,IAAO,8FAER,CACC,KAAQ,cACR,OAAU,gBACV,KAAQ,YACR,IAAO,uGAER,CACC,KAAQ,uBACR,OAAU,gBACV,KAAQ,YACR,IAAO,uGAER,CACC,KAAQ,OACR,OAAU,gBACV,KAAQ,YACR,IAAO,wFAER,CACC,KAAQ,UACR,OAAU,gBACV,KAAQ,YACR,IAAO,wFAER,CACC,KAAQ,UACR,OAAU,gBACV,KAAQ,YACR,IAAO,wFAER,CACC,OAAU,KACV,KAAQ,GACR,KAAQ,aACR,OAAU,WACV,MAAS,GACT,QAAW,IACX,WAAc,GACd,KAAQ,cAET,CACC,KAAQ,eACR,OAAU,gBACV,KAAQ,YACR,IAAO,kGAER,CACC,KAAQ,kBACR,OAAU,gBACV,KAAQ,YACR,IAAO,kGAER,CACC,KAAQ,YACR,OAAU,gBACV,KAAQ,YACR,IAAO,0FAER,CACC,KAAQ,WACR,OAAU,gBACV,KAAQ,YACR,IAAO,yFAER,CACC,UAAa,gBACb,KAAQ,WACR,OAAU,eACV,KAAQ,OACR,QAAW,IAEZ,CACC,UAAa,gBACb,KAAQ,YACR,OAAU,eACV,KAAQ,OACR,QAAW,IAEZ,CACC,KAAQ,oBACR,OAAU,gBACV,KAAQ,YACR,IAAO,oGAER,CACC,KAAQ,YACR,OAAU,gBACV,KAAQ,YACR,IAAO,8FAER,CACC,aAAgB,EAChB,KAAQ,gBACR,OAAU,eACV,KAAQ,SACR,OAAU,GAEX,CACC,KAAQ,aACR,OAAU,gBACV,KAAQ,YACR,IAAO,2FAER,CACC,KAAQ,YACR,OAAU,gBACV,KAAQ,YACR,IAAO,0FAER,CACC,aAAgB,EAChB,KAAQ,eACR,OAAU,aACV,KAAQ,SACR,OAAU,GAEX,CACC,UAAa,IACb,KAAQ,GACR,YAAe,IACf,YAAe,GACf,YAAe,IACf,YAAe,GACf,KAAQ,cACR,OAAU,gBACV,SAAY,IACZ,SAAY,GACZ,KAAQ,YAET,CACC,KAAQ,gBACR,OAAU,gBACV,KAAQ,YACR,IAAO,gGAER,CACC,KAAQ,eACR,OAAU,gBACV,KAAQ,YACR,IAAO,6FAER,CACC,KAAQ,iBACR,OAAU,gBACV,KAAQ,YACR,IAAO,iGAER,CACC,KAAQ,iBACR,OAAU,gBACV,KAAQ,YACR,IAAO,iGAER,CACC,KAAQ,YACR,OAAU,gBACV,KAAQ,YACR,IAAO,yFAER,CACC,KAAQ,cACR,OAAU,gBACV,KAAQ,YACR,IAAO,4FAER,CACC,KAAQ,YACR,OAAU,gBACV,KAAQ,YACR,IAAO,0FAER,CACC,KAAQ,gBACR,OAAU,gBACV,KAAQ,YACR,IAAO,yFAER,CACC,SAAY,GACZ,QAAW,GACX,KAAQ,eACR,OAAU,gBACV,KAAQ,SAET,CACC,KAAQ,yBACR,OAAU,gBACV,KAAQ,YACR,IAAO,2GAER,CACC,KAAQ,YACR,OAAU,gBACV,KAAQ,YACR,IAAO,2FAER,CACC,KAAQ,oBACR,OAAU,gBACV,KAAQ,YACR,IAAO,oGAER,CACC,KAAQ,mBACR,OAAU,gBACV,KAAQ,YACR,IAAO,mGAER,CACC,KAAQ,gBACR,OAAU,gBACV,KAAQ,YACR,IAAO,gGAER,CACC,KAAQ,0BACR,OAAU,gBACV,KAAQ,YACR,IAAO,8GAER,CACC,KAAQ,0BACR,OAAU,gBACV,KAAQ,YACR,IAAO,8GAER,CACC,KAAQ,gBACR,OAAU,gBACV,KAAQ,YACR,IAAO,8FAER,CACC,KAAQ,kBACR,OAAU,gBACV,KAAQ,YACR,IAAO,iGAER,CACC,UAAa,gBACb,KAAQ,aACR,OAAU,eACV,KAAQ,OACR,QAAW,IAEZ,CACC,UAAa,gBACb,KAAQ,WACR,OAAU,cACV,KAAQ,OACR,QAAW,GAEZ,CACC,UAAa,gBACb,KAAQ,YACR,OAAU,YACV,KAAQ,OACR,QAAW,MAGb,QAAW,CACV,MAAS,CACR,QAAW,EACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,GACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,EACX,MAAS,EACT,KAAQ,WAET,OAAU,WACV,KAAQ,QACR,eAAkB,CACjB,cAAiB,cACjB,YAAe,GACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,MAAS,CACR,QAAW,EACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,EACX,MAAS,EACT,KAAQ,WAET,OAAU,WACV,KAAQ,QACR,QAAW,GACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,WAAc,CACb,QAAW,EACX,OAAU,gBACV,KAAQ,aACR,QAAW,IAEZ,SAAY,CACX,OAAU,cACV,KAAQ,YAET,oBAAqB,CACpB,QAAW,EACX,OAAU,uBACV,KAAQ,oBACR,QAAW,IAEZ,KAAQ,CACP,OAAU,OACV,KAAQ,QAET,KAAQ,CACP,OAAU,UACV,KAAQ,QAET,eAAgB,CACf,QAAW,GACX,OAAU,kBACV,KAAQ,eACR,QAAW,GAEZ,OAAU,CACT,QAAW,EACX,OAAU,YACV,KAAQ,SACR,QAAW,IAEZ,MAAS,CACR,QAAW,EACX,OAAU,WACV,KAAQ,QACR,QAAW,IAEZ,QAAW,CACV,QAAW,EACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,sBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,EACX,MAAS,EACT,KAAQ,WAET,OAAU,gBACV,SAAW,EACX,KAAQ,UACR,QAAW,EACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,sBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,iBAAkB,CACjB,QAAW,EACX,OAAU,oBACV,KAAQ,iBACR,QAAW,IAEZ,OAAU,CACT,OAAU,YACV,KAAQ,UAET,QAAW,CACV,OAAU,aACV,KAAQ,WAET,OAAU,CACT,QAAW,EACX,OAAU,YACV,KAAQ,SACR,QAAW,IACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,aAAc,CACb,OAAU,gBACV,KAAQ,cAET,UAAa,CACZ,OAAU,eACV,KAAQ,YACR,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,IAAO,CACN,OAAU,gBACV,KAAQ,OAET,cAAe,CACd,QAAW,EACX,OAAU,iBACV,KAAQ,cACR,QAAW,IAEZ,cAAe,CACd,QAAW,EACX,OAAU,iBACV,KAAQ,cACR,QAAW,IAEZ,MAAS,CACR,OAAU,YACV,KAAQ,SAET,SAAY,CACX,QAAW,EACX,OAAU,cACV,KAAQ,WACR,QAAW,GACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,OAAU,CACT,OAAU,YACV,KAAQ,UAET,aAAc,CACb,OAAU,gBACV,KAAQ,cAET,sBAAuB,CACtB,OAAU,yBACV,KAAQ,uBAET,iBAAkB,CACjB,QAAW,EACX,OAAU,oBACV,KAAQ,iBACR,QAAW,IAEZ,gBAAiB,CAChB,OAAU,mBACV,KAAQ,gBACR,QAAW,MAEZ,aAAc,CACb,QAAW,EACX,OAAU,gBACV,KAAQ,aACR,QAAW,IAEZ,uBAAwB,CACvB,QAAW,EACX,OAAU,0BACV,KAAQ,uBACR,QAAW,GACX,eAAkB,CACjB,cAAiB,cACjB,YAAe,IACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,uBAAwB,CACvB,QAAW,GACX,OAAU,0BACV,KAAQ,uBACR,QAAW,IACX,eAAkB,CACjB,cAAiB,UACjB,YAAe,IACf,YAAe,EACf,KAAQ,kBACR,OAAU,gBACV,aAAgB,OAChB,SAAY,CACX,EAAK,EACL,EAAK,EACL,EAAK,GAEN,QAAW,GACX,MAAS,EACT,KAAQ,YAGV,WAAc,CACb,QAAW,EACX,OAAU,gBACV,KAAQ,aACR,QAAW,IAEZ,eAAgB,CACf,QAAW,EACX,OAAU,kBACV,KAAQ,eACR,QAAW,KAGb,UAAa,yBD9mBJzN,EAAO0N,gB/EhBmB,K+EkBlCD,SAAUhrB,MAAOkrB,IAChBL,EAAOK,QACD3N,EAAO4N,kBAAkBN,EAAKO,UAErCH,gBAAiBjrB,MAAOzD,IACvB,MAAMvd,QAAiBsI,MAAMiV,GACvBwH,QAAa/kB,EAAS+kB,aACtBwZ,EAAOyN,SAASjnB,IAEvB,eAAiB,OAAO6mB,EAAoB,UAC5C,oBAAsB,OAAOC,EAAKQ,QAAiB,SACnD,mBAAqB,OAAOT,EAAU,kBACtC,kBAAoB,OAAOA,EAAU,iBACrC7M,OAASA,GACR8M,EAAKQ,QAAQtN,GACd7Y,OAAuCnlB,GACtC6qC,EAAU7qC,GACXurC,aAAe5mB,IACdmmB,EAAKQ,QAAQ3mB,EAAO3kB,MAAQ2kB,EAC5B6Y,EAAOgO,cAERJ,kBAAmBnrB,MAAOorB,IACzB7N,EAAOrf,sBACD9hB,QAAQmC,IAAI6sC,EAAQ5qB,IAAI+c,EAAOiO,cACrCjO,EAAOkO,gBAERD,YAAaxrB,MAAO0E,UACG,QAAtB,EAAAkmB,EAAUlmB,EAAO3kB,aAAK,SAAEme,gBACxB,MAAMgH,QAAeuQ,GAAgB/Q,EAAO/tB,MAAM+tB,GAClDkmB,EAAUlmB,EAAO3kB,MAAQmlB,GAE1BwmB,2BAA4B1rB,MAAO0E,UAC5B6Y,EAAOiO,YAAY9mB,GACzB6Y,EAAOkO,gBAERE,cAAgBzmB,UACf,GAAIA,EAAOR,OAAOtuB,OAAQ,CACzB,IAAKw0C,EAAU1lB,EAAOR,OAAOtuB,QAC5B,MAAM,IAAIgD,MAAM,2BAA2B8rB,EAAOR,OAAOtuB,UAC1D8uB,EAAOluB,QAAQ4zC,EAAU1lB,EAAOR,OAAOtuB,SAClB,QAArB,EAAA8uB,EAAOkK,sBAAc,cAArBlK,EAAwB0lB,QAGxB1lB,EAAO9uB,OAAOY,QAAQ,6BAExBy0C,aAAc,KACb1zC,OAAO2G,OAAOksC,GACZnwB,QAAQ8iB,EAAOoO,eACjBpO,EAAOgO,cAERK,YAAa,CAACC,EAAoBC,EAAmBj1C,WACpD,SAAyB,QAArB,EAAA+zC,EAAUiB,UAAW,eAAE1mB,SAAS2mB,MACnClB,EAAUiB,GAAY1mB,SAAS2mB,GAAWj1C,GAC1Cg0C,EA+B8B,EAACA,EAA8BgB,EAAoBC,EAAmBC,KAEvG,MAAM3lB,EAAO,IAAKykB,EAAMO,QAAS,IAAIP,EAAKO,UACpCY,EAAM5lB,EAAKglB,QAAQtH,MAAKjrC,GAAKA,EAAEkH,OAAS8rC,IACxC9xB,EAAQqM,EAAKglB,QAAQ7jC,QAAQykC,GAEnC,OADA5lB,EAAKglB,QAAQrxB,GAAS,IAAKiyB,EAAK,CAACF,GAAYC,GACtC3lB,GArCG6lB,CAAmBpB,EAAMgB,EAAYC,EAAWj1C,GACvDg0C,EAAKx1B,UAAY,KACV,IAITk2B,WAAY,KACXV,EAAKO,QAAUrzC,OAAO2G,OAAOksC,GAAWpqB,KAAI3nB,GAAKA,EAAE6rB,SACnDmmB,EAAKO,QAAQc,MAAK,CAAChzB,EAAG+P,IAAM/P,EAAEnZ,KAAOkpB,EAAElpB,KAAO,GAAK,IACnD8qC,EAAKx1B,UAAY,IAEjBkoB,EAAOuN,aAAatwB,OAAOqwB,IAE5B3sB,cAAe,KACdnmB,OAAOgR,KAAK6hC,GACVnwB,QAAQ8iB,EAAO4O,gBAElBA,cAAgBpsC,IACf6qC,EAAU7qC,GAAMme,uBACT0sB,EAAU7qC,IAGlBqsC,6BAA+BrsC,IAC9Bw9B,EAAO4O,cAAcpsC,GACrBw9B,EAAOkO,iBAGT,OAAOlO,GnB7Ec8O,GACfC,EJTqC,GAC3ChP,aAAAA,MAGA,MAAMiP,EAAoC,GACpCC,EAAc,IAAIC,QAkIxB,MAhIqB,CACpB7N,kBAAmB,CAAC8N,EAAKt2C,EAA+BknC,EAAaU,cAAgB+H,OAAAA,EAAQC,QAAAA,EAAS2G,UAAAA,EAAWC,SAAAA,GAA0B,GAAIC,KAU9I,IAAIrhB,EACJ,GARAua,MAAAA,IAAAA,EAAW,KACXC,MAAAA,IAAAA,EAAY,KACZ2G,MAAAA,IAAAA,EAAc,GACdC,MAAAA,IAAAA,EAAa,GACRE,SAASD,KACbA,EAAe,GAGZN,EAAch1C,OAAQ,CACzBi0B,EAAK+gB,EAAc9hB,QACnB,IAAIlyB,EAAI,EACR,KAAOizB,EAAGuhB,OAASx0C,EAAIg0C,EAAch1C,QACpCgB,GAAK,EACLg0C,EAAc90C,KAAK+zB,GACnBA,EAAK+gB,EAAc9hB,aAGpBe,EAAK,IAAIwhB,MACTxhB,EAAGyhB,UAAW,EACdzhB,EAAG0hB,YAAc,YACjBV,EAAYt0C,IAAIszB,EAAI,wCAA6CA,IAElE,MAAM5O,EAASyU,KAEf,IAAI8N,GAAU,EACd,MAAMwH,EAASxsB,IACT8kB,EAAY9kB,IAClB,IAAIgzB,EAEJ,MAAMC,EAAsB,IAC3BD,GAAkB9V,GAAmB8V,GAEhCxO,EyBxD6B,CAAC0O,IAEtC,IAAIC,GAAU,EACVC,GAAa,EACbC,EAAoB,EAexB,MAdiB,IACbH,EACHI,YAAa,KACZH,GAAU,EACNC,GACHF,EAAOjN,KAAKoN,IAEdpN,KAAOjN,IACNoa,GAAa,EACbC,EAAoBra,EAChBma,GACHD,EAAOjN,KAAKjN,MzBwCOua,CAAuB,CAC1CvO,QAAAA,EACAwH,OAAAA,EACA1H,UAAAA,EACAmB,KAAMpgB,MAAOmT,EAAc,KAC1B,MAAMlxB,QAAayqB,GAAapsB,QAAQosC,GACxClhB,EAAGkhB,IAAMttB,IAAI4B,gBAAgB/e,GAC7BupB,EAAG2H,YAAcA,EACjBvW,EAAO/lB,MAAQ,EACf20B,EAAGyM,iBAAiB,QAAS0V,SACvBniB,EAAG4U,OACTuG,EAAOnsB,SACP2yB,EAAiB7V,IAAiBtX,eAC3BpD,EAAOgV,YAAY,EAAGoU,EAAS,WACV,KAAzBxa,EAAG/O,SAAWupB,IACb7S,QACGvW,EAAOgV,YAAYib,EAAcF,EAAW,gBAE5C/vB,EAAOgV,YAAYib,EAAc9G,EAAQ,WAEjDzS,KAAMtT,UACAmf,GASL,GAAOzoB,MAAM,EAAM;;mBAELk2B;iBACFphB,EAAGkhB;cACNA;QAETU,UACMxwB,EAAOgV,YAAY,EAAGgb,SACtB1N,KAfL,GAAOxoB,MAAM,EAAM;;kBAEP8U,EAAGkhB;eACNA;YAgBNxN,EAAUlf,UACVmf,GAQL,GAAOzoB,MAAM,EAAM;;gBAEP8U,EAAGkhB;aACNA;OAETvN,GAAU,EACViO,UACM3c,GAAK,KACX7T,EAAOsB,gBACPsuB,EAAYv0C,IAAIuzB,GAAInzB,aACpBmzB,EAAG2H,YAAc,EACjB3H,EAAGoiB,QACHxuB,IAAIgC,gBAAgBoK,EAAGkhB,KACvBlhB,EAAGgN,oBAAoB,QAASmV,GAChCpB,EAAc90C,KAAK+zB,GACnByT,EAAUzkB,UAtBT,GAAO9D,MAAM,EAAM;;iBAEP8U,EAAGkhB;cACNA;SAsBLiB,EAAc,KACdxO,EAQLD,IAPC,GAAOxoB,MAAM,EAAM;;iBAEP8U,EAAGkhB;cACNA;SAeX,MARa1sB,WACZwsB,EAAYv0C,IAAIuzB,GAAIx0B,QAAQ4lB,EAAOoB,OACnCpB,EAAO5lB,QAAQZ,GAEfuoC,EAAY8O,eAEbvqB,GAEOyb,KI3HkBkP,CAA6B,CAAEvQ,aAAAA,IA6C1D,MA3CoB,CACnBA,aAAAA,EACApY,OAAQoY,EAAapY,OACrBhC,KAAMlD,MAAO8tB,GAAuB,WAC7BxQ,EAAapa,KAAK4qB,IAEzBC,gBAAkBl3C,IAEjB,GADAA,EAAQytB,OAAOztB,GACXytB,OAAOlV,MAAMvY,IAAUA,ElDtBL,GkDsB0BA,EAAQwqB,EACvD,MAAMjoB,MAAM,yBAAyBvC,MAEtC,GAAOwb,KAAK,sBAAsBxb,KAClCymC,EAAaU,aAAapM,YAAY/6B,GAEtC+hC,GAAYF,SAAS,kBAAmB7hC,IAEzCm3C,eAAiBn3C,IAEhB,GADAA,EAAQytB,OAAOztB,GACXytB,OAAOlV,MAAMvY,IAAUA,ElDhCL,GkDgC0BA,EAAQwqB,EACvD,MAAMjoB,MAAM,yBAAyBvC,MAEtC,GAAOwb,KAAK,qBAAqBxb,KACjCqS,EAAOua,YAAc5sB,EACrBymC,EAAa7Z,YAAYmO,YAAY/6B,GAErC+hC,GAAYF,SAAS,iBAAkB7hC,IAExC+nC,kBAAmB,CAAC8N,EAAat2C,EAA+B0nC,EAA2B+O,KAC1FH,EAAMlD,EAAUnT,0BAA0BqW,GAC3BJ,EAAmB1N,kBAAkB8N,EAAKt2C,EAAQ0nC,EAAa+O,IAG/EoB,aAC4B,IAAvB/kC,EAAOua,YAEV/nB,KAAKsyC,eAAe9kC,EAAOsa,kBAG3Bta,EAAOsa,gBAAkBta,EAAOua,YAChC/nB,KAAKsyC,eAAe,MkB9BHE,CAAkB,CAAE1E,UAAAA,IAClC2E,EAAoBjR,EAAYI,aAChCoE,EI5BA,UAA0B,UAChC8H,GACU,IACVA,EAAYA,GAAarT,KAEzB,MAAMuL,EAAa,CAClB0M,mBAAoBpuB,MAAOzD,EAAaoH,EAAO,GAAyB0qB,GAAsB,KAC7F1qB,EAAKtD,QAAU,IAAKsD,EAAKtD,QAAS,cAAiB,SAAS,WAC5D,MAAMrhB,QAAiBsI,MAAMiV,EAAKoH,GAElC,OADA0qB,GrBsBI,SAAqBrvC,GAE3B,GAAIA,EAASf,QAAU,IACtB,MAAM,IAAI66B,GAAY95B,EAASf,QqBzBPqwC,CAAYtvC,GAC5BA,GAERuvC,oBAAqBvuB,MAAOzD,EAAaoH,EAAO,GAAyB0qB,GAAsB,KAC9F,MAAMrvC,QAAiB0iC,EAAW0M,mBAAmB7xB,EAAKoH,EAAM0qB,GAChE,aAAarvC,EAASiD,QAEvBoiC,oBAAqBrkB,MAAOwuB,EAAiB7qB,EAAO,MACnD,MAAMpH,EAAMitB,EAAUhT,cAAcgY,GACpC,OAAO9M,EAAW0M,mBAAmB7xB,EAAKoH,KAI5C,OAAO+d,EJMY+M,CAAiB,CAAEjF,UAAAA,IAChCkF,EhB1BsB,GAAGhN,WAAAA,EAAY+H,aAAAA,MAE3C,MAAMkF,EAAW,KAChBlF,EAAaW,KACZ,CAAEhY,QAAS,eAIP2b,EAAmBnxB,IACxB6sB,EAAaW,KACZ,CAAEhY,QAAS,oBAAqB1N,OAAQ,CAAE9H,OAAQA,MAI9CqrB,EAAoBrrB,IACzB6sB,EAAaW,KACZ,CAAEhY,QAAS,qBAAsB1N,OAAQ,CAAE9H,OAAQA,MAI/CgyB,EAAgB5uB,MAAO6uB,IAExBA,EAAIt3C,OAAS,GAChB,GAAOwJ,KAAK,EAAO;gCACU8tC,EAAIt3C;;YAIrB6E,QAAQmC,IAAIswC,EAAIruB,KAAKsuB,IACjCpN,EAAW2C,oBAAoB,gCAAgCyK,gBAQ3DC,EAAY/uB,MAAO8uB,SACXpN,EAAW2C,oBAAoB,6BAA6ByK,WAOpEE,EAAehvB,MAAO6uB,IAEvBA,EAAIt3C,OAAS,GAChB,GAAOwJ,KAAK,EAAO;+BACS8tC,EAAIt3C;;YAIpB6E,QAAQmC,IAAIswC,EAAIruB,KAAKsuB,IACjCpN,EAAW2C,oBAAoB,+BAA+ByK,gBAQ1DG,EAAuBjvB,MAAO6uB,IAE/BA,EAAIt3C,OAAS,GAChB,GAAOwJ,KAAK,EAAO;uCACiB8tC,EAAIt3C;;YAI5B6E,QAAQmC,IAAIswC,EAAIruB,KAAKsuB,IAChCpN,EAAW2C,oBAAoB,iCAAiCyK,gBAQ7DI,EAAUlvB,eACF0hB,EAAW2C,oBAAoB,iCAOvC8K,EAAenvB,MAAO6uB,IAEvBA,EAAIt3C,OAAS,GAChB,GAAOwJ,KAAK,EAAO;+BACS8tC,EAAIt3C;;YAIpB6E,QAAQmC,IAAIswC,EAAIruB,KAAKsuB,IACjCpN,EAAW2C,oBAAoB,gCAAgCyK,gBAQ3DM,EAAWpvB,MAAO8uB,SACVpN,EAAW2C,oBAAoB,6BAA6ByK,WAOpEO,EAAsBrvB,MAAO6uB,IAE9BA,EAAIt3C,OAAS,GAChB,GAAOwJ,KAAK,EAAO;sCACgB8tC,EAAIt3C;;YAI3B6E,QAAQmC,IAAIswC,EAAIruB,KAAKsuB,IACjCpN,EAAW2C,oBAAoB,iCAAiCyK,gBAQ5DQ,EAActvB,MAAO6uB,IAEtBA,EAAIt3C,OAAS,GAChB,GAAOwJ,KAAK,EAAO;8BACQ8tC,EAAIt3C;;YAInB6E,QAAQmC,IAAIswC,EAAIruB,KAAKsuB,IACjCpN,EAAW2C,oBAAoB,+BAA+ByK,gBA6ChE,OArCAhX,GAAkBC,UAAU,uBAAuBpd,aACjDwd,GAAkBwW,MAEpB7W,GAAkBC,UAAU,8BAA8Bpd,aACxDwd,GAAkB4V,EAAgB5V,EAAIzT,OAAO9H,UAE/Ckb,GAAkBC,UAAU,+BAA+Bpd,aACzDwd,GAAkB8P,EAAiB9P,EAAIzT,OAAO0D,UAEhD0P,GAAkBC,UAAU,4BAA4Bpd,aACtDwd,GAAkByW,EAAczW,EAAIzT,OAAOmqB,OAE7C/W,GAAkBC,UAAU,wBAAwBpd,aAClDwd,GAAkB4W,EAAU5W,EAAIzT,OAAOoqB,MAEzChX,GAAkBC,UAAU,mCAAmCpd,aAC7Dwd,GAAkB8W,EAAqB9W,EAAIzT,OAAOmqB,OAEpD/W,GAAkBC,UAAU,2BAA2Bpd,aACrDwd,GAAkB6W,EAAa7W,EAAIzT,OAAOmqB,OAE5C/W,GAAkBC,UAAU,sBAAsBpd,aAChDwd,GAAkB+W,MAEpBpX,GAAkBC,UAAU,2BAA2Bpd,aACrDwd,GAAkBgX,EAAahX,EAAIzT,OAAOmqB,OAE5C/W,GAAkBC,UAAU,uBAAuBpd,aACjDwd,GAAkBiX,EAASjX,EAAIzT,OAAOoqB,MAExChX,GAAkBC,UAAU,kCAAkCpd,aAC5Dwd,GAAkBkX,EAAoBlX,EAAIzT,OAAOmqB,OAEnD/W,GAAkBC,UAAU,0BAA0Bpd,aACpDwd,GAAkBmX,EAAYnX,EAAIzT,OAAOmqB,OAGpC,CACNF,SAAAA,EACAZ,gBAAAA,EACA9F,iBAAAA,EACA2G,cAAAA,EACAG,UAAAA,EACAE,qBAAAA,EACAD,aAAAA,EACAE,QAAAA,EACAC,aAAAA,EACAC,SAAAA,EACAC,oBAAAA,EACAC,YAAAA,IgBzKqBC,CAAc,CAAE7N,WAAAA,EAAY+H,aAAAA,IAC5CtM,EAAaH,KACbuD,EAAetD,GAAmB,CAAEC,YAAAA,EAAaC,WAAAA,IACjDqS,EAAgB/N,GAAoB,CAAEC,WAAAA,EAAYxE,YAAAA,EAAaqD,aAAAA,EAAcpD,WAAAA,IAC7EsS,EDtBmB,GACzBD,cAAAA,EACAjP,aAAAA,EACAkJ,aAAAA,EACAvM,YAAAA,MAGA,MAAMzE,EAAS,CAEdiX,aAAcv1B,IACdw1B,iBAAkBx1B,KAGby1B,EAA0Bv6B,I3E/BE,CAACw6B,IAAe1xB,EAAmB7I,KAAKiJ,MAAQsxB,G2EgCjFC,CAAgC,IAAZz6B,GACnB,MAAMkb,EAAU,EAAqBnS,KACjCmS,EAAU,EACb,GAAOle,KAAK,yCAAyCke,cAC3CA,EAAU,GACpB,GAAOle,KAAK,2CAA2Cke,eAW1DkZ,EAAaS,eAAe,cAC1BvvB,aALwByX,IACzB,YAAmBA,EAAQnO,WAC3B,QAAemO,EAAQ7O,SAKxB,MAAMwsB,EAAmBxzC,IACM,IAA1B6hB,KACHwxB,EAAuBrzC,EAAM8Y,WAE9B26B,EAAkBzzC,GAAO,GAAM,IAEhCktC,EAAaS,eAAe,aAC1BvvB,YAAYo1B,GAedtG,EAAaS,eAAe,qBAC1BvvB,aAd8Bpe,IAGD,IAA1B6hB,KACHwxB,EAAuBrzC,EAAM8Y,WAE9B,MAAM46B,EAAWjH,GAAqBzsC,EAAM0sC,UACtCiH,ED5CiC,EAACjH,EAAuC,KAChFlxC,OAAOgR,KAAKkgC,GACVzoB,KAAKkZ,GAAc72B,SAAS62B,EAAW,MC0ClByW,CAA0B5zC,EAAM0sC,UACtDmH,IACEhkB,QAAQvzB,GAAMq3C,EAAcnhC,SAASlW,EAAE6gC,aAAeuW,EAASlhC,SAASlW,EAAE+kC,QAC1EnjB,SAAS5hB,GAAM22C,EAAc7H,kBAAkB9uC,EAAE+kC,QACnDyS,EAAmB9zC,MAKpB,MAAM8zC,EAAsB9zC,IAC3ByzC,EAAkBzzC,GAAO,GAAO,IAEjCktC,EAAaS,eAAe,gBAC1BvvB,YAAY01B,GAEd,MAAML,EAAoB,CACzBzzC,EACA+zC,GAAuB,EACvBC,GAAsB,KAEtB,MAAMC,EAAcj0C,EAAM0sC,SACpBwH,EAAal0C,EAAMm0C,QACnBC,EAAkBP,IAClBQ,EAAiBC,IACnBP,GACHQ,EAA6BN,EAAaG,GACvCJ,GACHQ,EAA4BN,EAAYG,GACzCI,EAAmBR,EAAaG,EAAiBL,GACjDW,EAAkBR,EAAYG,GAC9Br0C,EAAM20C,eAAiBhU,EAAY6Q,gBAAgBxxC,EAAM20C,eACzD30C,EAAM40C,gBAAkB3B,EAAcvH,iBAAiB1rC,EAAM40C,gBAEzD50C,EAAM60C,iBACT,GAAO/+B,KAAK,EAAM;;cAEP9V,EAAM60C;WACT70C,EAAM80C;MAEd5Y,EAAOkX,iBAAiBn1B,OAAO,CAC9B82B,QAAS/0C,EAAMg1C,iBACflY,MAAO98B,EAAM60C,eACbtC,GAAIvyC,EAAM80C,eAGR90C,EAAMi1C,aACT,GAAOn/B,KAAK,EAAM;;cAEP9V,EAAMi1C;WACTj1C,EAAMk1C;MAEdhZ,EAAOiX,aAAal1B,OAAO,CAAE6e,MAAO98B,EAAMi1C,WAAY1C,GAAIvyC,EAAMk1C,WAEjE,IAAIC,EAAU,EACVC,EAAY,EAUhB,GATAnC,EAAcrH,gBAAgBluC,IAC7By3C,GAAWz3C,EAAQisC,qBAAqBl4B,KACxC2jC,GAAa13C,EAAQksC,uBAAuBn4B,QAE7C,GAAO0I,MAAM,EAAM;;sBAECg7B;yBACGC;KAEnB91C,OAAO4jC,OAAQ,CAClB,MAAM,SAACwJ,KAAa2I,GAAYr1C,EAEhCV,OAAO4jC,OAAOC,cAAc,CAC3B/oC,KAAM,QACNy7B,QAAS,sBACTve,MAAO,OACPvZ,KAAM,IACFs3C,EACH3I,SAAUn9B,KAAKC,UAAUk9B,GACzB4G,WAA8B,IAAlBtzC,EAAM8Y,UAClBsqB,WAAYrqB,KAAKiJ,MACjBuhB,0BAA2BxqB,KAAKiJ,MAAQ,IACxCJ,iBAAkB7I,KAAKiJ,MAA2B,IAAlBhiB,EAAM8Y,UACtC+I,oBAAqBA,SAMnB4yB,EAAqB,CAACR,EAAyCG,EAAoCpL,UACpFt/B,IAAhBuqC,IAKJz4C,OAAO0jB,QAAQ+0B,GACbpkB,QAAO,EAAEsN,EAAWz/B,UAAgCgM,IAAnBhM,EAAQ2iB,QAAiE,IAAzC7kB,OAAO2G,OAAOzE,EAAQkvC,QAAQ5xC,SAC/FkjB,SAAQ,EAAEif,EAAWz/B,KAAau1C,EAAc1N,mBAAmBxd,OAAOoV,GAAYz/B,EAAQ2iB,UD9J/D,EAACqsB,EAAuC,KAC1ElxC,OAAO0jB,QAAQwtB,GACbC,SAAQ,EAAExP,EAAUz/B,KACpBlC,OAAO0jB,QAAQxhB,EAAQkvC,QAAU,IAC/B3oB,KAAI,EAAEod,EAAKiU,MAAsB,CACjCjU,KAAAA,EACAkI,UAAW7rC,EAAQ6rC,UACnBlpB,OAAQ3iB,EAAQ2iB,OAChB8c,UAAWpV,OAAOoV,GAClB/iC,KAAMsD,EAAQtD,KACd0iC,MAAMp/B,EAAQo/B,MACduL,aAAa,CACZC,eAAegN,EAAMrxB,IAAI4oB,KAE1B5P,WAAWv/B,EAAQ87B,aCkJtB+b,CAAoBtB,GAClBpkB,QAAO,EAAEwR,KAAAA,MACT,MAAMmU,EAAWpB,EAAgB/qB,MAAK/sB,GAAGA,EAAE+kC,OAASA,IAUpD,OATImU,GACH,GAAOr7B,MAAM,EAAM;;eAETknB;QAET,eAAgB4S,EAChB,mBAAoBG,IAGdoB,KAER7F,MAAK,CAAChzB,EAAG+P,IACT/P,EAAE0rB,aAAaC,eAAe,GAAGpH,UAC/BxU,EAAE2b,aAAaC,eAAe,GAAGpH,UAChC,GACC,IAEJhjB,SAAQngB,GAAOk1C,EAAclK,qBAAqBhrC,EAAMirC,OAGrDuL,EAA+B,CAACN,EAAyCG,IAC9EA,EACEvkB,QAAO4lB,IACNhJ,GAAqBwH,GACpB5qB,MAAKgY,GAAOA,IAASoU,EAAepU,SACtCnjB,SAAQ,EAAEmjB,KAAAA,KAAS4R,EAAc7H,kBAAkB/J,KAehDqT,EAAoB,CAACR,EAAwCG,KAC9DH,GACH14C,OAAO2G,OAAO+xC,GAAYrkB,QAAO,EAAGwR,KAAAA,MACnC,MAAMmU,EAAWnB,EAAehrB,MAAK5sB,GAAGA,EAAE4kC,OAASA,IAUnD,OATImU,GACH,GAAOr7B,MAAM,EAAM;;eAETknB;QAET,cAAe6S,EACf,kBAAmBG,IAGbmB,KAER7F,MAAK,CAAChzB,EAAG+P,IAAM/P,EAAE8Y,MAAQ/I,EAAE+I,MAAQ,GAAK,IACxCvX,SAAS8hB,UACT,MAAMjiC,EAAoB,IACtBiiC,EACHV,SAAUU,EAAOtb,GACjBxE,SAAU8M,EAAagT,EAAOpF,IAAMoF,EAAOvK,OAC3C2J,eAAe,EACf8B,UAAqC,QAA1B,EAAAlU,EAAagT,EAAOvK,cAAM,QAAI,KAE1CuO,EAAa1C,oBAAoB,CAAEvjC,KAAAA,QAKhCy2C,EAA8B,CACnCN,EAAuCG,IAEhCA,EAELxkB,QAAQ6lB,IAEAl6C,OAAOgR,KAAK0nC,GAAY7qB,MAAKgY,GAAQqU,EAAcvY,WAAakE,IAASqU,EAAcrU,SAE/FnjB,SAAQ,EAAEmjB,KAAAA,MACV2C,EAAaQ,uBAAuBnD,MAIvC6L,EAAaS,eAAe,iBAC1BvvB,aAzD6B,EAAEk0B,IAAAA,MAChCA,EAAIp0B,SAAQq0B,GAAKU,EAAc3H,uBAAuBiH,QAyDvDrF,EAAaS,eAAe,yBAC1BvvB,aAxDoC,EAAEk0B,IAAAA,MACvCA,EAAIp0B,SAAQq0B,GAAMvO,EAAaM,mCAAmCiO,QAwDnErF,EAAaS,eAAe,gBAC1BvvB,aAvD4B,EAAEk0B,IAAAA,MAC/BA,EAAIp0B,SAAQq0B,GAAMvO,EAAaO,2BAA2BgO,QAuD3DrF,EAAaS,eAAe,YAC1BvvB,aAAY,KACZ60B,EAAczH,kBACdxH,EAAaU,oBAEfwI,EAAaS,eAAe,qBAC1BvvB,aAAY,EAAEiC,OAAAA,MACdsgB,EAAY6Q,gBAAgBnxB,MAE9B6sB,EAAaS,eAAe,sBAC1BvvB,aAAY,EAAEiC,OAAAA,MACd4yB,EAAcvH,iBAAiBrrB,MAEjC6sB,EAAaS,eAAe,sBAC1BvvB,aAAY,EAAEm0B,GAAAA,EAAIlyB,OAAAA,MAClB4yB,EAAc1N,mBAAmBgN,EAAIlyB,MAGvC,MAAMwzB,EAAqB,IAAI,IAAIZ,EAAc9H,cAAchpC,UACzDmyC,EAAoB,IAGlB,IAAItQ,EAAaC,aAAa9hC,UAAU0tB,QAC7CmQ,IAAYA,EAAO7C,YAAc6C,EAAO8C,kBAO3C,MAAO,CACN5G,OAAAA,EACAsX,gBAAAA,EACAM,mBAAAA,ICtPkB6B,CAAW,CAAEhV,YAAAA,EAAasS,cAAAA,EAAejP,aAAAA,EAAckJ,aAAAA,IAM1E,MAAO,CACN3R,kBAAiB,GACjB0R,UAAAA,EACAC,aAAAA,EACAvM,YAAAA,EACAiR,kBAAAA,EACAO,cAAAA,EACAnO,aAAAA,EACAiP,cAAAA,EACAC,WAAAA,EACAvsB,KAAMlD,OACLmyB,UAAAA,EACA15C,QAAAA,EAAU,UACV0qB,cAAAA,EAAgB,GAChBivB,SAAAA,EACAC,WAAAA,EACAC,SAAAA,EAAW,QACQ,MACnB,IAAIC,EAA0B,SAExB,OAAY95C,EAAS0qB,GAEF,mBAAdgvB,SACJA,IAGP,MAAMK,EAAWxyB,qBA/BLA,iBACPkd,EAAYha,OAClBga,EAAY8Q,eAAe,qBACrBvE,EAAazyC,WA6BXg7B,GACN,GAAO3f,KAAK,qBAEY,QAAxB,yBAAwB,SAAE6Q,QAG3B,GAAkC,cAA9B,2BACGsvB,IAEkB,mBAAbJ,IACVA,IACAxZ,GAAYF,SAAS,qBAIlB,CACJ,IAAI+Z,GAAS,EACb,GAAO1xC,KAAK,uBACc,mBAAfsxC,IACVA,IACAzZ,GAAYF,SAAS,mBAEtB,MAAMga,EAAS1yB,MAAOkY,IACkB,OAAnCA,EAAMvzB,OAAOguC,QAAQL,KAIrBpa,EAAM0a,QAA2B,IAAjB1a,EAAM0a,SAI1BL,EAAS96C,KAAKygC,EAAMvzB,QACpBuzB,EAAM71B,iBACN61B,EAAM2a,2BAEFJ,IACHA,GAAS,QACH,8BACAD,IACNM,IAGwB,mBAAbV,IACVA,IACAxZ,GAAYF,SAAS,qBAKlBoa,EAAQ,KACb54C,SAASs+B,oBAAoB,QAASka,GAAQ,GAG9C13C,YAAW,KACV,KAAOu3C,EAASh7C,OAAS,GAAG,CAC3B,IAAIoN,EAAS4tC,EAASjvC,MACtB,GAAO+O,KAAK,+BAAgC1N,GAC5CA,EAAOouC,WAEN,IAGJ74C,SAAS+9B,iBAAiB,QAASya,GAAQ,OAMzBM,IAEA","sources":["webpack://syrin-player/./node_modules/freeverb/index.js","webpack://syrin-player/./node_modules/freeverb/lib/lowpass-comb-filter.js","webpack://syrin-player/./node_modules/localforage/dist/localforage.js","webpack://syrin-player/./node_modules/loglevel-plugin-prefix/lib/loglevel-plugin-prefix.js","webpack://syrin-player/./node_modules/loglevel/lib/loglevel.js","webpack://syrin-player/webpack/bootstrap","webpack://syrin-player/webpack/runtime/compat get default export","webpack://syrin-player/webpack/runtime/define property getters","webpack://syrin-player/webpack/runtime/global","webpack://syrin-player/webpack/runtime/hasOwnProperty shorthand","webpack://syrin-player/./src/app/common/dumbStubs.ts","webpack://syrin-player/./src/modules-core/utility/uniqueArray.ts","webpack://syrin-player/./src/modules-core/utility/event.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/convolverUrls.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/constants.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/createEffect.ts","webpack://syrin-player/./src/modules-core/utility/serverTime.ts","webpack://syrin-player/./src/app/common/syrinscape.ts","webpack://syrin-player/./src/modules-core/log/index.ts","webpack://syrin-player/./src/modules-core/cache/utility.ts","webpack://syrin-player/./src/modules-core/cache/cacheStorageDatabase.ts","webpack://syrin-player/./src/modules-core/cache/localForageDatabase.ts","webpack://syrin-player/./src/modules-core/cache/storageDatabase.ts","webpack://syrin-player/./src/modules-core/utility/uuid.ts","webpack://syrin-player/./src/modules-core/config.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/analyserEffect.ts","webpack://syrin-player/./src/modules-core/cache/lruLinkedList.ts","webpack://syrin-player/./src/modules-core/cache/lruCache.ts","webpack://syrin-player/./src/modules-core/utility/MathExt.ts","webpack://syrin-player/./node_modules/common-tags/src/TemplateTag/TemplateTag.js","webpack://syrin-player/./node_modules/common-tags/src/inlineArrayTransformer/inlineArrayTransformer.js","webpack://syrin-player/./node_modules/common-tags/src/stripIndentTransformer/stripIndentTransformer.js","webpack://syrin-player/./node_modules/common-tags/src/trimResultTransformer/trimResultTransformer.js","webpack://syrin-player/./node_modules/common-tags/src/commaLists/commaLists.js","webpack://syrin-player/./node_modules/common-tags/src/commaListsAnd/commaListsAnd.js","webpack://syrin-player/./node_modules/common-tags/src/commaListsOr/commaListsOr.js","webpack://syrin-player/./node_modules/common-tags/src/splitStringTransformer/splitStringTransformer.js","webpack://syrin-player/./node_modules/common-tags/src/removeNonPrintingValuesTransformer/removeNonPrintingValuesTransformer.js","webpack://syrin-player/./node_modules/common-tags/src/html/html.js","webpack://syrin-player/./node_modules/common-tags/src/replaceSubstitutionTransformer/replaceSubstitutionTransformer.js","webpack://syrin-player/./node_modules/common-tags/src/safeHtml/safeHtml.js","webpack://syrin-player/./node_modules/common-tags/src/replaceResultTransformer/replaceResultTransformer.js","webpack://syrin-player/./node_modules/common-tags/src/oneLine/oneLine.js","webpack://syrin-player/./node_modules/common-tags/src/oneLineTrim/oneLineTrim.js","webpack://syrin-player/./node_modules/common-tags/src/oneLineCommaLists/oneLineCommaLists.js","webpack://syrin-player/./node_modules/common-tags/src/oneLineCommaListsOr/oneLineCommaListsOr.js","webpack://syrin-player/./node_modules/common-tags/src/oneLineCommaListsAnd/oneLineCommaListsAnd.js","webpack://syrin-player/./node_modules/common-tags/src/inlineLists/inlineLists.js","webpack://syrin-player/./node_modules/common-tags/src/oneLineInlineLists/oneLineInlineLists.js","webpack://syrin-player/./node_modules/common-tags/src/stripIndent/stripIndent.js","webpack://syrin-player/./node_modules/common-tags/src/stripIndents/stripIndents.js","webpack://syrin-player/./src/modules-core/cache/compositeDatabase.ts","webpack://syrin-player/./src/modules-core/cache/blobDatabase.ts","webpack://syrin-player/./src/modules-core/cache/customDatabase.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/sendEffect.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/spatialEffect.ts","webpack://syrin-player/./src/modules-core/utility/async.ts","webpack://syrin-player/./src/modules-core/utility/geometry.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/utility.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/volumeEffect.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/SkinnerAudio.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/freeverbEffect.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/createEffectMap.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/compressorEffect.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/convolverEffect.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/delayEffect.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/filterEffect.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/effects/reverbEffect.ts","webpack://syrin-player/./src/modules-core/urlSystem/urlSystem.ts","webpack://syrin-player/./src/modules-core/utility/strictTimeout.ts","webpack://syrin-player/./src/modules-core/audioSystem/blobSourceInstantiator.ts","webpack://syrin-player/./src/modules-core/utility/simpleRecord.ts","webpack://syrin-player/./src/modules-core/postMessageSystem/postMessageSystem.ts","webpack://syrin-player/./src/modules-core/eventSystem/eventSystem.ts","webpack://syrin-player/./src/modules-core/audioSystem/audioSystem.ts","webpack://syrin-player/./src/modules-core/authSystem/errors.ts","webpack://syrin-player/./src/modules-core/controlSystem/controlSystem.ts","webpack://syrin-player/./src/modules-core/utility/ParseExt.ts","webpack://syrin-player/./src/modules-core/elementSystem/utility.ts","webpack://syrin-player/external \"__dumbStubs\"","webpack://syrin-player/./src/modules-core/elementSystem/elementSpawnSystem.ts","webpack://syrin-player/./src/modules-core/utility/mutableMap.ts","webpack://syrin-player/./src/modules-core/uuidSystem/uuidSystem.ts","webpack://syrin-player/./src/modules-core/sampleSystem/sampleSpawnSystem.ts","webpack://syrin-player/./src/modules-core/sampleSystem/sampleSystem.ts","webpack://syrin-player/./src/modules-core/elementSystem/elementVolumeSystem.ts","webpack://syrin-player/./src/modules-core/elementSystem/elementSystem.ts","webpack://syrin-player/./src/modules-core/elementSystem/oneshotSystem.ts","webpack://syrin-player/./src/modules-core/elementSystem/playlistSystem.ts","webpack://syrin-player/./src/modules-core/socket/socketSystem.ts","webpack://syrin-player/./src/modules-core/syncSystem/utility.ts","webpack://syrin-player/./src/modules-core/syncSystem/syncSystem.ts","webpack://syrin-player/./src/modules-core/player.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/audioEffectSystem.ts","webpack://syrin-player/./src/modules-core/audioEffectSystem/defaultEffectFile.ts","webpack://syrin-player/./src/modules-core/audioSystem/types.ts","webpack://syrin-player/./src/modules-core/authSystem/authSystem.ts"],"sourcesContent":["// adapted from: https://github.com/TONEnoTONE/Tone.js/blob/master/Tone/effect/Freeverb.js\n\nvar combFilterTunings = [1557 / 44100, 1617 / 44100, 1491 / 44100, 1422 / 44100, 1277 / 44100, 1356 / 44100, 1188 / 44100, 1116 / 44100]\nvar allpassFilterFrequencies = [225, 556, 441, 341]\n\nvar LowpassCombFilter = require('./lib/lowpass-comb-filter')\n\nmodule.exports = Freeverb\n\nfunction Freeverb (audioContext) {\n  var node = audioContext.createGain()\n  node.channelCountMode = 'explicit'\n  node.channelCount = 2\n\n  var output = audioContext.createGain()\n  var merger = audioContext.createChannelMerger(2)\n  var splitter = audioContext.createChannelSplitter(2)\n  var highpass = audioContext.createBiquadFilter()\n  highpass.type = 'highpass'\n  highpass.frequency.value = 200\n\n  var wet = audioContext.createGain()\n  var dry = audioContext.createGain()\n\n  node.connect(dry)\n  node.connect(wet)\n  wet.connect(splitter)\n  merger.connect(highpass)\n  highpass.connect(output)\n  dry.connect(output)\n\n  var combFilters = []\n  var allpassFiltersL = []\n  var allpassFiltersR = []\n  var roomSize = 0.8\n  var dampening = 3000\n\n  // make the allpass filters on the right\n  for (var l = 0; l < allpassFilterFrequencies.length; l++) {\n    var allpassL = audioContext.createBiquadFilter()\n    allpassL.type = 'allpass'\n    allpassL.frequency.value = allpassFilterFrequencies[l]\n    allpassFiltersL.push(allpassL)\n\n    if (allpassFiltersL[l - 1]) {\n      allpassFiltersL[l - 1].connect(allpassL)\n    }\n  }\n\n  // make the allpass filters on the left\n  for (var r = 0; r < allpassFilterFrequencies.length; r++) {\n    var allpassR = audioContext.createBiquadFilter()\n    allpassR.type = 'allpass'\n    allpassR.frequency.value = allpassFilterFrequencies[r]\n    allpassFiltersR.push(allpassR)\n\n    if (allpassFiltersR[r - 1]) {\n      allpassFiltersR[r - 1].connect(allpassR)\n    }\n  }\n\n  allpassFiltersL[allpassFiltersL.length - 1].connect(merger, 0, 0)\n  allpassFiltersR[allpassFiltersR.length - 1].connect(merger, 0, 1)\n\n  // make the comb filters\n  for (var c = 0; c < combFilterTunings.length; c++) {\n    var lfpf = LowpassCombFilter(audioContext)\n    lfpf.delayTime.value = combFilterTunings[c]\n    if (c < combFilterTunings.length / 2) {\n      splitter.connect(lfpf, 0)\n      lfpf.connect(allpassFiltersL[0])\n    } else {\n      splitter.connect(lfpf, 1)\n      lfpf.connect(allpassFiltersR[0])\n    }\n    combFilters.push(lfpf)\n  }\n\n  Object.defineProperties(node, {\n    roomSize: {\n      get: function () {\n        return roomSize\n      },\n      set: function (value) {\n        roomSize = value\n        refreshFilters()\n      }\n    },\n    dampening: {\n      get: function () {\n        return dampening\n      },\n\n      set: function (value) {\n        dampening = value\n        refreshFilters()\n      }\n    }\n  })\n\n  refreshFilters()\n\n  node.connect = output.connect.bind(output)\n  node.disconnect = output.disconnect.bind(output)\n  node.wet = wet.gain\n  node.dry = dry.gain\n\n  // expose combFilters for direct automation\n  node.combFilters = combFilters\n\n  return node\n\n  // scoped\n\n  function refreshFilters () {\n    for (var i = 0; i < combFilters.length; i++) {\n      combFilters[i].resonance.value = roomSize\n      combFilters[i].dampening.value = dampening\n    }\n  }\n}\n","// adapted from: https://github.com/TONEnoTONE/Tone.js/blob/master/Tone/component/LowpassCombFilter.js\n\nmodule.exports = LowpassCombFilter\n\nfunction LowpassCombFilter (context) {\n  var node = context.createDelay(1)\n\n  var output = context.createBiquadFilter()\n\n  // this magic number seems to fix everything in Chrome 53\n  // see https://github.com/livejs/freeverb/issues/1#issuecomment-249080213\n  output.Q.value = -3.0102999566398125\n\n  output.type = 'lowpass'\n  node.dampening = output.frequency\n\n  var feedback = context.createGain()\n  node.resonance = feedback.gain\n\n  node.connect(output)\n  output.connect(feedback)\n  feedback.connect(node)\n\n  node.dampening.value = 3000\n  node.delayTime.value = 0.1\n  node.resonance.value = 0.5\n\n  return node\n}\n","/*!\n    localForage -- Offline Storage, Improved\n    Version 1.10.0\n    https://localforage.github.io/localForage\n    (c) 2013-2017 Mozilla, Apache License 2.0\n*/\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.localforage = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw (f.code=\"MODULE_NOT_FOUND\", f)}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(_dereq_,module,exports){\n'use strict';\nvar immediate = _dereq_(1);\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n\n},{\"1\":1}],3:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nif (typeof global.Promise !== 'function') {\n  global.Promise = _dereq_(2);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"2\":2}],4:[function(_dereq_,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getIDB() {\n    /* global indexedDB,webkitIndexedDB,mozIndexedDB,OIndexedDB,msIndexedDB */\n    try {\n        if (typeof indexedDB !== 'undefined') {\n            return indexedDB;\n        }\n        if (typeof webkitIndexedDB !== 'undefined') {\n            return webkitIndexedDB;\n        }\n        if (typeof mozIndexedDB !== 'undefined') {\n            return mozIndexedDB;\n        }\n        if (typeof OIndexedDB !== 'undefined') {\n            return OIndexedDB;\n        }\n        if (typeof msIndexedDB !== 'undefined') {\n            return msIndexedDB;\n        }\n    } catch (e) {\n        return;\n    }\n}\n\nvar idb = getIDB();\n\nfunction isIndexedDBValid() {\n    try {\n        // Initialize IndexedDB; fall back to vendor-prefixed versions\n        // if needed.\n        if (!idb || !idb.open) {\n            return false;\n        }\n        // We mimic PouchDB here;\n        //\n        // We test for openDatabase because IE Mobile identifies itself\n        // as Safari. Oh the lulz...\n        var isSafari = typeof openDatabase !== 'undefined' && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform);\n\n        var hasFetch = typeof fetch === 'function' && fetch.toString().indexOf('[native code') !== -1;\n\n        // Safari <10.1 does not meet our requirements for IDB support\n        // (see: https://github.com/pouchdb/pouchdb/issues/5572).\n        // Safari 10.1 shipped with fetch, we can use that to detect it.\n        // Note: this creates issues with `window.fetch` polyfills and\n        // overrides; see:\n        // https://github.com/localForage/localForage/issues/856\n        return (!isSafari || hasFetch) && typeof indexedDB !== 'undefined' &&\n        // some outdated implementations of IDB that appear on Samsung\n        // and HTC Android devices <4.4 are missing IDBKeyRange\n        // See: https://github.com/mozilla/localForage/issues/128\n        // See: https://github.com/mozilla/localForage/issues/272\n        typeof IDBKeyRange !== 'undefined';\n    } catch (e) {\n        return false;\n    }\n}\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\nfunction createBlob(parts, properties) {\n    /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n    parts = parts || [];\n    properties = properties || {};\n    try {\n        return new Blob(parts, properties);\n    } catch (e) {\n        if (e.name !== 'TypeError') {\n            throw e;\n        }\n        var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder : typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder : typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : WebKitBlobBuilder;\n        var builder = new Builder();\n        for (var i = 0; i < parts.length; i += 1) {\n            builder.append(parts[i]);\n        }\n        return builder.getBlob(properties.type);\n    }\n}\n\n// This is CommonJS because lie is an external dependency, so Rollup\n// can just ignore it.\nif (typeof Promise === 'undefined') {\n    // In the \"nopromises\" build this will just throw if you don't have\n    // a global promise object, but it would throw anyway later.\n    _dereq_(3);\n}\nvar Promise$1 = Promise;\n\nfunction executeCallback(promise, callback) {\n    if (callback) {\n        promise.then(function (result) {\n            callback(null, result);\n        }, function (error) {\n            callback(error);\n        });\n    }\n}\n\nfunction executeTwoCallbacks(promise, callback, errorCallback) {\n    if (typeof callback === 'function') {\n        promise.then(callback);\n    }\n\n    if (typeof errorCallback === 'function') {\n        promise[\"catch\"](errorCallback);\n    }\n}\n\nfunction normalizeKey(key) {\n    // Cast the key to a string, as that's all we can set as a key.\n    if (typeof key !== 'string') {\n        console.warn(key + ' used as a key, but it is not a string.');\n        key = String(key);\n    }\n\n    return key;\n}\n\nfunction getCallback() {\n    if (arguments.length && typeof arguments[arguments.length - 1] === 'function') {\n        return arguments[arguments.length - 1];\n    }\n}\n\n// Some code originally from async_storage.js in\n// [Gaia](https://github.com/mozilla-b2g/gaia).\n\nvar DETECT_BLOB_SUPPORT_STORE = 'local-forage-detect-blob-support';\nvar supportsBlobs = void 0;\nvar dbContexts = {};\nvar toString = Object.prototype.toString;\n\n// Transaction Modes\nvar READ_ONLY = 'readonly';\nvar READ_WRITE = 'readwrite';\n\n// Transform a binary string to an array buffer, because otherwise\n// weird stuff happens when you try to work with the binary string directly.\n// It is known.\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction _binStringToArrayBuffer(bin) {\n    var length = bin.length;\n    var buf = new ArrayBuffer(length);\n    var arr = new Uint8Array(buf);\n    for (var i = 0; i < length; i++) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return buf;\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\n// Code borrowed from PouchDB. See:\n// https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-adapter-idb/src/blobSupport.js\n//\nfunction _checkBlobSupportWithoutCaching(idb) {\n    return new Promise$1(function (resolve) {\n        var txn = idb.transaction(DETECT_BLOB_SUPPORT_STORE, READ_WRITE);\n        var blob = createBlob(['']);\n        txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob, 'key');\n\n        txn.onabort = function (e) {\n            // If the transaction aborts now its due to not being able to\n            // write to the database, likely due to the disk being full\n            e.preventDefault();\n            e.stopPropagation();\n            resolve(false);\n        };\n\n        txn.oncomplete = function () {\n            var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n            var matchedEdge = navigator.userAgent.match(/Edge\\//);\n            // MS Edge pretends to be Chrome 42:\n            // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n            resolve(matchedEdge || !matchedChrome || parseInt(matchedChrome[1], 10) >= 43);\n        };\n    })[\"catch\"](function () {\n        return false; // error, so assume unsupported\n    });\n}\n\nfunction _checkBlobSupport(idb) {\n    if (typeof supportsBlobs === 'boolean') {\n        return Promise$1.resolve(supportsBlobs);\n    }\n    return _checkBlobSupportWithoutCaching(idb).then(function (value) {\n        supportsBlobs = value;\n        return supportsBlobs;\n    });\n}\n\nfunction _deferReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Create a deferred object representing the current database operation.\n    var deferredOperation = {};\n\n    deferredOperation.promise = new Promise$1(function (resolve, reject) {\n        deferredOperation.resolve = resolve;\n        deferredOperation.reject = reject;\n    });\n\n    // Enqueue the deferred operation.\n    dbContext.deferredOperations.push(deferredOperation);\n\n    // Chain its promise to the database readiness.\n    if (!dbContext.dbReady) {\n        dbContext.dbReady = deferredOperation.promise;\n    } else {\n        dbContext.dbReady = dbContext.dbReady.then(function () {\n            return deferredOperation.promise;\n        });\n    }\n}\n\nfunction _advanceReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Resolve its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.resolve();\n        return deferredOperation.promise;\n    }\n}\n\nfunction _rejectReadiness(dbInfo, err) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Reject its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.reject(err);\n        return deferredOperation.promise;\n    }\n}\n\nfunction _getConnection(dbInfo, upgradeNeeded) {\n    return new Promise$1(function (resolve, reject) {\n        dbContexts[dbInfo.name] = dbContexts[dbInfo.name] || createDbContext();\n\n        if (dbInfo.db) {\n            if (upgradeNeeded) {\n                _deferReadiness(dbInfo);\n                dbInfo.db.close();\n            } else {\n                return resolve(dbInfo.db);\n            }\n        }\n\n        var dbArgs = [dbInfo.name];\n\n        if (upgradeNeeded) {\n            dbArgs.push(dbInfo.version);\n        }\n\n        var openreq = idb.open.apply(idb, dbArgs);\n\n        if (upgradeNeeded) {\n            openreq.onupgradeneeded = function (e) {\n                var db = openreq.result;\n                try {\n                    db.createObjectStore(dbInfo.storeName);\n                    if (e.oldVersion <= 1) {\n                        // Added when support for blob shims was added\n                        db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n                    }\n                } catch (ex) {\n                    if (ex.name === 'ConstraintError') {\n                        console.warn('The database \"' + dbInfo.name + '\"' + ' has been upgraded from version ' + e.oldVersion + ' to version ' + e.newVersion + ', but the storage \"' + dbInfo.storeName + '\" already exists.');\n                    } else {\n                        throw ex;\n                    }\n                }\n            };\n        }\n\n        openreq.onerror = function (e) {\n            e.preventDefault();\n            reject(openreq.error);\n        };\n\n        openreq.onsuccess = function () {\n            var db = openreq.result;\n            db.onversionchange = function (e) {\n                // Triggered when the database is modified (e.g. adding an objectStore) or\n                // deleted (even when initiated by other sessions in different tabs).\n                // Closing the connection here prevents those operations from being blocked.\n                // If the database is accessed again later by this instance, the connection\n                // will be reopened or the database recreated as needed.\n                e.target.close();\n            };\n            resolve(db);\n            _advanceReadiness(dbInfo);\n        };\n    });\n}\n\nfunction _getOriginalConnection(dbInfo) {\n    return _getConnection(dbInfo, false);\n}\n\nfunction _getUpgradedConnection(dbInfo) {\n    return _getConnection(dbInfo, true);\n}\n\nfunction _isUpgradeNeeded(dbInfo, defaultVersion) {\n    if (!dbInfo.db) {\n        return true;\n    }\n\n    var isNewStore = !dbInfo.db.objectStoreNames.contains(dbInfo.storeName);\n    var isDowngrade = dbInfo.version < dbInfo.db.version;\n    var isUpgrade = dbInfo.version > dbInfo.db.version;\n\n    if (isDowngrade) {\n        // If the version is not the default one\n        // then warn for impossible downgrade.\n        if (dbInfo.version !== defaultVersion) {\n            console.warn('The database \"' + dbInfo.name + '\"' + \" can't be downgraded from version \" + dbInfo.db.version + ' to version ' + dbInfo.version + '.');\n        }\n        // Align the versions to prevent errors.\n        dbInfo.version = dbInfo.db.version;\n    }\n\n    if (isUpgrade || isNewStore) {\n        // If the store is new then increment the version (if needed).\n        // This will trigger an \"upgradeneeded\" event which is required\n        // for creating a store.\n        if (isNewStore) {\n            var incVersion = dbInfo.db.version + 1;\n            if (incVersion > dbInfo.version) {\n                dbInfo.version = incVersion;\n            }\n        }\n\n        return true;\n    }\n\n    return false;\n}\n\n// encode a blob for indexeddb engines that don't support blobs\nfunction _encodeBlob(blob) {\n    return new Promise$1(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = function (e) {\n            var base64 = btoa(e.target.result || '');\n            resolve({\n                __local_forage_encoded_blob: true,\n                data: base64,\n                type: blob.type\n            });\n        };\n        reader.readAsBinaryString(blob);\n    });\n}\n\n// decode an encoded blob\nfunction _decodeBlob(encodedBlob) {\n    var arrayBuff = _binStringToArrayBuffer(atob(encodedBlob.data));\n    return createBlob([arrayBuff], { type: encodedBlob.type });\n}\n\n// is this one of our fancy encoded blobs?\nfunction _isEncodedBlob(value) {\n    return value && value.__local_forage_encoded_blob;\n}\n\n// Specialize the default `ready()` function by making it dependent\n// on the current database operations. Thus, the driver will be actually\n// ready when it's been initialized (default) *and* there are no pending\n// operations on the database (initiated by some other instances).\nfunction _fullyReady(callback) {\n    var self = this;\n\n    var promise = self._initReady().then(function () {\n        var dbContext = dbContexts[self._dbInfo.name];\n\n        if (dbContext && dbContext.dbReady) {\n            return dbContext.dbReady;\n        }\n    });\n\n    executeTwoCallbacks(promise, callback, callback);\n    return promise;\n}\n\n// Try to establish a new db connection to replace the\n// current one which is broken (i.e. experiencing\n// InvalidStateError while creating a transaction).\nfunction _tryReconnect(dbInfo) {\n    _deferReadiness(dbInfo);\n\n    var dbContext = dbContexts[dbInfo.name];\n    var forages = dbContext.forages;\n\n    for (var i = 0; i < forages.length; i++) {\n        var forage = forages[i];\n        if (forage._dbInfo.db) {\n            forage._dbInfo.db.close();\n            forage._dbInfo.db = null;\n        }\n    }\n    dbInfo.db = null;\n\n    return _getOriginalConnection(dbInfo).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        // store the latest db reference\n        // in case the db was upgraded\n        dbInfo.db = dbContext.db = db;\n        for (var i = 0; i < forages.length; i++) {\n            forages[i]._dbInfo.db = db;\n        }\n    })[\"catch\"](function (err) {\n        _rejectReadiness(dbInfo, err);\n        throw err;\n    });\n}\n\n// FF doesn't like Promises (micro-tasks) and IDDB store operations,\n// so we have to do it with callbacks\nfunction createTransaction(dbInfo, mode, callback, retries) {\n    if (retries === undefined) {\n        retries = 1;\n    }\n\n    try {\n        var tx = dbInfo.db.transaction(dbInfo.storeName, mode);\n        callback(null, tx);\n    } catch (err) {\n        if (retries > 0 && (!dbInfo.db || err.name === 'InvalidStateError' || err.name === 'NotFoundError')) {\n            return Promise$1.resolve().then(function () {\n                if (!dbInfo.db || err.name === 'NotFoundError' && !dbInfo.db.objectStoreNames.contains(dbInfo.storeName) && dbInfo.version <= dbInfo.db.version) {\n                    // increase the db version, to create the new ObjectStore\n                    if (dbInfo.db) {\n                        dbInfo.version = dbInfo.db.version + 1;\n                    }\n                    // Reopen the database for upgrading.\n                    return _getUpgradedConnection(dbInfo);\n                }\n            }).then(function () {\n                return _tryReconnect(dbInfo).then(function () {\n                    createTransaction(dbInfo, mode, callback, retries - 1);\n                });\n            })[\"catch\"](callback);\n        }\n\n        callback(err);\n    }\n}\n\nfunction createDbContext() {\n    return {\n        // Running localForages sharing a database.\n        forages: [],\n        // Shared database.\n        db: null,\n        // Database readiness (promise).\n        dbReady: null,\n        // Deferred operations on the database.\n        deferredOperations: []\n    };\n}\n\n// Open the IndexedDB database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    // Get the current context of the database;\n    var dbContext = dbContexts[dbInfo.name];\n\n    // ...or create a new context.\n    if (!dbContext) {\n        dbContext = createDbContext();\n        // Register the new context in the global container.\n        dbContexts[dbInfo.name] = dbContext;\n    }\n\n    // Register itself as a running localForage in the current context.\n    dbContext.forages.push(self);\n\n    // Replace the default `ready()` function with the specialized one.\n    if (!self._initReady) {\n        self._initReady = self.ready;\n        self.ready = _fullyReady;\n    }\n\n    // Create an array of initialization states of the related localForages.\n    var initPromises = [];\n\n    function ignoreErrors() {\n        // Don't handle errors here,\n        // just makes sure related localForages aren't pending.\n        return Promise$1.resolve();\n    }\n\n    for (var j = 0; j < dbContext.forages.length; j++) {\n        var forage = dbContext.forages[j];\n        if (forage !== self) {\n            // Don't wait for itself...\n            initPromises.push(forage._initReady()[\"catch\"](ignoreErrors));\n        }\n    }\n\n    // Take a snapshot of the related localForages.\n    var forages = dbContext.forages.slice(0);\n\n    // Initialize the connection process only when\n    // all the related localForages aren't pending.\n    return Promise$1.all(initPromises).then(function () {\n        dbInfo.db = dbContext.db;\n        // Get the connection or open a new one without upgrade.\n        return _getOriginalConnection(dbInfo);\n    }).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo, self._defaultConfig.version)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        dbInfo.db = dbContext.db = db;\n        self._dbInfo = dbInfo;\n        // Share the final connection amongst related localForages.\n        for (var k = 0; k < forages.length; k++) {\n            var forage = forages[k];\n            if (forage !== self) {\n                // Self is already up-to-date.\n                forage._dbInfo.db = dbInfo.db;\n                forage._dbInfo.version = dbInfo.version;\n            }\n        }\n    });\n}\n\nfunction getItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.get(key);\n\n                    req.onsuccess = function () {\n                        var value = req.result;\n                        if (value === undefined) {\n                            value = null;\n                        }\n                        if (_isEncodedBlob(value)) {\n                            value = _decodeBlob(value);\n                        }\n                        resolve(value);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items stored in database.\nfunction iterate(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openCursor();\n                    var iterationNumber = 1;\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (cursor) {\n                            var value = cursor.value;\n                            if (_isEncodedBlob(value)) {\n                                value = _decodeBlob(value);\n                            }\n                            var result = iterator(value, cursor.key, iterationNumber++);\n\n                            // when the iterator callback returns any\n                            // (non-`undefined`) value, then we stop\n                            // the iteration immediately\n                            if (result !== void 0) {\n                                resolve(result);\n                            } else {\n                                cursor[\"continue\"]();\n                            }\n                        } else {\n                            resolve();\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n\n    return promise;\n}\n\nfunction setItem(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        var dbInfo;\n        self.ready().then(function () {\n            dbInfo = self._dbInfo;\n            if (toString.call(value) === '[object Blob]') {\n                return _checkBlobSupport(dbInfo.db).then(function (blobSupport) {\n                    if (blobSupport) {\n                        return value;\n                    }\n                    return _encodeBlob(value);\n                });\n            }\n            return value;\n        }).then(function (value) {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n\n                    // The reason we don't _save_ null is because IE 10 does\n                    // not support saving the `null` type in IndexedDB. How\n                    // ironic, given the bug below!\n                    // See: https://github.com/mozilla/localForage/issues/161\n                    if (value === null) {\n                        value = undefined;\n                    }\n\n                    var req = store.put(value, key);\n\n                    transaction.oncomplete = function () {\n                        // Cast to undefined so the value passed to\n                        // callback/promise is the same as what one would get out\n                        // of `getItem()` later. This leads to some weirdness\n                        // (setItem('foo', undefined) will return `null`), but\n                        // it's not my fault localStorage is our baseline and that\n                        // it's weird.\n                        if (value === undefined) {\n                            value = null;\n                        }\n\n                        resolve(value);\n                    };\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction removeItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    // We use a Grunt task to make this safe for IE and some\n                    // versions of Android (including those used by Cordova).\n                    // Normally IE won't like `.delete()` and will insist on\n                    // using `['delete']()`, but we have a build step that\n                    // fixes this for us now.\n                    var req = store[\"delete\"](key);\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onerror = function () {\n                        reject(req.error);\n                    };\n\n                    // The request will be also be aborted if we've exceeded our storage\n                    // space.\n                    transaction.onabort = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction clear(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.clear();\n\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction length(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.count();\n\n                    req.onsuccess = function () {\n                        resolve(req.result);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction key(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        if (n < 0) {\n            resolve(null);\n\n            return;\n        }\n\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var advanced = false;\n                    var req = store.openKeyCursor();\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            // this means there weren't enough keys\n                            resolve(null);\n\n                            return;\n                        }\n\n                        if (n === 0) {\n                            // We have the first key, return it if that's what they\n                            // wanted.\n                            resolve(cursor.key);\n                        } else {\n                            if (!advanced) {\n                                // Otherwise, ask the cursor to skip ahead n\n                                // records.\n                                advanced = true;\n                                cursor.advance(n);\n                            } else {\n                                // When we get here, we've got the nth key.\n                                resolve(cursor.key);\n                            }\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openKeyCursor();\n                    var keys = [];\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (!cursor) {\n                            resolve(keys);\n                            return;\n                        }\n\n                        keys.push(cursor.key);\n                        cursor[\"continue\"]();\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        var isCurrentDb = options.name === currentConfig.name && self._dbInfo.db;\n\n        var dbPromise = isCurrentDb ? Promise$1.resolve(self._dbInfo.db) : _getOriginalConnection(options).then(function (db) {\n            var dbContext = dbContexts[options.name];\n            var forages = dbContext.forages;\n            dbContext.db = db;\n            for (var i = 0; i < forages.length; i++) {\n                forages[i]._dbInfo.db = db;\n            }\n            return db;\n        });\n\n        if (!options.storeName) {\n            promise = dbPromise.then(function (db) {\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                }\n\n                var dropDBPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.deleteDatabase(options.name);\n\n                    req.onerror = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        reject(req.error);\n                    };\n\n                    req.onblocked = function () {\n                        // Closing all open connections in onversionchange handler should prevent this situation, but if\n                        // we do get here, it just means the request remains pending - eventually it will succeed or error\n                        console.warn('dropInstance blocked for database \"' + options.name + '\" until all open connections are closed');\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        resolve(db);\n                    };\n                });\n\n                return dropDBPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var i = 0; i < forages.length; i++) {\n                        var _forage = forages[i];\n                        _advanceReadiness(_forage._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        } else {\n            promise = dbPromise.then(function (db) {\n                if (!db.objectStoreNames.contains(options.storeName)) {\n                    return;\n                }\n\n                var newVersion = db.version + 1;\n\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                    forage._dbInfo.version = newVersion;\n                }\n\n                var dropObjectPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.open(options.name, newVersion);\n\n                    req.onerror = function (err) {\n                        var db = req.result;\n                        db.close();\n                        reject(err);\n                    };\n\n                    req.onupgradeneeded = function () {\n                        var db = req.result;\n                        db.deleteObjectStore(options.storeName);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        db.close();\n                        resolve(db);\n                    };\n                });\n\n                return dropObjectPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var j = 0; j < forages.length; j++) {\n                        var _forage2 = forages[j];\n                        _forage2._dbInfo.db = db;\n                        _advanceReadiness(_forage2._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        }\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar asyncStorage = {\n    _driver: 'asyncStorage',\n    _initStorage: _initStorage,\n    _support: isIndexedDBValid(),\n    iterate: iterate,\n    getItem: getItem,\n    setItem: setItem,\n    removeItem: removeItem,\n    clear: clear,\n    length: length,\n    key: key,\n    keys: keys,\n    dropInstance: dropInstance\n};\n\nfunction isWebSQLValid() {\n    return typeof openDatabase === 'function';\n}\n\n// Sadly, the best way to save binary data in WebSQL/localStorage is serializing\n// it to Base64, so this is how we store it to prevent very strange errors with less\n// verbose ways of binary <-> string data storage.\nvar BASE_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nvar BLOB_TYPE_PREFIX = '~~local_forage_type~';\nvar BLOB_TYPE_PREFIX_REGEX = /^~~local_forage_type~([^~]+)~/;\n\nvar SERIALIZED_MARKER = '__lfsc__:';\nvar SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER.length;\n\n// OMG the serializations!\nvar TYPE_ARRAYBUFFER = 'arbf';\nvar TYPE_BLOB = 'blob';\nvar TYPE_INT8ARRAY = 'si08';\nvar TYPE_UINT8ARRAY = 'ui08';\nvar TYPE_UINT8CLAMPEDARRAY = 'uic8';\nvar TYPE_INT16ARRAY = 'si16';\nvar TYPE_INT32ARRAY = 'si32';\nvar TYPE_UINT16ARRAY = 'ur16';\nvar TYPE_UINT32ARRAY = 'ui32';\nvar TYPE_FLOAT32ARRAY = 'fl32';\nvar TYPE_FLOAT64ARRAY = 'fl64';\nvar TYPE_SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER_LENGTH + TYPE_ARRAYBUFFER.length;\n\nvar toString$1 = Object.prototype.toString;\n\nfunction stringToBuffer(serializedString) {\n    // Fill the string into a ArrayBuffer.\n    var bufferLength = serializedString.length * 0.75;\n    var len = serializedString.length;\n    var i;\n    var p = 0;\n    var encoded1, encoded2, encoded3, encoded4;\n\n    if (serializedString[serializedString.length - 1] === '=') {\n        bufferLength--;\n        if (serializedString[serializedString.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n\n    var buffer = new ArrayBuffer(bufferLength);\n    var bytes = new Uint8Array(buffer);\n\n    for (i = 0; i < len; i += 4) {\n        encoded1 = BASE_CHARS.indexOf(serializedString[i]);\n        encoded2 = BASE_CHARS.indexOf(serializedString[i + 1]);\n        encoded3 = BASE_CHARS.indexOf(serializedString[i + 2]);\n        encoded4 = BASE_CHARS.indexOf(serializedString[i + 3]);\n\n        /*jslint bitwise: true */\n        bytes[p++] = encoded1 << 2 | encoded2 >> 4;\n        bytes[p++] = (encoded2 & 15) << 4 | encoded3 >> 2;\n        bytes[p++] = (encoded3 & 3) << 6 | encoded4 & 63;\n    }\n    return buffer;\n}\n\n// Converts a buffer to a string to store, serialized, in the backend\n// storage library.\nfunction bufferToString(buffer) {\n    // base64-arraybuffer\n    var bytes = new Uint8Array(buffer);\n    var base64String = '';\n    var i;\n\n    for (i = 0; i < bytes.length; i += 3) {\n        /*jslint bitwise: true */\n        base64String += BASE_CHARS[bytes[i] >> 2];\n        base64String += BASE_CHARS[(bytes[i] & 3) << 4 | bytes[i + 1] >> 4];\n        base64String += BASE_CHARS[(bytes[i + 1] & 15) << 2 | bytes[i + 2] >> 6];\n        base64String += BASE_CHARS[bytes[i + 2] & 63];\n    }\n\n    if (bytes.length % 3 === 2) {\n        base64String = base64String.substring(0, base64String.length - 1) + '=';\n    } else if (bytes.length % 3 === 1) {\n        base64String = base64String.substring(0, base64String.length - 2) + '==';\n    }\n\n    return base64String;\n}\n\n// Serialize a value, afterwards executing a callback (which usually\n// instructs the `setItem()` callback/promise to be executed). This is how\n// we store binary data with localStorage.\nfunction serialize(value, callback) {\n    var valueType = '';\n    if (value) {\n        valueType = toString$1.call(value);\n    }\n\n    // Cannot use `value instanceof ArrayBuffer` or such here, as these\n    // checks fail when running the tests using casper.js...\n    //\n    // TODO: See why those tests fail and use a better solution.\n    if (value && (valueType === '[object ArrayBuffer]' || value.buffer && toString$1.call(value.buffer) === '[object ArrayBuffer]')) {\n        // Convert binary arrays to a string and prefix the string with\n        // a special marker.\n        var buffer;\n        var marker = SERIALIZED_MARKER;\n\n        if (value instanceof ArrayBuffer) {\n            buffer = value;\n            marker += TYPE_ARRAYBUFFER;\n        } else {\n            buffer = value.buffer;\n\n            if (valueType === '[object Int8Array]') {\n                marker += TYPE_INT8ARRAY;\n            } else if (valueType === '[object Uint8Array]') {\n                marker += TYPE_UINT8ARRAY;\n            } else if (valueType === '[object Uint8ClampedArray]') {\n                marker += TYPE_UINT8CLAMPEDARRAY;\n            } else if (valueType === '[object Int16Array]') {\n                marker += TYPE_INT16ARRAY;\n            } else if (valueType === '[object Uint16Array]') {\n                marker += TYPE_UINT16ARRAY;\n            } else if (valueType === '[object Int32Array]') {\n                marker += TYPE_INT32ARRAY;\n            } else if (valueType === '[object Uint32Array]') {\n                marker += TYPE_UINT32ARRAY;\n            } else if (valueType === '[object Float32Array]') {\n                marker += TYPE_FLOAT32ARRAY;\n            } else if (valueType === '[object Float64Array]') {\n                marker += TYPE_FLOAT64ARRAY;\n            } else {\n                callback(new Error('Failed to get type for BinaryArray'));\n            }\n        }\n\n        callback(marker + bufferToString(buffer));\n    } else if (valueType === '[object Blob]') {\n        // Conver the blob to a binaryArray and then to a string.\n        var fileReader = new FileReader();\n\n        fileReader.onload = function () {\n            // Backwards-compatible prefix for the blob type.\n            var str = BLOB_TYPE_PREFIX + value.type + '~' + bufferToString(this.result);\n\n            callback(SERIALIZED_MARKER + TYPE_BLOB + str);\n        };\n\n        fileReader.readAsArrayBuffer(value);\n    } else {\n        try {\n            callback(JSON.stringify(value));\n        } catch (e) {\n            console.error(\"Couldn't convert value into a JSON string: \", value);\n\n            callback(null, e);\n        }\n    }\n}\n\n// Deserialize data we've inserted into a value column/field. We place\n// special markers into our strings to mark them as encoded; this isn't\n// as nice as a meta field, but it's the only sane thing we can do whilst\n// keeping localStorage support intact.\n//\n// Oftentimes this will just deserialize JSON content, but if we have a\n// special marker (SERIALIZED_MARKER, defined above), we will extract\n// some kind of arraybuffer/binary data/typed array out of the string.\nfunction deserialize(value) {\n    // If we haven't marked this string as being specially serialized (i.e.\n    // something other than serialized JSON), we can just return it and be\n    // done with it.\n    if (value.substring(0, SERIALIZED_MARKER_LENGTH) !== SERIALIZED_MARKER) {\n        return JSON.parse(value);\n    }\n\n    // The following code deals with deserializing some kind of Blob or\n    // TypedArray. First we separate out the type of data we're dealing\n    // with from the data itself.\n    var serializedString = value.substring(TYPE_SERIALIZED_MARKER_LENGTH);\n    var type = value.substring(SERIALIZED_MARKER_LENGTH, TYPE_SERIALIZED_MARKER_LENGTH);\n\n    var blobType;\n    // Backwards-compatible blob type serialization strategy.\n    // DBs created with older versions of localForage will simply not have the blob type.\n    if (type === TYPE_BLOB && BLOB_TYPE_PREFIX_REGEX.test(serializedString)) {\n        var matcher = serializedString.match(BLOB_TYPE_PREFIX_REGEX);\n        blobType = matcher[1];\n        serializedString = serializedString.substring(matcher[0].length);\n    }\n    var buffer = stringToBuffer(serializedString);\n\n    // Return the right type based on the code/type set during\n    // serialization.\n    switch (type) {\n        case TYPE_ARRAYBUFFER:\n            return buffer;\n        case TYPE_BLOB:\n            return createBlob([buffer], { type: blobType });\n        case TYPE_INT8ARRAY:\n            return new Int8Array(buffer);\n        case TYPE_UINT8ARRAY:\n            return new Uint8Array(buffer);\n        case TYPE_UINT8CLAMPEDARRAY:\n            return new Uint8ClampedArray(buffer);\n        case TYPE_INT16ARRAY:\n            return new Int16Array(buffer);\n        case TYPE_UINT16ARRAY:\n            return new Uint16Array(buffer);\n        case TYPE_INT32ARRAY:\n            return new Int32Array(buffer);\n        case TYPE_UINT32ARRAY:\n            return new Uint32Array(buffer);\n        case TYPE_FLOAT32ARRAY:\n            return new Float32Array(buffer);\n        case TYPE_FLOAT64ARRAY:\n            return new Float64Array(buffer);\n        default:\n            throw new Error('Unkown type: ' + type);\n    }\n}\n\nvar localforageSerializer = {\n    serialize: serialize,\n    deserialize: deserialize,\n    stringToBuffer: stringToBuffer,\n    bufferToString: bufferToString\n};\n\n/*\n * Includes code from:\n *\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nfunction createDbTable(t, dbInfo, callback, errorCallback) {\n    t.executeSql('CREATE TABLE IF NOT EXISTS ' + dbInfo.storeName + ' ' + '(id INTEGER PRIMARY KEY, key unique, value)', [], callback, errorCallback);\n}\n\n// Open the WebSQL database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage$1(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = typeof options[i] !== 'string' ? options[i].toString() : options[i];\n        }\n    }\n\n    var dbInfoPromise = new Promise$1(function (resolve, reject) {\n        // Open the database; the openDatabase API will automatically\n        // create it for us if it doesn't exist.\n        try {\n            dbInfo.db = openDatabase(dbInfo.name, String(dbInfo.version), dbInfo.description, dbInfo.size);\n        } catch (e) {\n            return reject(e);\n        }\n\n        // Create our key/value table if it doesn't exist.\n        dbInfo.db.transaction(function (t) {\n            createDbTable(t, dbInfo, function () {\n                self._dbInfo = dbInfo;\n                resolve();\n            }, function (t, error) {\n                reject(error);\n            });\n        }, reject);\n    });\n\n    dbInfo.serializer = localforageSerializer;\n    return dbInfoPromise;\n}\n\nfunction tryExecuteSql(t, dbInfo, sqlStatement, args, callback, errorCallback) {\n    t.executeSql(sqlStatement, args, callback, function (t, error) {\n        if (error.code === error.SYNTAX_ERR) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name = ?\", [dbInfo.storeName], function (t, results) {\n                if (!results.rows.length) {\n                    // if the table is missing (was deleted)\n                    // re-create it table and retry\n                    createDbTable(t, dbInfo, function () {\n                        t.executeSql(sqlStatement, args, callback, errorCallback);\n                    }, errorCallback);\n                } else {\n                    errorCallback(t, error);\n                }\n            }, errorCallback);\n        } else {\n            errorCallback(t, error);\n        }\n    }, errorCallback);\n}\n\nfunction getItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName + ' WHERE key = ? LIMIT 1', [key], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).value : null;\n\n                    // Check to see if this is serialized content we need to\n                    // unpack.\n                    if (result) {\n                        result = dbInfo.serializer.deserialize(result);\n                    }\n\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction iterate$1(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var rows = results.rows;\n                    var length = rows.length;\n\n                    for (var i = 0; i < length; i++) {\n                        var item = rows.item(i);\n                        var result = item.value;\n\n                        // Check to see if this is serialized content\n                        // we need to unpack.\n                        if (result) {\n                            result = dbInfo.serializer.deserialize(result);\n                        }\n\n                        result = iterator(result, item.key, i + 1);\n\n                        // void(0) prevents problems with redefinition\n                        // of `undefined`.\n                        if (result !== void 0) {\n                            resolve(result);\n                            return;\n                        }\n                    }\n\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction _setItem(key, value, callback, retriesLeft) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            // The localStorage API doesn't return undefined values in an\n            // \"expected\" way, so undefined is always cast to null in all\n            // drivers. See: https://github.com/mozilla/localForage/pull/42\n            if (value === undefined) {\n                value = null;\n            }\n\n            // Save the original value to pass to the callback.\n            var originalValue = value;\n\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    dbInfo.db.transaction(function (t) {\n                        tryExecuteSql(t, dbInfo, 'INSERT OR REPLACE INTO ' + dbInfo.storeName + ' ' + '(key, value) VALUES (?, ?)', [key, value], function () {\n                            resolve(originalValue);\n                        }, function (t, error) {\n                            reject(error);\n                        });\n                    }, function (sqlError) {\n                        // The transaction failed; check\n                        // to see if it's a quota error.\n                        if (sqlError.code === sqlError.QUOTA_ERR) {\n                            // We reject the callback outright for now, but\n                            // it's worth trying to re-run the transaction.\n                            // Even if the user accepts the prompt to use\n                            // more storage on Safari, this error will\n                            // be called.\n                            //\n                            // Try to re-run the transaction.\n                            if (retriesLeft > 0) {\n                                resolve(_setItem.apply(self, [key, originalValue, callback, retriesLeft - 1]));\n                                return;\n                            }\n                            reject(sqlError);\n                        }\n                    });\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction setItem$1(key, value, callback) {\n    return _setItem.apply(this, [key, value, callback, 1]);\n}\n\nfunction removeItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName + ' WHERE key = ?', [key], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Deletes every item in the table.\n// TODO: Find out if this resets the AUTO_INCREMENT number.\nfunction clear$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName, [], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Does a simple `COUNT(key)` to get the number of items stored in\n// localForage.\nfunction length$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                // Ahhh, SQL makes this one soooooo easy.\n                tryExecuteSql(t, dbInfo, 'SELECT COUNT(key) as c FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var result = results.rows.item(0).c;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Return the key located at key index X; essentially gets the key from a\n// `WHERE id = ?`. This is the most efficient way I can think to implement\n// this rarely-used (in my experience) part of the API, but it can seem\n// inconsistent, because we do `INSERT OR REPLACE INTO` on `setItem()`, so\n// the ID of each key will change every time it's updated. Perhaps a stored\n// procedure for the `setItem()` SQL would solve this problem?\n// TODO: Don't change ID on `setItem()`.\nfunction key$1(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName + ' WHERE id = ? LIMIT 1', [n + 1], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).key : null;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var keys = [];\n\n                    for (var i = 0; i < results.rows.length; i++) {\n                        keys.push(results.rows.item(i).key);\n                    }\n\n                    resolve(keys);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// https://www.w3.org/TR/webdatabase/#databases\n// > There is no way to enumerate or delete the databases available for an origin from this API.\nfunction getAllStoreNames(db) {\n    return new Promise$1(function (resolve, reject) {\n        db.transaction(function (t) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'\", [], function (t, results) {\n                var storeNames = [];\n\n                for (var i = 0; i < results.rows.length; i++) {\n                    storeNames.push(results.rows.item(i).name);\n                }\n\n                resolve({\n                    db: db,\n                    storeNames: storeNames\n                });\n            }, function (t, error) {\n                reject(error);\n            });\n        }, function (sqlError) {\n            reject(sqlError);\n        });\n    });\n}\n\nfunction dropInstance$1(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            var db;\n            if (options.name === currentConfig.name) {\n                // use the db reference of the current instance\n                db = self._dbInfo.db;\n            } else {\n                db = openDatabase(options.name, '', '', 0);\n            }\n\n            if (!options.storeName) {\n                // drop all database tables\n                resolve(getAllStoreNames(db));\n            } else {\n                resolve({\n                    db: db,\n                    storeNames: [options.storeName]\n                });\n            }\n        }).then(function (operationInfo) {\n            return new Promise$1(function (resolve, reject) {\n                operationInfo.db.transaction(function (t) {\n                    function dropTable(storeName) {\n                        return new Promise$1(function (resolve, reject) {\n                            t.executeSql('DROP TABLE IF EXISTS ' + storeName, [], function () {\n                                resolve();\n                            }, function (t, error) {\n                                reject(error);\n                            });\n                        });\n                    }\n\n                    var operations = [];\n                    for (var i = 0, len = operationInfo.storeNames.length; i < len; i++) {\n                        operations.push(dropTable(operationInfo.storeNames[i]));\n                    }\n\n                    Promise$1.all(operations).then(function () {\n                        resolve();\n                    })[\"catch\"](function (e) {\n                        reject(e);\n                    });\n                }, function (sqlError) {\n                    reject(sqlError);\n                });\n            });\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar webSQLStorage = {\n    _driver: 'webSQLStorage',\n    _initStorage: _initStorage$1,\n    _support: isWebSQLValid(),\n    iterate: iterate$1,\n    getItem: getItem$1,\n    setItem: setItem$1,\n    removeItem: removeItem$1,\n    clear: clear$1,\n    length: length$1,\n    key: key$1,\n    keys: keys$1,\n    dropInstance: dropInstance$1\n};\n\nfunction isLocalStorageValid() {\n    try {\n        return typeof localStorage !== 'undefined' && 'setItem' in localStorage &&\n        // in IE8 typeof localStorage.setItem === 'object'\n        !!localStorage.setItem;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction _getKeyPrefix(options, defaultConfig) {\n    var keyPrefix = options.name + '/';\n\n    if (options.storeName !== defaultConfig.storeName) {\n        keyPrefix += options.storeName + '/';\n    }\n    return keyPrefix;\n}\n\n// Check if localStorage throws when saving an item\nfunction checkIfLocalStorageThrows() {\n    var localStorageTestKey = '_localforage_support_test';\n\n    try {\n        localStorage.setItem(localStorageTestKey, true);\n        localStorage.removeItem(localStorageTestKey);\n\n        return false;\n    } catch (e) {\n        return true;\n    }\n}\n\n// Check if localStorage is usable and allows to save an item\n// This method checks if localStorage is usable in Safari Private Browsing\n// mode, or in any other case where the available quota for localStorage\n// is 0 and there wasn't any saved items yet.\nfunction _isLocalStorageUsable() {\n    return !checkIfLocalStorageThrows() || localStorage.length > 0;\n}\n\n// Config the localStorage backend, using options set in the config.\nfunction _initStorage$2(options) {\n    var self = this;\n    var dbInfo = {};\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    dbInfo.keyPrefix = _getKeyPrefix(options, self._defaultConfig);\n\n    if (!_isLocalStorageUsable()) {\n        return Promise$1.reject();\n    }\n\n    self._dbInfo = dbInfo;\n    dbInfo.serializer = localforageSerializer;\n\n    return Promise$1.resolve();\n}\n\n// Remove all keys from the datastore, effectively destroying all data in\n// the app's key/value store!\nfunction clear$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var keyPrefix = self._dbInfo.keyPrefix;\n\n        for (var i = localStorage.length - 1; i >= 0; i--) {\n            var key = localStorage.key(i);\n\n            if (key.indexOf(keyPrefix) === 0) {\n                localStorage.removeItem(key);\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Retrieve an item from the store. Unlike the original async_storage\n// library in Gaia, we don't modify return values at all. If a key's value\n// is `undefined`, we pass that value to the callback function.\nfunction getItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result = localStorage.getItem(dbInfo.keyPrefix + key);\n\n        // If a result was found, parse it from the serialized\n        // string into a JS object. If result isn't truthy, the key\n        // is likely undefined and we'll pass it straight to the\n        // callback.\n        if (result) {\n            result = dbInfo.serializer.deserialize(result);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items in the store.\nfunction iterate$2(iterator, callback) {\n    var self = this;\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var keyPrefix = dbInfo.keyPrefix;\n        var keyPrefixLength = keyPrefix.length;\n        var length = localStorage.length;\n\n        // We use a dedicated iterator instead of the `i` variable below\n        // so other keys we fetch in localStorage aren't counted in\n        // the `iterationNumber` argument passed to the `iterate()`\n        // callback.\n        //\n        // See: github.com/mozilla/localForage/pull/435#discussion_r38061530\n        var iterationNumber = 1;\n\n        for (var i = 0; i < length; i++) {\n            var key = localStorage.key(i);\n            if (key.indexOf(keyPrefix) !== 0) {\n                continue;\n            }\n            var value = localStorage.getItem(key);\n\n            // If a result was found, parse it from the serialized\n            // string into a JS object. If result isn't truthy, the\n            // key is likely undefined and we'll pass it straight\n            // to the iterator.\n            if (value) {\n                value = dbInfo.serializer.deserialize(value);\n            }\n\n            value = iterator(value, key.substring(keyPrefixLength), iterationNumber++);\n\n            if (value !== void 0) {\n                return value;\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Same as localStorage's key() method, except takes a callback.\nfunction key$2(n, callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result;\n        try {\n            result = localStorage.key(n);\n        } catch (error) {\n            result = null;\n        }\n\n        // Remove the prefix from the key, if a key is found.\n        if (result) {\n            result = result.substring(dbInfo.keyPrefix.length);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var length = localStorage.length;\n        var keys = [];\n\n        for (var i = 0; i < length; i++) {\n            var itemKey = localStorage.key(i);\n            if (itemKey.indexOf(dbInfo.keyPrefix) === 0) {\n                keys.push(itemKey.substring(dbInfo.keyPrefix.length));\n            }\n        }\n\n        return keys;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Supply the number of keys in the datastore to the callback function.\nfunction length$2(callback) {\n    var self = this;\n    var promise = self.keys().then(function (keys) {\n        return keys.length;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Remove an item from the store, nice and simple.\nfunction removeItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        localStorage.removeItem(dbInfo.keyPrefix + key);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Set a key's value and run an optional callback once the value is set.\n// Unlike Gaia's implementation, the callback function is passed the value,\n// in case you want to operate on that value only after you're sure it\n// saved, or something like that.\nfunction setItem$2(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        // Convert undefined values to null.\n        // https://github.com/mozilla/localForage/pull/42\n        if (value === undefined) {\n            value = null;\n        }\n\n        // Save the original value to pass to the callback.\n        var originalValue = value;\n\n        return new Promise$1(function (resolve, reject) {\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    try {\n                        localStorage.setItem(dbInfo.keyPrefix + key, value);\n                        resolve(originalValue);\n                    } catch (e) {\n                        // localStorage capacity exceeded.\n                        // TODO: Make this a specific error/event.\n                        if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n                            reject(e);\n                        }\n                        reject(e);\n                    }\n                }\n            });\n        });\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance$2(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        var currentConfig = this.config();\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            if (!options.storeName) {\n                resolve(options.name + '/');\n            } else {\n                resolve(_getKeyPrefix(options, self._defaultConfig));\n            }\n        }).then(function (keyPrefix) {\n            for (var i = localStorage.length - 1; i >= 0; i--) {\n                var key = localStorage.key(i);\n\n                if (key.indexOf(keyPrefix) === 0) {\n                    localStorage.removeItem(key);\n                }\n            }\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar localStorageWrapper = {\n    _driver: 'localStorageWrapper',\n    _initStorage: _initStorage$2,\n    _support: isLocalStorageValid(),\n    iterate: iterate$2,\n    getItem: getItem$2,\n    setItem: setItem$2,\n    removeItem: removeItem$2,\n    clear: clear$2,\n    length: length$2,\n    key: key$2,\n    keys: keys$2,\n    dropInstance: dropInstance$2\n};\n\nvar sameValue = function sameValue(x, y) {\n    return x === y || typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y);\n};\n\nvar includes = function includes(array, searchElement) {\n    var len = array.length;\n    var i = 0;\n    while (i < len) {\n        if (sameValue(array[i], searchElement)) {\n            return true;\n        }\n        i++;\n    }\n\n    return false;\n};\n\nvar isArray = Array.isArray || function (arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n};\n\n// Drivers are stored here when `defineDriver()` is called.\n// They are shared across all instances of localForage.\nvar DefinedDrivers = {};\n\nvar DriverSupport = {};\n\nvar DefaultDrivers = {\n    INDEXEDDB: asyncStorage,\n    WEBSQL: webSQLStorage,\n    LOCALSTORAGE: localStorageWrapper\n};\n\nvar DefaultDriverOrder = [DefaultDrivers.INDEXEDDB._driver, DefaultDrivers.WEBSQL._driver, DefaultDrivers.LOCALSTORAGE._driver];\n\nvar OptionalDriverMethods = ['dropInstance'];\n\nvar LibraryMethods = ['clear', 'getItem', 'iterate', 'key', 'keys', 'length', 'removeItem', 'setItem'].concat(OptionalDriverMethods);\n\nvar DefaultConfig = {\n    description: '',\n    driver: DefaultDriverOrder.slice(),\n    name: 'localforage',\n    // Default DB size is _JUST UNDER_ 5MB, as it's the highest size\n    // we can use without a prompt.\n    size: 4980736,\n    storeName: 'keyvaluepairs',\n    version: 1.0\n};\n\nfunction callWhenReady(localForageInstance, libraryMethod) {\n    localForageInstance[libraryMethod] = function () {\n        var _args = arguments;\n        return localForageInstance.ready().then(function () {\n            return localForageInstance[libraryMethod].apply(localForageInstance, _args);\n        });\n    };\n}\n\nfunction extend() {\n    for (var i = 1; i < arguments.length; i++) {\n        var arg = arguments[i];\n\n        if (arg) {\n            for (var _key in arg) {\n                if (arg.hasOwnProperty(_key)) {\n                    if (isArray(arg[_key])) {\n                        arguments[0][_key] = arg[_key].slice();\n                    } else {\n                        arguments[0][_key] = arg[_key];\n                    }\n                }\n            }\n        }\n    }\n\n    return arguments[0];\n}\n\nvar LocalForage = function () {\n    function LocalForage(options) {\n        _classCallCheck(this, LocalForage);\n\n        for (var driverTypeKey in DefaultDrivers) {\n            if (DefaultDrivers.hasOwnProperty(driverTypeKey)) {\n                var driver = DefaultDrivers[driverTypeKey];\n                var driverName = driver._driver;\n                this[driverTypeKey] = driverName;\n\n                if (!DefinedDrivers[driverName]) {\n                    // we don't need to wait for the promise,\n                    // since the default drivers can be defined\n                    // in a blocking manner\n                    this.defineDriver(driver);\n                }\n            }\n        }\n\n        this._defaultConfig = extend({}, DefaultConfig);\n        this._config = extend({}, this._defaultConfig, options);\n        this._driverSet = null;\n        this._initDriver = null;\n        this._ready = false;\n        this._dbInfo = null;\n\n        this._wrapLibraryMethodsWithReady();\n        this.setDriver(this._config.driver)[\"catch\"](function () {});\n    }\n\n    // Set any config values for localForage; can be called anytime before\n    // the first API call (e.g. `getItem`, `setItem`).\n    // We loop through options so we don't overwrite existing config\n    // values.\n\n\n    LocalForage.prototype.config = function config(options) {\n        // If the options argument is an object, we use it to set values.\n        // Otherwise, we return either a specified config value or all\n        // config values.\n        if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) === 'object') {\n            // If localforage is ready and fully initialized, we can't set\n            // any new configuration values. Instead, we return an error.\n            if (this._ready) {\n                return new Error(\"Can't call config() after localforage \" + 'has been used.');\n            }\n\n            for (var i in options) {\n                if (i === 'storeName') {\n                    options[i] = options[i].replace(/\\W/g, '_');\n                }\n\n                if (i === 'version' && typeof options[i] !== 'number') {\n                    return new Error('Database version must be a number.');\n                }\n\n                this._config[i] = options[i];\n            }\n\n            // after all config options are set and\n            // the driver option is used, try setting it\n            if ('driver' in options && options.driver) {\n                return this.setDriver(this._config.driver);\n            }\n\n            return true;\n        } else if (typeof options === 'string') {\n            return this._config[options];\n        } else {\n            return this._config;\n        }\n    };\n\n    // Used to define a custom driver, shared across all instances of\n    // localForage.\n\n\n    LocalForage.prototype.defineDriver = function defineDriver(driverObject, callback, errorCallback) {\n        var promise = new Promise$1(function (resolve, reject) {\n            try {\n                var driverName = driverObject._driver;\n                var complianceError = new Error('Custom driver not compliant; see ' + 'https://mozilla.github.io/localForage/#definedriver');\n\n                // A driver name should be defined and not overlap with the\n                // library-defined, default drivers.\n                if (!driverObject._driver) {\n                    reject(complianceError);\n                    return;\n                }\n\n                var driverMethods = LibraryMethods.concat('_initStorage');\n                for (var i = 0, len = driverMethods.length; i < len; i++) {\n                    var driverMethodName = driverMethods[i];\n\n                    // when the property is there,\n                    // it should be a method even when optional\n                    var isRequired = !includes(OptionalDriverMethods, driverMethodName);\n                    if ((isRequired || driverObject[driverMethodName]) && typeof driverObject[driverMethodName] !== 'function') {\n                        reject(complianceError);\n                        return;\n                    }\n                }\n\n                var configureMissingMethods = function configureMissingMethods() {\n                    var methodNotImplementedFactory = function methodNotImplementedFactory(methodName) {\n                        return function () {\n                            var error = new Error('Method ' + methodName + ' is not implemented by the current driver');\n                            var promise = Promise$1.reject(error);\n                            executeCallback(promise, arguments[arguments.length - 1]);\n                            return promise;\n                        };\n                    };\n\n                    for (var _i = 0, _len = OptionalDriverMethods.length; _i < _len; _i++) {\n                        var optionalDriverMethod = OptionalDriverMethods[_i];\n                        if (!driverObject[optionalDriverMethod]) {\n                            driverObject[optionalDriverMethod] = methodNotImplementedFactory(optionalDriverMethod);\n                        }\n                    }\n                };\n\n                configureMissingMethods();\n\n                var setDriverSupport = function setDriverSupport(support) {\n                    if (DefinedDrivers[driverName]) {\n                        console.info('Redefining LocalForage driver: ' + driverName);\n                    }\n                    DefinedDrivers[driverName] = driverObject;\n                    DriverSupport[driverName] = support;\n                    // don't use a then, so that we can define\n                    // drivers that have simple _support methods\n                    // in a blocking manner\n                    resolve();\n                };\n\n                if ('_support' in driverObject) {\n                    if (driverObject._support && typeof driverObject._support === 'function') {\n                        driverObject._support().then(setDriverSupport, reject);\n                    } else {\n                        setDriverSupport(!!driverObject._support);\n                    }\n                } else {\n                    setDriverSupport(true);\n                }\n            } catch (e) {\n                reject(e);\n            }\n        });\n\n        executeTwoCallbacks(promise, callback, errorCallback);\n        return promise;\n    };\n\n    LocalForage.prototype.driver = function driver() {\n        return this._driver || null;\n    };\n\n    LocalForage.prototype.getDriver = function getDriver(driverName, callback, errorCallback) {\n        var getDriverPromise = DefinedDrivers[driverName] ? Promise$1.resolve(DefinedDrivers[driverName]) : Promise$1.reject(new Error('Driver not found.'));\n\n        executeTwoCallbacks(getDriverPromise, callback, errorCallback);\n        return getDriverPromise;\n    };\n\n    LocalForage.prototype.getSerializer = function getSerializer(callback) {\n        var serializerPromise = Promise$1.resolve(localforageSerializer);\n        executeTwoCallbacks(serializerPromise, callback);\n        return serializerPromise;\n    };\n\n    LocalForage.prototype.ready = function ready(callback) {\n        var self = this;\n\n        var promise = self._driverSet.then(function () {\n            if (self._ready === null) {\n                self._ready = self._initDriver();\n            }\n\n            return self._ready;\n        });\n\n        executeTwoCallbacks(promise, callback, callback);\n        return promise;\n    };\n\n    LocalForage.prototype.setDriver = function setDriver(drivers, callback, errorCallback) {\n        var self = this;\n\n        if (!isArray(drivers)) {\n            drivers = [drivers];\n        }\n\n        var supportedDrivers = this._getSupportedDrivers(drivers);\n\n        function setDriverToConfig() {\n            self._config.driver = self.driver();\n        }\n\n        function extendSelfWithDriver(driver) {\n            self._extend(driver);\n            setDriverToConfig();\n\n            self._ready = self._initStorage(self._config);\n            return self._ready;\n        }\n\n        function initDriver(supportedDrivers) {\n            return function () {\n                var currentDriverIndex = 0;\n\n                function driverPromiseLoop() {\n                    while (currentDriverIndex < supportedDrivers.length) {\n                        var driverName = supportedDrivers[currentDriverIndex];\n                        currentDriverIndex++;\n\n                        self._dbInfo = null;\n                        self._ready = null;\n\n                        return self.getDriver(driverName).then(extendSelfWithDriver)[\"catch\"](driverPromiseLoop);\n                    }\n\n                    setDriverToConfig();\n                    var error = new Error('No available storage method found.');\n                    self._driverSet = Promise$1.reject(error);\n                    return self._driverSet;\n                }\n\n                return driverPromiseLoop();\n            };\n        }\n\n        // There might be a driver initialization in progress\n        // so wait for it to finish in order to avoid a possible\n        // race condition to set _dbInfo\n        var oldDriverSetDone = this._driverSet !== null ? this._driverSet[\"catch\"](function () {\n            return Promise$1.resolve();\n        }) : Promise$1.resolve();\n\n        this._driverSet = oldDriverSetDone.then(function () {\n            var driverName = supportedDrivers[0];\n            self._dbInfo = null;\n            self._ready = null;\n\n            return self.getDriver(driverName).then(function (driver) {\n                self._driver = driver._driver;\n                setDriverToConfig();\n                self._wrapLibraryMethodsWithReady();\n                self._initDriver = initDriver(supportedDrivers);\n            });\n        })[\"catch\"](function () {\n            setDriverToConfig();\n            var error = new Error('No available storage method found.');\n            self._driverSet = Promise$1.reject(error);\n            return self._driverSet;\n        });\n\n        executeTwoCallbacks(this._driverSet, callback, errorCallback);\n        return this._driverSet;\n    };\n\n    LocalForage.prototype.supports = function supports(driverName) {\n        return !!DriverSupport[driverName];\n    };\n\n    LocalForage.prototype._extend = function _extend(libraryMethodsAndProperties) {\n        extend(this, libraryMethodsAndProperties);\n    };\n\n    LocalForage.prototype._getSupportedDrivers = function _getSupportedDrivers(drivers) {\n        var supportedDrivers = [];\n        for (var i = 0, len = drivers.length; i < len; i++) {\n            var driverName = drivers[i];\n            if (this.supports(driverName)) {\n                supportedDrivers.push(driverName);\n            }\n        }\n        return supportedDrivers;\n    };\n\n    LocalForage.prototype._wrapLibraryMethodsWithReady = function _wrapLibraryMethodsWithReady() {\n        // Add a stub for each driver API method that delays the call to the\n        // corresponding driver method until localForage is ready. These stubs\n        // will be replaced by the driver methods as soon as the driver is\n        // loaded, so there is no performance impact.\n        for (var i = 0, len = LibraryMethods.length; i < len; i++) {\n            callWhenReady(this, LibraryMethods[i]);\n        }\n    };\n\n    LocalForage.prototype.createInstance = function createInstance(options) {\n        return new LocalForage(options);\n    };\n\n    return LocalForage;\n}();\n\n// The actual localForage object that we expose as a module or via a\n// global. It's extended by pulling in one of our other libraries.\n\n\nvar localforage_js = new LocalForage();\n\nmodule.exports = localforage_js;\n\n},{\"3\":3}]},{},[4])(4)\n});\n","(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory();\n  } else {\n    root.prefix = factory(root);\n  }\n}(this, function (root) {\n  'use strict';\n\n  var merge = function (target) {\n    var i = 1;\n    var length = arguments.length;\n    var key;\n    for (; i < length; i++) {\n      for (key in arguments[i]) {\n        if (Object.prototype.hasOwnProperty.call(arguments[i], key)) {\n          target[key] = arguments[i][key];\n        }\n      }\n    }\n    return target;\n  };\n\n  var defaults = {\n    template: '[%t] %l:',\n    levelFormatter: function (level) {\n      return level.toUpperCase();\n    },\n    nameFormatter: function (name) {\n      return name || 'root';\n    },\n    timestampFormatter: function (date) {\n      return date.toTimeString().replace(/.*(\\d{2}:\\d{2}:\\d{2}).*/, '$1');\n    },\n    format: undefined\n  };\n\n  var loglevel;\n  var configs = {};\n\n  var reg = function (rootLogger) {\n    if (!rootLogger || !rootLogger.getLogger) {\n      throw new TypeError('Argument is not a root logger');\n    }\n    loglevel = rootLogger;\n  };\n\n  var apply = function (logger, config) {\n    if (!logger || !logger.setLevel) {\n      throw new TypeError('Argument is not a logger');\n    }\n\n    /* eslint-disable vars-on-top */\n    var originalFactory = logger.methodFactory;\n    var name = logger.name || '';\n    var parent = configs[name] || configs[''] || defaults;\n    /* eslint-enable vars-on-top */\n\n    function methodFactory(methodName, logLevel, loggerName) {\n      var originalMethod = originalFactory(methodName, logLevel, loggerName);\n      var options = configs[loggerName] || configs[''];\n\n      var hasTimestamp = options.template.indexOf('%t') !== -1;\n      var hasLevel = options.template.indexOf('%l') !== -1;\n      var hasName = options.template.indexOf('%n') !== -1;\n\n      return function () {\n        var content = '';\n\n        var length = arguments.length;\n        var args = Array(length);\n        var key = 0;\n        for (; key < length; key++) {\n          args[key] = arguments[key];\n        }\n\n        // skip the root method for child loggers to prevent duplicate logic\n        if (name || !configs[loggerName]) {\n          /* eslint-disable vars-on-top */\n          var timestamp = options.timestampFormatter(new Date());\n          var level = options.levelFormatter(methodName);\n          var lname = options.nameFormatter(loggerName);\n          /* eslint-enable vars-on-top */\n\n          if (options.format) {\n            content += options.format(level, lname, timestamp);\n          } else {\n            content += options.template;\n            if (hasTimestamp) {\n              content = content.replace(/%t/, timestamp);\n            }\n            if (hasLevel) content = content.replace(/%l/, level);\n            if (hasName) content = content.replace(/%n/, lname);\n          }\n\n          if (args.length && typeof args[0] === 'string') {\n            // concat prefix with first argument to support string substitutions\n            args[0] = content + ' ' + args[0];\n          } else {\n            args.unshift(content);\n          }\n        }\n\n        originalMethod.apply(undefined, args);\n      };\n    }\n\n    if (!configs[name]) {\n      logger.methodFactory = methodFactory;\n    }\n\n    // for remove inherited format option if template option preset\n    config = config || {};\n    if (config.template) config.format = undefined;\n\n    configs[name] = merge({}, parent, config);\n\n    logger.setLevel(logger.getLevel());\n\n    if (!loglevel) {\n      logger.warn(\n        'It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md'\n      );\n    }\n\n    return logger;\n  };\n\n  var api = {\n    reg: reg,\n    apply: apply\n  };\n\n  var save;\n\n  if (root) {\n    save = root.prefix;\n    api.noConflict = function () {\n      if (root.prefix === api) {\n        root.prefix = save;\n      }\n      return api;\n    };\n  }\n\n  return api;\n}));\n","/*\n* loglevel - https://github.com/pimterry/loglevel\n*\n* Copyright (c) 2013 Tim Perry\n* Licensed under the MIT license.\n*/\n(function (root, definition) {\n    \"use strict\";\n    if (typeof define === 'function' && define.amd) {\n        define(definition);\n    } else if (typeof module === 'object' && module.exports) {\n        module.exports = definition();\n    } else {\n        root.log = definition();\n    }\n}(this, function () {\n    \"use strict\";\n\n    // Slightly dubious tricks to cut down minimized file size\n    var noop = function() {};\n    var undefinedType = \"undefined\";\n    var isIE = (typeof window !== undefinedType) && (typeof window.navigator !== undefinedType) && (\n        /Trident\\/|MSIE /.test(window.navigator.userAgent)\n    );\n\n    var logMethods = [\n        \"trace\",\n        \"debug\",\n        \"info\",\n        \"warn\",\n        \"error\"\n    ];\n\n    // Cross-browser bind equivalent that works at least back to IE6\n    function bindMethod(obj, methodName) {\n        var method = obj[methodName];\n        if (typeof method.bind === 'function') {\n            return method.bind(obj);\n        } else {\n            try {\n                return Function.prototype.bind.call(method, obj);\n            } catch (e) {\n                // Missing bind shim or IE8 + Modernizr, fallback to wrapping\n                return function() {\n                    return Function.prototype.apply.apply(method, [obj, arguments]);\n                };\n            }\n        }\n    }\n\n    // Trace() doesn't print the message in IE, so for that case we need to wrap it\n    function traceForIE() {\n        if (console.log) {\n            if (console.log.apply) {\n                console.log.apply(console, arguments);\n            } else {\n                // In old IE, native console methods themselves don't have apply().\n                Function.prototype.apply.apply(console.log, [console, arguments]);\n            }\n        }\n        if (console.trace) console.trace();\n    }\n\n    // Build the best logging method possible for this env\n    // Wherever possible we want to bind, not wrap, to preserve stack traces\n    function realMethod(methodName) {\n        if (methodName === 'debug') {\n            methodName = 'log';\n        }\n\n        if (typeof console === undefinedType) {\n            return false; // No method possible, for now - fixed later by enableLoggingWhenConsoleArrives\n        } else if (methodName === 'trace' && isIE) {\n            return traceForIE;\n        } else if (console[methodName] !== undefined) {\n            return bindMethod(console, methodName);\n        } else if (console.log !== undefined) {\n            return bindMethod(console, 'log');\n        } else {\n            return noop;\n        }\n    }\n\n    // These private functions always need `this` to be set properly\n\n    function replaceLoggingMethods(level, loggerName) {\n        /*jshint validthis:true */\n        for (var i = 0; i < logMethods.length; i++) {\n            var methodName = logMethods[i];\n            this[methodName] = (i < level) ?\n                noop :\n                this.methodFactory(methodName, level, loggerName);\n        }\n\n        // Define log.log as an alias for log.debug\n        this.log = this.debug;\n    }\n\n    // In old IE versions, the console isn't present until you first open it.\n    // We build realMethod() replacements here that regenerate logging methods\n    function enableLoggingWhenConsoleArrives(methodName, level, loggerName) {\n        return function () {\n            if (typeof console !== undefinedType) {\n                replaceLoggingMethods.call(this, level, loggerName);\n                this[methodName].apply(this, arguments);\n            }\n        };\n    }\n\n    // By default, we use closely bound real methods wherever possible, and\n    // otherwise we wait for a console to appear, and then try again.\n    function defaultMethodFactory(methodName, level, loggerName) {\n        /*jshint validthis:true */\n        return realMethod(methodName) ||\n               enableLoggingWhenConsoleArrives.apply(this, arguments);\n    }\n\n    function Logger(name, defaultLevel, factory) {\n      var self = this;\n      var currentLevel;\n      defaultLevel = defaultLevel == null ? \"WARN\" : defaultLevel;\n\n      var storageKey = \"loglevel\";\n      if (typeof name === \"string\") {\n        storageKey += \":\" + name;\n      } else if (typeof name === \"symbol\") {\n        storageKey = undefined;\n      }\n\n      function persistLevelIfPossible(levelNum) {\n          var levelName = (logMethods[levelNum] || 'silent').toUpperCase();\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage[storageKey] = levelName;\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=\" + levelName + \";\";\n          } catch (ignore) {}\n      }\n\n      function getPersistedLevel() {\n          var storedLevel;\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          try {\n              storedLevel = window.localStorage[storageKey];\n          } catch (ignore) {}\n\n          // Fallback to cookies if local storage gives us nothing\n          if (typeof storedLevel === undefinedType) {\n              try {\n                  var cookie = window.document.cookie;\n                  var location = cookie.indexOf(\n                      encodeURIComponent(storageKey) + \"=\");\n                  if (location !== -1) {\n                      storedLevel = /^([^;]+)/.exec(cookie.slice(location))[1];\n                  }\n              } catch (ignore) {}\n          }\n\n          // If the stored level is not valid, treat it as if nothing was stored.\n          if (self.levels[storedLevel] === undefined) {\n              storedLevel = undefined;\n          }\n\n          return storedLevel;\n      }\n\n      function clearPersistedLevel() {\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage.removeItem(storageKey);\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=; expires=Thu, 01 Jan 1970 00:00:00 UTC\";\n          } catch (ignore) {}\n      }\n\n      /*\n       *\n       * Public logger API - see https://github.com/pimterry/loglevel for details\n       *\n       */\n\n      self.name = name;\n\n      self.levels = { \"TRACE\": 0, \"DEBUG\": 1, \"INFO\": 2, \"WARN\": 3,\n          \"ERROR\": 4, \"SILENT\": 5};\n\n      self.methodFactory = factory || defaultMethodFactory;\n\n      self.getLevel = function () {\n          return currentLevel;\n      };\n\n      self.setLevel = function (level, persist) {\n          if (typeof level === \"string\" && self.levels[level.toUpperCase()] !== undefined) {\n              level = self.levels[level.toUpperCase()];\n          }\n          if (typeof level === \"number\" && level >= 0 && level <= self.levels.SILENT) {\n              currentLevel = level;\n              if (persist !== false) {  // defaults to true\n                  persistLevelIfPossible(level);\n              }\n              replaceLoggingMethods.call(self, level, name);\n              if (typeof console === undefinedType && level < self.levels.SILENT) {\n                  return \"No console available for logging\";\n              }\n          } else {\n              throw \"log.setLevel() called with invalid level: \" + level;\n          }\n      };\n\n      self.setDefaultLevel = function (level) {\n          defaultLevel = level;\n          if (!getPersistedLevel()) {\n              self.setLevel(level, false);\n          }\n      };\n\n      self.resetLevel = function () {\n          self.setLevel(defaultLevel, false);\n          clearPersistedLevel();\n      };\n\n      self.enableAll = function(persist) {\n          self.setLevel(self.levels.TRACE, persist);\n      };\n\n      self.disableAll = function(persist) {\n          self.setLevel(self.levels.SILENT, persist);\n      };\n\n      // Initialize with the right level\n      var initialLevel = getPersistedLevel();\n      if (initialLevel == null) {\n          initialLevel = defaultLevel;\n      }\n      self.setLevel(initialLevel, false);\n    }\n\n    /*\n     *\n     * Top-level API\n     *\n     */\n\n    var defaultLogger = new Logger();\n\n    var _loggersByName = {};\n    defaultLogger.getLogger = function getLogger(name) {\n        if ((typeof name !== \"symbol\" && typeof name !== \"string\") || name === \"\") {\n          throw new TypeError(\"You must supply a name when creating a logger.\");\n        }\n\n        var logger = _loggersByName[name];\n        if (!logger) {\n          logger = _loggersByName[name] = new Logger(\n            name, defaultLogger.getLevel(), defaultLogger.methodFactory);\n        }\n        return logger;\n    };\n\n    // Grab the current global log variable in case of overwrite\n    var _log = (typeof window !== undefinedType) ? window.log : undefined;\n    defaultLogger.noConflict = function() {\n        if (typeof window !== undefinedType &&\n               window.log === defaultLogger) {\n            window.log = _log;\n        }\n\n        return defaultLogger;\n    };\n\n    defaultLogger.getLoggers = function getLoggers() {\n        return _loggersByName;\n    };\n\n    // ES6 default export, for compatibility\n    defaultLogger['default'] = defaultLogger;\n\n    return defaultLogger;\n}));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","\n\nexport const throwDumbMode = () => {\n\tthrow new Error('cannot create element directly from params - running player in dumb mode')\n}\n\n\n(window as any).__dumbStubs = {\n\telementParamsToPlaylistData: throwDumbMode,\n\telementParamsToSpatialData: throwDumbMode\n}","\nexport const createUniqueArray = <T>() => {\n\n\tconst items: T[] = []\n\n\treturn {\n\t\t_items: items,\n\t\taddItem: (item: T) => {\n\t\t\tconst index = items.indexOf(item)\n\t\t\tif (index === -1) {\n\t\t\t\titems.push(item)\n\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t\t},\n\t\tremoveItem: (item: T) => {\n\t\t\tconst index = items.indexOf(item)\n\t\t\tif (index > -1) {\n\t\t\t\titems.splice(index, 1)\n\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t\t},\n\t\tclearItems: () => items.length = 0,\n\t\tgetItems: () => items\n\t}\n}\n\n\n","import { Action } from './utilTypes'\nimport { createUniqueArray } from './uniqueArray'\n\nexport interface iEvent<T = void> {\n\t_listeners: Action<T>[]\n\t_listenersOneshot: Action<T>[]\n\tinvoke: Action<T>\n\taddListener: Action<Action<T>>\n\taddListenerOneshot: Action<Action<T>>\n\tremoveListener: Action<Action<T>>\n\tremoveListenerOneshot: Action<Action<T>>\n}\n\n\n\nexport function createEvent<T = void>(): iEvent<T> {\n\n\tconst listeners = createUniqueArray<Action<T>>()\n\tconst listenersOneshot = createUniqueArray<Action<T>>()\n\n\tconst addListener = (listener: Action<T>) => listeners.addItem(listener)\n\tconst addListenerOneshot = (listener: Action<T>) => listenersOneshot.addItem(listener)\n\n\tconst removeListener = (listener: Action<T>) => listeners.removeItem(listener)\n\tconst removeListenerOneshot = (listener: Action<T>) => listenersOneshot.removeItem(listener)\n\n\tfunction invoke(args?: any) {\n\t\tlisteners\n\t\t\t.getItems()\n\t\t\t.forEach(listener => listener(args))\n\t\tlistenersOneshot\n\t\t\t.getItems()\n\t\t\t.forEach(listener => listener(args))\n\t\tlistenersOneshot.clearItems()\n\t}\n\n\treturn {\n\t\t_listeners: listeners._items,\n\t\t_listenersOneshot: listenersOneshot._items,\n\t\tinvoke,\n\t\taddListener,\n\t\taddListenerOneshot,\n\t\tremoveListener,\n\t\tremoveListenerOneshot\n\t}\n\n\n}","const concertHallConvolverUrl = 'https://dl.dropboxusercontent.com/s/jbcawsshxqf0myr/ConradPrebysConcertHallSeatF111.wav?dl=0'\nconst stairwellConvolverUrl = 'https://dl.dropboxusercontent.com/s/sjzu2078lg4bpwh/3000CStreetGarageStairwell.wav?dl=0'\nconst caveConvolverUrl = 'https://dl.dropboxusercontent.com/s/o9ftqlv137mwh0x/Batcave.wav?dl=0'\nconst defaultConvolverUrl = stairwellConvolverUrl\nexport {\n\tdefaultConvolverUrl,\n\tconcertHallConvolverUrl,\n\tstairwellConvolverUrl,\n\tcaveConvolverUrl\n}\nexport const convolverUrls = {\n\t'Test/Cave': caveConvolverUrl,\n\t'Test/Stairwell': stairwellConvolverUrl,\n\t'Test/ConcertHall': concertHallConvolverUrl,\n\t'Brutalism/BiomedicalSciences': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/BiomedicalSciences.wav',\n\t'Brutalism/CarpenterCenter': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/CarpenterCenter.wav',\n\t'Brutalism/GalbraithHall': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/GalbraithHall.wav',\n\t'Brutalism/GeiselLibrary': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/GeiselLibrary.wav',\n\t'Brutalism/GraffitiHallway': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/GraffitiHallway.wav',\n\t'Brutalism/HumanitiesSocialSciencesCourtyard': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/HumanitiesSocialSciencesCourtyard.wav',\n\t'Brutalism/LoveLibrary': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/LoveLibrary.wav',\n\t'Brutalism/NaturalSciences': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/NaturalSciences.wav',\n\t'Brutalism/PacificHall': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/PacificHall.wav',\n\t'Brutalism/PepperCanyonHall': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/PepperCanyonHall.wav',\n\t'Brutalism/SanDiegoSupercomputerCenter': 'https://mrchantey.github.io/file-hosting/impulse-responses/Brutalism/SanDiegoSupercomputerCenter.wav',\n\t'Miscellaneous/AcademicQuadrangle': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/AcademicQuadrangle.wav',\n\t'Miscellaneous/Amaranth': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/Amaranth.wav',\n\t'Miscellaneous/BarMonsieurRicard': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/BarMonsieurRicard.wav',\n\t'Miscellaneous/CastilloDeLosTresReyesDelMorro': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/CastilloDeLosTresReyesDelMorro.wav',\n\t'Miscellaneous/CastilloDeLosTresReyesDelMorroArch': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/CastilloDeLosTresReyesDelMorroArch.wav',\n\t'Miscellaneous/CastilloDeLosTresReyesDelMorroCourtyard': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/CastilloDeLosTresReyesDelMorroCourtyard.wav',\n\t'Miscellaneous/CastilloDeLosTresReyesDelMorroSalasDeExposicion': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/CastilloDeLosTresReyesDelMorroSalasDeExposicion.wav',\n\t'Miscellaneous/CedarCreekWinery': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/CedarCreekWinery.wav',\n\t'Miscellaneous/ConvocationMall': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/ConvocationMall.wav',\n\t'Miscellaneous/CPMC264': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/CPMC264.wav',\n\t'Miscellaneous/FortalezaDeSanCarlosDeLaCabana ': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/FortalezaDeSanCarlosDeLaCabana .wav',\n\t'Miscellaneous/FourPointsRoom270': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/FourPointsRoom270.wav',\n\t'Miscellaneous/HartwellTavern': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/HartwellTavern.wav',\n\t'Miscellaneous/Hawxhurst': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/Hawxhurst.wav',\n\t'Miscellaneous/HepnerHall': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/HepnerHall.wav',\n\t'Miscellaneous/LittlefieldLobby': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/LittlefieldLobby.wav',\n\t'Miscellaneous/MillsArtMuseum': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/MillsArtMuseum.wav',\n\t'Miscellaneous/PabellonCulturalDeLaRepublica': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/PabellonCulturalDeLaRepublica.wav',\n\t'Miscellaneous/PabstBrewery': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/PabstBrewery.wav',\n\t'Miscellaneous/QuadracciPavilion': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/QuadracciPavilion.wav',\n\t'Miscellaneous/RedBridge': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/RedBridge.wav',\n\t'Miscellaneous/SteinmanFoundationRecordingSuite': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/SteinmanFoundationRecordingSuite.wav',\n\t'Miscellaneous/StorageTankNo7': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/StorageTankNo7.wav',\n\t'Miscellaneous/TijuanaMall': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/TijuanaMall.wav',\n\t'Miscellaneous/WangenheimRareBooksRoom': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/WangenheimRareBooksRoom.wav',\n\t'Miscellaneous/WarrenLectureHall2005': 'https://mrchantey.github.io/file-hosting/impulse-responses/Miscellaneous/WarrenLectureHall2005.wav',\n\t'Nature/ByronGlacier': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/ByronGlacier.wav',\n\t'Nature/CliffOfTheDawn': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/CliffOfTheDawn.wav',\n\t'Nature/DevilsPunchbowl': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/DevilsPunchbowl.wav',\n\t'Nature/DivorceBeach': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/DivorceBeach.wav',\n\t'Nature/FatMansMisery': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/FatMansMisery.wav',\n\t'Nature/FatMansSqueeze': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/FatMansSqueeze.wav',\n\t'Nature/IslaMujeresCave': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/IslaMujeresCave.wav',\n\t'Nature/PurgatoryChasm': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/PurgatoryChasm.wav',\n\t'Nature/StanleyParkCliffs': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/StanleyParkCliffs.wav',\n\t'Nature/TheSlot': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/TheSlot.wav',\n\t'Nature/WoodruffLane': 'https://mrchantey.github.io/file-hosting/impulse-responses/Nature/WoodruffLane.wav',\n\t'Recreation/Art Museum': 'https://mrchantey.github.io/file-hosting/impulse-responses/Recreation/Cranbrook Art Museum.wav',\n\t'Recreation/HaleHolisticYogaStudio': 'https://mrchantey.github.io/file-hosting/impulse-responses/Recreation/HaleHolisticYogaStudio.wav',\n\t'Recreation/Natatorium': 'https://mrchantey.github.io/file-hosting/impulse-responses/Recreation/Natatorium.wav',\n\t'Recreation/OutbackClimbingCenter': 'https://mrchantey.github.io/file-hosting/impulse-responses/Recreation/OutbackClimbingCenter.wav',\n\t'Recreation/RacquetballCourt': 'https://mrchantey.github.io/file-hosting/impulse-responses/Recreation/RacquetballCourt.wav',\n\t'Recreation/SewardWaterfrontPark': 'https://mrchantey.github.io/file-hosting/impulse-responses/Recreation/SewardWaterfrontPark.wav',\n\t'Recreation/Giant Tower': 'https://mrchantey.github.io/file-hosting/impulse-responses/Recreation/Sleeping Giant Tower.wav',\n\t'Stairwells/3000CStreetGarageStairwell': 'https://mrchantey.github.io/file-hosting/impulse-responses/Stairwells/3000CStreetGarageStairwell.wav',\n\t'Stairwells/CCRMAStairwell': 'https://mrchantey.github.io/file-hosting/impulse-responses/Stairwells/CCRMAStairwell.wav',\n\t'Stairwells/ConventionCenterSteps': 'https://mrchantey.github.io/file-hosting/impulse-responses/Stairwells/ConventionCenterSteps.wav',\n\t'Stairwells/CPMCNorthStairwell': 'https://mrchantey.github.io/file-hosting/impulse-responses/Stairwells/CPMCNorthStairwell.wav',\n\t'Stairwells/ExerciseAndNutritionSciences': 'https://mrchantey.github.io/file-hosting/impulse-responses/Stairwells/ExerciseAndNutritionSciences.wav',\n\t'Stairwells/StrathconaStairwellMcGill': 'https://mrchantey.github.io/file-hosting/impulse-responses/Stairwells/StrathconaStairwellMcGill.wav',\n\t'Stairwells/TransitCenter': 'https://mrchantey.github.io/file-hosting/impulse-responses/Stairwells/TransitCenter.wav',\n\t'Underground/Batcave': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/Batcave.wav',\n\t'Underground/BatteryBenson': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/BatteryBenson.wav',\n\t'Underground/BatteryBrannan': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/BatteryBrannan.wav',\n\t'Underground/BatteryPowell': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/BatteryPowell.wav',\n\t'Underground/BatteryQuarles': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/BatteryQuarles.wav',\n\t'Underground/BatteryRandol': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/BatteryRandol.wav',\n\t'Underground/BatteryTolles': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/BatteryTolles.wav',\n\t'Underground/CathedralRoom': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/CathedralRoom.wav',\n\t'Underground/DiscoveryRoom': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/DiscoveryRoom.wav',\n\t'Underground/DrainageTunnel': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/DrainageTunnel.wav',\n\t'Underground/FortWordenPillbox': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/FortWordenPillbox.wav',\n\t'Underground/FortWordenTunnel': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/FortWordenTunnel.wav',\n\t'Underground/HarborEntranceControlPost': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/HarborEntranceControlPost.wav',\n\t'Underground/LakeMerrittBART': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/LakeMerrittBART.wav',\n\t'Underground/LawrenceWelkCave': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/LawrenceWelkCave.wav',\n\t'Underground/NancyLakeTunnel': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/NancyLakeTunnel.wav',\n\t'Underground/PortageCreekTunnel': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/PortageCreekTunnel.wav',\n\t'Underground/PortTownsendSkatepark': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/PortTownsendSkatepark.wav',\n\t'Underground/Qasgiq': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/Qasgiq.wav',\n\t'Underground/SaltonSeaDrainagePipe': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/SaltonSeaDrainagePipe.wav',\n\t'Underground/SquareVictoriaDome': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/SquareVictoriaDome.wav',\n\t'Underground/TijuanaAqueductTunnel': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/TijuanaAqueductTunnel.wav',\n\t'Underground/TonyKnowlesCoastalTrailTunnel': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/TonyKnowlesCoastalTrailTunnel.wav',\n\t'Underground/TunnelToHeaven': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/TunnelToHeaven.wav',\n\t'Underground/TunnelToHell': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underground/TunnelToHell.wav',\n\t'Underpasses/5UnderpassValencia': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/5UnderpassValencia.wav',\n\t'Underpasses/ArroyoEnsenada': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/ArroyoEnsenada.wav',\n\t'Underpasses/Avenue52UnderpassLARiver': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/Avenue52UnderpassLARiver.wav',\n\t'Underpasses/Avenue60UnderpassLARiver': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/Avenue60UnderpassLARiver.wav',\n\t'Underpasses/BoulevardRosemontUnderpass': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/BoulevardRosemontUnderpass.wav',\n\t'Underpasses/CaribooRdUnderGaglardiWay': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/CaribooRdUnderGaglardiWay.wav',\n\t'Underpasses/CleftRidgeArch': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/CleftRidgeArch.wav',\n\t'Underpasses/Commerical&5Underpass': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/Commerical&5Underpass.wav',\n\t'Underpasses/DipwayArch': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/DipwayArch.wav',\n\t'Underpasses/EchoBridge': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/EchoBridge.wav',\n\t'Underpasses/FishCreekTrestleBridge': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/FishCreekTrestleBridge.wav',\n\t'Underpasses/FremontTroll': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/FremontTroll.wav',\n\t'Underpasses/HopkinsDriveUnderpass': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/HopkinsDriveUnderpass.wav',\n\t'Underpasses/JFKUnderpass': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/JFKUnderpass.wav',\n\t'Underpasses/LionsGateBridge': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/LionsGateBridge.wav',\n\t'Underpasses/OldSouthBridge': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/OldSouthBridge.wav',\n\t'Underpasses/RiverMountainsLoopTrailAqueduct': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/RiverMountainsLoopTrailAqueduct.wav',\n\t'Underpasses/StanleyParkCauseway': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/StanleyParkCauseway.wav',\n\t'Underpasses/StanleyParkDriveUnderpass': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/StanleyParkDriveUnderpass.wav',\n\t'Underpasses/SwitzerStUnderEHarborDr': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/SwitzerStUnderEHarborDr.wav',\n\t'Underpasses/TelephoneWash': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/TelephoneWash.wav',\n\t'Underpasses/WalkwayUnderECampusDr': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/WalkwayUnderECampusDr.wav',\n\t'Underpasses/WaterplacePark': 'https://mrchantey.github.io/file-hosting/impulse-responses/Underpasses/WaterplacePark.wav',\n\t'Venues/ConradPrebysConcertHallSeatF111': 'https://mrchantey.github.io/file-hosting/impulse-responses/Venues/ConradPrebysConcertHallSeatF111.wav',\n\t'Venues/MillsGreekTheater': 'https://mrchantey.github.io/file-hosting/impulse-responses/Venues/MillsGreekTheater.wav',\n\t'Venues/NaumburgBandshell': 'https://mrchantey.github.io/file-hosting/impulse-responses/Venues/NaumburgBandshell.wav',\n\t'Venues/Space4ArtGallery': 'https://mrchantey.github.io/file-hosting/impulse-responses/Venues/Space4ArtGallery.wav',\n\t'Venues/SteinmanHall': 'https://mrchantey.github.io/file-hosting/impulse-responses/Venues/SteinmanHall.wav',\n}","import { convolverUrls, stairwellConvolverUrl } from './convolverUrls'\nimport { AudioEffect } from './types'\n\nexport const defaultEffectFileUrl = ''  // 'https://dl.dropboxusercontent.com/s/3uzwlcr5ws12gau/SyrinscapeEffects%20-%20Returning%20to%20testing%20in%20Feb%202022%20-%20Ready%20to%20replace%20on%20server.json?dl=0'\n\nconst volumeParam = {\n\tdisplayName: 'Volume',\n\ttype: 'number' as const,\n\tdefault: 1,\n\tmax: 10\n}\n\nconst filterParams = {\n\tdetune: {\n\t\tdisplayName: 'Detune',\n\t\ttype: 'number' as const,\n\t\tdefault: 0,\n\t\tmin: -153600,\n\t\tmax: 153600,\n\t\tstep: 1\n\t},\n\tfrequency: {\n\t\tdisplayName: 'Frequency',\n\t\ttype: 'number' as const,\n\t\tdefault: 350,\n\t\tmin: 0,\n\t\tmax: 24000,\n\t\tstep: 100\n\t},\n\tresonance: {\n\t\tdisplayName: 'Resonance',\n\t\ttype: 'number' as const,\n\t\tdefault: 0.5,\n\t},\n\tgain: {\n\t\tdisplayName: 'Shelf Gain',\n\t\ttype: 'number' as const,\n\t\tdefault: 0,\n\t\tmin: -1541.273681640625,\n\t\tmax: 1541.273681640625,\n\t}\n}\n\n\nlet defaultNameCount = 0\nexport const createDefaultEffectParams = <T extends AudioEffect.EffectType>(type: T, name = `My ${type} effect ${++defaultNameCount}`): AudioEffect.EffectParamsTypeMap[T] =>\n\tObject.entries(effectMetadataMap[type].parameters)\n\t\t.reduce((acc, [key, value]) =>\n\t\t\t({ ...acc, [key]: JSON.parse(JSON.stringify(value.default)) }),\n\t\t\t{\n\t\t\t\tname,\n\t\t\t\ttype,\n\t\t\t\toutput: 'Global Volume',\n\t\t\t} as AudioEffect.EffectParamsTypeMap[T])\n\n\nexport const effectMetadataMap: AudioEffect.EffectMetadataMap = {\n\t'analyser': {\n\t\tdisplayName: 'Analyser',\n\t\tparameters: {\n\t\t\tfftSize: {\n\t\t\t\tdisplayName: 'fftSize',\n\t\t\t\toptions: {\n\t\t\t\t\t'32': '32',\n\t\t\t\t\t'64': '64',\n\t\t\t\t\t'128': '128',\n\t\t\t\t\t'256': '256',\n\t\t\t\t\t'512': '512',\n\t\t\t\t\t'1024': '1024',\n\t\t\t\t\t'2048': '2048',\n\t\t\t\t\t'4096': '4096',\n\t\t\t\t\t'8192': '8192',\n\t\t\t\t\t'16384': '16384',\n\t\t\t\t\t'32768': '32768',\n\t\t\t\t},\n\t\t\t\ttype: 'select',\n\t\t\t\tdefault: '128',  // Default: 2048\n\t\t\t},\n\t\t\tmaxDecibels: {\n\t\t\t\tdisplayName: 'maxDecibels',\n\t\t\t\tmax: 0,\n\t\t\t\tmin: -100,\n\t\t\t\tstep: 1,\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: -30,  // Default: -30\n\t\t\t},\n\t\t\tminDecibels: {\n\t\t\t\tdisplayName: 'minDecibels',\n\t\t\t\tmax: 0,\n\t\t\t\tmin: -100,\n\t\t\t\tstep: 1,\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: -100,  // Default: -100\n\t\t\t},\n\t\t\tsmoothingTimeConstant: {\n\t\t\t\tdisplayName: 'smoothingTimeConstant',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.8,  // Default: 0.8\n\t\t\t},\n\t\t\t// channelCount,\n\t\t\t// channelCountMode,\n\t\t\t// channelInterpretation,\n\t\t},\n\t},\n\t'compressor': {\n\t\tdisplayName: 'Compressor',\n\t\tparameters: {\n\t\t\tattack: {\n\t\t\t\tdisplayName: 'attack',\n\t\t\t\tstep: 0.001,\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.003,  // Default 0.003\n\t\t\t},\n\t\t\tknee: {\n\t\t\t\tdisplayName: 'knee',\n\t\t\t\tmax: 40,\n\t\t\t\tmin: 0,\n\t\t\t\tstep: 1,\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 30,  // Default 30\n\t\t\t},\n\t\t\tratio: {\n\t\t\t\tdisplayName: 'ratio',\n\t\t\t\tmax: 20,\n\t\t\t\tmin: 1,\n\t\t\t\tstep: 1,\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 12,  // Default 12\n\t\t\t},\n\t\t\trelease: {\n\t\t\t\tdisplayName: 'release',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.25,  // Default 0.25\n\t\t\t},\n\t\t\tthreshold: {\n\t\t\t\tdisplayName: 'threshold',\n\t\t\t\tmax: 0,\n\t\t\t\tmin: -100,\n\t\t\t\tstep: 1,\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: -24,  // Default: -24\n\t\t\t},\n\t\t},\n\t},\n\t'convolver': {\n\t\tdisplayName: 'Convolver',\n\t\tparameters: {\n\t\t\turl: {\n\t\t\t\tdisplayName: 'URL',\n\t\t\t\t// type: 'select',\n\t\t\t\ttype: 'string',\n\t\t\t\tdefault: stairwellConvolverUrl,\n\t\t\t\t// options: convolverUrls\n\t\t\t},\n\t\t}\n\t},\n\t'delay': {\n\t\tdisplayName: 'Delay',\n\t\tparameters: {\n\t\t\tfalloff: {\n\t\t\t\tdisplayName: 'Falloff',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.5,\n\t\t\t},\n\t\t\tduration: {\n\t\t\t\tdisplayName: 'Duration',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.5,\n\t\t\t\tmax: 1,\n\t\t\t}\n\t\t}\n\t},\n\t'send': {\n\t\tdisplayName: 'Send',\n\t\tparameters: {\n\t\t\twetness: {\n\t\t\t\tdisplayName: 'Wetness',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.5\n\t\t\t},\n\t\t\tdryOutput: {\n\t\t\t\tdisplayName: 'Dry Output',\n\t\t\t\ttype: 'audioReceive',\n\t\t\t\tdefault: 'Global Volume'\n\t\t\t}\n\t\t}\n\t},\n\t'volume': {\n\t\tdisplayName: 'Volume',\n\t\tparameters: {\n\t\t\tvolume: volumeParam,\n\t\t\tfadeDuration: {\n\t\t\t\tdisplayName: 'Fade Duration',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 1,\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 5,\n\t\t\t}\n\t\t}\n\t},\n\t'spatial': {\n\t\tdisplayName: 'Spatial',\n\t\tparameters: {\n\t\t\tposition: {\n\t\t\t\tdisplayName: 'Position',\n\t\t\t\ttype: 'vector3',\n\t\t\t\tdefault: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tz: 0\n\t\t\t\t}\n\t\t\t},\n\t\t\tspeed: {\n\t\t\t\tdisplayName: 'Speed',\n\t\t\t\tdefault: 0,\n\t\t\t\ttype: 'number',\n\t\t\t\tmax: 1000\n\t\t\t},\n\t\t\tpanningModel: {\n\t\t\t\tdisplayName: 'Panning Model',\n\t\t\t\ttype: 'select',\n\t\t\t\t// Do not use equalpower. It will only send audio to the closest speaker, e.g.\n\t\t\t\t// all sound to just the right channel if the source is on the right.\n\t\t\t\tdefault: 'HRTF',\n\t\t\t\toptions: {\n\t\t\t\t\t'Head Related TF': 'HRTF',\n\t\t\t\t\t'Equal Power': 'equalpower'\n\t\t\t\t} as Record<string, PanningModelType>\n\t\t\t},\n\t\t\tdistanceModel: {\n\t\t\t\tdisplayName: 'Distance Model',\n\t\t\t\ttype: 'select',\n\t\t\t\tdefault: 'inverse',\n\t\t\t\toptions: {\n\t\t\t\t\t'Inverse': 'inverse',\n\t\t\t\t\t'Exponential': 'exponential',\n\t\t\t\t\t'Linear': 'linear'\n\t\t\t\t} as Record<string, DistanceModelType>\n\t\t\t},\n\t\t\tminDistance: {  // refDistance, see: https://developer.mozilla.org/en-US/docs/Web/API/PannerNode/refDistance\n\t\t\t\tdisplayName: 'Min Distance',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0,\n\t\t\t\tmax: 1000,\n\t\t\t},\n\t\t\tmaxDistance: {\n\t\t\t\tdisplayName: 'Max Distance',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 100,\n\t\t\t\tmax: 1000,\n\t\t\t},\n\t\t\trolloff: {\n\t\t\t\tdisplayName: 'Rolloff',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.5,\n\t\t\t\tmax: 100,\n\t\t\t}\n\t\t}\n\t},\n\t'filter': {\n\t\tdisplayName: 'Filter',\n\t\tparameters: {\n\t\t\t...filterParams,\n\t\t\tfilterType: {\n\t\t\t\tdisplayName: 'Filter Type',\n\t\t\t\ttype: 'select',\n\t\t\t\tdefault: 'lowpass',\n\t\t\t\toptions: {\n\t\t\t\t\t'Low Pass': 'lowpass',\n\t\t\t\t\t'High Pass': 'highpass',\n\t\t\t\t\t'Band Pass': 'bandpass',\n\t\t\t\t\t'All Pass': 'allpass',\n\t\t\t\t\t'Low Shelf': 'lowshelf',\n\t\t\t\t\t'High Shelf': 'highshelf',\n\t\t\t\t\t'Peaking': 'peaking',\n\t\t\t\t\t'Notch': 'notch',\n\t\t\t\t} as Record<string, BiquadFilterType>\n\t\t\t}\n\t\t}\n\t},\n\t'reverb': {\n\t\tdisplayName: 'Reverb',\n\t\tparameters: {\n\t\t\tduration: {\n\t\t\t\tdisplayName: 'Duration',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 1,\n\t\t\t\tmax: 5\n\t\t\t},\n\t\t\tpreDelay: {\n\t\t\t\tdisplayName: 'Pre Delay',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.03,\n\t\t\t\tmax: 1\n\t\t\t},\n\t\t\tattack: {\n\t\t\t\tdisplayName: 'Attack',\n\t\t\t\tstep: 0.001,\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.001,\n\t\t\t},\n\t\t\tdecay: {\n\t\t\t\tdisplayName: 'Decay',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.1,\n\t\t\t\tmax: 1,\n\t\t\t},\n\t\t\tlpCutoff: {\n\t\t\t\t...filterParams.frequency,\n\t\t\t\tdisplayName: 'LP Cutoff',\n\t\t\t\tdefault: 2000,\n\t\t\t},\n\t\t\tlpResonance: {\n\t\t\t\tdisplayName: 'LP Resonance',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.2,\n\t\t\t\tmax: 1\n\t\t\t},\n\t\t\thpCutoff: {\n\t\t\t\t...filterParams.frequency,\n\t\t\t\tdisplayName: 'HP Cutoff',\n\t\t\t\tdefault: 500,\n\t\t\t},\n\t\t\thpResonance: {\n\t\t\t\tdisplayName: 'HP Resonance',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.1,\n\t\t\t\tmax: 1\n\t\t\t}\n\t\t}\n\t},\n\t'freeverb': {\n\t\tdisplayName: 'Freeverb',\n\t\tparameters: {\n\t\t\troomSize: {\n\t\t\t\tdisplayName: 'Room Size',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.9,\n\t\t\t\tmax: 1\n\t\t\t},\n\t\t\tdampening: {\n\t\t\t\tdisplayName: 'Dampening',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 6000,\n\t\t\t\tstep: 20,\n\t\t\t\tmax: 20000\n\t\t\t},\n\t\t\tpreDelay: {\n\t\t\t\tdisplayName: 'Predelay',\n\t\t\t\ttype: 'number',\n\t\t\t\tdefault: 0.01,\n\t\t\t\tmax: 1\n\t\t\t},\n\t\t\tlpFrequency: {\n\t\t\t\t...filterParams.frequency,\n\t\t\t\tdisplayName: 'LP Cutoff',\n\t\t\t\tdefault: 2000\n\t\t\t},\n\t\t\thpFrequency: {\n\t\t\t\t...filterParams.frequency,\n\t\t\t\tdisplayName: 'HP Cutoff',\n\t\t\t\tdefault: 600\n\t\t\t},\n\t\t\tlpResonance: {\n\t\t\t\t...filterParams.resonance,\n\t\t\t\tdisplayName: 'LP Resonance',\n\t\t\t},\n\t\t\t// lpGain:{\n\t\t\t//\t ...filterParams.gain,\n\t\t\t//\t displayName:'LP Gain'\n\t\t\t// },\n\t\t\thpResonance: {\n\t\t\t\t...filterParams.resonance,\n\t\t\t\tdisplayName: 'HP Resonance'\n\t\t\t},\n\t\t\tgain: {\n\t\t\t\t...volumeParam,\n\t\t\t\tdisplayName: 'Gain',\n\t\t\t\tdefault: 0.2\n\t\t\t}\n\t\t\t// hpGain:{\n\t\t\t//\t ...filterParams.gain,\n\t\t\t//\t displayName:'HP Gain'\n\t\t\t// },\n\t\t}\n\t}\n}\n\n","import { AudioEffect } from '../types'\n\nexport const createAudioEffect = (input: AudioNode, output = input) => ({\n\tinput,\n\toutput,\n\tconnect: (other: AudioEffect.HasInput) => output.connect(other.input),\n\tdisconnectAll: () => {\n\t\tinput.disconnect()\n\t\toutput.disconnect()\n\t}\n})","let serverTimeOffset = 0\n\nexport const getServerTimeOffset = () => serverTimeOffset\nexport const setServerTimeOffset = (serverTime) => serverTimeOffset = Date.now() - serverTime\n\nexport const getServerTime = (when: number = undefined) => (when || Date.now()) - serverTimeOffset\nexport default getServerTime\n","/*\nCreate a global 'syrinscape' object to expose our public API and hold references to any\nsingletons to ensure they are instantiated only once, even if loaded multiple times by\nindependent bundles that can optionally be used together.\n*/\n\ndeclare global {\n\tinterface Window {\n\t\tsyrinscape: any\n\t\tSentry: any\n\t}\n}\n\n// Create a proxy object to hold references to non-public singletons, to break tab\n// completion in the console. This is more about keeping our public API clean than\n// making anything truly inaccessible.\nconst createRegistry = () => {\n\tconst registry = {}\n\treturn new Proxy({}, {\n\t\tget(target, p, receiver) {\n\t\t\treturn registry[p as string]\n\t\t},\n\t\tset(target, p, newValue, receiver) {\n\t\t\tregistry[p as string] = newValue\n\t\t\treturn true\n\t\t},\n\t})\n}\n\nwindow.syrinscape ??= { _r: createRegistry() }\n\nexport const syrinscape = window.syrinscape\nexport default syrinscape\n","import rootLogger from 'loglevel'\nimport prefixer from 'loglevel-plugin-prefix'\nimport getServerTime from 'modules-core/utility/serverTime'\nimport syrinscape from 'app/common/syrinscape'\n\nprefixer.reg(rootLogger)\nprefixer.apply(rootLogger, {\n\ttemplate: '[%t] %l (%n):',\n\ttimestampFormatter: function (date) {\n\t\tconst serverDate = new Date(getServerTime(date.getTime()))\n\t\treturn serverDate.toTimeString().replace(/.*(\\d{2}:\\d{2}:\\d{2}).*/, '$1')\n\t},\n})\n\nconst allSetLevel = (level: rootLogger.LogLevelDesc, persist: boolean = true) => {\n\tObject.values(rootLogger.getLoggers()).forEach((logger) => logger.setLevel(level, persist))\n}\n\nconst allResetLevel = () => {\n\tObject.values(rootLogger.getLoggers()).forEach((logger) => logger.resetLevel())\n}\n\nsyrinscape.log ??= {\n\t...rootLogger,\n\tallSetLevel,\n\tallResetLevel,\n}\n\nexport const log = syrinscape.log\nexport default log\n","// @ts-ignore injected by webpack\nconst mediaPrefix = MEDIA_PREFIX\n\nconst prefix = 'http://browser-storage.syrinscape.com/'\nconst cleanedMediaURL = new URL(prefix)\ncleanedMediaURL.hostname = 'browser-storage-media.syrinscape.com'\nconst cleanedMediaPrefix = cleanedMediaURL.toString()\n\nexport const cleanKey = (key: string) => {\n\t// Convert key to a URL suitable for `Request()`, which the Cache API uses as keys.\n\ttry {\n\t\tlet url = new URL(key)\n\t\t// Strip the querystring from S3 URLs, because these are always (usually?) for\n\t\t// authorisation and do not identify a distinct object. Including these in the key\n\t\t// would result in many accidental `getItem()` failures when the same distinct\n\t\t// object is requested.\n\t\tif (key.startsWith(mediaPrefix)) {\n\t\t\turl.protocol = cleanedMediaURL.protocol\n\t\t\turl.port = cleanedMediaURL.port\n\t\t\turl.hostname = cleanedMediaURL.hostname\n\t\t\turl.search = ''\n\t\t\tkey = url.toString()\n\t\t}\n\t} catch (_) {\n\t\t// When the key is not already a URL with a hostname, convert it to a bogus URL with\n\t\t// a consistent scheme and hostname. Otherwise, when passed to `Request()` it will\n\t\t// implicitly use the current hostname, which might result in an unintentional\n\t\t// `getItem()` failure if accessed via different hostnames (e.g. `app.*` or `sN.`)\n\t\tkey = `${prefix}${encodeURIComponent(key)}`\n\t}\n\treturn key\n}\n\nexport const unCleanKey = (key: string) => {\n\t// Convert a URL key from the database back to its original string.\n\tif (key.startsWith(prefix)) {\n\t\tkey = decodeURIComponent(key.substring(prefix.length))\n\t} else if (key.startsWith(cleanedMediaPrefix)) {\n\t\tkey = decodeURIComponent(key.substring(cleanedMediaPrefix.length))\n\t\tkey = `${mediaPrefix}${key}`\n\t}\n\treturn key\n}\n","import { iDatabase } from './types'\nimport { cleanKey, unCleanKey } from './utility';\n\nexport const createCacheStorageDatabase = (name = 'database'): iDatabase => {\n\t// `createCacheStorageDatabase()` is not async, so we cannot `await caches.open(...)`.\n\t// Instead, we keep a reference to the promise and `await openCache` inside each\n\t// database function (below).\n\tlet openCache: Promise<Cache> = caches.open(name)\n\n\tconst db: iDatabase = {\n\t\tgetItem: async (key) => {\n\t\t\tconst cache = await openCache\n\t\t\tconst response = await cache.match(new Request(cleanKey(key)))\n\t\t\tif (!response) {\n\t\t\t\treturn null\n\t\t\t}\n\t\t\treturn response.blob()\n\t\t},\n\t\tsetItem: async (key, val) => {\n\t\t\tconst cache = await openCache\n\t\t\tawait cache.put(\n\t\t\t\tnew Request(cleanKey(key)),\n\t\t\t\tnew Response(val, { headers: { 'Content-Length': val.size.toString() } })\n\t\t\t)\n\t\t},\n\t\tremoveItem: async (key) => {\n\t\t\tconst cache = await openCache\n\t\t\tawait cache.delete(new Request(cleanKey(key)))\n\t\t},\n\t\tclear: async () => {\n\t\t\tconst cache = await openCache\n\t\t\tawait caches.delete(name)\n\t\t\topenCache = caches.open(name)\n\t\t},\n\t\tgetKeys: async () => {\n\t\t\tconst cache = await openCache\n\t\t\treturn (await cache.keys()).map((request) => unCleanKey(request.url))\n\t\t},\n\t}\n\treturn db\n}\n","import localforage from 'localforage'\nimport { iDatabase } from './types'\nimport { cleanKey } from './utility'\n\nexport const createLocalForageDatabase = (name = 'database'): iDatabase => {\n\tconst forage = localforage.createInstance({\n\t\tname,\n\t\tdriver: localforage.INDEXEDDB,\n\t\tversion: 1.0,\n\t})\n\n\t// localForage passes error strings to a callback, instead of throwing them directly.\n\tconst errCallback = (err) => {\n\t\tif (err) {\n\t\t\tthrow new Error(`localForage error: ${err}`)\n\t\t}\n\t}\n\n\tconst db: iDatabase = {\n\t\tgetItem: async (key) => await forage.getItem(cleanKey(key), errCallback),\n\t\tsetItem: async (key, val) => await forage.setItem(cleanKey(key), val, errCallback),\n\t\tremoveItem: async (key) => await forage.removeItem(cleanKey(key), errCallback),\n\t\tclear: forage.clear,\n\t\tgetKeys: forage.keys,\n\t}\n\treturn db\n}\n","/*\nCreate a named database that uses the browser's Cache API, with a fallback to IndexedDB.\n*/\n\nimport { createCacheStorageDatabase } from \"./cacheStorageDatabase\"\nimport { createLocalForageDatabase } from \"./localForageDatabase\"\nimport { iDatabase } from \"./types\"\nimport log from 'modules-core/log'\n\nconst logger = log.getLogger('storageDatabase')\n\nexport const createStorageDatabase = (name = 'database'): iDatabase => {\n\tlet database: iDatabase\n\n\t// Use IndexedDB, fallback to Cache API, which raises an \"operation too large\" error\n\t// when we have too many (>28k) keys.\n\t// See: https://bugs.chromium.org/p/chromium/issues/detail?id=688268#c6\n\tif ('indexedDB' in self) {\n\t\tlogger.info(`Using IndexedDB for cache database: ${name}`)\n\t\tdatabase = createLocalForageDatabase(name)\n\t\tif ('caches' in self) {\n\t\t\tcreateCacheStorageDatabase(name).clear()\n\t\t}\n\t} else {\n\t\tlogger.info(`Using Cache API for storage database: ${name}`)\n\t\tdatabase = createCacheStorageDatabase(name)\n\t\t// If IndexedDB is not available, we can't open and then clear a Cache API database.\n\t\t// createLocalForageDatabase(name).clear()\n\t}\n\treturn database\n}\n\nexport const storageDatabase = createStorageDatabase()\nexport default storageDatabase\n","export const uuid = () => {\n\tconst url = URL.createObjectURL(new Blob())\n\tconst [id] = url.toString().split('/').reverse()\n\tURL.revokeObjectURL(url)\n\treturn id\n}\nexport default uuid\n","/*\nProvides synchronous access to config with async write through to persistent storage.\nYou must call `await config.init(context = 'default')` first, then you can use the\ngetter/setter for each config item.\n*/\n\nimport log from 'modules-core/log'\nimport storageDatabase from './cache/storageDatabase'\nimport syrinscape from 'app/common/syrinscape'\nimport uuid from './utility/uuid'\n\nconst logger = log.getLogger('config')\n\nexport const minVolume = 0\nexport const maxVolume = 1.5\n\nconst createConfig = () => {\n\tlogger.info('createConfig()')\n\n\t// Allow overriding some config based on query string params.\n\tconst query = new URLSearchParams(location.search)\n\n\t// Allow callers to use an existing audio context.\n\tlet _audioContext: AudioContext\n\n\t// Set by `config.init()`. Set a different context to use a distinct set of config,\n\t// e.g. for use on the home page without interfering with the master interface config.\n\tlet _context: string\n\n\t// Require `await config.init()` before access.\n\tlet checkContext = () => {\n\t\tif (typeof _context === 'undefined') {\n\t\t\tthrow Error(\n\t\t\t\t`Unable to access config. Call 'await config.init()' first.`\n\t\t\t)\n\t\t}\n\t}\n\n\t// Local copy of last seen value.\n\tlet localData = {}\n\n\t// Get from local data.\n\tlet getLocalItem = (key: string, defaultValue: any = '') => {\n\t\tcheckContext()\n\t\tlet value = localData[`${_context}.${key}`]\n\t\tif (typeof value === 'undefined') {\n\t\t\treturn defaultValue\n\t\t}\n\t\treturn value\n\t}\n\n\t// Save to local data.\n\tlet setLocalItem = (key: string, value: any) => {\n\t\tcheckContext()\n\t\tlocalData[`${_context}.${key}`] = value\n\t\treturn value\n\t}\n\n\t// Get from persistent storage and write to local data.\n\tlet getItem = async (key: string, defaultValue: any = '') => {\n\t\tcheckContext()\n\t\tlet promiseResolve = getSyncPromise()\n\t\tlet item = await storageDatabase.getItem(`config.${_context}.${key}`)\n\t\tlet value\n\t\tif (item !== null) {\n\t\t\tvalue = JSON.parse(await new Response(item).text())\n\t\t} else {\n\t\t\tvalue = defaultValue\n\t\t\t// Save default to persistent storage, so we can detect changes later.\n\t\t\tawait storageDatabase.setItem(\n\t\t\t\t`config.${_context}.${key}`, new Blob([JSON.stringify(value ?? '')])\n\t\t\t)\n\t\t}\n\t\tpromiseResolve()\n\t\treturn setLocalItem(key, value)\n\t}\n\n\t// Save to persistent storage and write to local data.\n\tlet setItem = async (key: string, value: any, notify: boolean = true) => {\n\t\tcheckContext()\n\t\tlet promiseResolve = getSyncPromise()\n\t\tlet oldValue = await getItem(key)\n\t\tsetLocalItem(key, value)\n\t\tconst return_value = await storageDatabase.setItem(\n\t\t\t// Save an empty string instead of `undefined`, which will throw an error when we\n\t\t\t// later try to parse it as JSON.\n\t\t\t`config.${_context}.${key}`, new Blob([JSON.stringify(value ?? '')])\n\t\t)\n\t\tif (notify && oldValue !== value) {\n\t\t\tlogger.info(`Config changed for key: '${key}' from: '${oldValue}' to: '${value}'`)\n\t\t\tdocument.dispatchEvent(new CustomEvent('syrinscape.updateConfig', { detail: {\n\t\t\t\t[key]: value,\n\t\t\t}}))\n\t\t}\n\t\tpromiseResolve()\n\t\treturn return_value\n\t}\n\n\t// Hold a promise for async operations that should block sync().\n\tconst syncPromises: Promise<void>[] = []\n\n\t// Create a new promise that will block sync() and return a function to resolve it.\n\tconst getSyncPromise = () => {\n\t\tlet promiseResolve\n\t\tlet promise = new Promise<void>((resolve) => promiseResolve = resolve)\n\t\tsyncPromises.push(promise)\n\t\treturn () => {\n\t\t\tpromiseResolve()\n\t\t\tsyncPromises.splice(syncPromises.indexOf(promise), 1)\n\t\t}\n\t}\n\n\tconst config = {\n\t\t// @ts-ignore injected by webpack\n\t\thttpProtocol: query.get('httpProtocol') ?? SITE_PROTOCOL,\n\n\t\t// @ts-ignore injected by webpack\n\t\thttpHostname: query.get('httpHostname') ?? SITE_DOMAIN,\n\n\t\t// @ts-ignore injected by webpack\n\t\thttpPort: query.get('httpPort') ?? SITE_PORT,\n\n\t\t// @ts-ignore injected by webpack\n\t\twsProtocol: query.get('wsProtocol') ?? SITE_PROTOCOL.replace('http', 'ws'),  // Infer ws or wss from http or https\n\n\t\t// @ts-ignore injected by webpack\n\t\twsHostname: query.get('wsHostname') ?? SITE_DOMAIN,\n\n\t\t// @ts-ignore injected by webpack\n\t\twsPort: query.get('wsPort') ?? SITE_PORT,\n\n\t\t// Token for secure postMessage communication between windows.\n\t\tpostMessageToken: uuid(), // Disabling as it does not play nice with search\n\n\t\t// postMessage target window.\n\t\tpostMessageWindow: window.opener ?? (\n\t\t\twindow.parent !== window ? window.parent : null\n\t\t),\n\n\t\t// Populate local data from persistent storage and the server.\n\t\tinit: async (context = 'default', initialConfig = {}) => {\n\t\t\t_context = context ?? _context ?? 'default'\n\t\t\tconst promiseResolve = getSyncPromise()\n\t\t\t// Get current config, so we can later notify fields that have changed.\n\t\t\tconst oldConfig = {\n\t\t\t\tauthenticated: await getItem('authenticated'),\n\t\t\t\tdisplayName: await getItem('displayName'),\n\t\t\t\tsessionId: await getItem('sessionId'),\n\t\t\t\ttoken: await getItem('token'),\n\t\t\t\tlastLocalVolume: await getItem('lastLocalVolume', 1),\n\t\t\t\tlocalVolume: await getItem('localVolume', 1),\n\t\t\t\tvisualisationFramerate: await getItem('visualisationFramerate', 30),\n\t\t\t}\n\t\t\t// Save initial config to persistent storage.\n\t\t\tawait Promise.all(\n\t\t\t\tObject.entries(initialConfig).map(([key, value]) => setItem(key, value, false))\n\t\t\t)\n\t\t\t// Get server config.\n\t\t\t// Ideally this would use `authSystem`, but that imports `urlSystem` which\n\t\t\t// imports `config`, which is a circular dependency. So we manually craft an\n\t\t\t// authorised fetch to get a default `sessionId` from the server.\n\t\t\tlet url = `${config.httpProtocol}://app.${config.httpHostname}/config/`\n\t\t\tlet opts = {\n\t\t\t\theaders: {\n\t\t\t\t\tAccept: 'application/json',\n\t\t\t\t\tAuthorization: `Token ${await getItem('token')}`,\n\t\t\t\t},\n\t\t\t}\n\t\t\tlet response = await fetch(url, opts)\n\t\t\tif (response.ok) {\n\t\t\t\tlet data = await response.json()\n\t\t\t\t// Get hostname, so we can connect directly and avoid being told to reconnect.\n\t\t\t\tconfig.wsHostname = data.hostname\n\t\t\t\t// Save server config to persistent storage.\n\t\t\t\tawait setItem('authenticated', data.authenticated, false)\n\t\t\t\tawait setItem('displayName', data.display_name, false)\n\t\t\t\tawait setItem('sessionId', data.session_id, false)\n\t\t\t\tawait setItem('token', data.token, false)\n\t\t\t\t// Get changed config.\n\t\t\t\tconst changedConfig = Object.keys(oldConfig).reduce((acc, key) => {\n\t\t\t\t\tlet value = getLocalItem(key)\n\t\t\t\t\tif (value !== oldConfig[key]) {\n\t\t\t\t\t\tacc[key] = value\n\t\t\t\t\t}\n\t\t\t\t\treturn acc\n\t\t\t\t}, {})\n\t\t\t\t// Notify changed config.\n\t\t\t\tlogger.info(\"Changed config:\", changedConfig)\n\t\t\t\tdocument.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('syrinscape.updateConfig', { detail: changedConfig })\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\tlogger.warn(`HTTP ${response.status}: Unable to get config.`)\n\t\t\t}\n\t\t\tpromiseResolve()\n\t\t},\n\n\t\t// Wait until all sync promises are resolved or rejected.\n\t\tsync: async () => {\n\t\t\tawait Promise.allSettled(syncPromises)\n\t\t},\n\n\t\t// audioContext\n\t\tget audioContext(): AudioContext {\n\t\t\t_audioContext ??= new AudioContext()\n\t\t\treturn _audioContext\n\t\t},\n\t\tset audioContext(value: AudioContext) {\n\t\t\tif (typeof _audioContext !== 'undefined') {\n\t\t\t\tthrow Error('An audio context already exists, and cannot be reassigned.')\n\t\t\t}\n\t\t\t_audioContext = value\n\t\t},\n\n\t\t// authenticated\n\t\tget authenticated() {\n\t\t\treturn getLocalItem('authenticated')\n\t\t},\n\n\t\t// deviceName\n\t\tget deviceName() {\n\t\t\tlogger.warn('deviceName is deprecated. Use displayName instead.')\n\t\t\treturn config.displayName\n\t\t},\n\n\t\t// displayName\n\t\tget displayName() {\n\t\t\treturn getLocalItem('displayName')\n\t\t},\n\n\t\t// lastLocalVolume\n\t\tget lastLocalVolume(): number {\n\t\t\treturn getLocalItem('lastLocalVolume')\n\t\t},\n\t\tset lastLocalVolume(value: number | string) {\n\t\t\tvalue = Number(value)\n\t\t\t// Last local volume cannot be 0, which is the same as muted.\n\t\t\tif (value === 0) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif (Number.isNaN(value) || value < minVolume || value > maxVolume) {\n\t\t\t\tthrow Error(`Invalid lastLocalVolume: '${value}'`)\n\t\t\t}\n\t\t\tsetItem('lastLocalVolume', value)\n\t\t},\n\n\t\t// localVolume\n\t\tget localVolume(): number {\n\t\t\treturn getLocalItem('localVolume')\n\t\t},\n\t\tset localVolume(value: number | string) {\n\t\t\tvalue = Number(value)\n\t\t\tif (Number.isNaN(value) || value < minVolume || value > maxVolume) {\n\t\t\t\tthrow Error(`Invalid localVolume: '${value}'`)\n\t\t\t}\n\t\t\tsetItem('localVolume', value)\n\t\t},\n\n\t\t// sessionId\n\t\tget sessionId() {\n\t\t\treturn getLocalItem('sessionId')\n\t\t},\n\t\tset sessionId(value: string) {\n\t\t\tsetItem('sessionId', value)\n\t\t},\n\n\t\t// token\n\t\tget token() {\n\t\t\treturn getLocalItem('token')\n\t\t},\n\t\tset token(value: string) {\n\t\t\tif (value !== config.token) {\n\t\t\t\t// Re-init to update `authenticated` and `displayName` as well.\n\t\t\t\tconfig.init(_context, { token: value })\n\t\t\t}\n\t\t},\n\n\t\t// visualisationFramerate\n\t\tget visualisationFramerate(): number {\n\t\t\treturn getLocalItem('visualisationFramerate')\n\t\t},\n\t\tset visualisationFramerate(value: number | string) {\n\t\t\tvalue = Number(value)\n\t\t\tif (Number.isNaN(value) || value <= 0) {\n\t\t\t\tthrow Error(`Invalid visualisationFramerate: ${value}`)\n\t\t\t}\n\t\t\tsetItem('visualisationFramerate', value)\n\t\t},\n\t}\n\n\treturn config\n}\n\nsyrinscape.config ??= createConfig()\n\nexport const config = syrinscape.config\nexport default config\n","import { createAudioEffect } from '.'\nimport { createDefaultEffectParams } from '../constants'\nimport { AudioEffect } from '../types'\nimport config from 'modules-core/config'\n\nconst notEmpty = (value) => value !== 0\n\nexport const createAnalyserEffect = (params: AudioEffect.AnalyserEffectParams = {}) => {\n\tparams = Object.assign(createDefaultEffectParams('analyser'), params)\n\tif (params.isDestination)\n\t\tparams.output = undefined\n\n\t// TODO: Use destructuring assignment for `params`?\n\tconst node = new AnalyserNode(config.audioContext, params)\n\n\tlet visualisationRequestID: number\n\tlet visualisationDrawFunction: (data: AudioEffect.AnalyserData) => boolean\n\n\tlet lastFrequencyData: AudioEffect.FrequencyData\n\tlet lastTimeDomainData: AudioEffect.TimeDomainData\n\n\tconst effect: AudioEffect.AnalyserEffect = {\n\t\tparams,\n\t\tsetParam: {\n\t\t\tminDecibels: val => node.minDecibels = val,\n\t\t\tmaxDecibels: val => node.maxDecibels = val,\n\t\t\tsmoothingTimeConstant: val => node.smoothingTimeConstant = val,\n\t\t\tfftSize: val => node.fftSize = val,\n\t\t},\n\t\t...createAudioEffect(node),\n\t\tgetData: () => {\n\t\t\treturn {\n\t\t\t\t...effect.getFrequencyData(),\n\t\t\t\t...effect.getTimeDomainData(),\n\t\t\t}\n\t\t},\n\t\tgetFrequencyData: () => {\n\t\t\tconst frequencyData = new Uint8Array(node.frequencyBinCount)\n\t\t\tnode.getByteFrequencyData(frequencyData)\n\t\t\tlastFrequencyData = {\n\t\t\t\tfrequencyData,\n\t\t\t\tfrequencyBinCount: node.frequencyBinCount,\n\t\t\t}\n\t\t\treturn lastFrequencyData\n\t\t},\n\t\tgetTimeDomainData: () => {\n\t\t\tconst timeDomainData = new Float32Array(node.fftSize)\n\t\t\tnode.getFloatTimeDomainData(timeDomainData)\n\t\t\tlastTimeDomainData = {\n\t\t\t\ttimeDomainData,\n\t\t\t\tfftSize: node.fftSize,\n\t\t\t}\n\t\t\treturn lastTimeDomainData\n\t\t},\n\t\tget isActive () {\n\t\t\tconst active: boolean =\n\t\t\t\tlastFrequencyData?.frequencyData.some(notEmpty) ||\n\t\t\t\tlastTimeDomainData?.timeDomainData.some(notEmpty)\n\t\t\treturn active\n\t\t},\n\t\tget lastData () {\n\t\t\treturn {\n\t\t\t\t...lastFrequencyData,\n\t\t\t\t...lastTimeDomainData,\n\t\t\t}\n\t\t},\n\t\tlastFrequencyData,\n\t\tlastTimeDomainData,\n\t\tstartVisualisation: (drawFunction) => {\n\t\t\tif (drawFunction) {\n\t\t\t\tvisualisationDrawFunction = drawFunction\n\t\t\t}\n\t\t\t// Recursively schedule the given draw function (via `requestAnimationFrame`),\n\t\t\t// with new data from the analyser node.\n\t\t\tconst update = () => {\n\t\t\t\tvisualisationRequestID = requestAnimationFrame(update)\n\t\t\t\tconst frequencyData = new Uint8Array(node.frequencyBinCount)\n\t\t\t\tconst timeDomainData = new Float32Array(node.fftSize)\n\t\t\t\tnode.getByteFrequencyData(frequencyData)\n\t\t\t\tnode.getFloatTimeDomainData(timeDomainData)\n\t\t\t\tvisualisationDrawFunction({\n\t\t\t\t\tfrequencyData,\n\t\t\t\t\ttimeDomainData,\n\t\t\t\t\tfftSize: node.fftSize,\n\t\t\t\t\tfrequencyBinCount: node.frequencyBinCount,\n\t\t\t\t})\n\t\t\t}\n\t\t\t// Kick it off.\n\t\t\trequestAnimationFrame(update)\n\t\t},\n\t\tstopVisualisation: () => {\n\t\t\tcancelAnimationFrame(visualisationRequestID)\n\t\t\tvisualisationRequestID = 0\n\t\t},\n\t}\n\treturn effect\n}\n","export class LinkedListNode<K, V> {\n\tdata: V\n\tid: K\n\tnext: LinkedListNode<K, V> | null\n\tprev: LinkedListNode<K, V> | null\n\n\tconstructor(id: K, data: any) {\n\t\tthis.data = data\n\t\tthis.id = id\n\t\tthis.next = null\n\t\tthis.prev = null\n\t}\n}\n\nexport class LRULinkedList<K, V> {\n\t_size: number = 0\n\n\thead: LinkedListNode<K, V> | null\n\ttail: LinkedListNode<K, V> | null\n\tlimit: number\n\tpositions: Map<K, LinkedListNode<K, V>> = new Map<K, any>()\n\n\tconstructor(limit: number = Infinity) {\n\t\tthis.head = null\n\t\tthis.tail = null\n\t\tthis.limit = limit\n\t}\n\n\tget size() {\n\t\treturn this._size\n\t}\n\n\tset size(size: number) {\n\t\tthis._size = size\n\n\t\tif (this._size > this.limit) {\n\t\t\tthis.removeExcessNodes()\n\t\t}\n\t}\n\n\tget(id: K): V | null {\n\t\tconst node = this.positions.get(id)\n\n\t\tif (node) {\n\t\t\tconst newHeadNode = this.moveToHead(node)\n\n\t\t\tif (newHeadNode) {\n\t\t\t\treturn newHeadNode.data\n\t\t\t}\n\n\t\t\treturn null\n\t\t}\n\n\t\treturn null\n\t}\n\n\tremove(id: K): LinkedListNode<K, V> | null {\n\t\tif (!this.head) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst node = this.positions.get(id)\n\n\t\tif (!node) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst prevNode = node.prev\n\t\tconst nextNode = node.next\n\n\t\t// both prev and next node exists i.e. this node is neither head nor tail node\n\t\tif (prevNode && nextNode) {\n\t\t\tprevNode.next = nextNode\n\t\t\tnextNode.prev = prevNode\n\t\t\tthis.positions.delete(id)\n\t\t\tthis.size--\n\n\t\t\treturn node\n\t\t}\n\n\t\t// if this is the tail node\n\t\tif (prevNode && !nextNode) {\n\t\t\tprevNode.next = null\n\t\t\tthis.tail = prevNode\n\t\t\tthis.positions.delete(id)\n\t\t\tthis.size--\n\n\t\t\treturn node\n\t\t}\n\n\t\t// if this is the head node\n\t\tif (!prevNode && nextNode) {\n\t\t\tnextNode.prev = null\n\t\t\tthis.head = nextNode\n\t\t\tthis.positions.delete(id)\n\t\t\tthis.size--\n\n\t\t\treturn node\n\t\t}\n\n\t\t// if this is both the head and the tail i.e. the only node\n\t\tif (!prevNode && !nextNode) {\n\t\t\tthis.head = null\n\t\t\tthis.tail = null\n\t\t\tthis.positions.delete(id)\n\t\t\tthis.size--\n\n\t\t\treturn node\n\t\t}\n\n\t\treturn null\n\t}\n\n\thas(id: K): boolean {\n\t\tif (this.positions.has(id)) {\n\t\t\treturn true\n\t\t}\n\n\t\treturn false\n\t}\n\n\tkeys(): K[] {\n\t\treturn Array.from(this.positions.keys())\n\t}\n\n\tmoveToHead(node: LinkedListNode<K, V>): LinkedListNode<K, V> | null {\n\t\tconst nodeToMove = this.remove(node.id)\n\n\t\tif (nodeToMove) {\n\t\t\tconst newNode = this.addNodeToHead(nodeToMove.id, nodeToMove.data)\n\n\t\t\treturn newNode\n\t\t}\n\n\t\treturn null\n\t}\n\n\taddNodeToHead(id: K, data: V): LinkedListNode<K, V> {\n\t\tif (this.positions.has(id)) {\n\t\t\tconst node = this.moveToHead(this.positions.get(id))\n\n\t\t\treturn node\n\t\t}\n\n\t\tif (this.head) {\n\t\t\tlet oldHead = this.head\n\t\t\tconst newHead = new LinkedListNode<K, V>(id, data)\n\n\t\t\tnewHead.next = oldHead\n\t\t\tnewHead.prev = null\n\t\t\toldHead.prev = newHead\n\t\t\tthis.head = newHead\n\t\t\tthis.positions.set(id, newHead)\n\t\t\tthis.size++\n\n\t\t\treturn newHead\n\t\t} else {\n\t\t\tconst newNode = new LinkedListNode<K, V>(id, data)\n\t\t\tthis.head = newNode\n\n\t\t\tif (!this.tail) {\n\t\t\t\tthis.tail = newNode\n\t\t\t}\n\n\t\t\tthis.positions.set(id, newNode)\n\t\t\tthis.size++\n\n\t\t\treturn newNode\n\t\t}\n\t}\n\n\t// remove excess nodes from tail until size === limit\n\tremoveExcessNodes() {\n\t\tconst nodesToRemove = this.size - this.limit\n\n\t\tthis.removeNodes(nodesToRemove)\n\t}\n\n\t// remove given number of nodes from tail\n\tremoveNodes(nodesToRemove = 1) {\n\t\tfor (let i = 0; i < nodesToRemove; i++) {\n\t\t\tthis.removeTailNode()\n\t\t}\n\t}\n\n\tremoveTailNode() {\n\t\tif (!this.tail) {\n\t\t\treturn null\n\t\t}\n\n\t\tlet tailNode = this.tail\n\t\tlet currentNode = this.tail\n\n\t\tthis.positions.delete(currentNode.id)\n\t\tthis.size--\n\t\tcurrentNode = currentNode.prev\n\n\t\tif (currentNode) {\n\t\t\tcurrentNode.next = null\n\t\t} else {\n\t\t\tthis.head = null\n\t\t}\n\t\tthis.tail = currentNode\n\n\t\treturn tailNode\n\t}\n}\n","/**\n * Adapted from https://github.com/tusharf5/runtime-memcache\n */\n\nimport { LRULinkedList } from './lruLinkedList'\nimport { iCache } from './types'\nimport { cleanKey } from './utility'\nimport log from 'modules-core/log'\n\nconst logger = log.getLogger('lruCache')\n\nconst limit = Infinity\n\nfunction createLruCache<K, V>(): iCache<K, V> {\n\tconst cache = new LRULinkedList<K, V>(limit)\n\n\tlet _dirty = false\n\n\tconst setDirty = (value) => {\n\t\tif (_dirty !== value && value) {\n\t\t\tlogger.debug('Set LRU cache dirty.')\n\t\t}\n\t\t_dirty = value\n\t}\n\n\tfunction get(key: K) {\n\t\tconst val = cache.get(cleanKey(key as any) as any)\n\n\t\tif (val) {\n\t\t\treturn val\n\t\t}\n\n\t\treturn null\n\t}\n\n\tfunction set(key: K, value: any) {\n\t\tsetDirty(true)\n\t\tcache.addNodeToHead(cleanKey(key as any) as any, value)\n\n\t\treturn true\n\t}\n\n\tfunction removeByCount(number: number) {\n\t\tsetDirty(true)\n\t\tcache.removeNodes(number)\n\n\t\treturn true\n\t}\n\n\tfunction removeByKey(key: K) {\n\t\tsetDirty(true)\n\t\treturn cache.remove(cleanKey(key as any) as any)\n\t}\n\n\tfunction removeOne() {\n\t\tsetDirty(true)\n\t\treturn cache.removeTailNode()\n\t}\n\n\tfunction has(key: K) {\n\t\treturn cache.has(cleanKey(key as any) as any)\n\t}\n\n\tfunction size(): number {\n\t\treturn cache.size\n\t}\n\n\tfunction keys(): K[] {\n\t\treturn cache.keys()\n\t}\n\n\tfunction clear() {\n\t\tsetDirty(true)\n\t\tconst limit = cache.limit\n\t\tcache.limit = 0\n\t\tcache.size = 0 // Setter will remove excess nodes (> limit)\n\t\tcache.limit = limit\n\t}\n\n\tfunction toJSON() {\n\t\tif (cache.size === 0) {\n\t\t\treturn JSON.stringify([])\n\t\t}\n\t\tconst json = []\n\t\tlet node = cache.tail\n\t\twhile (node) {\n\t\t\tjson.push({\n\t\t\t\tid: node.id,\n\t\t\t\tdata: node.data,\n\t\t\t})\n\t\t\tnode = node.prev\n\t\t}\n\t\treturn JSON.stringify(json)\n\t}\n\n\treturn {\n\t\tget isDirty() {\n\t\t\treturn _dirty\n\t\t},\n\t\tsetDirty,\n\t\tcache,\n\t\tget,\n\t\tset,\n\t\tremoveByCount,\n\t\tremoveByKey,\n\t\tremoveOne,\n\t\thas,\n\t\tsize,\n\t\tkeys,\n\t\tclear,\n\t\ttoJSON,\n\t}\n}\ninterface iDbLruCache {\n\tsize: number\n\ttimestamp: number\n}\n\nexport function fromJSON(json: string) {\n\tconst newCache = createLruCache<string, iDbLruCache>()\n\tJSON.parse(json).forEach(node => {\n\t\tnewCache.set(node.id, node.data)\n\t})\n\treturn newCache\n}\n\nexport default createLruCache\n","import { Func } from './utilTypes'\n\ninterface iRandomNormal {\n\t(): number\n}\n\n// See: https://stackoverflow.com/a/18650828\nexport function formatBytes(bytes, decimals = 2) {\n\tif (bytes === 0) return '0 Bytes'\n\n\tconst k = 1000\n\tconst dm = decimals < 0 ? 0 : decimals\n\tconst sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n\n\tconst i = Math.floor(Math.log(bytes) / Math.log(k))\n\n\treturn parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i]\n}\n\n//https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array\n/* Randomize array in-place using Durstenfeld shuffle algorithm */\nexport const shuffleArray = (array: any[], randomNormal: iRandomNormal = Math.random) => {\n\tfor (let i = array.length - 1; i > 0; i--) {\n\t\tconst j = Math.floor(randomNormal() * (i + 1))\n\t\tconst temp = array[i]\n\t\tarray[i] = array[j]\n\t\tarray[j] = temp\n\t}\n}\n\n\nexport const randomBetween = (a: number, b: number, randomNormal: iRandomNormal = Math.random) => {\n\treturn a + (b - a) * randomNormal()\n}\nexport const deg2rad = Math.PI / 180\nexport const rad2deg = 180 / Math.PI\nexport const degToRad = (deg: number) => deg * deg2rad\nexport const radToDeg = (deg: number) => deg * rad2deg\n\nexport const millis2Secs = 0.001\nexport const secs2Millis = 1000\nexport const millisToSecs = (millis: number) => millis * millis2Secs\nexport const secsToMillis = (secs: number) => secs * secs2Millis\n\n\nexport const millis2Mins = 0.000016667\nexport const mins2Millis = 60000\nexport const millisToMins = (millis: number) => millis * millis2Mins\nexport const minsToMillis = (mins: number) => mins * mins2Millis\n\nexport const clamp = (val: number, min: number, max: number) =>\n\tMath.min(Math.max(val, min), max)\n\nexport const polarToCartesian = (theta: number, radius = 1) => ({\n\tx: Math.cos(theta) * radius,\n\ty: Math.sin(theta) * radius\n})\n\nexport const length = (x, y) => Math.sqrt(x * x + y * y)\n\nexport const cartesianToPolar = (x: number, y: number) => ({\n\ttheta: Math.atan2(y, x),\n\tradius: length(x, y)\n})\n\n\nexport const isAlmostEqual = (a: number, b: number, delta = 0.0001) => Math.abs(b - a) < delta\n\n\nexport const normalUnsignedToSigned = (val: number) => val * 2 - 1\nexport const normalSignedToUnsigned = (val: number) => val * 0.5 + 1\n\n\nexport const lerp = (a: number, b: number, t: number) => a + (b - a) * t\n\n\nexport const fromLength = <T>(create: Func<number, T> | Func<void, T>, length: number) => {\n\tconst arr = new Array<T>(length)\n\tfor (let i = 0; i < arr.length; i++) {\n\t\tarr[i] = (create as any)(i)\n\t}\n\treturn arr\n}\n\nexport const randomIndex = <T>(arr: T[], randomFunc = Math.random) =>\n\tarr[Math.floor(randomFunc() * arr.length)]\n\n\nexport const wrapReorder = <T>(arr: T[], index: number) => {\n\tconst next = []\n\tfor (let i = 0; i < arr.length; i++) {\n\t\tconst i2 = (i + index) % arr.length\n\t\tnext.push(arr[i2])\n\t}\n\treturn next\n}\n\nexport const elementsEqual = <T>(arr1: T[], arr2: T[]) =>\n\tarr1.length === arr2.length && arr1.every((item, index) => item === arr2[index])\n\nexport const createSeededRandom = (seed = 1) => {\n\tif (seed === 0) seed = 1\n\treturn () => {\n\t\tconst x = Math.sin(seed++) * 10000\n\t\treturn x - Math.floor(x)\n\t}\n}\n\n// See: https://stackoverflow.com/a/52649768\n/**\n * Computes the recursive average of an indefinite set\n * @param {Iterable<number>} set iterable sequence to average\n * @param {number} initAvg initial average value\n * @param {number} initCount initial average count\n */\nexport function average(set, initAvg = 0, initCount = 0) {\n\tif (!set || !set[Symbol.iterator])\n\t\tthrow Error(\"must pass an iterable sequence\");\n\n\tlet avg = initAvg;\n\tlet avgCnt = initCount;\n\tfor (let x of set) {\n\t\tavgCnt += 1;\n\t\tavg = avg * ((avgCnt - 1) / avgCnt) + x / avgCnt;\n\t}\n\treturn avg; // or {avg: avg, count: avgCnt};\n}\n","/**\n * @class TemplateTag\n * @classdesc Consumes a pipeline of composable transformer plugins and produces a template tag.\n */\nexport default class TemplateTag {\n  /**\n   * constructs a template tag\n   * @constructs TemplateTag\n   * @param  {...Object} [...transformers] - an array or arguments list of transformers\n   * @return {Function}                    - a template tag\n   */\n  constructor(...transformers) {\n    // if first argument is an array, extrude it as a list of transformers\n    if (transformers.length > 0 && Array.isArray(transformers[0])) {\n      transformers = transformers[0];\n    }\n\n    // if any transformers are functions, this means they are not initiated - automatically initiate them\n    this.transformers = transformers.map(transformer => {\n      return typeof transformer === 'function' ? transformer() : transformer;\n    });\n\n    // return an ES2015 template tag\n    return this.tag;\n  }\n\n  /**\n   * Applies all transformers to a template literal tagged with this method.\n   * If a function is passed as the first argument, assumes the function is a template tag\n   * and applies it to the template, returning a template tag.\n   * @param  {(Function|String|Array<String>)} strings        - Either a template tag or an array containing template strings separated by identifier\n   * @param  {...*}                            ...expressions - Optional list of substitution values.\n   * @return {(String|Function)}                              - Either an intermediary tag function or the results of processing the template.\n   */\n  tag = (strings, ...expressions) => {\n    if (typeof strings === 'function') {\n      // if the first argument passed is a function, assume it is a template tag and return\n      // an intermediary tag that processes the template using the aforementioned tag, passing the\n      // result to our tag\n      return this.interimTag.bind(this, strings);\n    }\n\n    if (typeof strings === 'string') {\n      // if the first argument passed is a string, just transform it\n      return this.transformEndResult(strings);\n    }\n\n    // else, return a transformed end result of processing the template with our tag\n    strings = strings.map(this.transformString.bind(this));\n    return this.transformEndResult(\n      strings.reduce(this.processSubstitutions.bind(this, expressions)),\n    );\n  };\n\n  /**\n   * An intermediary template tag that receives a template tag and passes the result of calling the template with the received\n   * template tag to our own template tag.\n   * @param  {Function}        nextTag          - the received template tag\n   * @param  {Array<String>}   template         - the template to process\n   * @param  {...*}            ...substitutions - `substitutions` is an array of all substitutions in the template\n   * @return {*}                                - the final processed value\n   */\n  interimTag(previousTag, template, ...substitutions) {\n    return this.tag`${previousTag(template, ...substitutions)}`;\n  }\n\n  /**\n   * Performs bulk processing on the tagged template, transforming each substitution and then\n   * concatenating the resulting values into a string.\n   * @param  {Array<*>} substitutions - an array of all remaining substitutions present in this template\n   * @param  {String}   resultSoFar   - this iteration's result string so far\n   * @param  {String}   remainingPart - the template chunk after the current substitution\n   * @return {String}                 - the result of joining this iteration's processed substitution with the result\n   */\n  processSubstitutions(substitutions, resultSoFar, remainingPart) {\n    const substitution = this.transformSubstitution(\n      substitutions.shift(),\n      resultSoFar,\n    );\n    return ''.concat(resultSoFar, substitution, remainingPart);\n  }\n\n  /**\n   * Iterate through each transformer, applying the transformer's `onString` method to the template\n   * strings before all substitutions are processed.\n   * @param {String}  str - The input string\n   * @return {String}     - The final results of processing each transformer\n   */\n  transformString(str) {\n    const cb = (res, transform) =>\n      transform.onString ? transform.onString(res) : res;\n    return this.transformers.reduce(cb, str);\n  }\n\n  /**\n   * When a substitution is encountered, iterates through each transformer and applies the transformer's\n   * `onSubstitution` method to the substitution.\n   * @param  {*}      substitution - The current substitution\n   * @param  {String} resultSoFar  - The result up to and excluding this substitution.\n   * @return {*}                   - The final result of applying all substitution transformations.\n   */\n  transformSubstitution(substitution, resultSoFar) {\n    const cb = (res, transform) =>\n      transform.onSubstitution\n        ? transform.onSubstitution(res, resultSoFar)\n        : res;\n    return this.transformers.reduce(cb, substitution);\n  }\n\n  /**\n   * Iterates through each transformer, applying the transformer's `onEndResult` method to the\n   * template literal after all substitutions have finished processing.\n   * @param  {String} endResult - The processed template, just before it is returned from the tag\n   * @return {String}           - The final results of processing each transformer\n   */\n  transformEndResult(endResult) {\n    const cb = (res, transform) =>\n      transform.onEndResult ? transform.onEndResult(res) : res;\n    return this.transformers.reduce(cb, endResult);\n  }\n}\n","const defaults = {\n  separator: '',\n  conjunction: '',\n  serial: false,\n};\n\n/**\n * Converts an array substitution to a string containing a list\n * @param  {String} [opts.separator = ''] - the character that separates each item\n * @param  {String} [opts.conjunction = '']  - replace the last separator with this\n * @param  {Boolean} [opts.serial = false] - include the separator before the conjunction? (Oxford comma use-case)\n *\n * @return {Object}                     - a TemplateTag transformer\n */\nconst inlineArrayTransformer = (opts = defaults) => ({\n  onSubstitution(substitution, resultSoFar) {\n    // only operate on arrays\n    if (Array.isArray(substitution)) {\n      const arrayLength = substitution.length;\n      const separator = opts.separator;\n      const conjunction = opts.conjunction;\n      const serial = opts.serial;\n      // join each item in the array into a string where each item is separated by separator\n      // be sure to maintain indentation\n      const indent = resultSoFar.match(/(\\n?[^\\S\\n]+)$/);\n      if (indent) {\n        substitution = substitution.join(separator + indent[1]);\n      } else {\n        substitution = substitution.join(separator + ' ');\n      }\n      // if conjunction is set, replace the last separator with conjunction, but only if there is more than one substitution\n      if (conjunction && arrayLength > 1) {\n        const separatorIndex = substitution.lastIndexOf(separator);\n        substitution =\n          substitution.slice(0, separatorIndex) +\n          (serial ? separator : '') +\n          ' ' +\n          conjunction +\n          substitution.slice(separatorIndex + 1);\n      }\n    }\n    return substitution;\n  },\n});\n\nexport default inlineArrayTransformer;\n","/**\n * strips indentation from a template literal\n * @param  {String} type = 'initial' - whether to remove all indentation or just leading indentation. can be 'all' or 'initial'\n * @return {Object}                  - a TemplateTag transformer\n */\nconst stripIndentTransformer = (type = 'initial') => ({\n  onEndResult(endResult) {\n    if (type === 'initial') {\n      // remove the shortest leading indentation from each line\n      const match = endResult.match(/^[^\\S\\n]*(?=\\S)/gm);\n      const indent = match && Math.min(...match.map(el => el.length));\n      if (indent) {\n        const regexp = new RegExp(`^.{${indent}}`, 'gm');\n        return endResult.replace(regexp, '');\n      }\n      return endResult;\n    }\n    if (type === 'all') {\n      // remove all indentation from each line\n      return endResult.replace(/^[^\\S\\n]+/gm, '');\n    }\n    throw new Error(`Unknown type: ${type}`);\n  },\n});\n\nexport default stripIndentTransformer;\n","/**\n * TemplateTag transformer that trims whitespace on the end result of a tagged template\n * @param  {String} side = '' - The side of the string to trim. Can be 'start' or 'end' (alternatively 'left' or 'right')\n * @return {Object}           - a TemplateTag transformer\n */\nconst trimResultTransformer = (side = '') => ({\n  onEndResult(endResult) {\n    if (side === '') {\n      return endResult.trim();\n    }\n\n    side = side.toLowerCase();\n\n    if (side === 'start' || side === 'left') {\n      return endResult.replace(/^\\s*/, '');\n    }\n\n    if (side === 'end' || side === 'right') {\n      return endResult.replace(/\\s*$/, '');\n    }\n\n    throw new Error(`Side not supported: ${side}`);\n  },\n});\n\nexport default trimResultTransformer;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\n\nconst commaLists = new TemplateTag(\n  inlineArrayTransformer({ separator: ',' }),\n  stripIndentTransformer,\n  trimResultTransformer,\n);\n\nexport default commaLists;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\n\nconst commaListsAnd = new TemplateTag(\n  inlineArrayTransformer({ separator: ',', conjunction: 'and' }),\n  stripIndentTransformer,\n  trimResultTransformer,\n);\n\nexport default commaListsAnd;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\n\nconst commaListsOr = new TemplateTag(\n  inlineArrayTransformer({ separator: ',', conjunction: 'or' }),\n  stripIndentTransformer,\n  trimResultTransformer,\n);\n\nexport default commaListsOr;\n","const splitStringTransformer = splitBy => ({\n  onSubstitution(substitution, resultSoFar) {\n    if (splitBy != null && typeof splitBy === 'string') {\n      if (typeof substitution === 'string' && substitution.includes(splitBy)) {\n        substitution = substitution.split(splitBy);\n      }\n    } else {\n      throw new Error('You need to specify a string character to split by.');\n    }\n    return substitution;\n  },\n});\n\nexport default splitStringTransformer;\n","const isValidValue = x =>\n  x != null && !Number.isNaN(x) && typeof x !== 'boolean';\n\nconst removeNonPrintingValuesTransformer = () => ({\n  onSubstitution(substitution) {\n    if (Array.isArray(substitution)) {\n      return substitution.filter(isValidValue);\n    }\n    if (isValidValue(substitution)) {\n      return substitution;\n    }\n    return '';\n  },\n});\n\nexport default removeNonPrintingValuesTransformer;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\nimport splitStringTransformer from '../splitStringTransformer';\nimport removeNonPrintingValuesTransformer from '../removeNonPrintingValuesTransformer';\n\nconst html = new TemplateTag(\n  splitStringTransformer('\\n'),\n  removeNonPrintingValuesTransformer,\n  inlineArrayTransformer,\n  stripIndentTransformer,\n  trimResultTransformer,\n);\n\nexport default html;\n","const replaceSubstitutionTransformer = (replaceWhat, replaceWith) => ({\n  onSubstitution(substitution, resultSoFar) {\n    if (replaceWhat == null || replaceWith == null) {\n      throw new Error(\n        'replaceSubstitutionTransformer requires at least 2 arguments.',\n      );\n    }\n\n    // Do not touch if null or undefined\n    if (substitution == null) {\n      return substitution;\n    } else {\n      return substitution.toString().replace(replaceWhat, replaceWith);\n    }\n  },\n});\n\nexport default replaceSubstitutionTransformer;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\nimport splitStringTransformer from '../splitStringTransformer';\nimport replaceSubstitutionTransformer from '../replaceSubstitutionTransformer';\n\nconst safeHtml = new TemplateTag(\n  splitStringTransformer('\\n'),\n  inlineArrayTransformer,\n  stripIndentTransformer,\n  trimResultTransformer,\n  replaceSubstitutionTransformer(/&/g, '&amp;'),\n  replaceSubstitutionTransformer(/</g, '&lt;'),\n  replaceSubstitutionTransformer(/>/g, '&gt;'),\n  replaceSubstitutionTransformer(/\"/g, '&quot;'),\n  replaceSubstitutionTransformer(/'/g, '&#x27;'),\n  replaceSubstitutionTransformer(/`/g, '&#x60;'),\n);\n\nexport default safeHtml;\n","/**\n * Replaces tabs, newlines and spaces with the chosen value when they occur in sequences\n * @param  {(String|RegExp)} replaceWhat - the value or pattern that should be replaced\n * @param  {*}               replaceWith - the replacement value\n * @return {Object}                      - a TemplateTag transformer\n */\nconst replaceResultTransformer = (replaceWhat, replaceWith) => ({\n  onEndResult(endResult) {\n    if (replaceWhat == null || replaceWith == null) {\n      throw new Error(\n        'replaceResultTransformer requires at least 2 arguments.',\n      );\n    }\n    return endResult.replace(replaceWhat, replaceWith);\n  },\n});\n\nexport default replaceResultTransformer;\n","import TemplateTag from '../TemplateTag';\nimport trimResultTransformer from '../trimResultTransformer';\nimport replaceResultTransformer from '../replaceResultTransformer';\n\nconst oneLine = new TemplateTag(\n  replaceResultTransformer(/(?:\\n(?:\\s*))+/g, ' '),\n  trimResultTransformer,\n);\n\nexport default oneLine;\n","import TemplateTag from '../TemplateTag';\nimport trimResultTransformer from '../trimResultTransformer';\nimport replaceResultTransformer from '../replaceResultTransformer';\n\nconst oneLineTrim = new TemplateTag(\n  replaceResultTransformer(/(?:\\n\\s*)/g, ''),\n  trimResultTransformer,\n);\n\nexport default oneLineTrim;\n","import TemplateTag from '../TemplateTag';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\nimport replaceResultTransformer from '../replaceResultTransformer';\n\nconst oneLineCommaLists = new TemplateTag(\n  inlineArrayTransformer({ separator: ',' }),\n  replaceResultTransformer(/(?:\\s+)/g, ' '),\n  trimResultTransformer,\n);\n\nexport default oneLineCommaLists;\n","import TemplateTag from '../TemplateTag';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\nimport replaceResultTransformer from '../replaceResultTransformer';\n\nconst oneLineCommaListsOr = new TemplateTag(\n  inlineArrayTransformer({ separator: ',', conjunction: 'or' }),\n  replaceResultTransformer(/(?:\\s+)/g, ' '),\n  trimResultTransformer,\n);\n\nexport default oneLineCommaListsOr;\n","import TemplateTag from '../TemplateTag';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\nimport replaceResultTransformer from '../replaceResultTransformer';\n\nconst oneLineCommaListsAnd = new TemplateTag(\n  inlineArrayTransformer({ separator: ',', conjunction: 'and' }),\n  replaceResultTransformer(/(?:\\s+)/g, ' '),\n  trimResultTransformer,\n);\n\nexport default oneLineCommaListsAnd;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\n\nconst inlineLists = new TemplateTag(\n  inlineArrayTransformer,\n  stripIndentTransformer,\n  trimResultTransformer,\n);\n\nexport default inlineLists;\n","import TemplateTag from '../TemplateTag';\nimport inlineArrayTransformer from '../inlineArrayTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\nimport replaceResultTransformer from '../replaceResultTransformer';\n\nconst oneLineInlineLists = new TemplateTag(\n  inlineArrayTransformer,\n  replaceResultTransformer(/(?:\\s+)/g, ' '),\n  trimResultTransformer,\n);\n\nexport default oneLineInlineLists;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\n\nconst stripIndent = new TemplateTag(\n  stripIndentTransformer,\n  trimResultTransformer,\n);\n\nexport default stripIndent;\n","import TemplateTag from '../TemplateTag';\nimport stripIndentTransformer from '../stripIndentTransformer';\nimport trimResultTransformer from '../trimResultTransformer';\n\nconst stripIndents = new TemplateTag(\n  stripIndentTransformer('all'),\n  trimResultTransformer,\n);\n\nexport default stripIndents;\n","/*\nAn LRU composite database that uses one database for reads and writes (e.g.\n`storageDatabase`, which uses the Cache API or IndexedDB for local storage), with a\nfallback to a second database on read miss (e.g one that makes a fetch request to S3).\n\nKeeps track of the last access time (via `getItem`) we can remove least recently used\ndata when necessary to keep storage use under some limit.\n\nFor now, we are assuming that the first database is relying on browser storage and so we\nare using the browser storage limit (TODO: or a user-defined limit) to decide when we\nneed to remove least recently used data.\n*/\n\nimport createLruCache, { fromJSON } from './lruCache'\nimport { iDatabase } from './types'\nimport { getServerTime } from 'modules-core/utility'\nimport log from 'modules-core/log'\nimport { iCache } from '.'\nimport { formatBytes } from 'modules-core/utility/MathExt'\nimport { oneLine, source } from 'common-tags'\n\nconst logger = log.getLogger('compositeDatabase')\n\n// Maintain a storage buffer of 50 MB, so we have enough room to add that much data in\n// one hit without exceeding our storage quota. This can happen if we call many async\n// functions that load data in a fast loop. This buffer should also be large enough to\n// allow anything we might save directly via `storageDatabase`, which will bypass the\n// composite database LRU policy.\nconst storageBuffer = 50 * 1000 * 1000\n\ninterface iDbLruCache {\n\tsize: number\n\ttimestamp: number\n}\n\nexport const createCompositeDatabase = (prioritizedDatabases: iDatabase[]) => {\n\tconst forEachDatabase = async (func: (db: iDatabase) => void) => {\n\t\tawait Promise.all(prioritizedDatabases.map(func))\n\t}\n\n\tconst forEachDatabasePartial = async (\n\t\tfunc: (db: iDatabase) => void,\n\t\tstartIndex: number,\n\t\tendIndex: number\n\t) => {\n\t\tconst promises = prioritizedDatabases.slice(startIndex, endIndex).map(func)\n\t\tawait Promise.all(promises)\n\t}\n\n\tlet lruCache: iCache<string, iDbLruCache>\n\n\tconst lruCacheKey = 'lruCacheBackup'\n\n\tconst lruEvict = async (target: number) => {\n\t\tlet toRemove: number\n\t\tif (navigator.storage?.estimate) {\n\t\t\tconst estimate = await navigator.storage.estimate()\n\t\t\tconst overrun = estimate.usage - estimate.quota\n\t\t\ttoRemove = target + overrun\n\t\t\tif (toRemove < 0) {\n\t\t\t\t// Quota available is already more than the target. Nothing to do.\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlet removed = 0\n\t\t\tlet i = 0\n\t\t\twhile (removed < toRemove) {\n\t\t\t\tconst removedItem = lruCache.removeOne()\n\t\t\t\tif (removedItem) {\n\t\t\t\t\tlogger.debug(`Removed LRU item: ${removedItem.id}`)\n\t\t\t\t} else {\n\t\t\t\t\tlogger.debug(`Nothing left in LRU cache to remove.`)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tawait db.removeItem(removedItem.id)\n\t\t\t\tremoved += removedItem.data.size\n\t\t\t\ti += 1\n\t\t\t}\n\t\t\tif (i > 0) {\n\t\t\t\tlogger.warn(source`\n\t\t\t\t\tRemoved ${i} LRU items from cache database to free ${formatBytes(removed)}.\n\t\t\t\t\t\tstorage limit: ${formatBytes(estimate.quota)}\n\t\t\t\t\t\tstorage used: ${oneLine`\n\t\t\t\t\t\t\t${formatBytes(estimate.usage)}\n\t\t\t\t\t\t\t(${(estimate.usage / estimate.quota * 100).toFixed(2)}%)\n\t\t\t\t\t\t`}\n\t\t\t\t`)\n\t\t\t}\n\t\t}\n\t}\n\n\tconst db: iDatabase = {\n\t\tgetItem: async (key) => {\n\t\t\tfor (let i = 0; i < prioritizedDatabases.length; i++) {\n\t\t\t\tconst item = await prioritizedDatabases[i].getItem(key)\n\t\t\t\tif (item) {\n\t\t\t\t\tforEachDatabasePartial(async (db) => {\n\t\t\t\t\t\tawait lruEvict(storageBuffer)\n\t\t\t\t\t\tawait db.setItem(key, item)\n\t\t\t\t\t\tlruCache.set(key, { size: item.size, timestamp: getServerTime() })\n\t\t\t\t\t}, 0, i)\n\t\t\t\t\treturn item\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null\n\t\t},\n\t\tsetItem: (key, item) => { throw new Error('Not implemented.') },\n\t\tremoveItem: async (key) => {\n\t\t\tawait forEachDatabase(async (db) => await db.removeItem(key))\n\t\t\tlruCache.removeByKey(key)\n\t\t},\n\t\tclear: async () => {\n\t\t\tawait forEachDatabase((db) => db.clear())\n\t\t\tlruCache.clear()\n\t\t},\n\t\tgetKeys: async () => {\n\t\t\tconst keys = new Set<string>()\n\t\t\tawait forEachDatabase(async (db) => (await db.getKeys()).forEach((key) => keys.add(key)))\n\t\t\treturn Array.from(keys)\n\t\t}\n\t}\n\n\tconst init = async () => {\n\t\t// Get or create LRU cache.\n\t\tconst getLruCache = async () => {\n\t\t\tconst blob = await prioritizedDatabases[0].getItem(lruCacheKey)\n\t\t\tif (blob === null) {\n\t\t\t\tlogger.info('Create new LRU cache.')\n\t\t\t\treturn createLruCache<string, iDbLruCache>()\n\t\t\t}\n\t\t\tlogger.info('Restore LRU cache from backup.')\n\t\t\treturn fromJSON(await new Response(blob).text())\n\t\t}\n\t\tlruCache = await getLruCache()\n\n\t\t// Add keys we have already in the cache but not the lruCache, to the lruCache.\n\t\tconst syncLruCacheKeys = async () => {\n\t\t\tconst lruKeys = lruCache.keys()\n\t\t\tconst cacheKeys = await db.getKeys()\n\t\t\tconst missingKeys = cacheKeys.filter((key) => {\n\t\t\t\treturn key !== lruCacheKey && !lruKeys.includes(key)\n\t\t\t})\n\t\t\tmissingKeys.forEach(async (key) => {\n\t\t\t\tconst item = await db.getItem(key)\n\t\t\t\tlruCache.set(key, { size: item.size, timestamp: getServerTime() })\n\t\t\t\tlogger.debug(source`\n\t\t\t\t\tRestored item found in cache database but missing from LRU cache.\n\t\t\t\t\t\tkey: ${key}\n\t\t\t\t`)\n\t\t\t})\n\t\t\tif (missingKeys.length) {\n\t\t\t\tlogger.info(oneLine`\n\t\t\t\t\tRestored ${missingKeys.length} items found in cache database but missing from\n\t\t\t\t\tLRU cache.\n\t\t\t\t`)\n\t\t\t}\n\t\t}\n\t\tsyncLruCacheKeys()\n\n\t\t// Backup LRU cache every 5 seconds, if it has changed.\n\t\tconst backupLruCache = async () => {\n\t\t\tif (lruCache.isDirty) {\n\t\t\t\tconst db = prioritizedDatabases[0]\n\t\t\t\tconst blob = new Blob([lruCache.toJSON()])\n\t\t\t\tawait lruEvict(storageBuffer)\n\t\t\t\tlogger.debug(`LRU cache is dirty. Backup. Size: ${lruCache.size} items`)\n\t\t\t\tawait db.setItem(lruCacheKey, blob)\n\t\t\t\tlruCache.setDirty(false)\n\t\t\t}\n\t\t}\n\t\tlogger.info(\"Call backupLruCache() every 5 seconds.\")\n\t\twindow.setInterval(backupLruCache, 5000)\n\t}\n\tinit()\n\n\treturn db\n}\n","import { createCompositeDatabase } from './compositeDatabase'\nimport { createCustomDatabase } from './customDatabase'\nimport { iFetch } from './types'\nimport log from 'modules-core/log'\nimport syrinscape from 'app/common/syrinscape'\nimport { createStorageDatabase } from './storageDatabase'\nimport { formatBytes } from 'modules-core/utility/MathExt'\nimport { oneLine, source } from 'common-tags'\n\nconst logger = log.getLogger('blobDatabase')\n\ninterface iArgs {\n\tfetchMethod?: iFetch\n}\n\nconst createBlobDatabase = ({\n\tfetchMethod,\n}: iArgs = {}) => {\n\tlogger.info(\"createBlobDatabase()\")\n\n\tfetchMethod ??= window.fetch\n\t// const memoryDB = createObjectDatabase()\n\n\tif (navigator.storage) {\n\t\tif (navigator.storage.persist) {\n\t\t\tnavigator.storage.persist().then(function(persistent) {\n\t\t\t\tif (persistent) {\n\t\t\t\t\tlogger.info(\n\t\t\t\t\t\t'Storage is persistent. Will not be cleared except by explicit user action.'\n\t\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\t\tlogger.info(\n\t\t\t\t\t\t'Storage is temporary. May be cleared by the UA under storage pressure.'\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\tconst estimateStorage = async () => {\n\t\t\tif (navigator.storage.estimate) {\n\t\t\t\tconst estimate = await navigator.storage.estimate()\n\t\t\t\tlogger.info(`Storage limit: ${formatBytes(estimate.quota)}`)\n\t\t\t\tlogger.info(oneLine`\n\t\t\t\t\tStorage used: ${formatBytes(estimate.usage)}\n\t\t\t\t\t(${(estimate.usage / estimate.quota * 100).toFixed(2)}%)\n\t\t\t\t`)\n\t\t\t}\n\t\t}\n\t\testimateStorage()\n\t}\n\n\tconst localDatabase = createStorageDatabase('blob-cache')\n\n\tconst remoteDatabase = createCustomDatabase({\n\t\tgetItem: async (key: string) => {\n\t\t\tblobDatabase._onFetch(key)\n\t\t\tconst response = await fetchMethod(key)\n\t\t\tif (response.status !== 200)\n\t\t\t\tthrow new Error(`bad response: ${response}`)\n\t\t\tconst blob = await response.blob()\n\t\t\treturn blob\n\t\t}\n\t}, true)\n\n\tconst compositeDatabase = createCompositeDatabase([\n\t\t// memoryDB,\n\t\tlocalDatabase,\n\t\tremoteDatabase\n\t])\n\n\tconst blobDatabase = {\n\t\tgetBlob: (key: string): Promise<Blob> => compositeDatabase.getItem(key),\n\t\t// clear: compositeDatabase.clear,\n\t\t// getBlobURL: blobURLDatabase.getBlobURL,\n\t\t// removeBlobURL: blobURLDatabase.removeBlobURL,\n\t\t_onFetch: (key: string) => { },\n\t\t// _memoryDB: memoryDB,\n\t\t_localDatabase: localDatabase,\n\t\t_remoteDatabase: remoteDatabase,\n\t\t// _blobURLDatabase: blobURLDatabase,\n\t\t_compositeDatabase: compositeDatabase\n\t}\n\n\treturn blobDatabase\n}\n\nexport type iBlobDatabase = ReturnType<typeof createBlobDatabase>\n\nsyrinscape._r.blobDatabase ??= createBlobDatabase()\n\nexport const blobDatabase = syrinscape._r.blobDatabase\nexport default blobDatabase\n","import { iDatabase } from './types'\n\n\n\n\n\n\n//the 'get' database is designed to be the last in a comosite database\nexport const createCustomDatabase = (db: Partial<iDatabase>, suppressWarning = true) => {\n\n\tconst warn = suppressWarning\n\t\t? async () => { }\n\t\t: async () => console.warn('\\'get\\' database is immutable')\n\n\tconst dbDefault: iDatabase = {\n\t\tgetItem: warn,\n\t\tsetItem: warn,\n\t\tclear: warn,\n\t\tremoveItem: warn,\n\t\tgetKeys: () => {\n\t\t\twarn()\n\t\t\tconst keys: string[] = []\n\t\t\treturn new Promise(resolve => resolve(keys))\n\t\t},\n\t}\n\n\treturn { ...dbDefault, ...db }\n}\n","import { createDefaultEffectParams } from '..'\nimport { AudioEffect } from '../types'\nimport { createAudioEffect } from './createEffect'\nimport config from 'modules-core/config'\n\n\nexport const createSendEffect = (params: AudioEffect.SendEffectParams = {}) => {\n\tparams = Object.assign(createDefaultEffectParams('send'), params)\n\n\tconst input = config.audioContext.createGain()\n\tconst wet = config.audioContext.createGain()\n\tconst dry = config.audioContext.createGain()\n\t// const destination = send.getOutputs()[0]\n\n\t// const effectBase =\n\n\tconst effect: AudioEffect.SendEffect = {\n\t\tparams,\n\t\t...createAudioEffect(input, wet),\n\t\tconnectFromMap: map =>\n\t\t\tdry.connect(map[params.dryOutput].input),\n\t\tsetWet: (value: number) => {\n\t\t\twet.gain.value = value\n\t\t\tdry.gain.value = 1 - value\n\t\t},\n\t\tgetWet: () => wet.gain.value,\n\t\tsetParam: {\n\t\t\t'wetness': (val) => effect.setWet(val)\n\t\t},\n\t\t_input: input,\n\t\t_wet: wet,\n\t\t_dry: dry\n\t}\n\n\tinput.connect(wet)\n\tinput.connect(dry)\n\teffect.setWet(params.wetness)\n\n\treturn effect\n}\n","import { iVector3 } from 'modules-core/utility'\nimport { createDefaultEffectParams } from '../constants'\nimport { AudioEffect } from '../types'\nimport { createAudioEffect } from './createEffect'\nimport config from 'modules-core/config'\n\nexport const createSpatialEffect = (params: AudioEffect.SpatialEffectParams = {}) => {\n\tparams = Object.assign(createDefaultEffectParams('spatial'), params)\n\n\tconst panner = new PannerNode(config.audioContext, {\n\t\tpanningModel: params.panningModel,\n\t\tdistanceModel: params.distanceModel,\n\t\trolloffFactor: params.rolloff,\n\t\trefDistance: params.minDistance,\n\t\tmaxDistance: params.maxDistance,\n\t})\n\n\tconst effect = {\n\t\tparams,\n\t\t...createAudioEffect(panner),\n\t\tsetPosition: (vec: iVector3) => {\n\t\t\tpanner.positionX.value = vec.x || 0\n\t\t\tpanner.positionY.value = vec.y || 0\n\t\t\tpanner.positionZ.value = vec.z || 0\n\t\t},\n\t\tgetPosition: () => ({ x: panner.positionX.value, y: panner.positionY.value, z: panner.positionZ.value }),\n\t\t// `PannerNode.setVelocity()` is deprecated. We have re-implemented it here by\n\t\t// applying a vector (expressed in meters per second) to the panning node's position\n\t\t// over the duration of a sample to get its final destination, and then applying a\n\t\t// linear ramp to each axis.\n\t\tsetVelocity: function (vector: iVector3, seconds: number) {\n\t\t\tpanner.positionX.linearRampToValueAtTime(\n\t\t\t\tpanner.positionX.value + vector.x * seconds,\n\t\t\t\tconfig.audioContext.currentTime + seconds,\n\t\t\t)\n\t\t\tpanner.positionY.linearRampToValueAtTime(\n\t\t\t\tpanner.positionY.value + vector.y * seconds,\n\t\t\t\tconfig.audioContext.currentTime + seconds,\n\t\t\t)\n\t\t\tpanner.positionZ.linearRampToValueAtTime(\n\t\t\t\tpanner.positionZ.value + vector.z * seconds,\n\t\t\t\tconfig.audioContext.currentTime + seconds,\n\t\t\t)\n\t\t},\n\t\tsetParam: {\n\t\t\t'position': (val) => effect.setPosition(val)\n\t\t},\n\t\tnode: panner\n\t} as AudioEffect.SpatialEffect\n\n\teffect.setPosition(params.position)\n\n\treturn effect\n}\n","export const wait = (millis: number) =>\n\tnew Promise(resolve => setTimeout(resolve, millis))\n\nexport const waitForRequestAnimationFrame = () =>\n\tnew Promise((resolve) => window.requestAnimationFrame(resolve))\n\n\nexport function runWithTimeout(promise: Promise<any>, timeout = 8000) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst timer = setTimeout(() => {\n\t\t\treject(new Error('TIMEOUT'))\n\t\t}, timeout)\n\t\tpromise.then(val => {\n\t\t\tclearTimeout(timer)\n\t\t\tresolve(val)\n\t\t}).catch(err => {\n\t\t\tclearTimeout(timer)\n\t\t\treject(err)\n\t\t})\n\t})\n}\n\nexport function createFetchWithTimeout(fetch = window.fetch, timeout?) {\n\treturn (url, opts = {}) => runWithTimeout(fetch(url, opts), timeout) as Promise<Response>\n}\n\n\n// const createDeferred = <T>() => {\n//\t let deferred: Partial<Deferred<T>> = {}\n//\t deferred.promise = new Promise<T>((resolve, reject) => {\n//\t\t deferred.resolve = resolve\n//\t\t deferred.reject = reject\n//\t })\n//\t return deferred as Deferred<T>\n// }\n// export interface Deferred<T> {\n//\t resolve: (value: T | PromiseLike<T>) => void\n//\t reject: (reason?: any) => void\n//\t promise: Promise<T>\n// }\n","\nexport interface iVector2 {\n\tx: number\n\ty: number\n}\nexport interface iVector3 {\n\tx: number\n\ty: number\n\tz: number\n}\n\n\n// Add one vector to another.\nexport const add = (v1: iVector3, v2: iVector3) => ({\n\tx: v1.x + v2.x,\n\ty: v1.y + v2.y,\n\tz: v1.z + v2.z\n})\n\nexport const length = (v: iVector3) =>\n\tMath.sqrt(v.x * v.x + v.y * v.y + v.z * v.z)\n\nexport const multiply = (v: iVector3, val: number) => ({\n\tx: v.x * val,\n\ty: v.y * val,\n\tz: v.z * val\n})\n\nexport const normalize = (v: iVector3) =>\n\tmultiply(v, 1 / length(v))\n\n\n","import { AnimationCurve } from 'modules-core/audioSystem/types'\nimport log from 'modules-core/log'\nimport { add, length, iVector3, MathExt, multiply } from 'modules-core/utility'\n\n\n\nexport const minSafeAudioNumber = 0.001\nexport const maxSafeAudioNumber = 1 - minSafeAudioNumber\n\nconst logger = log.getLogger('audioEffectSystem')\n\nconst lerp = (a, b, t) => a + (b - a) * t\n\nconst curveMap: Record<AnimationCurve, (val: number) => number> = {\n\tlinear: (t: number) => t,\n\teaseIn: (t: number) => 1 - Math.cos(t * Math.PI * 0.5),//start gentle, equal power\n\teaseOut: (t: number) => Math.sin(t * Math.PI * 0.5),//start steep, default\n}\n\n\n//OPTIMIZE ME\n//GAH a bug! exponentialRamp jumps to value, not sure why...\n// node.gain.linearRampToValueAtTime(target, time)\n// node.gain.exponentialRampToValueAtTime(target, time)\n// node.gain.setTargetAtTime(normalizeVal(val), context.currentTime + duration, duration * 0.3)\n\n\nexport const rampToValueAtTime = (param: AudioParam, val: number, start: number, duration: number, curveName?: AnimationCurve) => {\n\tcurveName ??= 'easeOut'\n\tif (duration === 0)\n\t\tduration = minSafeAudioNumber\n\tconst values = []\n\tconst current = param.value\n\tconst resolution = 32\n\n\tconst curve = curveMap[curveName]\n\tfor (let i = 0; i < resolution; i++) {\n\t\tconst t = curve(i / (resolution - 1))\n\t\tvalues.push(lerp(current, val, t))\n\t}\n\tparam.cancelScheduledValues(start)\n\ttry {\n\t\tparam.setValueCurveAtTime(values, start, duration)\n\t} catch (error) {\n\t\tif (/AudioParam.setValueCurveAtTime: Can't add events during a curve event/.test(error.message)) {\n\t\t\tlogger.error(error)\n\t\t} else {\n\t\t\tthrow error\n\t\t}\n\t}\n}\n\n\nexport const rampToCenteredVelocityOverTime = (zPos: AudioParam, startPos: iVector3, velocity: iVector3, startTime: number, duration: number, resolution = 10) => {\n\tconst values = new Array<number>(resolution)\n\tfor (let i = 0; i < resolution; i++) {\n\t\tconst iFrac = i / (resolution - 1)\n\t\tconst timeStep = duration * iFrac\n\n\t\tconst pos = add(startPos, multiply(velocity, timeStep))\n\n\t\tvalues[i] = length(pos)\n\t}\n\tzPos.setValueCurveAtTime(values, startTime, duration)\n\treturn values\n}\n","// import getServerTime from 'modules-core/utility/serverTime'\nimport { MathExt, wait } from 'modules-core/utility'\nimport { createAudioEffect } from '.'\nimport { createDefaultEffectParams } from '../constants'\nimport { AudioEffect } from '../types'\nimport { maxSafeAudioNumber, minSafeAudioNumber, rampToValueAtTime } from '../utility'\nimport config from 'modules-core/config'\n\nexport const createVolumeEffect = (params: AudioEffect.VolumeEffectParams = {}) => {\n\tparams = Object.assign(createDefaultEffectParams('volume'), params)\n\tif (params.isDestination)\n\t\tparams.output = undefined\n\n\tconst node = new GainNode(config.audioContext, { gain: params.volume })\n\n\t// const normalizeVal = (val: number) => MathExt.clamp(val, minSafeAudioNumber, maxSafeAudioNumber)\n\n\t// Range (in dB) for volume slider, from 0-100%.\n\t// Chris claims that applying a 50% reduction to global volume is necessary to get an\n\t// element set to 1% to be as quiet as he needs it with a range of 30. Changing it to\n\t// 45 makes an element at 1% with global volume at 100% sound exactly like Chris would\n\t// have heard when he tested. Ben has tested lots of content and prefers 37.5dB range.\n\t// With the current range of 30dB, every 20% on the slider is -9dB, which is said to\n\t// sound about half as loud.\n\tconst query = new URLSearchParams(location.search)\n\tconst volumeSliderRange = Number(query.get('dbRangeVolumeEffect') ?? 37.5)\n\n\t// Gain 1 is \"reference level\" (dBFS) and the maximum we should ever send to the audio\n\t// destination. Here we convert volume expressed as a percentage to dBFS (min: -30dB),\n\t// and then to gain, to give us an exponential volume control that behaves more like\n\t// we expect. Every 20% reduction on the slider will halve the volume (-6dBFS).\n\tconst volumeToGain = (volume: number) => {\n\t\tconst dbfs = -volumeSliderRange + (volume * volumeSliderRange)\n\t\tif (dbfs == -volumeSliderRange) {\n\t\t\treturn 0\n\t\t} else {\n\t\t\t// See: https://teropa.info/blog/2016/08/30/amplitude-and-loudness.html\n\t\t\treturn Math.pow(10, dbfs / 20)\n\t\t}\n\t}\n\n\t// Convert gain back to volume expressed as a percentage\n\tconst gainToVolume = (gain: number) => {\n\t\tconst dbfs = 20 * Math.log10(gain)\n\t\treturn 1 - (dbfs / -volumeSliderRange)\n\t}\n\n\tconst effect: AudioEffect.VolumeEffect = {\n\t\tparams,\n\t\t...createAudioEffect(node),\n\t\tget value() { return gainToVolume(node.gain.value) },\n\t\tset value(val) {\n\t\t\tnode.gain.cancelScheduledValues(config.audioContext.currentTime)\n\t\t\tnode.gain.value = volumeToGain(val)\n\t\t},\n\t\tfadeToValue: async (val, durationSecs = params.fadeDuration, curveName) => {\n\t\t\trampToValueAtTime(\n\t\t\t\tnode.gain,\n\t\t\t\tvolumeToGain(val),\n\t\t\t\tconfig.audioContext.currentTime,\n\t\t\t\tdurationSecs,\n\t\t\t\tcurveName,\n\t\t\t)\n\t\t\tawait wait(durationSecs * 1000)\n\t\t},\n\t\tsetParam: {\n\t\t\t'volume': (val) => node.gain.value = val,\n\t\t\t'fadeDuration': val => params.fadeDuration = val\n\t\t},\n\t\t// fadeToValueAtTimestamp: async (val: number, timestamp: number) =>{\n\t\t//\t const duration =\n\t\t//\t rampSafely(val, context.currentTime + timestamp - MathExt.millisToSecs(getServerTime())),\n\t\t//\t await wait(durationSecs * 1000)\n\t\t// }\n\t}\n\treturn effect\n}\n\n","//https://blog.gskinner.com/archives/2019/02/reverb-web-audio-api.html\n\n// SAFARI Polyfills\n// if(!window.AudioBuffer.prototype.copyToChannel) {\n// \twindow.AudioBuffer.prototype.copyToChannel = function copyToChannel (buffer,channel) {\n// \t\tthis.getChannelData(channel).set(buffer)\n// \t}\n// }\n// if(!window.AudioBuffer.prototype.copyFromChannel) {\n// \twindow.AudioBuffer.prototype.copyFromChannel = function copyFromChannel (buffer,channel) {\n// \t\tbuffer.set(this.getChannelData(channel))\n// \t}\n// }\n// var OfflineAudioContext = window.OfflineAudioContext || window.webkitOfflineAudioContext\nclass SkinnerEffect {\n\tname: string\n\tcontext: AudioContext\n\tinput: AudioNode\n\teffect: AudioNode\n\tbypassed: boolean\n\toutput: AudioNode\n\tconstructor(context: AudioContext) {\n\t\tthis.name = 'effect'\n\t\tthis.context = context\n\t\tthis.input = this.context.createGain()\n\t\tthis.effect = null\n\t\tthis.bypassed = false\n\t\tthis.output = this.context.createGain()\n\t\tthis.setup()\n\t\tthis.wireUp()\n\t}\n\n\tsetup() {\n\t\tthis.effect = this.context.createGain()\n\t}\n\n\twireUp() {\n\t\tthis.input.connect(this.effect)\n\t\tthis.effect.connect(this.output)\n\t}\n\n\tconnect(destination) {\n\t\tthis.output.connect(destination)\n\t}\n\n}\n\n// class SkinnerSample {\n//\t context: AudioContext\n//\t buffer: AudioBufferSourceNode\n//\t sampleBuffer: AudioBuffer\n//\t loaded: boolean\n//\t output: GainNode\n\n//\t constructor(context: AudioContext) {\n//\t\t this.context = context\n//\t\t this.buffer = this.context.createBufferSource()\n//\t\t this.buffer.start()\n//\t\t this.sampleBuffer = null\n//\t\t // this.rawBuffer = null\n//\t\t this.loaded = false\n//\t\t this.output = this.context.createGain()\n//\t\t this.output.gain.value = 0.1\n//\t }\n\n//\t play() {\n//\t\t if (this.loaded) {\n//\t\t\t this.buffer = this.context.createBufferSource()\n//\t\t\t this.buffer.buffer = this.sampleBuffer\n//\t\t\t this.buffer.connect(this.output)\n//\t\t\t this.buffer.start(this.context.currentTime)\n//\t\t }\n//\t }\n\n//\t connect(input) {\n//\t\t this.output.connect(input)\n//\t }\n\n//\t async load(path) {\n//\t\t this.loaded = false\n//\t\t const response = await fetch(path)\n//\t\t const blob = await response.arrayBuffer()\n//\t\t this.sampleBuffer = await this.context.decodeAudioData(blob)\n//\t\t this.loaded = true\n//\t\t return this\n//\t }\n// }\n\n\nclass SkinnerAmpEnvelope {\n\tcontext: AudioContext\n\toutput: GainNode\n\tpartials: []\n\tvelocity: number\n\tgain: number\n\t_attack: number\n\t_decay: number\n\t_sustain: number\n\t_release: number\n\n\tconstructor(context: AudioContext, gain = 1) {\n\t\tthis.context = context\n\t\tthis.output = this.context.createGain()\n\t\tthis.output.gain.value = gain\n\t\tthis.partials = []\n\t\tthis.velocity = 0\n\t\tthis.gain = gain\n\t\tthis._attack = 0\n\t\tthis._decay = 0.001\n\t\tthis._sustain = this.output.gain.value\n\t\tthis._release = 0.001\n\t}\n\n\ton(velocity) {\n\t\tthis.velocity = velocity / 127\n\t\tthis.start(this.context.currentTime)\n\t}\n\n\toff(MidiEvent) {\n\t\treturn this.stop(this.context.currentTime)\n\t}\n\n\tstart(time) {\n\t\tthis.output.gain.value = 0\n\t\tthis.output.gain.setValueAtTime(0, time)\n\t\tthis.output.gain.setTargetAtTime(1, time, this.attack + 0.00001)\n\t\tthis.output.gain.setTargetAtTime(this.sustain * this.velocity, time + this.attack, this.decay)\n\t}\n\n\tstop(time) {\n\t\tthis.sustain = this.output.gain.value\n\t\tthis.output.gain.cancelScheduledValues(time)\n\t\tthis.output.gain.setValueAtTime(this.sustain, time)\n\t\tthis.output.gain.setTargetAtTime(0, time, this.release + 0.00001)\n\t}\n\n\tset attack(value) {\n\t\tthis._attack = value\n\t}\n\n\tget attack() {\n\t\treturn this._attack\n\t}\n\n\tset decay(value) {\n\t\tthis._decay = value\n\t}\n\n\tget decay() {\n\t\treturn this._decay\n\t}\n\n\tset sustain(value) {\n\t\tthis.gain = value\n\t\tthis._sustain\n\t}\n\n\tget sustain() {\n\t\treturn this.gain\n\t}\n\n\tset release(value) {\n\t\tthis._release = value\n\t}\n\n\tget release() {\n\t\treturn this._release\n\t}\n\n\tconnect(destination) {\n\t\tthis.output.connect(destination)\n\t}\n}\n\nclass SkinnerVoice {\n\tcontext: AudioContext\n\ttype: OscillatorType\n\tvalue: number\n\tgain: number\n\toutput: GainNode\n\tpartials: OscillatorNode[]\n\tampEnvelope: SkinnerAmpEnvelope\n\n\tconstructor(context: AudioContext, type: OscillatorType = 'sawtooth', gain = 0.1) {\n\t\tthis.context = context\n\t\tthis.type = type\n\t\tthis.value = -1\n\t\tthis.gain = gain\n\t\tthis.output = this.context.createGain()\n\t\tthis.partials = []\n\t\tthis.output.gain.value = this.gain\n\t\tthis.ampEnvelope = new SkinnerAmpEnvelope(this.context)\n\t\tthis.ampEnvelope.connect(this.output)\n\t}\n\n\tinit() {\n\t\tconst osc = this.context.createOscillator()\n\t\tosc.type = this.type\n\t\tosc.connect(this.ampEnvelope.output)\n\t\tosc.start(this.context.currentTime)\n\t\tthis.partials.push(osc)\n\t}\n\n\ton(MidiEvent) {\n\t\tthis.value = MidiEvent.value\n\t\tthis.partials.forEach((osc) => {\n\t\t\tosc.frequency.value = MidiEvent.frequency\n\t\t})\n\t\tthis.ampEnvelope.on(MidiEvent.velocity || MidiEvent)\n\t}\n\n\toff(MidiEvent?) {\n\t\tthis.ampEnvelope.off(MidiEvent)\n\t\tthis.partials.forEach((osc) => {\n\t\t\tosc.stop(this.context.currentTime + this.ampEnvelope.release * 4)\n\t\t})\n\t}\n\n\tconnect(destination) {\n\t\tthis.output.connect(destination)\n\t}\n\n\tset detune(value) {\n\t\tthis.partials.forEach(p => p.detune.value = value)\n\t}\n\n\tset attack(value) {\n\t\tthis.ampEnvelope.attack = value\n\t}\n\n\tget attack() {\n\t\treturn this.ampEnvelope.attack\n\t}\n\n\tset decay(value) {\n\t\tthis.ampEnvelope.decay = value\n\t}\n\n\tget decay() {\n\t\treturn this.ampEnvelope.decay\n\t}\n\n\tset sustain(value) {\n\t\tthis.ampEnvelope.sustain = value\n\t}\n\n\tget sustain() {\n\t\treturn this.ampEnvelope.sustain\n\t}\n\n\tset release(value) {\n\t\tthis.ampEnvelope.release = value\n\t}\n\n\tget release() {\n\t\treturn this.ampEnvelope.release\n\t}\n\n}\nclass SkinnerNoise extends SkinnerVoice {\n\t_length: number\n\t//@ts-ignore\n\tpartials: AudioBufferSourceNode[]\n\tconstructor(context, gain) {\n\t\tsuper(context, gain)\n\t\tthis._length = 2\n\t}\n\n\tget length() {\n\t\treturn this._length || 2\n\t}\n\tset length(value) {\n\t\tthis._length = value\n\t}\n\n\tinit() {\n\t\tconst lBuffer = new Float32Array(this.length * this.context.sampleRate)\n\t\tconst rBuffer = new Float32Array(this.length * this.context.sampleRate)\n\t\tfor (let i = 0; i < this.length * this.context.sampleRate; i++) {\n\t\t\tlBuffer[i] = 1 - (2 * Math.random())\n\t\t\trBuffer[i] = 1 - (2 * Math.random())\n\t\t}\n\t\tconst buffer = this.context.createBuffer(2, this.length * this.context.sampleRate, this.context.sampleRate)\n\t\tbuffer.copyToChannel(lBuffer, 0)\n\t\tbuffer.copyToChannel(rBuffer, 1)\n\n\t\tconst osc = this.context.createBufferSource()\n\t\tosc.buffer = buffer\n\t\tosc.loop = true\n\t\tosc.loopStart = 0\n\t\tosc.loopEnd = 2\n\t\tosc.start(this.context.currentTime)\n\t\tosc.connect(this.ampEnvelope.output)\n\t\tthis.partials.push(osc)\n\t}\n\n\ton(MidiEvent) {\n\t\tthis.value = MidiEvent.value\n\t\tthis.ampEnvelope.on(MidiEvent.velocity || MidiEvent)\n\t}\n\n}\n\nclass SkinnerFilter extends SkinnerEffect {\n\teffect: BiquadFilterNode\n\tconstructor(context, type: BiquadFilterType = 'lowpass', cutoff = 1000, resonance = 0.9) {\n\t\tsuper(context)\n\t\tthis.name = 'filter'\n\t\tthis.effect.frequency.value = cutoff\n\t\tthis.effect.Q.value = resonance\n\t\tthis.effect.type = type\n\t}\n\n\tsetup() {\n\t\tthis.effect = this.context.createBiquadFilter()\n\t\tthis.effect.connect(this.output)\n\t\tthis.wireUp()\n\t}\n\n}\n\nexport class SkinnerAdvancedReverb extends SkinnerEffect {\n\n\tpreDelay: DelayNode\n\tmultitap: DelayNode[]\n\tmultitapGain: GainNode\n\n\tduration: number\n\tattack: number\n\tdecay: number\n\trelease: number\n\twet: GainNode\n\teffect: ConvolverNode\n\n\tconstructor(context: AudioContext) {\n\t\tsuper(context)\n\t\tthis.name = 'AdvancedReverb'\n\t}\n\n\t//@ts-ignore\n\toverride setup({ duration, preDelay, attack, decay }: {\n\t\tduration?: number\n\t\tpreDelay?: number\n\t\tattack?: number\n\t\tdecay?: number\n\t} = { }) {\n\t\tduration ??= 1\n\t\tpreDelay ??= 0.03\n\t\tattack ??= 0.001\n\t\tdecay ??= 0.1\n\n\t\tthis.effect = this.context.createConvolver()\n\n\t\tthis.duration = duration\n\t\tthis.attack = attack\n\t\tthis.decay = decay\n\t\tthis.release = duration\n\n\t\tthis.preDelay = this.context.createDelay(duration)\n\t\tthis.preDelay.delayTime.setValueAtTime(preDelay, this.context.currentTime)\n\n\t\tthis.multitap = []\n\n\t\tfor (let i = 2; i > 0; i--) {\n\t\t\tthis.multitap.push(this.context.createDelay(duration))\n\t\t}\n\t\tthis.multitap.map((t, i) => {\n\t\t\tif (this.multitap[i + 1]) {\n\t\t\t\tt.connect(this.multitap[i + 1])\n\t\t\t}\n\t\t\tt.delayTime.setValueAtTime(0.001 + (i * (preDelay / 2)), this.context.currentTime)\n\t\t})\n\n\t\tthis.multitapGain = this.context.createGain()\n\t\tthis.multitap[this.multitap.length - 1].connect(this.multitapGain)\n\n\t\tthis.multitapGain.gain.value = 0.2\n\n\t\tthis.multitapGain.connect(this.output)\n\n\t\tthis.wet = this.context.createGain()\n\t\tthis.wet.gain.value = 1\n\n\t\tthis.input.connect(this.wet)\n\t\tthis.wet.connect(this.preDelay)\n\t\tthis.wet.connect(this.multitap[0])\n\t\tthis.preDelay.connect(this.effect)\n\t\tthis.effect.connect(this.output)\n\n\t}\n\n\trenderTail({ lpCutoff, lpResonance, hpCutoff, hpResonance }: {\n\t\tlpCutoff?: number\n\t\tlpResonance?: number\n\t\thpCutoff?: number\n\t\thpResonance?: number\n\t} = { }) {\n\t\tlpCutoff ??= 2000\n\t\tlpResonance ??= 0.2\n\t\thpCutoff ??= 500\n\t\thpResonance ??= 0.1\n\n\t\tconst tailContext = new OfflineAudioContext(2, this.context.sampleRate * this.duration, this.context.sampleRate)\n\t\ttailContext.oncomplete = (buffer) =>\n\t\t\tthis.effect.buffer = buffer.renderedBuffer\n\n\t\tconst tailOsc = new SkinnerNoise(tailContext, 1)\n\t\tconst tailLPFilter = new SkinnerFilter(tailContext, 'lowpass', lpCutoff, lpResonance)\n\t\tconst tailHPFilter = new SkinnerFilter(tailContext, 'highpass', hpCutoff, hpResonance)\n\n\t\ttailOsc.init()\n\t\ttailOsc.connect(tailHPFilter.input)\n\t\ttailHPFilter.connect(tailLPFilter.input)\n\t\ttailLPFilter.connect(tailContext.destination)\n\t\ttailOsc.attack = this.attack\n\t\ttailOsc.decay = this.decay\n\t\ttailOsc.release = this.release\n\n\t\ttailContext.startRendering()\n\n\t\ttailOsc.on({ frequency: 500, velocity: 1 })\n\t\tsetTimeout(() => tailOsc.off(), 20)\n\t}\n\n\tset decayTime(value) {\n\t\tconst dc = value / 3\n\t\tthis.duration = value\n\t\tthis.attack = 0\n\t\tthis.decay = 0\n\t\tthis.release = dc\n\t\tthis.renderTail()\n\t}\n}\n/*example preset params\n{\n\t\"near_reverb_level\": -500,\n\t\"name\": \"Alley\",\n\t\"reflections_level\": -1204,\n\t\"reflections_delay\": 0.007,\n\t\"lf_reference\": 250,\n\t\"density\": 100,\n\t\"hf_reference\": 5000,\n\t\"decay_time\": 1.49,\n\t\"far_reverb_level\": 2000,\n\t\"reverb_delay\": 0.011,\n\t\"room_hf\": -270,\n\t\"diffusion\": 100,\n\t\"room\": -1000,\n\t\"decay_hf_ratio\": 0.86,\n\t\"dry_level\": 0,\n\t\"far_reverb_distance\": 50,\n\t\"near_reverb_distance\": 5,\n\t\"room_lf\": 0\n}\n*/","import { createAudioEffect } from './createEffect'\nimport { AudioEffect } from '../types'\nimport { createDefaultEffectParams, effectMetadataMap } from '../constants'\nimport config from 'modules-core/config'\nimport Freeverb from 'freeverb'\n\n//https://github.com/mmckegg/freeverb\n\ninterface Freeverb extends GainNode {\n\troomSize: number\n\tdampening: number\n\twet: AudioParam\n\tdry: AudioParam\n}\n\nexport const createFreeverbEffect = (params: AudioEffect.FreeverbEffectParams) => {\n\tparams = Object.assign(createDefaultEffectParams('freeverb'), params)\n\n\tconst preDelay = config.audioContext.createDelay(\n\t\t//@ts-ignore\n\t\teffectMetadataMap.freeverb.parameters.preDelay.max\n\t)\n\tpreDelay.delayTime.value = params.preDelay\n\n\tconst reverb = Freeverb(config.audioContext) as Freeverb\n\treverb.wet.value = 1\n\treverb.dry.value = 0\n\treverb.roomSize = params.roomSize\n\treverb.dampening = params.dampening\n\n\tconst hp = config.audioContext.createBiquadFilter()\n\thp.type = 'highpass'\n\thp.frequency.value = params.hpFrequency\n\thp.Q.value = params.hpResonance\n\n\tconst lp = config.audioContext.createBiquadFilter()\n\tlp.type = 'lowpass'\n\tlp.frequency.value = params.lpFrequency\n\tlp.Q.value = params.lpResonance\n\n\tconst output = config.audioContext.createGain()\n\toutput.gain.value = params.gain\n\n\tpreDelay.connect(reverb)\n\treverb.connect(hp)\n\thp.connect(lp)\n\tlp.connect(output)\n\n\tconst effect = {\n\t\tparams,\n\t\t...createAudioEffect(preDelay, output),\n\t\tsetParam: {\n\t\t\tpreDelay: val => preDelay.delayTime.value = val,\n\t\t\tdampening: val => reverb.dampening = val,\n\t\t\troomSize: val => reverb.roomSize = val,\n\t\t\thpFrequency: val => hp.frequency.value = val,\n\t\t\thpResonance: val => hp.Q.value = val,\n\t\t\tlpFrequency: val => lp.frequency.value = val,\n\t\t\tlpResonance: val => lp.Q.value = val,\n\t\t\tgain: val => output.gain.value = val,\n\t\t}\n\t} as AudioEffect.FreeverbEffect\n\treturn effect\n}\n","import { createAnalyserEffect } from './analyserEffect'\nimport { createCompressorEffect } from './compressorEffect'\nimport { createFilterEffect } from './filterEffect'\nimport { AudioEffect } from '../types'\nimport { createConvolverEffect } from './convolverEffect'\nimport { createDelayEffect } from './delayEffect'\nimport { createSendEffect } from './sendEffect'\nimport { createSpatialEffect } from './spatialEffect'\nimport { createVolumeEffect } from './volumeEffect'\nimport { createReverbEffect } from './reverbEffect'\nimport { createFreeverbEffect } from './freeverbEffect'\n\n\nexport const createEffectMap: AudioEffect.CreateEffectMap = {\n\t'volume': createVolumeEffect,\n\t'analyser': createAnalyserEffect,\n\t'compressor': createCompressorEffect,\n\t'convolver': createConvolverEffect,\n\t'send': createSendEffect,\n\t'delay': createDelayEffect,\n\t'spatial': createSpatialEffect,\n\t'filter': createFilterEffect,\n\t'reverb': createReverbEffect,\n\t'freeverb': createFreeverbEffect\n}","import { createAudioEffect } from '.'\nimport { createDefaultEffectParams } from '../constants'\nimport { AudioEffect } from '../types'\nimport config from 'modules-core/config'\n\nexport const createCompressorEffect = (params: AudioEffect.CompressorEffectParams = {}) => {\n\tparams = Object.assign(createDefaultEffectParams('compressor'), params)\n\tif (params.isDestination)\n\t\tparams.output = undefined\n\n\t// TODO: Use destructuring assignment for `params`?\n\tconst node = new DynamicsCompressorNode(config.audioContext, params)\n\n\tconst effect: AudioEffect.CompressorEffect = {\n\t\tparams,\n\t\tsetParam: {},\n\t\t...createAudioEffect(node),\n\t}\n\treturn effect\n}\n","import { blobDatabase } from 'modules-core/cache'\nimport { createDefaultEffectParams } from '../constants'\nimport { AudioEffect } from '../types'\nimport { createAudioEffect } from './createEffect'\nimport config from 'modules-core/config'\n\n\nexport const createConvolverEffect = async (params: AudioEffect.ConvolverEffectParams = {}) => {\n\tparams = Object.assign(createDefaultEffectParams('convolver'), params)\n\tconst blob = await blobDatabase.getBlob(params.url)\n\tconst arrayBuffer = await blob.arrayBuffer()\n\tconst audioBuffer = await config.audioContext.decodeAudioData(arrayBuffer)\n\n\tconst node = config.audioContext.createConvolver()\n\tnode.buffer = audioBuffer\n\n\tconst effect = {\n\t\t...createAudioEffect(node),\n\t\tparams,\n\t\tsetParam: {}\n\t} as AudioEffect.ConvolverEffect\n\n\treturn effect\n}\n","import { createAudioEffect } from './createEffect'\nimport { AudioEffect } from '../types'\nimport { effectMetadataMap, createDefaultEffectParams } from '../constants'\nimport config from 'modules-core/config'\n\nexport const createDelayEffect = (params: AudioEffect.DelayEffectParams) => {\n\tparams = Object.assign(createDefaultEffectParams('delay'), params)\n\tconst node = config.audioContext.createDelay(\n\t\t//@ts-ignore\n\t\teffectMetadataMap.delay.parameters.duration.max\n\t)\n\tnode.delayTime.value = params.duration\n\n\tconst feedbackNode = config.audioContext.createGain()\n\tfeedbackNode.gain.value = params.falloff\n\n\tnode.connect(feedbackNode)\n\tfeedbackNode.connect(node)\n\n\tconst effect = {\n\t\t//we use feedback node so falloff is applied on first pass\n\t\tparams,\n\t\t...createAudioEffect(feedbackNode, node),\n\t\tsetParam: {\n\t\t\t'duration': val => node.delayTime.value = val,\n\t\t\t'falloff': val => feedbackNode.gain.value = val,\n\t\t}\n\t} as AudioEffect.DelayEffect\n\treturn effect\n}\n","import { createAudioEffect } from './createEffect'\nimport { createDefaultEffectParams } from '../constants'\nimport { AudioEffect } from '../types'\nimport config from 'modules-core/config'\n\nexport const createFilterEffect = (params: AudioEffect.FilterEffectParams) => {\n\tparams = Object.assign(createDefaultEffectParams('filter'), params)\n\n\t//TODO input & output gains so we can have many ins and outs\n\n\tconst node = config.audioContext.createBiquadFilter()\n\tnode.type = params.filterType\n\tnode.Q.value = params.resonance\n\tnode.detune.value = params.detune\n\tnode.gain.value = params.gain\n\tnode.frequency.value = params.frequency\n\n\tconst input = config.audioContext.createGain()\n\tconst output = config.audioContext.createGain()\n\n\tinput.connect(node)\n\tnode.connect(output)\n\tconst effect = {\n\t\tparams,\n\t\t...createAudioEffect(input, output),\n\t\tsetParam: {\n\t\t\t'filterType': val => node.type = val,\n\t\t\t'resonance': val => node.Q.value = val,\n\t\t\t'detune': val => node.detune.value = val,\n\t\t\t'gain': val => node.gain.value = val,\n\t\t\t'frequency': val => node.frequency.value = val,\n\t\t}\n\t} as AudioEffect.FilterEffect\n\treturn effect\n}\n\n","import { createAudioEffect } from './createEffect'\nimport { AudioEffect } from '../types'\nimport { createDefaultEffectParams } from '../constants'\nimport { SkinnerAdvancedReverb } from './SkinnerAudio'\nimport config from 'modules-core/config'\n\nexport const createReverbEffect = (params: AudioEffect.ReverbEffectParams) => {\n\tparams = Object.assign(createDefaultEffectParams('reverb'), params)\n\n\tconst reverb = new SkinnerAdvancedReverb(config.audioContext)\n\treverb.setup({ ...params })\n\treverb.renderTail({ ...params })\n\n\tconst effect = {\n\t\tparams,\n\t\t...createAudioEffect(reverb.input, reverb.output),\n\t\tsetParam: {\n\t\t}\n\t} as AudioEffect.ReverbEffect\n\treturn effect\n}\n","import config from 'modules-core/config'\nimport log from 'modules-core/log'\n\nconst logger = log.getLogger('urlSystem')\n\ntype SocketPath =\n| 'ws-master-interface'\n| 'ws-online-player/websocket'\n| 'ws-control-panel'\n| 'ws-web-player/websocket'\n\nexport const createUrlSystem = () => {\n\tconst maybePort = (port: string) => port ? `:${port}` : ''\n\tconst maybeSubdomain = (subdomain: string) => subdomain ? `${subdomain}.` : ''\n\treturn {\n\t\t// Replace local hostnames. We might have inconsistent URLs in redis if the site\n\t\t// has been accessed at multiple locations.\n\t\treplaceLocalDomainAndPort: (path: string) => {\n\t\t\tconst new_path = path.replace(RegExp('://[^/]*(localhost|lvh.me)[^/]+'), `://${config.httpHostname}${maybePort(config.httpPort)}`)\n\t\t\tif (new_path !== path)\n\t\t\t\tlogger.debug(`replaceLocalDomainAndPort(): ${path} => ${new_path}`)\n\t\t\treturn new_path\n\t\t},\n\n\t\tcreateUrlHttp: (path: string, subdomain: string = '') => {\n\t\t\treturn `${config.httpProtocol}://${maybeSubdomain(subdomain)}${config.httpHostname}${maybePort(config.httpPort)}/${path}`\n\t\t},\n\n\t\tcreateUrlWs: (socketPath: SocketPath) => {\n\t\t\treturn `${config.wsProtocol}://${config.wsHostname}${maybePort(config.wsPort)}/${socketPath}`\n\t\t},\n\t}\n}\n\nexport type iUrlSystem = ReturnType<typeof createUrlSystem>\n\nexport const urlSystem = createUrlSystem()\nexport default urlSystem\n","import log from \"modules-core/log\"\n\nlet checkTimersId: number\nlet checkTimersInterval = 1000 / 60\nlet logger = log.getLogger('strictTimeout')\nlet nextId = 1\nlet timers = new Map<number, Timer>()\n\ninterface Timer {\n\tstart: number\n\tend: number\n\tcallback: () => any\n}\n\nlet checkTimers = () => {\n\ttimers.forEach((timer, id) => {\n\t\tlet { start, end, callback } = timer\n\t\tlet now = new Date().getTime()\n\t\tif (start < now) {\n\t\t\ttimers.delete(id)\n\t\t\t// Allow 5s grace to match the 5s grace we allow on scrubbing samples.\n\t\t\tif (typeof end === 'undefined' || end > now - 5000) {\n\t\t\t\ttry {\n\t\t\t\t\tcallback()\n\t\t\t\t} catch(e) {\n\t\t\t\t\tlogger.error(`Error while executing strict timer ${id}`, e, timer)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})\n\tif (timers.size === 0) {\n\t\tstopStrictTimers()\n\t} else if (typeof checkTimersId !== 'undefined') {\n\t\tcheckTimersId = window.setTimeout(checkTimers, checkTimersInterval)\n\t}\n}\n\nexport let clearStrictTimeout = (id: number) => {\n\ttimers.delete(id)\n}\n\nexport let setStrictTimeout = (callback: () => any, delay: number, limit?: number) => {\n\tif (typeof checkTimersId === 'undefined') {\n\t\tstartStrictTimers()\n\t}\n\tlet now = new Date().getTime()\n\tlet start = now + delay\n\tlet end = limit ? start + limit : undefined\n\tlet id = nextId++\n\ttimers.set(id, { start, end, callback })\n\treturn id\n}\n\nexport let startStrictTimers = () => {\n\tif (typeof checkTimersId === 'undefined') {\n\t\tcheckTimersId = window.setTimeout(checkTimers, checkTimersInterval)\n\t}\n}\n\nexport let stopStrictTimers = () => {\n\tcheckTimersId = undefined\n\twindow.clearTimeout(checkTimersId)\n}\n","import { createAsyncAudioSource, FadeOptions } from 'modules-core/audioSystem/types'\nimport { blobDatabase } from 'modules-core/cache/blobDatabase'\nimport { createVolumeEffect } from 'modules-core/audioEffectSystem/effects/volumeEffect'\nimport { AudioEffect } from 'modules-core/audioEffectSystem/types'\nimport { AudioEffectSystem } from 'modules-core/audioEffectSystem'\nimport { createEvent, wait } from 'modules-core/utility'\nimport log from 'modules-core/log'\nimport { source } from 'common-tags'\nimport { clearStrictTimeout, setStrictTimeout } from 'modules-core/utility/strictTimeout'\nimport config from 'modules-core/config'\n\nconst logger = log.getLogger('audioSystem')\n\ninterface Args {\n\teffectSystem: AudioEffectSystem\n}\nexport const createBlobSourceInstantiator = ({\n\teffectSystem\n}: Args) => {\n\n\tconst audioElements: HTMLAudioElement[] = []\n\tconst sourceNodes = new WeakMap()  // {el: HTMLAudioElement: sourceNode: MediaElementAudioSourceNode}\n\n\tconst instantiator = {\n\t\tcreateAudioSource: (src, output: AudioEffect.HasInput = effectSystem.globalVolume, { fadeIn, fadeOut, fadeScrub, fadeStop }: FadeOptions = {}, targetVolume?: number) => {\n\t\t\t// fadeIn ??= 0.1\n\t\t\t// curveName ??= 'easeIn'\n\t\t\tfadeIn ??= 0.03\n\t\t\tfadeOut ??= 0.03\n\t\t\tfadeScrub ??= 3\n\t\t\tfadeStop ??= 3\n\t\t\tif (!isFinite(targetVolume))\n\t\t\t\ttargetVolume = 1\n\n\t\t\tlet el: HTMLAudioElement\n\t\t\tif (audioElements.length) {\n\t\t\t\tel = audioElements.shift()\n\t\t\t\tlet i = 0\n\t\t\t\twhile (el.ended && i < audioElements.length) {\n\t\t\t\t\ti += 1\n\t\t\t\t\taudioElements.push(el)\n\t\t\t\t\tel = audioElements.shift()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tel = new Audio()\n\t\t\t\tel.autoplay = false\n\t\t\t\tel.crossOrigin = 'anonymous'\n\t\t\t\tsourceNodes.set(el, config.audioContext.createMediaElementSource(el))\n\t\t\t}\n\t\t\tconst volume = createVolumeEffect()\n\n\t\t\tlet isAlive = true\n\t\t\tconst onPlay = createEvent()\n\t\t\tconst onDispose = createEvent()\n\t\t\tlet fadeOutHandler: any\n\n\t\t\tconst clearFadeoutHandler = () =>\n\t\t\t\tfadeOutHandler && clearStrictTimeout(fadeOutHandler)\n\n\t\t\tconst audioSource = createAsyncAudioSource({\n\t\t\t\tisAlive,\n\t\t\t\tonPlay,\n\t\t\t\tonDispose,\n\t\t\t\tplay: async (currentTime = 0) => {\n\t\t\t\t\tconst blob = await blobDatabase.getBlob(src)\n\t\t\t\t\tel.src = URL.createObjectURL(blob)\n\t\t\t\t\tel.currentTime = currentTime\n\t\t\t\t\tvolume.value = 0\n\t\t\t\t\tel.addEventListener('ended', handleEnded)\n\t\t\t\t\tawait el.play()\n\t\t\t\t\tonPlay.invoke()\n\t\t\t\t\tfadeOutHandler = setStrictTimeout(async () =>\n\t\t\t\t\t\tawait volume.fadeToValue(0, fadeOut, 'easeIn')\n\t\t\t\t\t, (el.duration - fadeOut) * 1000)\n\t\t\t\t\tif (currentTime)\n\t\t\t\t\t\tawait volume.fadeToValue(targetVolume, fadeScrub, 'easeIn')\n\t\t\t\t\telse\n\t\t\t\t\t\tawait volume.fadeToValue(targetVolume, fadeIn, 'easeIn')\n\t\t\t\t},\n\t\t\t\tstop: async () => {\n\t\t\t\t\tif (!isAlive) {\n\t\t\t\t\t\t// Break the recursive chain between `sampleInstance` and `audioSource`.\n\t\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\t\taudioSource.stop(): Already dead! Cannot stop when dead! This is probably a bug.\n\t\t\t\t\t\t\t\tel.src: ${el.src}\n\t\t\t\t\t\t\t\tsrc: ${src}\n\t\t\t\t\t\t`)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\taudioSource.stop():\n\t\t\t\t\t\t\tfadeStop: ${fadeStop}\n\t\t\t\t\t\t\tel.src: ${el.src}\n\t\t\t\t\t\t\tsrc: ${src}\n\t\t\t\t\t`)\n\t\t\t\t\tclearFadeoutHandler()\n\t\t\t\t\tawait volume.fadeToValue(0, fadeStop)\n\t\t\t\t\tawait dispose()\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tconst dispose = async () => {\n\t\t\t\tif (!isAlive) {\n\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\taudioSource.dispose(): Already dead! Can only dispose once!\n\t\t\t\t\t\t\tel.src: ${el.src}\n\t\t\t\t\t\t\tsrc: ${src}\n\t\t\t\t\t`)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlogger.debug(source`\n\t\t\t\t\taudioSource.dispose():\n\t\t\t\t\t\tel.src: ${el.src}\n\t\t\t\t\t\tsrc: ${src}\n\t\t\t\t`)\n\t\t\t\tisAlive = false\n\t\t\t\tclearFadeoutHandler() // No-op if stop() called already\n\t\t\t\tawait wait(1000)//wait before disconnect, required for delay effects\n\t\t\t\tvolume.disconnectAll()\n\t\t\t\tsourceNodes.get(el).disconnect()\n\t\t\t\tel.currentTime = 0\n\t\t\t\tel.pause()\n\t\t\t\tURL.revokeObjectURL(el.src)\n\t\t\t\tel.removeEventListener('ended', handleEnded)\n\t\t\t\taudioElements.push(el)\n\t\t\t\tonDispose.invoke()\n\t\t\t}\n\n\t\t\tconst handleEnded = () => {\n\t\t\t\tif (!isAlive) {\n\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\taudioSource.handleEnded(): Already dead! Can only handle ended once!\n\t\t\t\t\t\t\tel.src: ${el.src}\n\t\t\t\t\t\t\tsrc: ${src}\n\t\t\t\t\t`)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tdispose()\n\t\t\t}\n\n\t\t\tconst init = async () => {\n\t\t\t\tsourceNodes.get(el).connect(volume.input)\n\t\t\t\tvolume.connect(output)\n\n\t\t\t\taudioSource.handleReady()\n\t\t\t}\n\t\t\tinit()\n\n\t\t\treturn audioSource\n\t\t}\n\t}\n\treturn instantiator\n}\n","\n\n\ntype RecordKey = string | number | symbol\n\nexport const createSimpleRecord = <T1 extends RecordKey, T2>(createFunc: (key: T1) => T2) => {\n\n\tconst record: Partial<Record<T1, T2>> = {}\n\n\n\treturn {\n\t\t// record,\n\t\tgetOrUndefined: (key: T1) => record[key],\n\t\tgetOrCreate: (key: T1) => {\n\t\t\tif (!record[key])\n\t\t\t\trecord[key] = createFunc(key)\n\t\t\treturn record[key]\n\t\t}\n\t}\n}","import { iEvent, createEvent } from 'modules-core/utility'\nimport { createSimpleRecord } from 'modules-core/utility/simpleRecord'\nimport config from 'modules-core/config'\nimport log from 'modules-core/log'\nimport syrinscape from 'app/common/syrinscape'\n\nconst logger = log.getLogger('postMessageSystem')\n\nexport interface iMessage {\n\tmessage: string\n\tparams?: any\n\ttoken?: string\n}\n\nexport const createPostMessageSystem = () => {\n\tlogger.info(\"createPostMessageSystem()\")\n\tconst onMessage = createSimpleRecord<string, iEvent<iMessage>>(createEvent)\n\tconst onAnyMessage = createEvent<iMessage>()\n\twindow.addEventListener('message', event => {\n\t\tlet { message, params, token } = event.data as iMessage\n\t\tif (token !== config.postMessageToken) {\n\t\t\treturn\n\t\t}\n\t\tlet msg = { message, params }\n\t\tonAnyMessage.invoke(msg)\n\t\tonMessage.getOrUndefined(msg.message)?.invoke(msg)\n\t})\n\n\tconst postMessageSystem = {\n\t\tonMessage: (message: string) => onMessage.getOrCreate(message),\n\t\tonAnyMessage,\n\t\tsendMessage: (message: string, params?: any) => {\n\t\t\tif (!config.postMessageWindow) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\t// params = JSON.parse(JSON.stringify(params))\n\t\t\tlet msg = { message, params, token: config.postMessageToken }\n\t\t\tconfig.postMessageWindow.postMessage(msg, '*')\n\t\t}\n\t}\n\n\tpostMessageSystem.onMessage('syrinscape.setToken').addListener(\n\t\t(msg: iMessage) => { config.token = msg.params.token }\n\t)\n\n\treturn postMessageSystem\n}\n\nexport type iPostMessageSystem = ReturnType<typeof createPostMessageSystem>\n\nsyrinscape._r.postMessageSystem ??= createPostMessageSystem()\n\nexport const postMessageSystem = syrinscape._r.postMessageSystem\nexport default postMessageSystem\n","import { iMessage, postMessageSystem } from \"modules-core/postMessageSystem\"\nimport log from \"modules-core/log\"\nimport syrinscape from \"app/common/syrinscape\"\n\nconst logger = log.getLogger('eventSystem')\n\nclass SyrinscapeEvent {\n\teventName: string\n\tlisteners: (EventListenerOrEventListenerObject)[]\n\n\tconstructor(name: string, listener?: EventListenerOrEventListenerObject) {\n\t\tthis.listeners = []\n\t\tif (listener) {\n\t\t\tthis.listeners.push(listener)\n\t\t}\n\t\tthis.eventName = `syrinscape.${name}`\n\t}\n\n\taddListener(listener: EventListenerOrEventListenerObject) {\n\t\tthis.listeners.push(listener)\n\t\tdocument.addEventListener(this.eventName, listener)\n\t\t// Return unbind function.\n\t\treturn () => {\n\t\t\tdocument.removeEventListener(this.eventName, listener)\n\t\t}\n\t}\n\n\tdelete() {\n\t\tthis.listeners.forEach((listener) => {\n\t\t\tdocument.removeEventListener(this.eventName, listener)\n\t\t})\n\t\tdelete events[this.eventName]\n\t}\n\n\tdispatch(detail?: any) {\n\t\tconst event = new CustomEvent(this.eventName, {\n\t\t\tdetail: detail ?? null,\n\t\t})\n\t\tdocument.dispatchEvent(event)\n\t\tpostMessageSystem.sendMessage('syrinscape.dispatchEvent', {\n\t\t\teventName: this.eventName,\n\t\t\teventDetail: detail,\n\t\t})\n\t}\n}\n\ninterface SyrinscapeEvents {\n\t[key: string]: SyrinscapeEvent\n}\n\n// Add events to global syrinscape object and export for other modules.\nsyrinscape.events ??= {} as SyrinscapeEvents\nexport const events: SyrinscapeEvents = syrinscape.events\n\nconst createEventSystem = () => {\n\tlogger.info(\"createEventSystem()\")\n\n\tpostMessageSystem.onMessage('syrinscape.dispatchEvent').addListener(\n\t\t(msg: iMessage) => {\n\t\t\tconst event = new CustomEvent(msg.params.eventName, {\n\t\t\t\tdetail: msg.params.eventDetail || null,\n\t\t\t})\n\t\t\tdocument.dispatchEvent(event)\n\t\t}\n\t)\n\n\tlet getOrCreate = (eventName: string) => {\n\t\tlet event = events[eventName]\n\t\tif (typeof event === 'undefined') {\n\t\t\tevents[eventName] = new SyrinscapeEvent(eventName)\n\t\t}\n\t\treturn events[eventName]\n\t}\n\n\treturn {\n\t\tadd: (eventName: string, listener?: EventListenerOrEventListenerObject) => {\n\t\t\tconst event = getOrCreate(eventName)\n\t\t\tif (listener !== undefined) {\n\t\t\t\treturn event.addListener(listener)\n\t\t\t}\n\t\t\treturn () => {}\n\t\t},\n\n\t\tdelete: (eventName: string) => {\n\t\t\tif (!events[eventName]) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tevents[eventName].delete()\n\t\t},\n\n\t\tdispatch: (eventName: string, detail?: any) => {\n\t\t\tgetOrCreate(eventName).dispatch(detail)\n\t\t},\n\t}\n}\n\nexport type EventSystem = ReturnType<typeof createEventSystem>\n\nsyrinscape._r.eventSystem ??= createEventSystem()\n\nexport const eventSystem = syrinscape._r.eventSystem\nexport default eventSystem\n\n// Register events. Usually this happens in the module where the event is dispatched or\n// handled, but we need to register some here to avoid circular imports.\neventSystem.add(\"updateConfig\")\n","import { AudioEffect, createAudioEffectSystem } from 'modules-core/audioEffectSystem'\nimport { iUrlSystem, createUrlSystem } from 'modules-core/urlSystem'\nimport { FadeOptions } from './types'\nimport { createBlobSourceInstantiator } from './blobSourceInstantiator'\nimport { createEvent } from 'modules-core/utility'\nimport { eventSystem } from 'modules-core/eventSystem'\nimport { config, maxVolume, minVolume } from 'modules-core/config'\nimport log from 'modules-core/log'\n\n// Register events.\neventSystem.add('setGlobalVolume')\neventSystem.add('setLocalVolume')\n\nconst logger = log.getLogger('audioSystem')\n\ninterface Args {\n\turlSystem?: iUrlSystem\n}\nexport function createAudioSystem({\n\turlSystem,\n}: Args = {}) {\n\n\turlSystem = urlSystem || createUrlSystem()\n\n\tconst effectSystem = createAudioEffectSystem()\n\tconst sourceInstantiator = createBlobSourceInstantiator({ effectSystem })\n\n\tconst audioSystem = {\n\t\teffectSystem,\n\t\teffect: effectSystem.effect,\n\t\tinit: async (useDefaultEffectFile = true) => {\n\t\t\tawait effectSystem.init(useDefaultEffectFile)\n\t\t},\n\t\tsetGlobalVolume: (value: number) => {\n\t\t\tvalue = Number(value)\n\t\t\tif (Number.isNaN(value) || value < minVolume || value > maxVolume) {\n\t\t\t\tthrow Error(`Invalid localVolume: '${value}'`)\n\t\t\t}\n\t\t\tlogger.info(`Set global volume: ${value}`)\n\t\t\teffectSystem.globalVolume.fadeToValue(value)\n\t\t\t// Dispatch event so interfaces can update their volume controls.\n\t\t\teventSystem.dispatch('setGlobalVolume', value)\n\t\t},\n\t\tsetLocalVolume: (value: number) => {\n\t\t\tvalue = Number(value)\n\t\t\tif (Number.isNaN(value) || value < minVolume || value > maxVolume) {\n\t\t\t\tthrow Error(`Invalid localVolume: '${value}'`)\n\t\t\t}\n\t\t\tlogger.info(`Set local volume: ${value}`)\n\t\t\tconfig.localVolume = value\n\t\t\teffectSystem.localVolume.fadeToValue(value)\n\t\t\t// Dispatch event so interfaces can update their volume controls.\n\t\t\teventSystem.dispatch('setLocalVolume', value)\n\t\t},\n\t\tcreateAudioSource: (src: string, output?: AudioEffect.HasInput, fadeOptions?: FadeOptions, targetVolume?: number) => {\n\t\t\tsrc = urlSystem.replaceLocalDomainAndPort(src)\n\t\t\tconst source = sourceInstantiator.createAudioSource(src, output, fadeOptions, targetVolume)\n\t\t\treturn source\n\t\t},\n\t\ttoggleMute() {\n\t\t\tif (config.localVolume === 0) {\n\t\t\t\t// Muted. Restore last local volume.\n\t\t\t\tthis.setLocalVolume(config.lastLocalVolume)\n\t\t\t} else {\n\t\t\t\t// Not muted. Set last local volume (to restore on unmute) and mute.\n\t\t\t\tconfig.lastLocalVolume = config.localVolume\n\t\t\t\tthis.setLocalVolume(0)\n\t\t\t}\n\t\t},\n\t}\n\treturn audioSystem\n}\n\nexport type iAudioSystem = ReturnType<typeof createAudioSystem>\n","\nexport const throwNoAuthError = () => { throw new NotYetAuthorizedError() }\n\n\nexport class AuthenticationError extends Error {\n\tconstructor(message = '') {\n\t\tsuper(message)\n\t\tthis.name = 'AuthenticationError'\n\t}\n}\n\nexport class MissingParameterError extends Error {\n\tconstructor(message = '') {\n\t\tsuper(message)\n\t\tthis.name = 'MissingParameterError'\n\t}\n}\n\nexport class NotYetAuthorizedError extends Error {\n\tconstructor(message = '') {\n\t\tsuper(message)\n\t\tthis.message = 'Auth token has not been set, please authorize before making requests'\n\t\tthis.name = 'NotYetAuthorizedError'\n\t}\n}\n\nexport class StatusError extends Error {\n\tconstructor(status: number) {\n\t\tsuper()\n\t\tthis.name = 'StatusError'\n\t\tthis.message = `request returned a ${status} status`\n\t}\n}\nexport class UnexpectedDataError extends Error {\n\tconstructor(message = '') {\n\t\tsuper(message)\n\t\tthis.name = 'UnexpectedDataError'\n\t}\n}\n\n\nexport function checkStatus(response: Response) {\n\t// if (response.status !== 200)\n\tif (response.status >= 400)\n\t\tthrow new StatusError(response.status)\n\treturn response\n}","import { SocketSystem } from 'modules-core/socket'\nimport log from 'modules-core/log'\nimport { iAuthSystem } from 'modules-core/authSystem'\nimport { commaLists, oneLine } from 'common-tags'\nimport { iMessage, postMessageSystem } from 'modules-core/postMessageSystem'\n\nconst logger = log.getLogger('controlSystem')\n\ninterface Args{\n\tauthSystem: iAuthSystem\n\tsocketSystem: SocketSystem\n}\n\nexport const ControlSystem = ({ authSystem, socketSystem }: Args) => {\n\n\tconst sendFull = () => {\n\t\tsocketSystem.send(\n\t\t\t{ message: 'send_full' }\n\t\t)\n\t}\n\n\tconst setGlobalVolume = (volume: number) => {\n\t\tsocketSystem.send(\n\t\t\t{ message: 'set_global_volume', params: { volume: volume } }\n\t\t)\n\t}\n\n\tconst setOneshotVolume = (volume: number) => {\n\t\tsocketSystem.send(\n\t\t\t{ message: 'set_oneshot_volume', params: { volume: volume } }\n\t\t)\n\t}\n\n\tconst startElements = async (pks: (number | string)[]) => {\n\t\t// TODO: One request for multiple PKs? If we ever call this with multiple PKs.\n\t\tif (pks.length > 1) {\n\t\t\tlogger.warn(oneLine`\n\t\t\t\tstartElements(): Starting ${pks.length} elements. This makes a new request for\n\t\t\t\teach element. Consider refactoring.\n\t\t\t`)\n\t\t}\n\t\treturn await Promise.all(pks.map((pk) => {\n\t\t\tauthSystem.authorizedFetchPath(`online/frontend-api/elements/${pk}/play/`)\n\t\t}))\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'start_elements', params: { pks: pks } }\n\t\t// )\n\t}\n\n\tconst startMood = async (pk: number | string) => {\n\t\treturn await authSystem.authorizedFetchPath(`online/frontend-api/moods/${pk}/play/`)\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'start_mood', params: { pk: pk } }\n\t\t// )\n\t}\n\n\tconst startSamples = async (pks: (number | string)[]) => {\n\t\t// TODO: One request for multiple PKs? If we ever call this with multiple PKs.\n\t\tif (pks.length > 1) {\n\t\t\tlogger.warn(oneLine`\n\t\t\t\tstartSamples(): Starting ${pks.length} samples. This makes a new request for\n\t\t\t\teach sample. Consider refactoring.\n\t\t\t`)\n\t\t}\n\t\treturn await Promise.all(pks.map((pk) => {\n\t\t\tauthSystem.authorizedFetchPath(`online/frontend-api/samples/${pk}/play/`)\n\t\t}))\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'start_samples', params: { pks: pks } }\n\t\t// )\n\t}\n\n\tconst startPlaylistEntries = async (pks: (number | string)[]) => {\n\t\t// TODO: One request for multiple PKs? If we ever call this with multiple PKs.\n\t\tif (pks.length > 1) {\n\t\t\tlogger.warn(oneLine`\n\t\t\t\tstartPlaylistEntries(): Starting ${pks.length} playlist entries. This makes a new request for\n\t\t\t\teach element. Consider refactoring.\n\t\t\t`)\n\t\t}\n\t\treturn await Promise.all(pks.map((pk) => {\n\t\t\t\tauthSystem.authorizedFetchPath(`online/frontend-api/playlists/${pk}/play/`)\n\t\t}))\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'start_playlist_entries', params: { pks: pks } }\n\t\t// )\n\t}\n\n\tconst stopAll = async () => {\n\t\treturn await authSystem.authorizedFetchPath('online/frontend-api/stop-all/')\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'stop_all' }\n\t\t// )\n\t}\n\n\tconst stopElements = async (pks: (number | string)[]) => {\n\t\t// TODO: One request for multiple PKs? If we ever call this with multiple PKs.\n\t\tif (pks.length > 1) {\n\t\t\tlogger.warn(oneLine`\n\t\t\t\tstopElements(): Stopping ${pks.length} elements. This makes a new request for\n\t\t\t\teach element. Consider refactoring.\n\t\t\t`)\n\t\t}\n\t\treturn await Promise.all(pks.map((pk) => {\n\t\t\tauthSystem.authorizedFetchPath(`online/frontend-api/elements/${pk}/stop/`)\n\t\t}))\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'stop_elements', params: { pks: pks } }\n\t\t// )\n\t}\n\n\tconst stopMood = async (pk: number | string) => {\n\t\treturn await authSystem.authorizedFetchPath(`online/frontend-api/moods/${pk}/stop/`)\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'stop_mood', params: { pk: pk } }\n\t\t// )\n\t}\n\n\tconst stopPlaylistEntries = async (pks: (number | string)[]) => {\n\t\t// TODO: One request for multiple PKs? If we ever call this with multiple PKs.\n\t\tif (pks.length > 1) {\n\t\t\tlogger.warn(oneLine`\n\t\t\t\tstopPlaylistEntries(): Stopping ${pks.length} elements. This makes a new request\n\t\t\t\tfor each playlist entries. Consider refactoring.\n\t\t\t`)\n\t\t}\n\t\treturn await Promise.all(pks.map((pk) => {\n\t\t\tauthSystem.authorizedFetchPath(`online/frontend-api/playlists/${pk}/stop/`)\n\t\t}))\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'stop_playlist_entries', params: { pks: pks } }\n\t\t// )\n\t}\n\n\tconst stopSamples = async (pks: (number | string)[]) => {\n\t\t// TODO: One request for multiple PKs? If we ever call this with multiple PKs.\n\t\tif (pks.length > 1) {\n\t\t\tlogger.warn(oneLine`\n\t\t\t\tstopSamples(): Stopping ${pks.length} samples. This makes a new request for\n\t\t\t\teach sample. Consider refactoring.\n\t\t\t`)\n\t\t}\n\t\treturn await Promise.all(pks.map((pk) => {\n\t\t\tauthSystem.authorizedFetchPath(`online/frontend-api/samples/${pk}/stop/`)\n\t\t}))\n\t\t// Websocket implementation (missing authorization checks), in case we refactor.\n\t\t// socketSystem.send(\n\t\t// \t{ message: 'stop_samples', params: { pks: pks } }\n\t\t// )\n\t}\n\n\tpostMessageSystem.onMessage('syrinscape.sendFull').addListener(\n\t\t(msg: iMessage) => sendFull()\n\t)\n\tpostMessageSystem.onMessage('syrinscape.setGlobalVolume').addListener(\n\t\t(msg: iMessage) => setGlobalVolume(msg.params.volume)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.setOneshotVolume').addListener(\n\t\t(msg: iMessage) => setOneshotVolume(msg.params.number)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.startElements').addListener(\n\t\t(msg: iMessage) => startElements(msg.params.pks)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.startMood').addListener(\n\t\t(msg: iMessage) => startMood(msg.params.pk)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.startPlaylistEntries').addListener(\n\t\t(msg: iMessage) => startPlaylistEntries(msg.params.pks)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.startSamples').addListener(\n\t\t(msg: iMessage) => startSamples(msg.params.pks)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.stopAll').addListener(\n\t\t(msg: iMessage) => stopAll()\n\t)\n\tpostMessageSystem.onMessage('syrinscape.stopElements').addListener(\n\t\t(msg: iMessage) => stopElements(msg.params.pks)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.stopMood').addListener(\n\t\t(msg: iMessage) => stopMood(msg.params.pk)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.stopPlaylistEntries').addListener(\n\t\t(msg: iMessage) => stopPlaylistEntries(msg.params.pks)\n\t)\n\tpostMessageSystem.onMessage('syrinscape.stopSamples').addListener(\n\t\t(msg: iMessage) => stopSamples(msg.params.pks)\n\t)\n\n\treturn {\n\t\tsendFull,\n\t\tsetGlobalVolume,\n\t\tsetOneshotVolume,\n\t\tstartElements,\n\t\tstartMood,\n\t\tstartPlaylistEntries,\n\t\tstartSamples,\n\t\tstopAll,\n\t\tstopElements,\n\t\tstopMood,\n\t\tstopPlaylistEntries,\n\t\tstopSamples,\n\t}\n}\n\nexport type ControlSystem = ReturnType<typeof ControlSystem>\n","import { AudioEffect } from 'modules-core/audioEffectSystem/types'\nimport { Element } from 'modules-core/elementSystem/types'\nimport { Sample } from 'modules-core/sampleSystem/types'\nimport { UnitySocket } from 'modules-core/socket/types'\n\n\nexport const deepClone = <T>(val: T) =>\n\tJSON.parse(JSON.stringify(val)) as T\n\nexport const parseFloatOr = (fallback: number, val?: string) =>\n\tparseFloat(val) || fallback\nexport const parseFloatOrZero = (val?: string) =>\n\tparseFloatOr(0, val)\nexport const parseFloatOrOne = (val?: string) =>\n\tparseFloatOr(1, val)\n\nexport const parseFloatSecondsToMillis = (str?: string) =>\n\tparseFloatOrZero(str) * 1000\n\nexport const parseElementType = (type?: UnitySocket.ElementType) => type || 'sfx'\n\nconst parseBoolOr = (val: boolean | undefined, fallback: boolean) =>\n\tval === true ? true : val === false ? false : fallback\n\nexport const parseRepeat = (params: UnitySocket.Element) =>\n\tparams.type === 'oneshot'\n\t\t? false\n\t\t: params.playlist_order === 'random'\n\t\t\t? true\n\t\t\t: params.repeat_playlist === false\n\t\t\t\t? false\n\t\t\t\t: true\n\nexport const parseLoop = (sampleDelayMin: number, sampleDelayMax: number) =>\n\tsampleDelayMin < 0\n\t&& sampleDelayMax < 0\n\t&& Math.abs(sampleDelayMax - sampleDelayMin) < 0.001\n\nexport const socketElementToParams = (params: UnitySocket.Element): Element.Params => ({\n\ttitle: params.name,\n\tplaylistParams: socketElementToPlaylistParams(params),\n\ttype: parseElementType(params.type),\n\tpresetName: params.reverb_preset as AudioEffect.Preset,\n\telementId: cleanElementId(params.id),\n\tspatialParams: socketElementToSpatialParams(params),\n})\n\nexport const socketElementToPlaylistParams = (params: UnitySocket.Element): Element.PlaylistParams => {\n\tconst sampleDelayMin = parseFloatSecondsToMillis(params.min_wait)\n\tconst sampleDelayMax = parseFloatSecondsToMillis(params.max_wait)\n\tconst order = params.playlist_order as Element.PlaylistOrder\n\tconst loop = parseLoop(sampleDelayMin, sampleDelayMax)\n\tconst repeat = loop || parseRepeat(params)\n\treturn {\n\t\torder,\n\t\tloop,\n\t\trepeat,\n\t\tsampleDelayMin,\n\t\tsampleDelayMax,\n\t\tsampleDelayPos: params.allow_samples_to_overlap ? 'start' : 'end',\n\t\telementDelayMin: parseFloatSecondsToMillis(params.min_start_delay),\n\t\telementDelayMax: parseFloatSecondsToMillis(params.max_start_delay),\n\t\tsampleParamsList: params.playlist ? params.playlist.map(socketSampleToSampleParams) : []\n\t}\n}\n\nexport const socketElementToSpatialParams = (params: UnitySocket.Element): Element.SpatialParams | undefined => {\n\tparams.position_samples ??= true\n\tif (!params.position_samples)\n\t\treturn\n\treturn {\n\t\tminDist: parseFloatOrZero(params.min_distance),\n\t\tmaxDist: parseFloatOrZero(params.max_distance),\n\t\tminAngle: parseFloatOrZero(params.min_angle),\n\t\tmaxAngle: parseFloatOrZero(params.max_angle),\n\t\tspeed: parseFloatOrZero(params.speed)\n\t}\n}\n\nexport const socketSampleToSampleParams = (params: UnitySocket.Sample): Sample.Params => ({\n\tspatializable: parseBoolOr(params.is_3d, true),\n\tname: params.name,\n\tduration: parseFloatSecondsToMillis(params.len),\n\turl: params.url,\n\tsampleId: cleanSampleId(params.s_id || params.id),\n\tminGain: parseFloatOrOne(params.min_gain),\n\tmaxGain: parseFloatOrOne(params.max_gain)\n})\n\n\nexport const socketMoodElementToParams = (moodElement: UnitySocket.Mood['moodelements'][number]): Element.Params => {\n\tconst params = socketElementToParams(moodElement.element)\n\tparams.playlistParams.useElementDelay = true\n\treturn params\n}\n\nexport const cleanElementId = (id:string)=>\n\tid && Number(id.replace('e_',''))\nexport const cleanSampleId = (id:string)=>\n\tid && Number(id.replace('s_',''))","import { deepClone } from 'modules-core/utility/ParseExt'\nimport { Element } from './types'\nimport { Sample } from 'modules-core/sampleSystem/types'\n\nexport const filterByElementId = (map: Element.MutableMap, elementId: number) =>\n\t[...map.getRaw()]\n\t\t.filter(([key, element]) => element.elementId === elementId)\n\nexport const filterBySampleId = (map: Sample.MutableMap, sampleId: number) =>\n\t[...map.getRaw()]\n\t\t.filter(([key, sample]) => sample.sampleId === sampleId)\n\nexport const stripElementInstanceToData = ({\n\ttitle, elementId, type, presetName, playlistParams, spatialParams, uuid, playlistData\n}: Element.Instance): Element.Data =>\n\tdeepClone({ title, elementId, type, presetName, playlistParams, spatialParams, uuid, playlistData })\n\n\n\nexport const stripElementDataToParams = ({ uuid, playlistData, ...params }: Element.Data): Element.Params =>\n\tdeepClone(params)\n","const __WEBPACK_NAMESPACE_OBJECT__ = __dumbStubs;","import { FadeOptions, iAudioSystem } from 'modules-core/audioSystem'\nimport { iUuidSystem } from 'modules-core/uuidSystem/uuidSystem'\nimport { iSampleSystem } from 'modules-core/sampleSystem/sampleSystem'\nimport { Element, stripElementDataToParams } from 'modules-core/elementSystem'\nimport { iAuthSystem } from 'modules-core/authSystem'\nimport { createAnalyserEffect, createVolumeEffect } from 'modules-core/audioEffectSystem'\nimport { elementParamsToPlaylistData } from 'modules-core/elementSystem/smart/smartFunctions'\nimport { Sample } from 'modules-core/sampleSystem'\nimport { createPlaylistSystem } from './playlistSystem'\nimport { iEvent } from 'modules-core/utility'\nimport { OneshotSystem } from './oneshotSystem'\nimport { ElementVolumeSystem } from './elementVolumeSystem'\nimport { deepClone } from 'modules-core/utility/ParseExt'\nimport { ParseExt } from 'modules-core/utility'\nimport log from 'modules-core/log'\nimport getServerTime from 'modules-core/utility/serverTime'\nimport { MathExt } from 'modules-core/utility'\nimport { source } from 'common-tags'\nimport { eventSystem } from 'modules-core/eventSystem'\nimport { clearStrictTimeout, setStrictTimeout } from 'modules-core/utility/strictTimeout'\n// Avoid circular import (elementSystem > elementSpawnSystem > player > elementSystem)\n// by using the global `syrinscape.player`, instead.\n// import player from 'modules-core/player'\nimport syrinscape from 'app/common/syrinscape'\n\n// Register events.\neventSystem.add('startElement')\n\nconst logger = log.getLogger('elementSpawnSystem')\n\nlet spawnCount = 0\nlet averageSpawnDelay = 0\nlet maxSpawnDelay = 0\n\ninterface iArgs {\n\tauthSystem: iAuthSystem\n\taudioSystem: iAudioSystem\n\tsampleSystem: iSampleSystem\n\tuuidSystem: iUuidSystem\n\telementMap: Element.MutableMap\n\tplaylistSystem: Element.PlaylistSystem\n\toneshotSystem: OneshotSystem\n\telementVolumeSystem: ElementVolumeSystem\n}\n\n\n//@ts-ignore injected by webpack\nconst isDumbMode = typeof WEBPACK_DUMB_MODE === 'undefined'\n\t? false\n\t//@ts-ignore injected by webpack\n\t: WEBPACK_DUMB_MODE === 'true'\n\nexport const createElementSpawnSystem = ({\n\tauthSystem, audioSystem, sampleSystem,\n\tuuidSystem, elementMap, playlistSystem,\n\toneshotSystem, elementVolumeSystem }: iArgs) => {\n\n\tconst { effectSystem } = audioSystem\n\n\tconst elementParamsToDataDumbMode = async (params: Element.Params) => {\n\t\tconst response = await authSystem\n\t\t\t.authorizedFetchPath('online/frontend-api/element-params-to-data/', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tbody: JSON.stringify(params)\n\t\t\t})\n\t\tif (response.status !== 200)\n\t\t\tthrow new Error(`bad response: ${response.status}`)\n\t\treturn await response.json() as Element.Data\n\t}\n\n\tconst elementParamsToDataSmartMode = (params: Element.Params) => ({\n\t\t...params,\n\t\tuuid: uuidSystem.nextId(),\n\t\tplaylistData: elementParamsToPlaylistData(params, uuidSystem),\n\t})\n\n\tconst handleSampleFinished = (element: Element.Instance, sampleUUID: string) => {\n\t\telement.sampleInstanceLookup.delete(sampleUUID)\n\t\tif (\n\t\t\telement.alive &&\n\t\t\telement.sampleInstanceLookup.size === 0 &&\n\t\t\telement.sampleFutureDataLookup.size === 0\n\t\t) {\n\t\t\telement?.dispose();\n\t\t}\n\t}\n\n\tconst handleRepeat = (element: Element.Instance) => {\n\t\tif (!element.alive)\n\t\t\treturn\n\t\tconst params = system.dataToRepeatParams(element)\n\t\tsystem.spawnElementFromParams(params)\n\t}\n\n\tlet analyseElements: boolean = false\n\n\tconst system = {\n\t\tanalyseElements,\n\t\tinit: ({ analyse = false } = {}) => {\n\t\t\tlogger.info(`Analyse elements: ${analyse}`)\n\t\t\tanalyseElements = analyse\n\t\t},\n\t\tdataToRepeatParams: (elementData: Element.Data): Element.Params => {\n\t\t\tconst lastItem = elementData.playlistData.sampleDataList[elementData.playlistData.sampleDataList.length - 1]\n\t\t\tlet nextStart = lastItem.startTime\n\t\t\tif (elementData.playlistParams.sampleDelayPos === 'end')\n\t\t\t\tnextStart += lastItem.duration\n\t\t\tconst newElementParams = stripElementDataToParams(elementData)\n\t\t\tnewElementParams.playlistParams.firstSampleDelay = true\n\t\t\tnewElementParams.playlistParams.useElementDelay = false\n\n\t\t\tnewElementParams.playedSamples = elementData.playlistData.sampleDataList\n\t\t\t\t.map(sample => sample.sampleId)\n\t\t\tnewElementParams.startTime = nextStart\n\t\t\treturn newElementParams\n\t\t},\n\t\tparamsToData: async (params: Element.Params) => {\n\t\t\tparams = deepClone(params)//just to be sure, though we shouldnt need this\n\t\t\tparams.playlistParams.sampleParamsPlaylist = playlistSystem.createPlaylist(params)\n\t\t\tconst elementData: Element.Data = isDumbMode\n\t\t\t\t? await elementParamsToDataDumbMode(params)\n\t\t\t\t: elementParamsToDataSmartMode(params)\n\n\t\t\tlet { startTime, playlistData } = elementData\n\t\t\tif (startTime !== undefined) {\n\t\t\t\tconst lastItem = playlistData.sampleDataList[playlistData.sampleDataList.length - 1]\n\t\t\t\tconst relativeEndTime = lastItem.startTime + lastItem.duration\n\t\t\t\tconst relativeStartTime = getServerTime() - startTime\n\t\t\t\tconst delta = relativeEndTime - relativeStartTime\n\t\t\t\tif (delta < 0) {\n\t\t\t\t\tconsole.warn('next start time cannot be earlier than playlist duration. consider reducing delay between samples')\n\t\t\t\t\tstartTime = undefined\n\t\t\t\t}\n\t\t\t}\n\t\t\tstartTime ??= getServerTime()\n\t\t\tplaylistData.sampleDataList\n\t\t\t\t.forEach(item => item.startTime += startTime)\n\t\t\treturn elementData\n\t\t},\n\t\tspawnElementFromParams: async (params: Element.Params) => {\n\t\t\tconst elementData = await system.paramsToData(params)\n\t\t\treturn system.spawnElementFromData(elementData)\n\t\t},\n\t\tspawnElementFromData: (data: Element.Data, full: boolean = false) => {\n\t\t\tconst now = getServerTime()\n\n\t\t\tconst element = {\n\t\t\t\t...data,\n\t\t\t\talive: true,\n\t\t\t} as Partial<Element.Instance> as Element.Instance\n\n\t\t\t// Before we create the element, check if there are any existing elements, because\n\t\t\t// we will emit a `startElement` event one time only for the very first element.\n\t\t\tlet emitStartElement = syrinscape.player.elementSystem\n\t\t\t\t.getElementsWithElementId(element.elementId).length === 0\n\t\t\t\t&& data.playlistData.sampleDataList.some(sample => !sample.manuallyTriggered)\n\n\t\t\tif (analyseElements) {\n\t\t\t\telement.analyser = createAnalyserEffect()\n\t\t\t}\n\n\t\t\tlet preset = effectSystem.preset(data.presetName)\n\t\t\tif (preset === undefined) {\n\t\t\t\tlogger.warn(source`\n\t\t\t\t\tUnknown effect spawning element, fallback to 'Off'.\n\t\t\t\t\teffect:\n\t\t\t\t\t\tname: ${data.presetName}\n\t\t\t\t\telement:\n\t\t\t\t\t\ttitle: ${element.title}\n\t\t\t\t\t\tid: ${element.elementId}\n\t\t\t\t\t\tuuid: ${element.uuid}\n\t\t\t\t`)\n\t\t\t\tpreset = effectSystem.preset('Off')\n\t\t\t}\n\n\t\t\tconst wetVolume = createVolumeEffect()\n\t\t\tconst dryVolume = createVolumeEffect()\n\n\t\t\telement.setVolume = (volume) => {\n\t\t\t\twetVolume.fadeToValue(volume)\n\t\t\t\tdryVolume.fadeToValue(volume)\n\t\t\t}\n\n\t\t\tif (element.volume !== undefined)\n\t\t\t\telementVolumeSystem.setElementIdVolume(element.elementId, element.volume)\n\t\t\tif (elementVolumeSystem.elementVolumeMap.has(element.elementId)) {\n\t\t\t\tconst volume = elementVolumeSystem.elementVolumeMap.get(element.elementId)\n\t\t\t\twetVolume.value = volume\n\t\t\t\tdryVolume.value = volume\n\t\t\t}\n\n\t\t\tconst wetEffect = data.presetName === 'Off' ?\n\t\t\t\tcreateVolumeEffect()//dead end effect\n\t\t\t\t: effectSystem.effect(preset.effect)\n\t\t\tlet removeOneshotVolumeListener\n\t\t\tif (data.type === 'oneshot') {\n\t\t\t\tremoveOneshotVolumeListener = oneshotSystem.createOneshotVolume(wetVolume, dryVolume, element.analyser, wetEffect)\n\t\t\t} else {\n\t\t\t\twetVolume.connect(wetEffect)\n\t\t\t\tif (element.analyser) {\n\t\t\t\t\tdryVolume.connect(element.analyser)\n\t\t\t\t\telement.analyser.connect(effectSystem.globalVolume)\n\t\t\t\t} else {\n\t\t\t\t\tdryVolume.connect(effectSystem.globalVolume)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst fadeOptions: FadeOptions = data.crossfade\n\t\t\t\t? {\n\t\t\t\t\tfadeIn: data.crossfade,\n\t\t\t\t\tfadeOut: data.crossfade,\n\t\t\t\t} : undefined\n\n\t\t\telement.sampleInstanceLookup = new Map<string, Sample.Instance>()\n\t\t\telement.sampleFutureDataLookup = new Map<string, Sample.FutureData>()\n\t\t\tlet firstStartTime: number\n\t\t\telement.playlistData.sampleDataList.forEach((sampleData) => {\n\t\t\t\tif (!firstStartTime || sampleData.startTime < firstStartTime) {\n\t\t\t\t\tfirstStartTime = sampleData.startTime\n\t\t\t\t}\n\t\t\t\tconst spawnSample = () => {\n\t\t\t\t\t// Ignore stats for resumed samples via `send_full`. This can throw\n\t\t\t\t\t// out the average and max delay by a huge amount.\n\t\t\t\t\tif (full && sampleData.startTime < now) {\n\t\t\t\t\t\tconst scrubbed = (getServerTime() - sampleData.startTime) / 1000\n\t\t\t\t\t\tlogger.info(source`\n\t\t\t\t\t\t\tspawn sample:\n\t\t\t\t\t\t\t\tscheduled samples: ${element.sampleFutureDataLookup.size}\n\t\t\t\t\t\t\t\tscrubbed seconds: ${scrubbed}\n\t\t\t\t\t\t\tsample:\n\t\t\t\t\t\t\t\tname: ${sampleData.name}\n\t\t\t\t\t\t\t\tuuid: ${sampleData.uuid},\n\t\t\t\t\t\t\telement:\n\t\t\t\t\t\t\t\ttitle: ${element.title}\n\t\t\t\t\t\t\t\tid: ${element.elementId}\n\t\t\t\t\t\t\t\tuuid: ${element.uuid}\n\t\t\t\t\t\t`)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tspawnCount += 1\n\t\t\t\t\t\t// Ignore spawn delay for scrubbed samples.\n\t\t\t\t\t\tlet spawnDelay = (getServerTime() - sampleData.startTime) / 1000\n\t\t\t\t\t\taverageSpawnDelay = MathExt.average([spawnDelay], averageSpawnDelay, spawnCount)\n\t\t\t\t\t\tmaxSpawnDelay = Math.max(spawnDelay, maxSpawnDelay)\n\t\t\t\t\t\tlogger.info(source`\n\t\t\t\t\t\t\tspawn sample:\n\t\t\t\t\t\t\t\tscheduled samples: ${element.sampleFutureDataLookup.size}\n\t\t\t\t\t\t\t\tspawned samples: ${spawnCount}\n\t\t\t\t\t\t\t\tdelay: ${spawnDelay}\n\t\t\t\t\t\t\t\tavg delay: ${averageSpawnDelay}\n\t\t\t\t\t\t\t\tmax delay: ${maxSpawnDelay}\n\t\t\t\t\t\t\tsample:\n\t\t\t\t\t\t\t\tname: ${sampleData.name}\n\t\t\t\t\t\t\t\tuuid: ${sampleData.uuid}\n\t\t\t\t\t\t\telement:\n\t\t\t\t\t\t\t\ttitle: ${element.title}\n\t\t\t\t\t\t\t\tid: ${element.elementId}\n\t\t\t\t\t\t\t\tuuid: ${element.uuid}\n\t\t\t\t\t\t`)\n\t\t\t\t\t}\n\n\t\t\t\t\tsampleData.elementId = element.elementId\n\n\t\t\t\t\telement.sampleFutureDataLookup.delete(sampleData.uuid)\n\t\t\t\t\tconst sample = sampleSystem.spawnSampleFromData({\n\t\t\t\t\t\tfadeOptions,\n\t\t\t\t\t\tdata: sampleData,\n\t\t\t\t\t\twetOut: wetVolume,\n\t\t\t\t\t\tdryOut: dryVolume,\n\t\t\t\t\t})\n\t\t\t\t\tsample.audioSource.onPlay.addListener(() =>\n\t\t\t\t\t\tplaylistSystem.appendPlayedSamples(element.elementId, sample.sampleId))\n\t\t\t\t\tsample.onDispose.addListener(() =>\n\t\t\t\t\t\thandleSampleFinished(element, sample.uuid))\n\t\t\t\t\telement.sampleInstanceLookup.set(sample.uuid, sample)\n\t\t\t\t}\n\t\t\t\t// If sample starts more than `preloadWindow` seconds in the future, delay\n\t\t\t\t// spawning to keep the audio node count low. When starting a mood, we might\n\t\t\t\t// have data for hundreds of samples (e.g. multiple sfx elements, each with a\n\t\t\t\t// trigger delay of ~1 second). But creating audio nodes in advance to do\n\t\t\t\t// nothing until their start time is unnecessarily heavy, and might be\n\t\t\t\t// completely pointless if the element is stopped before they are started. The\n\t\t\t\t// preload window should be large enough to allow time for preloading a typical\n\t\t\t\t// number of samples of a typical size on a typical connection. In the future,\n\t\t\t\t// this window could resize dynamically per user based on their current\n\t\t\t\t// connection speed and the number and size of samples in the playlist.\n\t\t\t\tconst preloadWindow = 10  // Seconds\n\t\t\t\tconst spawnTime = sampleData.startTime - preloadWindow * 1000\n\t\t\t\tif (spawnTime > now) {\n\t\t\t\t\telement.sampleFutureDataLookup.set(sampleData.uuid, {\n\t\t\t\t\t\t...sampleData,\n\t\t\t\t\t\ttimeoutId: setStrictTimeout(\n\t\t\t\t\t\t\tspawnSample,\n\t\t\t\t\t\t\tspawnTime - now,\n\t\t\t\t\t\t\tpreloadWindow * 1000 + sampleData.duration,\n\t\t\t\t\t\t),\n\t\t\t\t\t})\n\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\tDelay spawning sample for ${(spawnTime - now) / 1000} seconds.\n\t\t\t\t\t\t\tscheduledSamples: ${element.sampleFutureDataLookup.size}\n\t\t\t\t\t\t\tspawnedSamples: ${spawnCount}\n\t\t\t\t\t\tsample:\n\t\t\t\t\t\t\tname: ${sampleData.name}\n\t\t\t\t\t\t\tuuid: ${sampleData.uuid}\n\t\t\t\t\t\telement:\n\t\t\t\t\t\t\ttitle: ${element.title}\n\t\t\t\t\t\t\tid: ${element.elementId}\n\t\t\t\t\t\t\tuuid: ${element.uuid}\n\t\t\t\t\t`)\n\t\t\t\t}\n\t\t\t\t// Otherwise, spawn immediately.\n\t\t\t\telse {\n\t\t\t\t\tspawnSample()\n\t\t\t\t}\n\t\t\t})\n\t\t\tlogger.debug(source`\n\t\t\t\tspawnElementFromData():\n\t\t\t\t\tscheduled samples: ${element.sampleFutureDataLookup.size}\n\t\t\t\t\tspawned samples: ${element.sampleInstanceLookup.size}\n\t\t\t\telement:\n\t\t\t\t\ttitle: ${data.title}\n\t\t\t\t\tid: ${data.elementId}\n\t\t\t\t\tuuid: ${data.uuid}\n\t\t\t`)\n\n\t\t\tif (element.playlistParams?.repeat) {\n\t\t\t\tconst firstSample = element.playlistData.sampleDataList[0]\n\t\t\t\telement.sampleInstanceLookup.get(firstSample.uuid).audioSource\n\t\t\t\t\t.onPlay.addListener(() => handleRepeat(element))\n\t\t\t}\n\n\t\t\telement.dispose = async () => {\n\t\t\t\tif (!element.alive) {\n\t\t\t\t\tlogger.warn(source`\n\t\t\t\t\t\telement.dispose(): Already dead! Can only dispose once!\n\t\t\t\t\t\t\ttitle: ${element.title}\n\t\t\t\t\t\t\tid: ${element.elementId}\n\t\t\t\t\t\t\tuuid: ${element.uuid}\n\t\t\t\t\t`)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlogger.debug(source`\n\t\t\t\t\telement.dispose():\n\t\t\t\t\t\ttitle: ${element.title}\n\t\t\t\t\t\tid: ${element.elementId}\n\t\t\t\t\t\tuuid: ${element.uuid}\n\t\t\t\t`)\n\t\t\t\telement.alive = false\n\t\t\t\tremoveOneshotVolumeListener?.()\n\t\t\t\telement.sampleFutureDataLookup.forEach((sampleFutureData) => {\n\t\t\t\t\tclearStrictTimeout(sampleFutureData.timeoutId)\n\t\t\t\t})\n\t\t\t\telement.sampleFutureDataLookup.clear()\n\t\t\t\tawait Promise.all([...element.sampleInstanceLookup]\n\t\t\t\t\t.map(([, sample]) => sample.dispose()))\n\t\t\t\t// If we are analysing elements, we need to defer disposal until visualisation\n\t\t\t\t// has stopped.\n\t\t\t\tconst finallyDispose = () => {\n\t\t\t\t\tif (element.analyser?.isActive) {\n\t\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\t\telement.finallyDispose(): Visualisation still active. Delay.\n\t\t\t\t\t\t\t\ttitle: ${element.title}\n\t\t\t\t\t\t\t\tid: ${element.elementId}\n\t\t\t\t\t\t\t\tuuid: ${element.uuid}\n\t\t\t\t\t\t`)\n\t\t\t\t\t\tsetTimeout(finallyDispose, 100) // Try again until analyser is inactive\n\t\t\t\t\t} else {\n\t\t\t\t\t\twetVolume.disconnectAll()\n\t\t\t\t\t\tdryVolume.disconnectAll()\n\t\t\t\t\t\telement.analyser?.disconnectAll()\n\t\t\t\t\t\telementMap.mutate(map => map.delete(data.uuid))\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfinallyDispose()\n\t\t\t}\n\n\t\t\telementMap.mutate(map => map.set(data.uuid, element))\n\n\t\t\t// Emit `startElement` event.\n\t\t\tif (emitStartElement) {\n\t\t\t\teventSystem.dispatch('startElement', {\n\t\t\t\t\telementId: element.elementId,\n\t\t\t\t\ttimeToFirstSample: Math.max(firstStartTime - now, 0),\n\t\t\t\t})\n\t\t\t}\n\n\t\t\treturn element\n\t\t},\n\t\t_elementParamsToDataSmartMode: elementParamsToDataSmartMode,\n\t\t_elementParamsToDataDumbMode: elementParamsToDataDumbMode,\n\t}\n\treturn system\n}\n\nexport type iElementSpawnSystem = ReturnType<typeof createElementSpawnSystem>\n","import { createEvent, iEvent } from './event'\n\n\n\nexport const createMutableMap = <T1, T2>(): iMutableMap<T1, T2> => {\n\tconst map = new Map<T1, T2>()\n\tconst onUpdate = createEvent<Readonly<Map<T1, T2>>>()\n\n\treturn {\n\t\tgetRaw: () => map,\n\t\tget: () => map as Readonly<Map<T1, T2>>,\n\t\tupdate: () => onUpdate.invoke(map),\n\t\tonUpdate,\n\t\tmutate: (action) => {\n\t\t\taction(map)\n\t\t\tonUpdate.invoke(map)\n\t\t},\n\t\ttryMutate: (action) => {\n\t\t\tif (action(map))\n\t\t\t\tonUpdate.invoke(map)\n\t\t},\n\t}\n}\n\n\nexport interface iMutableMap<T1, T2> {\n\tget: () => Readonly<Map<T1, T2>>\n\tgetRaw: () => Map<T1, T2>\n\tupdate: () => void\n\tonUpdate: iEvent<Readonly<Map<T1, T2>>>\n\tmutate: (action: (map: Map<T1, T2>) => any) => void\n\ttryMutate: (action: (map: Map<T1, T2>) => boolean) => void\n}\n// export type iMutableMap = ReturnType<typeof createMutableMap>","\n\n\n\ninterface iArgs {\n\tprefix?: string\n}\nexport const createUuidSystem = ({ prefix }: iArgs = {}) => {\n\tprefix = prefix || Math.random().toFixed(8)\n\tlet i = 0\n\treturn {\n\t\tnextId: () => `${prefix}-${i++}`\n\t}\n}\n\nexport type iUuidSystem = ReturnType<typeof createUuidSystem>","import { createEvent, MathExt, add, length, multiply } from 'modules-core/utility'\nimport { createSendEffect, rampToCenteredVelocityOverTime } from 'modules-core/audioEffectSystem'\nimport { createSpatialEffect } from 'modules-core/audioEffectSystem/effects/spatialEffect'\nimport { AudioEffect } from 'modules-core/audioEffectSystem/types'\nimport { FadeOptions, iAudioSystem } from 'modules-core/audioSystem'\nimport { Sample } from 'modules-core/sampleSystem/types'\nimport { createUuidSystem, iUuidSystem } from 'modules-core/uuidSystem'\nimport log from 'modules-core/log'\nimport getServerTime, { getServerTimeOffset } from 'modules-core/utility/serverTime'\nimport { source } from 'common-tags'\nimport { eventSystem } from 'modules-core/eventSystem'\nimport { clearStrictTimeout, setStrictTimeout } from 'modules-core/utility/strictTimeout'\nimport { filterBySampleId } from 'modules-core/elementSystem'\nimport config from 'modules-core/config'\nimport syrinscape from 'app/common/syrinscape'\n\nconst logger = log.getLogger('sampleSpawnSystem')\n\n// Register events.\neventSystem.add('startSample')\n\ninterface iSpawnSample {\n\twetOut?: AudioEffect.HasInput\n\tdryOut?: AudioEffect.HasInput\n}\n\ninterface iSpawnSampleFromParamsArgs extends iSpawnSample {\n\tparams: Sample.Params\n\tstartTime?: number\n}\n\ninterface iSpawnSampleFromDataArgs extends iSpawnSample {\n\tdata: Sample.Data\n\tfadeOptions?: FadeOptions\n}\n\ninterface iArgs {\n\taudioSystem: iAudioSystem\n\tuuidSystem?: iUuidSystem\n\tsampleMap: Sample.MutableMap\n}\nexport const createSampleSpawnSystem = ({ audioSystem, uuidSystem, sampleMap }: iArgs) => {\n\tconst { effectSystem } = audioSystem\n\tuuidSystem = uuidSystem ?? createUuidSystem()\n\n\tconst system = {\n\t\tspawnSampleFromParams: ({ params, startTime, wetOut, dryOut }: iSpawnSampleFromParamsArgs) => {\n\t\t\tconst data: Sample.Data = {\n\t\t\t\t...params,\n\t\t\t\tvolume: MathExt.randomBetween(params.minGain, params.maxGain),\n\t\t\t\tuuid: uuidSystem.nextId(),\n\t\t\t\tstartTime: startTime ?? getServerTime(),\n\t\t\t}\n\t\t\t// eventSystem.dispatch('startSample', data)\n\t\t\treturn system.spawnSampleFromData({ data, wetOut, dryOut })\n\t\t},\n\t\tspawnSampleFromData: ({ data, wetOut, dryOut, fadeOptions }: iSpawnSampleFromDataArgs) => {\n\t\t\tconst preset = effectSystem.preset(data.presetName)\n\t\t\twetOut ??= effectSystem.effect(preset?.effect)\n\t\t\tif (data.presetName === 'Off')\n\t\t\t\twetOut = undefined\n\t\t\tdryOut ??= effectSystem.globalVolume\n\t\t\tconst { spatialData, volume, startTime } = data\n\t\t\tdata.uuid ??= uuidSystem.nextId()\n\n\t\t\tlet wetSpatial: AudioEffect.SpatialEffect\n\t\t\tlet drySpatial: AudioEffect.SpatialEffect\n\t\t\tlet wetDrySend: AudioEffect.SendEffect\n\n\t\t\t//create dry spatializer\n\t\t\tif (spatialData) {\n\t\t\t\tconst params = preset?.drySpatializer ?? effectSystem.defaultPreset.drySpatializer\n\t\t\t\tdrySpatial = createSpatialEffect(params)\n\t\t\t\tdrySpatial.connect(dryOut)\n\t\t\t\tdryOut = drySpatial\n\t\t\t}\n\n\t\t\t//create wet spatializer\n\t\t\tif (spatialData && wetOut) {\n\t\t\t\tconst params = preset?.wetSpatializer ?? effectSystem.defaultPreset.wetSpatializer\n\t\t\t\twetSpatial = createSpatialEffect(params)\n\t\t\t\twetSpatial.connect(wetOut)\n\t\t\t\t// Position wet spatialiser directly in front of the listener at a distance\n\t\t\t\t// equal to the initial sample position.\n\t\t\t\twetSpatial.setPosition({ x: 0, y: 0, z: length(spatialData.position) })\n\t\t\t\twetOut = wetSpatial\n\t\t\t}\n\n\t\t\tlet sourceOut = dryOut\n\n\t\t\t//create wet dry send\n\t\t\tif (wetOut) {\n\t\t\t\tconst wetDrySend = createSendEffect()\n\t\t\t\twetDrySend._wet.connect(wetOut.input)\n\t\t\t\twetDrySend._dry.connect(dryOut.input)\n\t\t\t\tconst wetGain = preset?.wetGain ?? effectSystem.defaultPreset.wetGain\n\t\t\t\tconst dryGain = preset?.dryGain ?? effectSystem.defaultPreset.dryGain\n\t\t\t\twetDrySend._wet.gain.value = wetGain\n\t\t\t\twetDrySend._dry.gain.value = dryGain\n\t\t\t\tsourceOut = wetDrySend\n\t\t\t}\n\n\t\t\tconst audioSource = audioSystem.createAudioSource(data.url, sourceOut, fadeOptions, volume)\n\n\t\t\tlet startHandle\n\n\t\t\tconst sampleInstance: Sample.Instance = {\n\t\t\t\t...data,\n\t\t\t\talive: true,\n\t\t\t\tisPlaying: false,\n\t\t\t\taudioSource,\n\t\t\t\tonDispose: createEvent(),\n\t\t\t\tdispose: async () => {\n\t\t\t\t\tif (!sampleInstance.alive) {\n\t\t\t\t\t\t// Failsafe in case the recursive chain between `sampleInstance` and\n\t\t\t\t\t\t// `audioSource` is not broken.\n\t\t\t\t\t\tlogger.warn(source`\n\t\t\t\t\t\t\tsampleInstance.dispose(): Already dead! Can only dispose once!\n\t\t\t\t\t\t\t\tname: ${sampleInstance.name}\n\t\t\t\t\t\t\t\tuuid: ${sampleInstance.uuid}\n\t\t\t\t\t\t\t\tsrc: ${data.url}\n\t\t\t\t\t\t`)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\tsampleInstance.dispose():\n\t\t\t\t\t\t\tname: ${sampleInstance.name}\n\t\t\t\t\t\t\tuuid: ${sampleInstance.uuid}\n\t\t\t\t\t\t\tsrc: ${data.url}\n\t\t\t\t\t`)\n\t\t\t\t\tclearStrictTimeout(startHandle)\n\t\t\t\t\tsampleInstance.alive = false\n\t\t\t\t\t// Break the recursive chain between `sampleInstance` and `audioSource`.\n\t\t\t\t\taudioSource.onDispose.removeListener(sampleInstance.dispose)\n\t\t\t\t\tif (audioSource.isAlive) {\n\t\t\t\t\t\t// Emit first `stopSample` event on request to stop, before fade out.\n\t\t\t\t\t\tconst stopTime = sampleInstance.startTime + sampleInstance.duration\n\t\t\t\t\t\tlet now = getServerTime()\n\t\t\t\t\t\teventSystem.dispatch('stopSample', {\n\t\t\t\t\t\t\telementId: sampleInstance.elementId,\n\t\t\t\t\t\t\tplaylistEntryId: sampleInstance.playlistEntryId,\n\t\t\t\t\t\t\tsampleId: sampleInstance.sampleId,\n\t\t\t\t\t\t\ttimeToStop: Math.min(Math.max(stopTime - now, 0), 3000) || 0,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t// Fade out.\n\t\t\t\t\t\tawait audioSource.stop()\n\t\t\t\t\t\t// Emit final `stopSample` event if there are no other active samples with\n\t\t\t\t\t\t// the same ID. This can happen when a sample is restarted during the fade\n\t\t\t\t\t\t// out after being stopped.\n\t\t\t\t\t\tnow = getServerTime()\n\t\t\t\t\t\tif (!filterBySampleId(sampleMap, sampleInstance.sampleId).some(\n\t\t\t\t\t\t\t([, sample]) =>\n\t\t\t\t\t\t\t\tsample.uuid !== sampleInstance.uuid\n\t\t\t\t\t\t\t\t&& sample.startTime <= now\n\t\t\t\t\t\t\t\t&& now < sample.startTime + sample.duration\n\t\t\t\t\t\t\t\t// Only compare playlist entry samples with playlist entry samples, and\n\t\t\t\t\t\t\t\t// library samples with library samples. We must still emit `stopSample`\n\t\t\t\t\t\t\t\t// when a playlist entry sample is disposed even if the same sample is\n\t\t\t\t\t\t\t\t// also still active via the library.\n\t\t\t\t\t\t\t\t&& sample.elementId === sampleInstance.elementId\n\t\t\t\t\t\t\t\t&& sample.playlistEntryId === sampleInstance.playlistEntryId\n\t\t\t\t\t\t)) {\n\t\t\t\t\t\t\teventSystem.dispatch('stopSample', {\n\t\t\t\t\t\t\t\telementId: sampleInstance.elementId,\n\t\t\t\t\t\t\t\tplaylistEntryId: sampleInstance.playlistEntryId,\n\t\t\t\t\t\t\t\tsampleId: sampleInstance.sampleId,\n\t\t\t\t\t\t\t\ttimeToStop: 0, // Already stopped\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\twetSpatial?.disconnectAll()\n\t\t\t\t\tdrySpatial?.disconnectAll()\n\t\t\t\t\twetDrySend?.disconnectAll()\n\t\t\t\t\tsampleMap.mutate(map => map.delete(data.uuid))\n\t\t\t\t\t// Stop visualisation when there are no samples.\n\t\t\t\t\tif (sampleMap.getRaw().size === 0) {\n\t\t\t\t\t\tsyrinscape.visualisation?.stop()\n\t\t\t\t\t}\n\t\t\t\t\tsampleInstance.onDispose.invoke()\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Dispose of this sample after its audio source is disposed (e.g. when it ends).\n\t\t\t// This is required for oneshots which are never explicitly stopped.\n\t\t\taudioSource.onDispose.addListener(sampleInstance.dispose)\n\n\t\t\tconst startSample = (scrubToSecs?: number) => {\n\t\t\t\tlogger.debug(source`\n\t\t\t\t\tstartSample():\n\t\t\t\t\t\tname: ${sampleInstance.name}\n\t\t\t\t\t\tuuid: ${sampleInstance.uuid}\n\t\t\t\t\t\tsrc: ${data.url}\n\t\t\t\t`)\n\n\t\t\t\tif (window.Sentry) {\n\t\t\t\t\tconst now = getServerTime()\n\n\t\t\t\t\twindow.Sentry.addBreadcrumb({\n\t\t\t\t\t\ttype: \"debug\",\n\t\t\t\t\t\tmessage: \"startSample()\",\n\t\t\t\t\t\tlevel: \"info\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\tclientTime: Date.now(),\n\t\t\t\t\t\t\tendTime: data.startTime + data.duration,\n\t\t\t\t\t\t\tgetServerTime: now,\n\t\t\t\t\t\t\tstartTimeServerTimeDelta: data.startTime - now,\n\t\t\t\t\t\t\tclientTimeServerTimeDelta: Date.now() - now,\n\t\t\t\t\t\t\tgetServerTimeOffset: getServerTimeOffset(),\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tif (spatialData) {\n\t\t\t\t\tlet duration = data.duration / 1000\n\t\t\t\t\t// Set the original position and use the original (full) panning time.\n\n\t\t\t\t\tlet startPos = spatialData.position\n\t\t\t\t\tconst { velocity } = spatialData\n\t\t\t\t\tif (scrubToSecs !== undefined) {\n\t\t\t\t\t\t// Set a new starting position (original + velocity over scrubbed seconds) and\n\t\t\t\t\t\t// reduce the panning time by scrubbed seconds.\n\t\t\t\t\t\tstartPos = add(startPos, multiply(velocity, scrubToSecs))\n\t\t\t\t\t\tduration -= scrubToSecs\n\t\t\t\t\t}\n\t\t\t\t\tdrySpatial.setPosition(startPos)\n\t\t\t\t\tdrySpatial.setVelocity(velocity, duration)\n\n\t\t\t\t\tif (wetSpatial !== undefined) {\n\t\t\t\t\t\tconst now = config.audioContext.currentTime\n\t\t\t\t\t\trampToCenteredVelocityOverTime(wetSpatial.node.positionZ, startPos, velocity, now, duration)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Start visualisation with samples.\n\t\t\t\tsyrinscape.visualisation?.start()\n\t\t\t\taudioSource.play(scrubToSecs)\n\t\t\t\tsampleInstance.isPlaying = true\n\t\t\t\tsampleMap.update()\n\n\t\t\t\tif (data.elementId && !data.manuallyTriggered) {\n\t\t\t\t\t// For playlist entry samples triggered via the element (not manually), we\n\t\t\t\t\t// need access to the element system to send `timeToNextSample`. Dispatch\n\t\t\t\t\t// internal `startElementSample` event to avoid circular import.\n\t\t\t\t\tdocument.dispatchEvent(\n\t\t\t\t\t\tnew CustomEvent('syrinscape.internalStartElementSample', { detail: data })\n\t\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\t\teventSystem.dispatch('startSample', {\n\t\t\t\t\t\telementId: data.elementId,\n\t\t\t\t\t\tplaylistEntryId: data.playlistEntryId,\n\t\t\t\t\t\tsampleId: data.sampleId,\n\t\t\t\t\t\ttimeToStop: data.startTime + data.duration - getServerTime(),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst now = getServerTime()\n\n\t\t\tif (window.Sentry) {\n\t\t\t\twindow.Sentry.addBreadcrumb({\n\t\t\t\t\ttype: \"debug\",\n\t\t\t\t\tmessage: \"spawnSampleFromData()\",\n\t\t\t\t\tlevel: \"info\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t...data,\n\t\t\t\t\t\tclientTime: Date.now(),\n\t\t\t\t\t\tendTime: data.startTime + data.duration,\n\t\t\t\t\t\tgetServerTime: now,\n\t\t\t\t\t\tstartTimeServerTimeDelta: data.startTime - now,\n\t\t\t\t\t\tclientTimeServerTimeDelta: Date.now() - now,\n\t\t\t\t\t\tgetServerTimeOffset: getServerTimeOffset(),\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\n\t\t\t// Scrub to current position and start if start time is more than 5 seconds ago.\n\t\t\tif (startTime <= now - 5000) {\n\t\t\t\tlogger.debug(source`\n\t\t\t\t\tspawnSampleFromData(): Already in progress. Scrub ${MathExt.millisToSecs((now - startTime))} seconds.\n\t\t\t\t\t\tname: ${data.name}\n\t\t\t\t\t\tuuid: ${data.uuid}\n\t\t\t\t`)\n\t\t\t\tstartSample(MathExt.millisToSecs(now - startTime))\n\t\t\t}\n\t\t\t// Start with no scrubbing if start time is within 5 seconds.\n\t\t\telse if (startTime <= now) {\n\t\t\t\tlogger.debug(source`\n\t\t\t\t\tspawnSampleFromData(): Start with no scrubbing.\n\t\t\t\t\t\tname: ${data.name}\n\t\t\t\t\t\tuuid: ${data.uuid}\n\t\t\t\t`)\n\t\t\t\tstartSample()\n\t\t\t}\n\t\t\t// Schedule start if start time is in the future.\n\t\t\telse {\n\t\t\t\tstartHandle = setStrictTimeout(startSample, startTime - now, data.duration)\n\t\t\t\tlogger.debug(source`\n\t\t\t\t\tspawnSampleFromData(): Schedule start in ${MathExt.millisToSecs((startTime - now))} seconds.\n\t\t\t\t\t\tname: ${data.name}\n\t\t\t\t\t\tuuid: ${data.uuid}\n\t\t\t\t\t\tstartHandle: ${startHandle}\n\t\t\t\t`)\n\t\t\t}\n\n\t\t\tsampleMap.mutate(map =>\n\t\t\t\tmap.set(data.uuid, sampleInstance))\n\t\t\treturn sampleInstance\n\t\t}\n\t}\n\treturn system\n}\n\nexport type iSampleSpawnSystem = ReturnType<typeof createSampleSpawnSystem>\n","import { createMutableMap } from 'modules-core/utility'\nimport { iAudioSystem } from 'modules-core/audioSystem/audioSystem'\nimport { Sample } from 'modules-core/sampleSystem/types'\nimport { createSampleSpawnSystem } from 'modules-core/sampleSystem/sampleSpawnSystem'\nimport { createUuidSystem, iUuidSystem } from 'modules-core/uuidSystem/uuidSystem'\nimport { ParseExt } from 'modules-core/utility'\nimport { AudioEffect } from 'modules-core/audioEffectSystem'\nimport { UnitySocket } from 'modules-core/socket/types'\nimport getServerTime from 'modules-core/utility/serverTime'\nimport { eventSystem } from 'modules-core/eventSystem'\nimport { filterBySampleId } from 'modules-core/elementSystem'\n\n// Register events.\neventSystem.add('stopSample')\n\ninterface iArgs {\n\taudioSystem: iAudioSystem\n\tuuidSystem?: iUuidSystem\n}\n\nexport const createSampleSystem = ({ audioSystem, uuidSystem }: iArgs) => {\n\tuuidSystem = uuidSystem || createUuidSystem()\n\n\tconst sampleMap = createMutableMap<string, Sample.Instance>() as Sample.MutableMap\n\n\tconst sampleSpawnSystem = createSampleSpawnSystem({ audioSystem, uuidSystem, sampleMap })\n\n\tconst getSamplesWithSampleId = (map: Sample.UUIDMap, sampleId: number) =>\n\t\t[...map].filter(([key, sample]) => sample.sampleId === sampleId)\n\n\tconst sampleSystem = {\n\t\tmap: sampleMap,\n\t\tgetSamples: () => sampleMap.getRaw(),\n\t\tgetSamplesWithSampleId:(sampleId: number)=>\n\t\t\tfilterBySampleId(sampleMap, sampleId),\n\t\t...sampleSpawnSystem,\n\t\tremoveSample: (uuid: string) =>\n\t\t\tsampleMap.get().get(uuid).dispose(),\n\t\tgetStopWait: (sampleId: number) => {\n\t\t\t// Get the wait time until the last active sample matching `sampleId` will stop.\n\t\t\tconst now = getServerTime()\n\t\t\tlet stopTime: number\n\t\t\tsampleSystem.getSamplesWithSampleId(sampleId).filter(([, sample]) =>\n\t\t\t\tsample.startTime <= now && now < sample.startTime + sample.duration\n\t\t\t).forEach(([, sample]) => {\n\t\t\t\tconst thisStopTime = sample.startTime + sample.duration\n\t\t\t\tif (!stopTime || thisStopTime > stopTime) {\n\t\t\t\t\tstopTime = thisStopTime\n\t\t\t\t}\n\t\t\t})\n\t\t\t// TODO: Use the server provided fadeout duration instead of a 3000ms hard limit.\n\t\t\treturn Math.min(Math.max(stopTime - now, 0), 3000) || 0\n\t\t},\n\t\tstopPlaylistEntryByPlaylistEntryId: (playlistEntryId: number) => {\n\t\t\t[...sampleSystem.getSamples().values()]\n\t\t\t\t.filter((sample) => sample.playlistEntryId === playlistEntryId)\n\t\t\t\t.forEach((sample) => sample.dispose())\n\t\t},\n\t\tstopDirectSampleBySampleId: (sampleId: number) => {\n\t\t\tsampleSystem.getSamplesWithSampleId(sampleId).forEach(([, sample]) => {\n\t\t\t\tif (!sample.elementId && !sample.playlistEntryId) {\n\t\t\t\t\tsample.dispose()\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tstopSampleBySampleUuid: (sampleUuid: string) => {\n\t\t\tsampleMap.getRaw().get(sampleUuid).dispose()\n\t\t},\n\t\tstopAllSamples: () => {\n\t\t\treturn Promise.all([...sampleMap.getRaw()].map(([, sample]) => sample.dispose()))\n\t\t},\n\t\tcreateSocketSampleSnapshot: (sample: UnitySocket.Sample) => {\n\t\t\treturn {\n\t\t\t\ttimestamp: getServerTime(),\n\t\t\t\tsampleInstance: {\n\t\t\t\t\t...ParseExt.socketSampleToSampleParams(sample),\n\t\t\t\t\tstartTime: getServerTime()\n\t\t\t\t},\n\t\t\t\tsampleMessage: sample\n\t\t\t}\n\t\t},\n\t\tplaySample: (sampleData: UnitySocket.Sample) =>\n\t\t\tsampleSystem.spawnSampleFromParams({ params: ParseExt.socketSampleToSampleParams(sampleData) }),\n\t\tplaySampleAtTime: (sampleData: UnitySocket.Sample, startTime?: number) =>\n\t\t\tsampleSystem.spawnSampleFromParams({ params: ParseExt.socketSampleToSampleParams(sampleData), startTime }),\n\t\tplaySampleWithReverb: (sampleData: UnitySocket.Sample, presetName: AudioEffect.Preset = 'Cave', startTime?: number) =>\n\t\t\tsampleSystem.spawnSampleFromParams({ params: { ...ParseExt.socketSampleToSampleParams(sampleData), presetName }, startTime }),\n\t\tstopSample: ({ id }: UnitySocket.Server.StopSample) =>\n\t\t\tsampleSystem.stopDirectSampleBySampleId(Number(id)),\n\n\t}\n\treturn sampleSystem\n\n}\n\nexport type iSampleSystem = ReturnType<typeof createSampleSystem>\n","import { Element } from './types'\nimport { eventSystem } from 'modules-core/eventSystem'\nimport { filterByElementId } from './utility'\n\n// Register events.\neventSystem.add('setElementVolume')\n\ninterface Args {\n\telementMap: Element.MutableMap\n}\nexport const createElementVolumeSystem = ({ elementMap }: Args) => {\n\n\tconst elementVolumeMap = new Map<number, number>()\n\n\tconst system = {\n\t\telementVolumeMap,\n\t\tsetElementIdVolume: (elementId: number, value: number) => {\n\t\t\tif (elementVolumeMap.get(elementId) === value)\n\t\t\t\treturn\n\t\t\telementVolumeMap.set(elementId, value)\n\t\t\tfilterByElementId(elementMap, elementId)\n\t\t\t\t.forEach(([, element]) => element.setVolume(value))\n\t\t\teventSystem.dispatch('setElementVolume', {\n\t\t\t\telementId,\n\t\t\t\tvolume: value,\n\t\t\t})\n\t\t}\n\t}\n\treturn system\n}\n\nexport type ElementVolumeSystem = ReturnType<typeof createElementVolumeSystem>\n","import { iAudioSystem } from 'modules-core/audioSystem/audioSystem'\nimport { Element } from 'modules-core/elementSystem/types'\nimport { createElementSpawnSystem } from 'modules-core/elementSystem/elementSpawnSystem'\nimport { iSampleSystem, createSampleSystem } from 'modules-core/sampleSystem/sampleSystem'\nimport { createUuidSystem, iUuidSystem } from 'modules-core/uuidSystem/uuidSystem'\nimport { createEvent, createMutableMap } from 'modules-core/utility'\nimport { iAuthSystem } from 'modules-core/authSystem'\nimport { createPlaylistSystem } from './playlistSystem'\nimport { createOneshotSystem } from './oneshotSystem'\nimport { createElementVolumeSystem } from './elementVolumeSystem'\nimport { filterByElementId } from './utility'\nimport { ParseExt } from 'modules-core/utility'\nimport { fromLength } from 'modules-core/utility/MathExt'\nimport { UnitySocket } from 'modules-core/socket/types'\nimport getServerTime from 'modules-core/utility/serverTime'\nimport { eventSystem } from 'modules-core/eventSystem'\nimport { Sample } from 'modules-core/sampleSystem/types'\n\n// Register events.\neventSystem.add('startElementSample')\neventSystem.add('stopElement')\n\ninterface iArgs {\n\tauthSystem: iAuthSystem\n\taudioSystem: iAudioSystem\n\tsampleSystem?: iSampleSystem\n\tuuidSystem?: iUuidSystem\n}\n\nexport const createElementSystem = ({ authSystem, audioSystem, sampleSystem, uuidSystem }: iArgs) => {\n\tuuidSystem = uuidSystem || createUuidSystem()\n\tsampleSystem = sampleSystem || createSampleSystem({ audioSystem, uuidSystem, })\n\n\tconst elementMap = createMutableMap<string, Element.Instance>() as Element.MutableMap\n\n\tconst elementVolumeSystem = createElementVolumeSystem({ elementMap })\n\tconst oneshotSystem = createOneshotSystem({ audioSystem })\n\n\tconst playlistSystem = createPlaylistSystem()\n\tconst elementSpawnSystem = createElementSpawnSystem({\n\t\tauthSystem, audioSystem, sampleSystem,\n\t\tuuidSystem, elementMap, playlistSystem,\n\t\toneshotSystem, elementVolumeSystem,\n\t})\n\n\tconst system = {\n\t\t...elementSpawnSystem,\n\t\t...elementVolumeSystem,\n\t\tplaylistSystem,\n\t\toneshotSystem,\n\t\tgetElements: () => elementMap.getRaw(),\n\t\tmap: elementMap,\n\t\tstopElementByUuid: (uuid: string) =>\n\t\t\telementMap.mutate(map => map.get(uuid).dispose()),\n\t\tgetElementsWithElementId:(elementId: number)=>\n\t\t\tfilterByElementId(elementMap, elementId)\n\t\t\t// Only elements that have samples that were not manually triggered.\n\t\t\t.filter(([_, element]) =>\n\t\t\t\telement.playlistData.sampleDataList.some(sample => !sample.manuallyTriggered)\n\t\t\t),\n\t\tgetStopWait: (elementId: number) => {\n\t\t\t// Get the wait time until the current sample will stop.\n\t\t\tlet now = getServerTime()\n\t\t\tlet stopTime: number\n\t\t\tsystem.getElementsWithElementId(elementId).forEach(([_, element]) => {\n\t\t\t\tlet sample = element.playlistData.sampleDataList.find(\n\t\t\t\t\t(s) => s.startTime <= now && s.startTime + s.duration > now\n\t\t\t\t)\n\t\t\t\tif (sample && (!stopTime || sample.startTime + sample.duration < stopTime)) {\n\t\t\t\t\tstopTime = sample.startTime + sample.duration\n\t\t\t\t}\n\t\t\t})\n\t\t\t// TODO: Use the server provided fadeout duration instead of a 3000ms hard limit.\n\t\t\treturn Math.min(Math.max(stopTime - now, 0), 3000) || 0\n\t\t},\n\t\tstopElementByElementId: (elementId: number, emit: boolean = true) => {\n\t\t\tfilterByElementId(elementMap, elementId)\n\t\t\t\t.forEach(([, element]) => element.dispose())\n\t\t\tif (emit) {\n\t\t\t\teventSystem.dispatch('stopElement', {\n\t\t\t\t\telementId,\n\t\t\t\t\ttimeToStop: system.getStopWait(elementId)\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tstopAllElements: () => {\n\t\t\tlet seen: Set<number> = new Set()\n\t\t\treturn Promise.all([...elementMap.getRaw()].map(([, element]) => {\n\t\t\t\tif (!seen.has(element.elementId)) {\n\t\t\t\t\tseen.add(element.elementId)\n\t\t\t\t\teventSystem.dispatch('stopElement', {\n\t\t\t\t\t\telementId: element.elementId,\n\t\t\t\t\t\ttimeToStop: system.getStopWait(element.elementId),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\treturn element.dispose()\n\t\t\t}))\n\t\t},\n\t\tsetElementIdVolume: (elementId: number, volume: number) =>\n\t\t\telementVolumeSystem.setElementIdVolume(elementId, volume),\n\t\tsetOneshotVolume: (value: number) =>\n\t\t\toneshotSystem.setVolume(value),\n\t\tplayElement: (element: UnitySocket.Element) =>\n\t\t\tsystem.spawnElementFromParams(ParseExt.socketElementToParams(element)),\n\t\tforEachElement: (func: (e: Element.Instance) => void) =>\n\t\t\telementMap.get().forEach(func),\n\n\t\tcreateSocketElementSnapshot: async (element: UnitySocket.Element, repeatLength = 3) => {\n\t\t\tconst firstParams = ParseExt.socketElementToParams(element)\n\t\t\tconst elementInstances = await system.createParamsSnapshot(firstParams, repeatLength)\n\t\t\tconst snapshot = {\n\t\t\t\ttimestamp: getServerTime(),\n\t\t\t\telementInstances,\n\t\t\t\telementMessage: element,\n\t\t\t}\n\t\t\treturn snapshot\n\t\t},\n\t\tcreateParamsSnapshot: async (params: Element.Params, repeatLength = 3) => {\n\t\t\tlet prevInstance = await elementSpawnSystem.paramsToData(params)\n\t\t\tconst instances = [prevInstance]\n\t\t\tfor (let i = 0; i < repeatLength; i++) {\n\t\t\t\tconst nextParams = elementSpawnSystem.dataToRepeatParams(prevInstance)\n\t\t\t\tprevInstance = await elementSpawnSystem.paramsToData(nextParams)\n\t\t\t\tinstances.push(prevInstance)\n\t\t\t}\n\t\t\treturn instances\n\t\t},\n\t}\n\n\tdocument.addEventListener('syrinscape.internalStartElementSample', (event: CustomEvent) => {\n\t\tlet sampleData = event.detail\n\n\t\t// Get time to stop.\n\t\tlet timeToStop = sampleData.startTime + sampleData.duration - getServerTime()\n\n\t\t// Get time to stop or next sample.\n\t\tlet nextStartTime: number\n\t\tsystem.getElementsWithElementId(sampleData.elementId).forEach(([_, element]) => {\n\t\t\tlet nextSample = element.playlistData.sampleDataList.find(\n\t\t\t\t(s) => s.startTime > sampleData.startTime && s.uuid !== sampleData.uuid\n\t\t\t)\n\t\t\tif (nextSample && (!nextStartTime || nextSample.startTime < nextStartTime)) {\n\t\t\t\tnextStartTime = nextSample.startTime\n\t\t\t}\n\t\t})\n\t\tsampleData.timeToStopOrNextSample = nextStartTime\n\t\t\t? nextStartTime - getServerTime()  // Next sample\n\t\t\t: timeToStop  // Stop\n\n\t\teventSystem.dispatch('startSample', {\n\t\t\telementId: sampleData.elementId,\n\t\t\tplaylistEntryId: sampleData.playlistEntryId,\n\t\t\ttimeToStop,\n\t\t\ttimeToStopOrNextSample: sampleData.timeToStopOrNextSample,\n\t\t})\n\t})\n\n\treturn system\n}\n\nexport type iElementSystem = ReturnType<typeof createElementSystem>\n","import { createEvent } from 'modules-core/utility'\nimport { AudioEffect, createVolumeEffect } from 'modules-core/audioEffectSystem'\nimport { iAudioSystem } from 'modules-core/audioSystem'\nimport syrinscape from 'app/common/syrinscape'\n\n\ninterface Args {\n\taudioSystem: iAudioSystem\n}\nexport const createOneshotSystem = ({ audioSystem }: Args) => {\n\tconst { effectSystem } = audioSystem\n\tlet volume = 1\n\tconst onChange = createEvent<number>()\n\tconst system = {\n\t\tonChange,\n\t\t// get volume() { return volume },\n\t\tsetVolume: (val: number) => {\n\t\t\tvolume = val\n\t\t\tonChange.invoke(volume)\n\t\t},\n\t\tcreateOneshotVolume: (\n\t\t\twet: AudioEffect.VolumeEffect,\n\t\t\tdry: AudioEffect.VolumeEffect,\n\t\t\tdryAnalyser: AudioEffect.AnalyserEffect,\n\t\t\teffect: AudioEffect.Effect\n\t\t) => {\n\t\t\tconst wetOneshot = createVolumeEffect()\n\t\t\tconst dryOneshot = createVolumeEffect()\n\t\t\twetOneshot.value = volume\n\t\t\tdryOneshot.value = volume\n\t\t\twet.connect(wetOneshot)\n\t\t\tdry.connect(dryOneshot)\n\t\t\twetOneshot.connect(effect)\n\t\t\tif (dryAnalyser) {\n\t\t\t\tdryOneshot.connect(dryAnalyser)\n\t\t\t\tdryAnalyser.connect(effectSystem.globalVolume)\n\t\t\t} else {\n\t\t\t\tdryOneshot.connect(effectSystem.globalVolume)\n\t\t\t}\n\t\t\tconst handleChange = (volume: number) => {\n\t\t\t\twetOneshot.fadeToValue(volume)\n\t\t\t\tdryOneshot.fadeToValue(volume)\n\t\t\t}\n\t\t\tonChange.addListener(handleChange)\n\t\t\treturn () => onChange.removeListener(handleChange)\n\t\t}\n\t}\n\treturn system\n}\n\nexport type OneshotSystem = ReturnType<typeof createOneshotSystem>\n","import { createEvent, MathExt } from 'modules-core/utility'\nimport { Sample } from 'modules-core/sampleSystem'\nimport { createSeededRandom, fromLength, randomIndex, wrapReorder } from 'modules-core/utility/MathExt'\nimport { Element } from './types'\n\n\n\nexport const RANDOM_PLAYLIST_LENGTH = 12\n\ninterface Args {\n}\nexport const createPlaylistSystem = ({ }: Args = {}) => {\n\n\tconst playedSamplesMap: Element.PlayedSamplesMap = new Map()\n\n\tconst getOrCreatePlayedSamples = (elementId: number) => {\n\t\tif (playedSamplesMap.has(elementId))\n\t\t\treturn playedSamplesMap.get(elementId)\n\t\tconst playedSamples: number[] = []\n\t\tplayedSamplesMap.set(elementId, playedSamples)\n\t\treturn playedSamples\n\t}\n\n\tconst system = {\n\t\tonPlayedSamplesChanged: createEvent<Element.PlayedSamplesMap>(),\n\t\tplayedSamplesMap,\n\t\tcreatePlaylist: (elementParams: Element.Params) => {\n\t\t\tlet { playedSamples } = elementParams\n\t\t\tconst { elementId, playlistParams, type, randomSeed } = elementParams\n\t\t\tconst { sampleParamsList, order } = playlistParams\n\n\t\t\tif (sampleParamsList.length <= 1)\n\t\t\t\treturn sampleParamsList\n\n\t\t\tconst randomFunc = randomSeed === undefined\n\t\t\t\t? Math.random\n\t\t\t\t: createSeededRandom(randomSeed)\n\n\t\t\tif (order === 'random')\n\t\t\t\treturn fromLength<Sample.Params>(\n\t\t\t\t\t() => randomIndex(sampleParamsList, randomFunc)\n\t\t\t\t\t, RANDOM_PLAYLIST_LENGTH)\n\n\t\t\tplayedSamples ??= getOrCreatePlayedSamples(elementId)\n\t\t\tif (playedSamples.length >= sampleParamsList.length) {\n\t\t\t\tconst last = playedSamples[playedSamples.length - 1]\n\t\t\t\tsystem.clearPlayedSamples(elementId)\n\t\t\t\tsystem.appendPlayedSamples(elementId, last)\n\t\t\t}\n\n\t\t\tlet newPlaylist = [...sampleParamsList]\n\n\t\t\tconst lastPlayed = playedSamples.length > 0\n\t\t\t\t? playedSamples[playedSamples.length - 1]\n\t\t\t\t: undefined\n\n\t\t\tif (order === 'shuffle') {\n\t\t\t\tMathExt.shuffleArray(newPlaylist, randomFunc)\n\t\t\t\tif (newPlaylist[0].sampleId === lastPlayed)\n\t\t\t\t\tnewPlaylist.push(newPlaylist.shift())\n\t\t\t} else {\n\t\t\t\tif (lastPlayed) {\n\t\t\t\t\tconst nextIndex = (newPlaylist.indexOf(\n\t\t\t\t\t\tnewPlaylist.find(sample =>\n\t\t\t\t\t\t\tsample.sampleId === lastPlayed))\n\t\t\t\t\t\t+ 1) % newPlaylist.length\n\t\t\t\t\tnewPlaylist = wrapReorder(newPlaylist, nextIndex)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === 'oneshot') {\n\t\t\t\tnewPlaylist = newPlaylist\n\t\t\t\t\t.filter(sample => !playedSamples.includes(sample.sampleId))\n\t\t\t\tnewPlaylist.splice(1)\n\t\t\t\tsystem.appendPlayedSamples(elementId, newPlaylist[0].sampleId)\n\t\t\t}\n\n\t\t\treturn newPlaylist\n\t\t},\n\t\tclearPlayedSamples: (elementId: number) => {\n\t\t\tgetOrCreatePlayedSamples(elementId)\n\t\t\t\t.length = 0\n\t\t\tsystem.onPlayedSamplesChanged\n\t\t\t\t.invoke(playedSamplesMap)\n\t\t},\n\t\tclearAllPlayedSamples: () => {\n\t\t\tplayedSamplesMap.clear()\n\t\t\tsystem.onPlayedSamplesChanged\n\t\t\t\t.invoke(playedSamplesMap)\n\t\t},\n\t\tappendPlayedSamples: (elementId: number, sampleId: number) => {\n\t\t\tconst playedSamples = getOrCreatePlayedSamples(elementId)\n\t\t\t// playedSamples.length = 0\n\t\t\tif (!playedSamples.includes(sampleId))\n\t\t\t\tplayedSamples.push(sampleId)\n\t\t\tsystem.onPlayedSamplesChanged\n\t\t\t\t.invoke(playedSamplesMap)\n\t\t}\n\t}\n\treturn system\n}\n","import { iUrlSystem } from 'modules-core/urlSystem'\nimport { createEvent, createSimpleRecord, iEvent, MathExt, runWithTimeout } from 'modules-core/utility'\nimport { Client, Server, SocketState } from './types'\nimport { MessageHandlerMap, ReconnectParams } from './types/Server'\nimport log from 'modules-core/log'\nimport { oneLine } from 'common-tags'\nimport { eventSystem } from 'modules-core/eventSystem'\nimport config from 'modules-core/config'\n\nconst logger = log.getLogger('socketSystem')\n\ninterface Args {\n\turlSystem: iUrlSystem\n  logLevel?: 'quiet'|'verbose'\n}\n\nexport const SocketSystem = ({urlSystem,logLevel}:Args)=>{\n\tconst BACKOFF_INITIAL = 500  // Half a second\n\tconst BACKOFF_MAX = 60 * 1000  // 1 minute\n\tconst BACKOFF_MULTIPLIER = 2  // Seconds\n\n\tlet backoff = 0\n\tlet last_connect: number\n\tlet state: SocketState = 'Idle'\n\tlet ws: WebSocket\n\n\tconst onMessageRecord = createSimpleRecord<Server.MessageName, iEvent<Server.MessageParams>>(createEvent)\n\n\tconst system = {\n\t\tget state() { return state },\n\t\tset state(_state: SocketState){\n\t\t\tstate = _state\n\t\t\tsystem.onStateChange.invoke(state)\n\t\t},\n\n\t\tconnect: async () =>\n\t\t\tnew Promise<void>((resolve, reject) => {\n\t\t\t\tsystem.state = 'Connecting'\n\t\t\t\tconst url = urlSystem.createUrlWs('ws-web-player/websocket')\n\t\t\t\tws = new WebSocket(url)\n\t\t\t\tws.onclose = () => {\n\t\t\t\t\tsystem.state = 'Idle'\n\t\t\t\t\t// Reconnect with progressive backoff. Count the backoff from the last\n\t\t\t\t\t// connect, not from the last disconnect.\n\t\t\t\t\tbackoff = Math.min(\n\t\t\t\t\t\tMath.max(backoff * BACKOFF_MULTIPLIER, BACKOFF_INITIAL),\n\t\t\t\t\t\tBACKOFF_MAX,\n\t\t\t\t\t)\n\t\t\t\t\t// Subtract current connection duration from backoff.\n\t\t\t\t\tbackoff -= Math.min(Date.now() - last_connect, backoff) || 0\n\t\t\t\t\tlogger.info(\n\t\t\t\t\t\t`Connection closed. Reconnect in ${MathExt.millisToSecs(backoff)} seconds.`\n\t\t\t\t\t)\n\t\t\t\t\tsetTimeout(system.connect, backoff)\n\t\t\t\t\t// Unset last connect time, because we are disconnected and have already set\n\t\t\t\t\t// the backoff timeout. If we successfully connect, we will set it again.\n\t\t\t\t\tlast_connect = undefined\n\t\t\t\t}\n\t\t\t\tws.onerror = (event) => {\n\t\t\t\t\treject()\n\t\t\t\t\tif (system.state !== 'Error') {\n\t\t\t\t\t\tsystem.state = 'Error'\n\t\t\t\t\t}\n\t\t\t\t\tsystem.onError.invoke(event)\n\t\t\t\t\tws.close()\n\t\t\t\t}\n\t\t\t\tws.onmessage= (event) => {\n\t\t\t\t\tif (system.state !== 'Active') {\n\t\t\t\t\t\tsystem.state = 'Active'\n\t\t\t\t\t}\n\t\t\t\t\tconst data = JSON.parse(event.data) as Server.Message\n\t\t\t\t\tlogger.debug('<<< Socket Message Received:', data)\n\t\t\t\t\tsystem.onMessage.invoke(data)\n\t\t\t\t\tsystem.onNamedMessage(data.message).invoke(data.params)\n\t\t\t\t}\n\t\t\t\tws.onopen = (event) => {\n\t\t\t\t\tresolve()\n\t\t\t\t\tlast_connect = Date.now()\n\t\t\t\t\tsystem.send({\n\t\t\t\t\t\tmessage:'register',\n\t\t\t\t\t\tsession_id: config.sessionId,\n\t\t\t\t\t\ttoken: config.token,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}),\n\n\t\tonMessage:createEvent<Server.Message>(),\n\t\tonNamedMessage:onMessageRecord.getOrCreate as\n            <T extends Server.MessageName>(key: T) => iEvent<Server.MessageParamsMap[T]>,\n\t\treconnect: () => {\n\t\t\tif (ws !== undefined) {\n\t\t\t\tlogger.info(\"reconnect()\")\n\t\t\t\tbackoff = 0\n\t\t\t\tws.close()\n\t\t\t} else {\n\t\t\t\tlogger.info(\"reconnect() called before connect()\")\n\t\t\t}\n\t\t},\n\t\tsend:<T extends Client.MessageName>(data:Client.Message<T>)=>{\n\t\t\tlogger.debug('>>> Socket Message Sent:', data)\n\t\t\tws.send(JSON.stringify(data))\n\t\t},\n\t\tonError:createEvent<Event>(),\n\t\tonStateChange:createEvent<SocketState>(),\n\t}\n\n\tconst socketMessageLookup: MessageHandlerMap = {\n\t\tping: (params) => system.send({ message: 'ping', params }),\n\n\t\terror: (params) => logger.error(params.message),\n\n\t\treconnect_to_new_backend: ({ subdomain, domain_and_port }: ReconnectParams) => {\n\t\t\tconst [domain, port] = domain_and_port.split(':')\n\t\t\tconfig.wsHostname = `${subdomain}.${domain}`\n\t\t\tif (port) config.wsPort = port\n\t\t\tlogger.info(oneLine`\n\t\t\t\tReconnect to new backend: ${urlSystem.createUrlWs('ws-web-player/websocket')}\n\t\t\t`)\n\t\t\tsystem.reconnect()\n\t\t},\n\t}\n\n\tObject.entries(socketMessageLookup)\n\t\t.forEach(([key,func]:[Server.MessageName,Server.MessageHandler])=>\n\t\t\tsystem.onNamedMessage(key).addListener(func))\n\n\teventSystem.add('updateConfig', (event) => {\n\t\tif (event.detail.sessionId || event.detail.token) {\n\t\t\tsystem.reconnect()\n\t\t}\n\t})\n\n\treturn system\n}\nexport type SocketSystem = ReturnType<typeof SocketSystem>\n","import { SocketAPI } from 'modules-core/socket'\nimport {Element} from 'modules-core/elementSystem'\nimport { Sample } from 'modules-core/sampleSystem'\n\nexport const elementChunksToData = (elements:SocketAPI.Server.ElementMap = {})=>\n\tObject.entries(elements)\n\t\t.flatMap(([elementId,element])=>\n\t\t\tObject.entries(element.chunks || {})\n\t\t\t\t.map(([uuid,chunk]):Element.Data=>({\n\t\t\t\t\tuuid,  // Chunk UUID from server data\n\t\t\t\t\tcrossfade: element.crossfade,\n\t\t\t\t\tvolume: element.volume,\n\t\t\t\t\telementId: Number(elementId),\n\t\t\t\t\ttype: element.type,\n\t\t\t\t\ttitle:element.title,\n\t\t\t\t\tplaylistData:{\n\t\t\t\t\t\tsampleDataList:chunk.map(sampleToData)\n\t\t\t\t\t},\n\t\t\t\t\tpresetName:element.reverb,\n\t\t\t\t})))\n\nexport const elementChunksToUuids = (elements:SocketAPI.Server.ElementMap = {})=>\n\tObject.values(elements)\n\t\t.flatMap(element=>\n\t\t\tObject.keys(element.chunks))\n\nexport const elementChunksToElementIds = (elements:SocketAPI.Server.ElementMap = {}) =>\n\tObject.keys(elements)\n\t\t.map((elementId) => parseInt(elementId, 10))\n\ntype SampleToData = (sample:SocketAPI.Server.Sample)=>Sample.Data\nexport const sampleToData:SampleToData = sample=>({\n\tuuid:sample.uuid,\n\tname:sample.name,\n\tsampleId:sample.id,\n\tvolume:sample.volume,\n\tstartTime:sample.start * 1000,\n\tduration:(sample.end - sample.start) * 1000,\n\tpresetName:sample.reverb,\n\tspatializable:!!sample.position,\n\tspatialData:sample.position && {\n\t\tposition:tupleToVector3(sample.position),\n\t\tvelocity:tupleToVector3(sample.velocity)\n\t},\n\turl:sample.url,\n\tplaylistEntryId:sample.playlist_entry_pk,\n\tmanuallyTriggered:!!sample.manually_triggered,\n})\n\nconst tupleToVector3 = (vec:[number,number,number])=>\n\t({x:vec[0],y:vec[1],z:vec[2]})\n","import { iAudioSystem } from 'modules-core/audioSystem'\nimport { Element, iElementSystem } from 'modules-core/elementSystem'\nimport { iSampleSystem, Sample } from 'modules-core/sampleSystem'\nimport { SocketAPI, SocketSystem } from 'modules-core/socket'\nimport { elementChunksToData, elementChunksToElementIds, elementChunksToUuids } from './utility'\nimport { createEvent, MathExt } from '../utility'\nimport getServerTime, { getServerTimeOffset, setServerTimeOffset } from 'modules-core/utility/serverTime'\nimport log from 'modules-core/log'\nimport { source } from 'common-tags'\nimport { secsToMillis } from 'modules-core/utility/MathExt'\nimport config from 'modules-core/config'\n\nconst logger = log.getLogger('syncSystem')\n\ninterface Args{\n    socketSystem:SocketSystem\n    elementSystem:iElementSystem\n    sampleSystem:iSampleSystem\n    audioSystem:iAudioSystem\n}\n\nexport const SyncSystem = ({\n\telementSystem,\n\tsampleSystem,\n\tsocketSystem,\n\taudioSystem\n}: Args) => {\n\n\tconst events = {\n\t\t// TODO: Ask matt about createEvent type definition.\n\t\tonChangeMood: createEvent<any>(),\n\t\tonChangeSoundset: createEvent<any>(),\n\t}\n\n\tconst updateServerTimeOffset = (timestamp) => {\n\t\tsetServerTimeOffset(timestamp * 1000)\n\t\t\tconst seconds = MathExt.millisToSecs(getServerTimeOffset())\n\t\t\tif (seconds > 0) {\n\t\t\t\tlogger.info(`Local time is ahead of server time by ${seconds} seconds.`)\n\t\t\t} else if (seconds < 0) {\n\t\t\t\tlogger.info(`Local time is behind of server time by ${-seconds} seconds.`)\n\t\t\t}\n\t\t}\n\n\t// Save canonical config delivered by server on successful registration. Clients can\n\t// register without session ID or token, and the server will generate values\n\t// accordingly which should be persisted by the client.\n\tconst handleRegistered = (message: SocketAPI.Server.RegisteredParams) => {\n\t\tconfig.sessionId = message.session_id\n\t\tconfig.token = message.token\n\t}\n\tsocketSystem.onNamedMessage('registered')\n\t\t.addListener(handleRegistered)\n\n\tconst handleFullState = (state:SocketAPI.Server.PlayState)=>{\n\t\tif (getServerTimeOffset() === 0) {\n\t\t\tupdateServerTimeOffset(state.timestamp)\n\t\t}\n\t\thandleCommonState(state, true, true)\n\t}\n\tsocketSystem.onNamedMessage('send_full')\n\t\t.addListener(handleFullState)\n\n\tconst handleFullElementState = (state:SocketAPI.Server.PlayState)=>{\n\t\t// Stop any currently playing chunks that belong to a specified Element, but are not\n\t\t// included in the provided state, before updating state via `handlePartialState`.\n\t\tif (getServerTimeOffset() === 0) {\n\t\t\tupdateServerTimeOffset(state.timestamp)\n\t\t}\n\t\tconst newUUids = elementChunksToUuids(state.elements)\n\t\tconst newElementIds = elementChunksToElementIds(state.elements)\n\t\tgetPlayingElements()\n\t\t\t.filter((e) => newElementIds.includes(e.elementId) && !newUUids.includes(e.uuid))\n\t\t\t.forEach((e) => elementSystem.stopElementByUuid(e.uuid))\n\t\thandlePartialState(state)\n\t}\n\tsocketSystem.onNamedMessage('send_full_element')\n\t\t.addListener(handleFullElementState)\n\n\tconst handlePartialState = (state:SocketAPI.Server.PlayState)=>{\n\t\thandleCommonState(state, false, false)\n\t}\n\tsocketSystem.onNamedMessage('send_partial')\n\t\t.addListener(handlePartialState)\n\n\tconst handleCommonState = (\n\t\tstate:SocketAPI.Server.PlayState,\n\t\tfullElements:boolean = false,\n\t\tfullSamples:boolean = false,\n\t) => {\n\t\tconst newElements = state.elements\n\t\tconst newSamples = state.samples\n\t\tconst playingElements = getPlayingElements()\n\t\tconst playingSamples = getPlayingSamples()\n\t\tif (fullElements)\n\t\t\thandleStopElementsOnSendFull(newElements, playingElements)\n\t\tif (fullSamples)\n\t\t\thandleStopSamplesOnSendFull(newSamples, playingSamples)\n\t\thandlePlayElements(newElements, playingElements, fullElements)\n\t\thandlePlaySamples(newSamples, playingSamples)\n\t\tstate.global_volume && audioSystem.setGlobalVolume(state.global_volume)\n\t\tstate.oneshot_volume && elementSystem.setOneshotVolume(state.oneshot_volume)\n\n\t\tif (state.soundset_title) {\n\t\t\tlogger.info(source`\n\t\t\t\tCurrent soundset:\n\t\t\t\t\ttitle: ${state.soundset_title}\n\t\t\t\t\tid: ${state.soundset_pk}\n\t\t\t`)\n\t\t\tevents.onChangeSoundset.invoke({\n\t\t\t\tartwork: state.soundset_artwork,\n\t\t\t\ttitle: state.soundset_title,\n\t\t\t\tpk: state.soundset_pk,\n\t\t\t})\n\t\t}\n\t\tif (state.mood_title) {\n\t\t\tlogger.info(source`\n\t\t\t\tCurrent mood:\n\t\t\t\t\ttitle: ${state.mood_title}\n\t\t\t\t\tid: ${state.mood_pk}\n\t\t\t`)\n\t\t\tevents.onChangeMood.invoke({ title: state.mood_title, pk: state.mood_pk })\n\t\t}\n\t\tlet spawned = 0\n\t\tlet scheduled = 0\n\t\telementSystem.forEachElement((element) => {\n\t\t\tspawned += element.sampleInstanceLookup.size\n\t\t\tscheduled += element.sampleFutureDataLookup.size\n\t\t})\n\t\tlogger.debug(source`\n\t\t\thandleCommonState():\n\t\t\t\tactive samples: ${spawned}\n\t\t\t\tscheduled samples: ${scheduled}\n\t\t`)\n\t\tif (window.Sentry) {\n\t\t\tconst {elements, ...stateObj} = state\n\n\t\t\twindow.Sentry.addBreadcrumb({\n\t\t\t\ttype: \"debug\",\n\t\t\t\tmessage: \"handleCommonState()\",\n\t\t\t\tlevel: \"info\",\n\t\t\t\tdata: {\n\t\t\t\t\t...stateObj,\n\t\t\t\t\telements: JSON.stringify(elements),\n\t\t\t\t\tserverTime: state.timestamp * 1000,\n\t\t\t\t\tclientTime: Date.now(),\n\t\t\t\t\tclientTimeServerTimeDelta: Date.now() - getServerTime(),\n\t\t\t\t\tserverTimeOffset: Date.now() - (state.timestamp * 1000),\n\t\t\t\t\tgetServerTimeOffset: getServerTimeOffset(),\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t}\n\n\tconst handlePlayElements = (newElements:SocketAPI.Server.ElementMap, playingElements:Element.Instance[], full:boolean) => {\n\t\tif (newElements === undefined) {\n\t\t\treturn\n\t\t}\n\n\t\t// Set volume for elements that have no chunks.\n\t\tObject.entries(newElements)\n\t\t\t.filter(([elementId, element]) => element.volume !== undefined && Object.values(element.chunks).length === 0)\n\t\t\t.forEach(([elementId, element]) => elementSystem.setElementIdVolume(Number(elementId), element.volume))\n\n\t\telementChunksToData(newElements)\n\t\t\t.filter(({uuid})=>{\n\t\t\t\tconst existing = playingElements.some(e=>e.uuid === uuid)\n\t\t\t\tif (existing) {\n\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\thandlePlayElements(): Element is already playing. This is probably a bug!\n\t\t\t\t\t\t\tuuid: ${uuid}\n\t\t\t\t\t\t`,\n\t\t\t\t\t\t'newElements:', newElements,\n\t\t\t\t\t\t'playingElements:', playingElements,\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\treturn !existing\n\t\t\t})\n\t\t\t.sort((a, b) => (\n\t\t\t\ta.playlistData.sampleDataList[0].startTime\n\t\t\t\t> b.playlistData.sampleDataList[0].startTime\n\t\t\t\t\t? 1\n\t\t\t\t\t: -1\n\t\t\t))\n\t\t\t.forEach(data=> elementSystem.spawnElementFromData(data, full))\n\t}\n\n\tconst handleStopElementsOnSendFull = (newElements:SocketAPI.Server.ElementMap, playingElements:Element.Instance[])=>\n\t\tplayingElements\n\t\t\t.filter(playingElement=>\n\t\t\t\t!elementChunksToUuids(newElements)\n\t\t\t\t\t.some(uuid=> uuid === playingElement.uuid))\n\t\t\t.forEach(({uuid})=> elementSystem.stopElementByUuid(uuid))\n\n\tconst handleStopElementsByPk = ({pks}:SocketAPI.Server.StopElementsParams)=>{\n\t\tpks.forEach(pk=> elementSystem.stopElementByElementId(pk))\n\t}\n\tconst handleStopPlaylistEntriesByPk = ({pks}: SocketAPI.Server.StopElementsParams) => {\n\t\tpks.forEach(pk => sampleSystem.stopPlaylistEntryByPlaylistEntryId(pk))\n\t}\n\tconst handleStopSamplesByPk = ({pks}:SocketAPI.Server.StopSamplesParams) => {\n\t\tpks.forEach(pk => sampleSystem.stopDirectSampleBySampleId(pk))\n\t}\n\tconst handleStopSamplesByUuid = ({uuids}:SocketAPI.Server.StopSamplesParams) => {\n\t\tuuids.forEach(uuid => sampleSystem.stopSampleBySampleUuid(uuid))\n\t}\n\n\tconst handlePlaySamples = (newSamples: SocketAPI.Server.SampleMap, playingSamples: Sample.Instance[]) => {\n\t\tif (newSamples) {\n\t\t\tObject.values(newSamples).filter(({ uuid }) => {\n\t\t\t\tconst existing = playingSamples.some(s=>s.uuid === uuid)\n\t\t\t\tif (existing) {\n\t\t\t\t\tlogger.debug(source`\n\t\t\t\t\t\thandlePlaySamples(): Sample is already playing. This is probably a bug!\n\t\t\t\t\t\t\tuuid: ${uuid}\n\t\t\t\t\t\t`,\n\t\t\t\t\t\t'newSamples:', newSamples,\n\t\t\t\t\t\t'playingSamples:', playingSamples,\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\treturn !existing\n\t\t\t})\n\t\t\t.sort((a, b) => a.start > b.start ? 1 : -1)\n\t\t\t.forEach((sample) => {\n\t\t\t\tconst data: Sample.Data = {\n\t\t\t\t\t...sample,\n\t\t\t\t\tsampleId: sample.id,\n\t\t\t\t\tduration: secsToMillis(sample.end - sample.start),\n\t\t\t\t\tspatializable: false,\n\t\t\t\t\tstartTime: secsToMillis(sample.start) ?? getServerTime(),\n\t\t\t\t}\n\t\t\t\tsampleSystem.spawnSampleFromData({ data })\n\t\t\t})\n\t\t}\n\t}\n\n\tconst handleStopSamplesOnSendFull = (\n\t\tnewSamples:SocketAPI.Server.SampleMap, playingSamples:Sample.Instance[]\n\t) => {\n\t\treturn playingSamples\n\t\t\t// Get `playingSamples` that are not in `newSamples`.\n\t\t\t.filter((playingSample) => {\n\t\t\t\t// Sample is not part of an element instance (has no `elementId` property)\n\t\t\t\treturn !Object.keys(newSamples).some(uuid => playingSample.elementId && uuid === playingSample.uuid)\n\t\t\t})\n\t\t\t.forEach(({uuid})=> {\n\t\t\t\tsampleSystem.stopSampleBySampleUuid(uuid)\n\t\t\t})\n\t}\n\n\tsocketSystem.onNamedMessage('stop_elements')\n\t\t.addListener(handleStopElementsByPk)\n\tsocketSystem.onNamedMessage('stop_playlist_entries')\n\t\t.addListener(handleStopPlaylistEntriesByPk)\n\tsocketSystem.onNamedMessage('stop_samples')\n\t\t.addListener(handleStopSamplesByPk)\n\tsocketSystem.onNamedMessage('stop_all')\n\t\t.addListener(()=>{\n\t\t\telementSystem.stopAllElements()\n\t\t\tsampleSystem.stopAllSamples()\n\t\t})\n\tsocketSystem.onNamedMessage('set_global_volume')\n\t\t.addListener(({volume}) => {\n\t\t\taudioSystem.setGlobalVolume(volume)\n\t\t})\n\tsocketSystem.onNamedMessage('set_oneshot_volume')\n\t\t.addListener(({volume}) => {\n\t\t\telementSystem.setOneshotVolume(volume)\n\t\t})\n\tsocketSystem.onNamedMessage('set_element_volume')\n\t\t.addListener(({pk, volume}) => {\n\t\t\telementSystem.setElementIdVolume(pk, volume)\n\t\t})\n\n\tconst getPlayingElements = ()=>[...elementSystem.getElements().values()]\n\tconst getPlayingSamples = () => {\n\t\t// Only samples that were played directly (with no associated elementId\n\t\t// or playlistEntryId).\n\t\treturn [...sampleSystem.getSamples().values()].filter(\n\t\t\t(sample) => !sample.elementId && !sample.playlistEntryId\n\t\t)\n\t}\n\t// const extractSamples = (elements:SocketAPI.Server.Element[])=>\n\t// elements.map(e=> Object.values(e.chunks))\n\n\n\treturn {\n\t\tevents,\n\t\thandleFullState,\n\t\thandlePartialState\n\t}\n}\n\nexport type SyncSystem = ReturnType<typeof SyncSystem>\n","import $ from 'jquery'\nimport 'app/common/dumbStubs'\nimport { createAudioSystem } from 'modules-core/audioSystem'\nimport { createAuthSystem } from 'modules-core/authSystem'\nimport { eventSystem } from './eventSystem'\nimport { postMessageSystem } from './postMessageSystem'\nimport { ControlSystem } from 'modules-core/controlSystem'\nimport { createElementSystem } from 'modules-core/elementSystem'\nimport { createSampleSystem } from 'modules-core/sampleSystem'\nimport { SocketSystem } from 'modules-core/socket'\nimport { SyncSystem } from 'modules-core/syncSystem'\nimport { createUrlSystem } from 'modules-core/urlSystem'\nimport { createUuidSystem } from 'modules-core/uuidSystem'\nimport config from 'modules-core/config'\nimport log from 'modules-core/log'\nimport syrinscape from 'app/common/syrinscape'\n\n// Register events.\neventSystem.add('playerActive')\neventSystem.add('playerInactive')\n\nconst logger = log.getLogger('player')\n\ninterface PlayerInitOpts {\n\tcontext?: string\n\tconfigure?: () => void\n\tinitialConfig?: {}\n\tonActive?: () => void\n\tonInactive?: () => void\n\tselector?: string\n}\n\nexport const createPlayer = () => {\n\tlogger.info('createPlayer()')\n\tconst urlSystem = createUrlSystem()\n\tconst socketSystem = SocketSystem({ urlSystem })\n\tconst audioSystem = createAudioSystem({ urlSystem })\n\tconst audioEffectSystem = audioSystem.effectSystem\n\tconst authSystem = createAuthSystem({ urlSystem })\n\tconst controlSystem = ControlSystem({ authSystem, socketSystem })\n\tconst uuidSystem = createUuidSystem()\n\tconst sampleSystem = createSampleSystem({ audioSystem, uuidSystem })\n\tconst elementSystem = createElementSystem({ authSystem, audioSystem, sampleSystem, uuidSystem })\n\tconst syncSystem = SyncSystem({ audioSystem, elementSystem, sampleSystem, socketSystem })\n\tconst start = async () => {\n\t\tawait audioSystem.init()\n\t\taudioSystem.setLocalVolume(config.localVolume)\n\t\tawait socketSystem.connect()\n\t}\n\treturn {\n\t\tpostMessageSystem,\n\t\turlSystem,\n\t\tsocketSystem,\n\t\taudioSystem,\n\t\taudioEffectSystem,\n\t\tcontrolSystem,\n\t\tsampleSystem,\n\t\telementSystem,\n\t\tsyncSystem,\n\t\tinit: async ({\n\t\t\tconfigure,\n\t\t\tcontext = 'default',\n\t\t\tinitialConfig = {},\n\t\t\tonActive,\n\t\t\tonInactive,\n\t\t\tselector = 'body',\n\t\t}: PlayerInitOpts = {}) => {\n\t\t\tlet deferred: HTMLElement[] = []\n\t\t\t// Populate config from storage and set defaults.\n\t\t\tawait config.init(context, initialConfig)\n\t\t\t// User configuration.\n\t\t\tif (typeof configure === 'function') {\n\t\t\t\tawait configure()\n\t\t\t}\n\t\t\t// Start and execute onActive.\n\t\t\tconst activate = async () => {\n\t\t\t\tawait start()\n\t\t\t\tlogger.info('Player is active.')\n\t\t\t\t// Start visualisation loop.\n\t\t\t\tsyrinscape.visualisation?.init()\n\t\t\t}\n\t\t\t// No interaction required. Activate immediately.\n\t\t\tif (config.audioContext.state !== 'suspended') {\n\t\t\t\tawait activate()\n\t\t\t\t// Execute callback.\n\t\t\t\tif (typeof onActive === 'function') {\n\t\t\t\t\tonActive()\n\t\t\t\t\teventSystem.dispatch('playerActive')\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Configure unlock on interaction, with deferred clicks.\n\t\t\telse {\n\t\t\t\tlet locked = true\n\t\t\t\tlogger.warn('Player is inactive.')\n\t\t\t\tif (typeof onInactive === 'function') {\n\t\t\t\t\tonInactive()\n\t\t\t\t\teventSystem.dispatch('playerInactive')\n\t\t\t\t}\n\t\t\t\tconst unlock = async (event) => {\n\t\t\t\t\tif (event.target.closest(selector) === null) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t// Only unlock on primary click.\n\t\t\t\t\tif (event.button && event.button !== 0) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t// Defer this event until activation.\n\t\t\t\t\tdeferred.push(event.target)\n\t\t\t\t\tevent.preventDefault()\n\t\t\t\t\tevent.stopImmediatePropagation()\n\t\t\t\t\t// Only unlock once.\n\t\t\t\t\tif (locked) {\n\t\t\t\t\t\tlocked = false\n\t\t\t\t\t\tawait config.audioContext.resume()\n\t\t\t\t\t\tawait activate()\n\t\t\t\t\t\tclean()\n\t\t\t\t\t\t// Execute callback *after* clean. Otherwise, the callback might trigger\n\t\t\t\t\t\t// events that will be deferred indefinitely.\n\t\t\t\t\t\tif (typeof onActive === 'function') {\n\t\t\t\t\t\t\tonActive()\n\t\t\t\t\t\t\teventSystem.dispatch('playerActive')\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Trigger deferred events and remove unlock event handler.\n\t\t\t\tconst clean = () => {\n\t\t\t\t\tdocument.removeEventListener('click', unlock, true)\n\t\t\t\t\t// It seems we are inexplicably required to trigger the click\n\t\t\t\t\t// asynchronously via setTimeout, or the deferred click never triggers.\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\twhile (deferred.length > 0) {\n\t\t\t\t\t\t\tlet target = deferred.pop()\n\t\t\t\t\t\t\tlogger.info('Executing deferred click for', target)\n\t\t\t\t\t\t\ttarget.click()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 0)\n\t\t\t\t}\n\t\t\t\t// Add unlock/defer event handler.\n\t\t\t\tdocument.addEventListener('click', unlock, true)\n\t\t\t}\n\t\t},\n\t}\n}\n\nsyrinscape.player ??= createPlayer()\n\nexport const player = syrinscape.player\nexport default player\n","\nimport { createEvent, wait } from 'modules-core/utility'\nimport { defaultEffectFileUrl } from '.'\nimport { createDefaultEffectFile } from './defaultEffectFile'\nimport { createEffectMap } from './effects/createEffectMap'\nimport { AudioEffect } from './types'\nimport config from 'modules-core/config'\nimport getServerTime from 'modules-core/utility/serverTime'\n\nexport const createAudioEffectSystem = () => {\n\tconst effectMap: AudioEffect.EffectMap = {}\n\tlet file: AudioEffect.EffectFile = null\n\n\tconst system = {\n\t\tonFileChange: createEvent<AudioEffect.EffectFile>(),\n\t\tinit: async (useDefault = true) => {\n\t\t\tif(useDefault)\n\t\t\t\tawait system.loadFile(createDefaultEffectFile())\n\t\t\telse\n\t\t\t\tawait system.loadFileFromUrl(defaultEffectFileUrl)\n\t\t},\n\t\tloadFile: async (_file: AudioEffect.EffectFile) => {\n\t\t\tfile = _file\n\t\t\tawait system.rebuildAllEffects(file.effects)\n\t\t},\n\t\tloadFileFromUrl: async (url: string) => {\n\t\t\tconst response = await fetch(url)\n\t\t\tconst json = await response.json()\n\t\t\tawait system.loadFile(json)\n\t\t},\n\t\tget analyser() { return effectMap['Analyser'] as AudioEffect.AnalyserEffect },\n\t\tget defaultPreset() { return file.presets['Default'] },\n\t\tget globalVolume() { return effectMap['Global Volume'] as AudioEffect.VolumeEffect },\n\t\tget localVolume() { return effectMap['Local Volume'] as AudioEffect.VolumeEffect },\n\t\tpreset: (preset: AudioEffect.Preset) =>\n\t\t\tfile.presets[preset],\n\t\teffect: <T extends AudioEffect.Effect>(name: string) =>\n\t\t\teffectMap[name] as T,\n\t\tupdatePreset: (params: AudioEffect.PresetParams) => {\n\t\t\tfile.presets[params.name] = params\n\t\t\tsystem.updateFile()\n\t\t},\n\t\trebuildAllEffects: async (effects: AudioEffect.EffectParams[]) => {\n\t\t\tsystem.disconnectAll()\n\t\t\tawait Promise.all(effects.map(system.buildEffect))\n\t\t\tsystem.reconnectAll()\n\t\t},\n\t\tbuildEffect: async (params: AudioEffect.EffectParams) => {\n\t\t\teffectMap[params.name]?.disconnectAll()\n\t\t\tconst effect = await createEffectMap[params.type](params)\n\t\t\teffectMap[params.name] = effect\n\t\t},\n\t\tbuildEffectAndReconnectAll: async (params: AudioEffect.EffectParams) => {\n\t\t\tawait system.buildEffect(params)\n\t\t\tsystem.reconnectAll()\n\t\t},\n\t\tconnectEffect: (effect: AudioEffect.Effect) => {\n\t\t\tif (effect.params.output) {\n\t\t\t\tif (!effectMap[effect.params.output])\n\t\t\t\t\tthrow new Error(`Audio effect not found: ${effect.params.output}`)\n\t\t\t\teffect.connect(effectMap[effect.params.output])\n\t\t\t\teffect.connectFromMap?.(effectMap)\n\t\t\t}\n\t\t\telse//only for master\n\t\t\t\teffect.output.connect(config.audioContext.destination)\n\t\t},\n\t\treconnectAll: () => {\n\t\t\tObject.values(effectMap)\n\t\t\t\t.forEach(system.connectEffect)\n\t\t\tsystem.updateFile()\n\t\t},\n\t\ttrySetParam: (effectName: string, paramName: string, value: any) => {\n\t\t\tif (effectMap[effectName]?.setParam[paramName]) {\n\t\t\t\teffectMap[effectName].setParam[paramName](value)\n\t\t\t\tfile = setFileEffectParam(file, effectName, paramName, value)\n\t\t\t\tfile.timestamp = getServerTime()\n\t\t\t\treturn true\n\t\t\t}\n\t\t\treturn false\n\t\t},\n\t\tupdateFile: () => {\n\t\t\tfile.effects = Object.values(effectMap).map(e => e.params)\n\t\t\tfile.effects.sort((a, b) => a.name > b.name ? 1 : -1)\n\t\t\tfile.timestamp = getServerTime()\n\t\t\t// if(!quiet)\n\t\t\tsystem.onFileChange.invoke(file)\n\t\t},\n\t\tdisconnectAll: () => {\n\t\t\tObject.keys(effectMap)\n\t\t\t\t.forEach(system.disposeEffect)\n\t\t},\n\t\tdisposeEffect: (name: string) => {\n\t\t\teffectMap[name].disconnectAll()\n\t\t\tdelete effectMap[name]\n\t\t\t// effectMap[name] = undefined\n\t\t},\n\t\tdisposeEffectAndReconnectAll: (name: string) => {\n\t\t\tsystem.disposeEffect(name)\n\t\t\tsystem.reconnectAll()\n\t\t},\n\t}\n\treturn system\n}\n\n\nexport const setFileEffectParam = (file: AudioEffect.EffectFile, effectName: string, paramName: string, paramValue: any) => {\n\t//this would be a one-liner if we used maps instead of arrays\n\tconst next = { ...file, effects: [...file.effects] }\n\tconst eff = next.effects.find(e => e.name === effectName)\n\tconst index = next.effects.indexOf(eff)\n\tnext.effects[index] = { ...eff, [paramName]: paramValue }\n\treturn next\n}\n\nexport type AudioEffectSystem = ReturnType<typeof createAudioEffectSystem>\n","import getServerTime from 'modules-core/utility/serverTime'\nimport { createDefaultEffectParams } from './constants'\nimport { caveConvolverUrl, concertHallConvolverUrl, stairwellConvolverUrl } from './convolverUrls'\nimport { AudioEffect } from './types'\n\n\n\nexport const createDefaultEffectFile = (): AudioEffect.EffectFile => ({\n\t\"effects\": [\n\t\t{\n\t\t\t\"name\": \"Alley ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/0vz8w5byepxv8k4/Sweep%20samples_Alley2nd%20try_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"fftSize\": 256,\n\t\t\t\"isDestination\": true,\n\t\t\t\"maxDecibels\": -30,\n\t\t\t\"minDecibels\": -100,\n\t\t\t\"name\": \"Analyser\",\n\t\t\t\"smoothingTimeConstant\": 0.8,\n\t\t\t\"type\": \"analyser\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Arena ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/ov18hhpdpe98yyr/Sweep%20samples_Arena_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Auditorium ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/5oqio2hvvag7sou/Sweep%20samples_Auditorium_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Bathroom ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/x32s6651nwnyvbb/BathroomSweep-96000-24-M-10.0s_dc.zwav.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Carpetted Hallway ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/f0zbljvpkl9iaba/Sweep%20samples_Carpetted%20Hallway_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Cave\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/fmv48mbfvagf9gk/Room_capture_Cave_01_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Cave ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/ey33w5dnkdklz7d/Sweep%20samples_Cave_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"City ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/fds6qyegx4dmcum/Room_capture_City_02_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"attack\": 0.003,\n\t\t\t\"knee\": 30,\n\t\t\t\"name\": \"Compressor\",\n\t\t\t\"output\": \"Analyser\",\n\t\t\t\"ratio\": 12,\n\t\t\t\"release\": 0.25,\n\t\t\t\"threshold\": -24,\n\t\t\t\"type\": \"compressor\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Concert Hall\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/cz4rpyxx4dqdacp/Room_capture_Concert%20hall_03_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Concert Hall ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/22vly35tb4e5nsp/Sweep%20samples_Concert%20Hall_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Crazed ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/32i3gbl2ac5ixra/Sweep%20samples_Crazed_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Dazed ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/f4betvklj5uk6e8/Sweep%20samples_Dazed_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"dryOutput\": \"Global Volume\",\n\t\t\t\"name\": \"Dry Long\",\n\t\t\t\"output\": \"Concert Hall\",\n\t\t\t\"type\": \"send\",\n\t\t\t\"wetness\": 0.5\n\t\t},\n\t\t{\n\t\t\t\"dryOutput\": \"Global Volume\",\n\t\t\t\"name\": \"Dry Short\",\n\t\t\t\"output\": \"Concert Hall\",\n\t\t\t\"type\": \"send\",\n\t\t\t\"wetness\": 0.2\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Flooded Cavern ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/q5k8hfimlka8u3m/Sweep%20samples_Flooded%20Cavern_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Forest ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/3sh05lsoffimjsb/Room_capture_Forest_05_fix_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"fadeDuration\": 1,\n\t\t\t\"name\": \"Global Volume\",\n\t\t\t\"output\": \"Local Volume\",\n\t\t\t\"type\": \"volume\",\n\t\t\t\"volume\": 1\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Hallway ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/fkk8zxram928imu/Room_capture_Hallway_05_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Hanger ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/cafxgkmm38nq9n3/Sweep%20samples_Hanger_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"fadeDuration\": 1,\n\t\t\t\"name\": \"Local Volume\",\n\t\t\t\"output\": \"Compressor\",\n\t\t\t\"type\": \"volume\",\n\t\t\t\"volume\": 1\n\t\t},\n\t\t{\n\t\t\t\"dampening\": 6000,\n\t\t\t\"gain\": 0.2,\n\t\t\t\"hpFrequency\": 600,\n\t\t\t\"hpResonance\": 0.5,\n\t\t\t\"lpFrequency\": 2000,\n\t\t\t\"lpResonance\": 0.5,\n\t\t\t\"name\": \"Long Reverb\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"preDelay\": 0.01,\n\t\t\t\"roomSize\": 0.9,\n\t\t\t\"type\": \"freeverb\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Metal Room ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/8df9jkybo5j5j8t/Room_capture_Metal%20room_06_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Mountains ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/b8hgw5uimhb9efv/Room_capture_Mountains_07_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Padded Cell ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/oqrk3ied4b71yiy/Sweep%20samples_Padded%20Cell_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Parking lot ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/qpuxz6ujbgxumeu/Room_capture_Parking%20lot_08_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Plains ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/x9r8r4cyyuaja7d/Room_capture_Plain_09_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Poisoned ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/vrlkoo9xnc294ao/Sweep%20samples_Poisoned_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Quarry ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/zw2hfyk7reichz9/Sweep%20samples_Quarry_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Sewer pipe ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/ltj5zfi1avlmovp/Room_capture_Sewer_10_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"duration\": 0.2,\n\t\t\t\"falloff\": 0.4,\n\t\t\t\"name\": \"Simple Delay\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"delay\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Soft furnished room ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/bf8b9jy0jhbnqft/Sweep%20samples_Soft%20furnished%20room_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Stairwell\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/sjzu2078lg4bpwh/3000CStreetGarageStairwell.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Stone Corridor ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/c8ky9offetjl7ld/Sweep%20samples_Stone%20corridor_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Stone Dungeon ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/vrhznwahzoc2sno/Room_capture_Stone%20Dungeon_11_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Stone room ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/u3zxtfmav475pyu/Sweep%20samples_Stone%20room_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Through a heavy door ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/3iru4ke6t90t8o2/Sweep%20samples_Through%20a%20heavy%20door_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Through a light door ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/opbkl2qp9foncm4/Sweep%20samples_Through%20a%20light%20door_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Underwater ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/wqd1hhrscm717s2/Room_capture_Underwater_12_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"name\": \"Vanilla room ss\",\n\t\t\t\"output\": \"Global Volume\",\n\t\t\t\"type\": \"convolver\",\n\t\t\t\"url\": \"https://dl.dropboxusercontent.com/s/51px3ofee71ob75/Sweep%20samples_Vanila%20room_dc.wav?dl=0\"\n\t\t},\n\t\t{\n\t\t\t\"dryOutput\": \"Global Volume\",\n\t\t\t\"name\": \"Wet Effect\",\n\t\t\t\"output\": \"Simple Delay\",\n\t\t\t\"type\": \"send\",\n\t\t\t\"wetness\": 0.7\n\t\t},\n\t\t{\n\t\t\t\"dryOutput\": \"Global Volume\",\n\t\t\t\"name\": \"Wet Long\",\n\t\t\t\"output\": \"Long Reverb\",\n\t\t\t\"type\": \"send\",\n\t\t\t\"wetness\": 1\n\t\t},\n\t\t{\n\t\t\t\"dryOutput\": \"Global Volume\",\n\t\t\t\"name\": \"Wet Short\",\n\t\t\t\"output\": \"Stairwell\",\n\t\t\t\"type\": \"send\",\n\t\t\t\"wetness\": 0.75\n\t\t}\n\t],\n\t\"presets\": {\n\t\t\"Alley\": {\n\t\t\t\"dryGain\": 2,\n\t\t\t\"drySpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 30,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 1,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t},\n\t\t\t\"effect\": \"Alley ss\",\n\t\t\t\"name\": \"Alley\",\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 50,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.5,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Arena\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"drySpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 1,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t},\n\t\t\t\"effect\": \"Arena ss\",\n\t\t\t\"name\": \"Arena\",\n\t\t\t\"wetGain\": 0.1,\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.4,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Auditorium\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Auditorium ss\",\n\t\t\t\"name\": \"Auditorium\",\n\t\t\t\"wetGain\": 0.1\n\t\t},\n\t\t\"Bathroom\": {\n\t\t\t\"effect\": \"Bathroom ss\",\n\t\t\t\"name\": \"Bathroom\"\n\t\t},\n\t\t\"Carpetted Hallway\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Carpetted Hallway ss\",\n\t\t\t\"name\": \"Carpetted Hallway\",\n\t\t\t\"wetGain\": 0.4\n\t\t},\n\t\t\"Cave\": {\n\t\t\t\"effect\": \"Cave\",\n\t\t\t\"name\": \"Cave\"\n\t\t},\n\t\t\"City\": {\n\t\t\t\"effect\": \"City ss\",\n\t\t\t\"name\": \"City\"\n\t\t},\n\t\t\"Concert Hall\": {\n\t\t\t\"dryGain\": 0.5,\n\t\t\t\"effect\": \"Concert Hall ss\",\n\t\t\t\"name\": \"Concert Hall\",\n\t\t\t\"wetGain\": 1\n\t\t},\n\t\t\"Crazed\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Crazed ss\",\n\t\t\t\"name\": \"Crazed\",\n\t\t\t\"wetGain\": 0.3\n\t\t},\n\t\t\"Dazed\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Dazed ss\",\n\t\t\t\"name\": \"Dazed\",\n\t\t\t\"wetGain\": 0.1\n\t\t},\n\t\t\"Default\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"drySpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"My spatial effect 2\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 1,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t},\n\t\t\t\"effect\": \"Global Volume\",\n\t\t\t\"isFixed\": true,\n\t\t\t\"name\": \"Default\",\n\t\t\t\"wetGain\": 1,\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"My spatial effect 1\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.4,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Flooded Cavern\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Flooded Cavern ss\",\n\t\t\t\"name\": \"Flooded Cavern\",\n\t\t\t\"wetGain\": 0.5\n\t\t},\n\t\t\"Forest\": {\n\t\t\t\"effect\": \"Forest ss\",\n\t\t\t\"name\": \"Forest\"\n\t\t},\n\t\t\"Hallway\": {\n\t\t\t\"effect\": \"Hallway ss\",\n\t\t\t\"name\": \"Hallway\"\n\t\t},\n\t\t\"Hangar\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Hanger ss\",\n\t\t\t\"name\": \"Hangar\",\n\t\t\t\"wetGain\": 0.15,\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.8,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Metal Room\": {\n\t\t\t\"effect\": \"Metal Room ss\",\n\t\t\t\"name\": \"Metal Room\"\n\t\t},\n\t\t\"Mountains\": {\n\t\t\t\"effect\": \"Mountains ss\",\n\t\t\t\"name\": \"Mountains\",\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.8,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Off\": {\n\t\t\t\"effect\": \"Global Volume\",\n\t\t\t\"name\": \"Off\"\n\t\t},\n\t\t\"Padded Cell\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Padded Cell ss\",\n\t\t\t\"name\": \"Padded Cell\",\n\t\t\t\"wetGain\": 0.2\n\t\t},\n\t\t\"Parking lot\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Parking lot ss\",\n\t\t\t\"name\": \"Parking lot\",\n\t\t\t\"wetGain\": 0.3\n\t\t},\n\t\t\"Plain\": {\n\t\t\t\"effect\": \"Plains ss\",\n\t\t\t\"name\": \"Plain\"\n\t\t},\n\t\t\"Poisoned\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Poisoned ss\",\n\t\t\t\"name\": \"Poisoned\",\n\t\t\t\"wetGain\": 0.5,\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.5,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Quarry\": {\n\t\t\t\"effect\": \"Quarry ss\",\n\t\t\t\"name\": \"Quarry\"\n\t\t},\n\t\t\"Sewer pipe\": {\n\t\t\t\"effect\": \"Sewer pipe ss\",\n\t\t\t\"name\": \"Sewer pipe\"\n\t\t},\n\t\t\"Soft furnished room\": {\n\t\t\t\"effect\": \"Soft furnished room ss\",\n\t\t\t\"name\": \"Soft furnished room\"\n\t\t},\n\t\t\"Stone Corridor\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Stone Corridor ss\",\n\t\t\t\"name\": \"Stone Corridor\",\n\t\t\t\"wetGain\": 0.3\n\t\t},\n\t\t\"Stone Dungeon\": {\n\t\t\t\"effect\": \"Stone Dungeon ss\",\n\t\t\t\"name\": \"Stone Dungeon\",\n\t\t\t\"wetGain\": 6.33\n\t\t},\n\t\t\"Stone room\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Stone room ss\",\n\t\t\t\"name\": \"Stone room\",\n\t\t\t\"wetGain\": 0.4\n\t\t},\n\t\t\"Through a heavy door\": {\n\t\t\t\"dryGain\": 0,\n\t\t\t\"effect\": \"Through a heavy door ss\",\n\t\t\t\"name\": \"Through a heavy door\",\n\t\t\t\"wetGain\": 0.5,\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"exponential\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.7,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Through a light door\": {\n\t\t\t\"dryGain\": 0.1,\n\t\t\t\"effect\": \"Through a light door ss\",\n\t\t\t\"name\": \"Through a light door\",\n\t\t\t\"wetGain\": 0.47,\n\t\t\t\"wetSpatializer\": {\n\t\t\t\t\"distanceModel\": \"inverse\",\n\t\t\t\t\"maxDistance\": 100,\n\t\t\t\t\"minDistance\": 1,\n\t\t\t\t\"name\": \"Wet Spatializer\",\n\t\t\t\t\"output\": \"Global Volume\",\n\t\t\t\t\"panningModel\": \"HRTF\",\n\t\t\t\t\"position\": {\n\t\t\t\t\t\"x\": 0,\n\t\t\t\t\t\"y\": 0,\n\t\t\t\t\t\"z\": 0\n\t\t\t\t},\n\t\t\t\t\"rolloff\": 0.7,\n\t\t\t\t\"speed\": 0,\n\t\t\t\t\"type\": \"spatial\"\n\t\t\t}\n\t\t},\n\t\t\"Underwater\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Underwater ss\",\n\t\t\t\"name\": \"Underwater\",\n\t\t\t\"wetGain\": 0.3\n\t\t},\n\t\t\"Vanilla room\": {\n\t\t\t\"dryGain\": 1,\n\t\t\t\"effect\": \"Vanilla room ss\",\n\t\t\t\"name\": \"Vanilla room\",\n\t\t\t\"wetGain\": 0.5\n\t\t}\n\t},\n\t\"timestamp\": 1672719228481.26\n})\n","import { AudioEffect } from 'modules-core/audioEffectSystem'\nimport { iEvent } from 'modules-core/utility'\n\nexport const createAsyncAudioSource = (source: iAudioSource) => {\n\n\tlet isReady = false\n\tlet shouldPlay = false\n\tlet cachedCurrentTime = 0\n\tconst asyncSrc = {\n\t\t...source,\n\t\thandleReady: () => {\n\t\t\tisReady = true\n\t\t\tif (shouldPlay)\n\t\t\t\tsource.play(cachedCurrentTime)\n\t\t},\n\t\tplay: (currentTime?: number) => {\n\t\t\tshouldPlay = true\n\t\t\tcachedCurrentTime = currentTime\n\t\t\tif (isReady)\n\t\t\t\tsource.play(currentTime)\n\t\t}\n\t}\n\treturn asyncSrc\n}\n\nexport type AnimationCurve = 'easeIn' | 'easeOut' | 'linear'\n\nexport interface FadeOptions {\n\tfadeIn?: number\n\tfadeOut?: number\n\tfadeScrub?: number\n\tfadeStop?: number\n}\n\nexport interface iAudioSource {\n\tisAlive: boolean\n\tplay: (currentTime?: number) => void\n\tstop: () => Promise<void>\n\tonPlay: iEvent<void>\n\tonDispose: iEvent<void>\n}\n\nexport interface iCreateAudioSource {\n\t(src: string, output: AudioEffect.HasOutput): iAudioSource\n}\n\nexport interface iCreateSourceInstantiatorArgs {\n\tcontext: AudioContext\n}\n\nexport interface iSourceInstantiator {\n\tcreateAudioSource: iCreateAudioSource\n}\n\nexport interface iCreateSourceInstantiator {\n\t(args: iCreateSourceInstantiatorArgs): iSourceInstantiator\n}","import { checkStatus, throwNoAuthError } from './errors'\nimport { createUrlSystem, iUrlSystem } from 'modules-core/urlSystem'\nimport config from 'modules-core/config'\n\ninterface iArgs {\n\turlSystem?: iUrlSystem\n}\n\n\n\nexport function createAuthSystem({\n\turlSystem,\n}: iArgs = {}) {\n\turlSystem = urlSystem || createUrlSystem()\n\n\tconst authSystem = {\n\t\tauthorizedFetchUrl: async (url: string, opts = {} as Auth.iRequestOpts, checkResponseStatus = true) => {\n\t\t\topts.headers = { ...opts.headers, 'Authorization': `Token ${config.token}` }\n\t\t\tconst response = await fetch(url, opts)\n\t\t\tcheckResponseStatus && checkStatus(response)\n\t\t\treturn response\n\t\t},\n\t\tauthorizedFetchBlob: async (url: string, opts = {} as Auth.iRequestOpts, checkResponseStatus = true) => {\n\t\t\tconst response = await authSystem.authorizedFetchUrl(url, opts, checkResponseStatus)\n\t\t\treturn await response.blob()\n\t\t},\n\t\tauthorizedFetchPath: async (urlPath: string, opts = {} as Auth.iRequestOpts) => {\n\t\t\tconst url = urlSystem.createUrlHttp(urlPath)\n\t\t\treturn authSystem.authorizedFetchUrl(url, opts)\n\t\t},\n\n\t}\n\treturn authSystem\n}\n\n\n// export const fetchWithQueryParamsToken = async ({ url, opts, authState }: iHandleAuthorizedFetch) => {\n//\t const seperator = url.includes('?') ? '&' : '?'\n//\t url = `${url}${seperator}${objectToQueryParams({ auth_token: authState.authToken })}`\n//\t return await fetch(url, opts)\n// }\n\nexport type iAuthSystem = ReturnType<typeof createAuthSystem>\n"],"names":["combFilterTunings","allpassFilterFrequencies","LowpassCombFilter","module","exports","audioContext","node","createGain","channelCountMode","channelCount","output","merger","createChannelMerger","splitter","createChannelSplitter","highpass","createBiquadFilter","type","frequency","value","wet","dry","connect","combFilters","allpassFiltersL","allpassFiltersR","roomSize","dampening","l","length","allpassL","push","r","allpassR","c","lfpf","delayTime","Object","defineProperties","get","set","refreshFilters","bind","disconnect","gain","i","resonance","context","createDelay","Q","feedback","e","t","n","s","o","u","f","Error","code","call","_dereq_","global","scheduleDrain","draining","Mutation","MutationObserver","WebKitMutationObserver","called","observer","nextTick","element","document","createTextNode","observe","characterData","data","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","setTimeout","channel","port1","onmessage","port2","postMessage","queue","oldQueue","len","task","this","g","self","window","immediate","INTERNAL","handlers","REJECTED","FULFILLED","PENDING","Promise","resolver","TypeError","state","outcome","safelyResolveThenable","QueueItem","promise","onFulfilled","onRejected","callFulfilled","otherCallFulfilled","callRejected","otherCallRejected","unwrap","func","returnValue","reject","resolve","getThen","obj","then","apply","arguments","thenable","onError","onSuccess","result","tryCatch","status","out","prototype","constructor","error","reason","all","iterable","toString","values","Array","resolved","allResolver","outValue","race","response","_typeof","Symbol","iterator","idb","indexedDB","webkitIndexedDB","mozIndexedDB","OIndexedDB","msIndexedDB","getIDB","createBlob","parts","properties","Blob","name","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","append","getBlob","Promise$1","executeCallback","callback","executeTwoCallbacks","errorCallback","normalizeKey","key","console","warn","String","getCallback","DETECT_BLOB_SUPPORT_STORE","supportsBlobs","dbContexts","READ_ONLY","READ_WRITE","_binStringToArrayBuffer","bin","buf","ArrayBuffer","arr","Uint8Array","charCodeAt","_checkBlobSupport","txn","transaction","blob","objectStore","put","onabort","preventDefault","stopPropagation","oncomplete","matchedChrome","navigator","userAgent","match","matchedEdge","parseInt","_checkBlobSupportWithoutCaching","_deferReadiness","dbInfo","dbContext","deferredOperation","deferredOperations","dbReady","_advanceReadiness","pop","_rejectReadiness","err","_getConnection","upgradeNeeded","forages","db","close","dbArgs","version","openreq","open","onupgradeneeded","createObjectStore","storeName","oldVersion","ex","newVersion","onerror","onsuccess","onversionchange","target","_getOriginalConnection","_getUpgradedConnection","_isUpgradeNeeded","defaultVersion","isNewStore","objectStoreNames","contains","isDowngrade","isUpgrade","incVersion","_decodeBlob","encodedBlob","atob","_isEncodedBlob","__local_forage_encoded_blob","_fullyReady","_initReady","_dbInfo","createTransaction","mode","retries","undefined","tx","forage","_tryReconnect","asyncStorage","_driver","_initStorage","options","ready","initPromises","ignoreErrors","j","slice","_defaultConfig","k","_support","isSafari","openDatabase","test","platform","hasFetch","fetch","indexOf","IDBKeyRange","isIndexedDBValid","iterate","req","openCursor","iterationNumber","cursor","getItem","setItem","blobSupport","reader","FileReader","onloadend","base64","btoa","readAsBinaryString","store","removeItem","clear","count","advanced","openKeyCursor","advance","keys","dropInstance","currentConfig","config","dbPromise","deleteObjectStore","_forage2","deleteDatabase","onblocked","BASE_CHARS","BLOB_TYPE_PREFIX_REGEX","SERIALIZED_MARKER","SERIALIZED_MARKER_LENGTH","TYPE_ARRAYBUFFER","TYPE_BLOB","TYPE_INT8ARRAY","TYPE_UINT8ARRAY","TYPE_UINT8CLAMPEDARRAY","TYPE_INT16ARRAY","TYPE_INT32ARRAY","TYPE_UINT16ARRAY","TYPE_UINT32ARRAY","TYPE_FLOAT32ARRAY","TYPE_FLOAT64ARRAY","TYPE_SERIALIZED_MARKER_LENGTH","toString$1","stringToBuffer","serializedString","encoded1","encoded2","encoded3","encoded4","bufferLength","p","buffer","bytes","bufferToString","base64String","substring","localforageSerializer","serialize","valueType","marker","fileReader","onload","str","readAsArrayBuffer","JSON","stringify","deserialize","parse","blobType","matcher","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","createDbTable","executeSql","tryExecuteSql","sqlStatement","args","SYNTAX_ERR","results","rows","_setItem","retriesLeft","originalValue","serializer","sqlError","QUOTA_ERR","getAllStoreNames","storeNames","item","webSQLStorage","dbInfoPromise","description","size","operationInfo","dropTable","operations","_getKeyPrefix","defaultConfig","keyPrefix","_isLocalStorageUsable","localStorageTestKey","localStorage","checkIfLocalStorageThrows","localStorageWrapper","isLocalStorageValid","keyPrefixLength","itemKey","includes","array","searchElement","x","y","isNaN","isArray","arg","DefinedDrivers","DriverSupport","DefaultDrivers","INDEXEDDB","WEBSQL","LOCALSTORAGE","DefaultDriverOrder","OptionalDriverMethods","LibraryMethods","concat","DefaultConfig","driver","callWhenReady","localForageInstance","libraryMethod","_args","extend","_key","hasOwnProperty","localforage_js","LocalForage","driverTypeKey","instance","Constructor","_classCallCheck","driverName","defineDriver","_config","_driverSet","_initDriver","_ready","_wrapLibraryMethodsWithReady","setDriver","replace","driverObject","complianceError","driverMethods","driverMethodName","methodNotImplementedFactory","methodName","_i","_len","optionalDriverMethod","configureMissingMethods","setDriverSupport","support","info","getDriver","getDriverPromise","getSerializer","serializerPromise","drivers","supportedDrivers","_getSupportedDrivers","setDriverToConfig","extendSelfWithDriver","_extend","oldDriverSetDone","currentDriverIndex","driverPromiseLoop","initDriver","supports","libraryMethodsAndProperties","createInstance","root","loglevel","save","defaults","template","levelFormatter","level","toUpperCase","nameFormatter","timestampFormatter","date","toTimeString","format","configs","api","reg","rootLogger","getLogger","logger","setLevel","originalFactory","methodFactory","parent","logLevel","loggerName","originalMethod","hasTimestamp","hasLevel","hasName","content","timestamp","Date","lname","unshift","merge","getLevel","prefix","noConflict","definition","noop","undefinedType","isIE","logMethods","bindMethod","method","Function","traceForIE","log","trace","realMethod","replaceLoggingMethods","debug","enableLoggingWhenConsoleArrives","defaultMethodFactory","Logger","defaultLevel","factory","currentLevel","storageKey","getPersistedLevel","storedLevel","ignore","cookie","location","encodeURIComponent","exec","levels","persist","SILENT","levelNum","levelName","persistLevelIfPossible","setDefaultLevel","resetLevel","clearPersistedLevel","enableAll","TRACE","disableAll","initialLevel","defaultLogger","_loggersByName","_log","getLoggers","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","__esModule","d","a","defineProperty","enumerable","globalThis","prop","throwDumbMode","__dumbStubs","elementParamsToPlaylistData","elementParamsToSpatialData","createUniqueArray","items","_items","addItem","index","splice","clearItems","getItems","createEvent","listeners","listenersOneshot","_listeners","_listenersOneshot","invoke","forEach","listener","addListener","addListenerOneshot","removeListener","removeListenerOneshot","volumeParam","displayName","default","max","filterParams","detune","min","step","defaultNameCount","createDefaultEffectParams","entries","effectMetadataMap","parameters","reduce","acc","fftSize","maxDecibels","minDecibels","smoothingTimeConstant","attack","knee","ratio","release","threshold","url","falloff","duration","wetness","dryOutput","volume","fadeDuration","position","z","speed","panningModel","distanceModel","minDistance","maxDistance","rolloff","filterType","preDelay","decay","lpCutoff","lpResonance","hpCutoff","hpResonance","lpFrequency","hpFrequency","createAudioEffect","input","other","disconnectAll","serverTimeOffset","getServerTimeOffset","getServerTime","when","now","syrinscape","_r","registry","Proxy","receiver","newValue","createRegistry","getTime","allSetLevel","allResetLevel","mediaPrefix","cleanedMediaURL","URL","hostname","cleanedMediaPrefix","cleanKey","startsWith","protocol","port","search","_","createCacheStorageDatabase","openCache","caches","async","cache","Request","val","Response","headers","delete","getKeys","map","request","unCleanKey","decodeURIComponent","createStorageDatabase","database","errCallback","createLocalForageDatabase","createObjectURL","id","split","reverse","revokeObjectURL","maxVolume","query","URLSearchParams","_audioContext","_context","checkContext","localData","getLocalItem","defaultValue","setLocalItem","promiseResolve","getSyncPromise","text","notify","oldValue","return_value","dispatchEvent","CustomEvent","detail","syncPromises","httpProtocol","httpHostname","httpPort","wsProtocol","wsHostname","wsPort","postMessageToken","postMessageWindow","opener","init","initialConfig","oldConfig","authenticated","sessionId","token","lastLocalVolume","localVolume","visualisationFramerate","opts","Accept","Authorization","ok","json","display_name","session_id","changedConfig","sync","allSettled","AudioContext","Number","createConfig","notEmpty","createAnalyserEffect","params","assign","isDestination","AnalyserNode","visualisationRequestID","visualisationDrawFunction","lastFrequencyData","lastTimeDomainData","effect","setParam","getData","getFrequencyData","getTimeDomainData","frequencyData","frequencyBinCount","getByteFrequencyData","timeDomainData","getFloatTimeDomainData","some","startVisualisation","drawFunction","update","requestAnimationFrame","stopVisualisation","cancelAnimationFrame","LinkedListNode","next","prev","LRULinkedList","limit","Infinity","_size","positions","Map","head","tail","removeExcessNodes","newHeadNode","moveToHead","remove","prevNode","nextNode","has","from","nodeToMove","addNodeToHead","oldHead","newHead","newNode","nodesToRemove","removeNodes","removeTailNode","tailNode","currentNode","createLruCache","_dirty","setDirty","removeByCount","number","removeByKey","removeOne","toJSON","formatBytes","decimals","dm","Math","floor","parseFloat","pow","toFixed","randomBetween","b","randomNormal","random","millisToSecs","PI","millis","secsToMillis","secs","TemplateTag","transformers","tag","strings","expressions","interimTag","transformEndResult","transformString","processSubstitutions","transformer","previousTag","substitutions","resultSoFar","remainingPart","substitution","transformSubstitution","shift","res","transform","onString","onSubstitution","endResult","onEndResult","separator","conjunction","serial","arrayLength","indent","join","separatorIndex","lastIndexOf","el","regexp","RegExp","side","trim","toLowerCase","inlineArrayTransformer","stripIndentTransformer","trimResultTransformer","splitBy","isValidValue","splitStringTransformer","filter","replaceWhat","replaceWith","replaceSubstitutionTransformer","replaceResultTransformer","storageBuffer","blobDatabase","fetchMethod","storage","persistent","estimate","quota","usage","estimateStorage","localDatabase","remoteDatabase","suppressWarning","createCustomDatabase","_onFetch","compositeDatabase","prioritizedDatabases","forEachDatabase","forEachDatabasePartial","startIndex","endIndex","promises","lruCache","lruCacheKey","lruEvict","toRemove","removed","removedItem","Set","add","newCache","fromJSON","getLruCache","lruKeys","missingKeys","syncLruCacheKeys","setInterval","isDirty","createCompositeDatabase","_localDatabase","_remoteDatabase","_compositeDatabase","createBlobDatabase","createSendEffect","connectFromMap","setWet","getWet","_input","_wet","_dry","createSpatialEffect","panner","PannerNode","rolloffFactor","refDistance","setPosition","vec","positionX","positionY","positionZ","getPosition","setVelocity","vector","seconds","linearRampToValueAtTime","wait","v1","v2","v","sqrt","multiply","curveMap","linear","easeIn","cos","easeOut","sin","createVolumeEffect","GainNode","volumeSliderRange","volumeToGain","dbfs","log10","cancelScheduledValues","fadeToValue","durationSecs","curveName","param","start","current","curve","setValueCurveAtTime","message","rampToValueAtTime","SkinnerEffect","bypassed","setup","wireUp","destination","SkinnerAmpEnvelope","partials","velocity","_attack","_decay","_sustain","_release","on","currentTime","off","MidiEvent","stop","time","setValueAtTime","setTargetAtTime","sustain","SkinnerNoise","ampEnvelope","osc","createOscillator","super","_length","lBuffer","sampleRate","rBuffer","createBuffer","copyToChannel","createBufferSource","loop","loopStart","loopEnd","SkinnerFilter","cutoff","SkinnerAdvancedReverb","createConvolver","multitap","multitapGain","renderTail","tailContext","OfflineAudioContext","renderedBuffer","tailOsc","tailLPFilter","tailHPFilter","startRendering","dc","createEffectMap","DynamicsCompressorNode","arrayBuffer","audioBuffer","delay","feedbackNode","reverb","freeverb","hp","lp","createUrlSystem","maybePort","replaceLocalDomainAndPort","path","new_path","createUrlHttp","subdomain","maybeSubdomain","createUrlWs","socketPath","checkTimersId","checkTimersInterval","nextId","timers","checkTimers","timer","end","stopStrictTimers","clearStrictTimeout","setStrictTimeout","startStrictTimers","clearTimeout","createSimpleRecord","createFunc","record","getOrUndefined","getOrCreate","postMessageSystem","onMessage","onAnyMessage","addEventListener","event","msg","sendMessage","createPostMessageSystem","SyrinscapeEvent","eventName","removeEventListener","events","dispatch","eventDetail","eventSystem","createEventSystem","StatusError","parseFloatOr","fallback","parseFloatOrZero","parseFloatOrOne","parseFloatSecondsToMillis","socketElementToParams","title","playlistParams","socketElementToPlaylistParams","presetName","reverb_preset","elementId","cleanElementId","spatialParams","socketElementToSpatialParams","sampleDelayMin","min_wait","sampleDelayMax","max_wait","order","playlist_order","abs","parseLoop","repeat","repeat_playlist","parseRepeat","sampleDelayPos","allow_samples_to_overlap","elementDelayMin","min_start_delay","elementDelayMax","max_start_delay","sampleParamsList","playlist","socketSampleToSampleParams","position_samples","minDist","min_distance","maxDist","max_distance","minAngle","min_angle","maxAngle","max_angle","spatializable","is_3d","sampleId","cleanSampleId","s_id","minGain","min_gain","maxGain","max_gain","filterByElementId","getRaw","filterBySampleId","sample","spawnCount","averageSpawnDelay","maxSpawnDelay","createMutableMap","onUpdate","mutate","action","tryMutate","createUuidSystem","createSampleSystem","audioSystem","uuidSystem","sampleMap","sampleSpawnSystem","effectSystem","system","spawnSampleFromParams","startTime","wetOut","dryOut","uuid","spawnSampleFromData","fadeOptions","preset","globalVolume","spatialData","wetSpatial","drySpatial","drySpatializer","defaultPreset","wetSpatializer","sourceOut","wetDrySend","wetGain","dryGain","audioSource","createAudioSource","startHandle","sampleInstance","alive","isPlaying","onDispose","dispose","isAlive","stopTime","playlistEntryId","timeToStop","startSample","scrubToSecs","Sentry","addBreadcrumb","clientTime","endTime","startTimeServerTimeDelta","clientTimeServerTimeDelta","startPos","zPos","resolution","pos","rampToCenteredVelocityOverTime","play","manuallyTriggered","createSampleSpawnSystem","sampleSystem","getSamples","getSamplesWithSampleId","removeSample","getStopWait","thisStopTime","stopPlaylistEntryByPlaylistEntryId","stopDirectSampleBySampleId","stopSampleBySampleUuid","sampleUuid","stopAllSamples","createSocketSampleSnapshot","sampleMessage","playSample","sampleData","playSampleAtTime","playSampleWithReverb","stopSample","createElementSystem","authSystem","elementMap","elementVolumeSystem","elementVolumeMap","setElementIdVolume","setVolume","createElementVolumeSystem","oneshotSystem","onChange","createOneshotVolume","dryAnalyser","wetOneshot","dryOneshot","handleChange","createOneshotSystem","playlistSystem","playedSamplesMap","getOrCreatePlayedSamples","playedSamples","onPlayedSamplesChanged","createPlaylist","elementParams","randomSeed","randomFunc","seed","createSeededRandom","create","randomIndex","fromLength","last","clearPlayedSamples","appendPlayedSamples","newPlaylist","lastPlayed","temp","nextIndex","find","i2","wrapReorder","clearAllPlayedSamples","createPlaylistSystem","elementSpawnSystem","elementParamsToDataDumbMode","authorizedFetchPath","body","analyseElements","analyse","dataToRepeatParams","elementData","lastItem","playlistData","sampleDataList","nextStart","newElementParams","stripElementDataToParams","firstSampleDelay","useElementDelay","paramsToData","sampleParamsPlaylist","spawnElementFromParams","spawnElementFromData","full","emitStartElement","analyser","wetVolume","dryVolume","wetEffect","removeOneshotVolumeListener","crossfade","fadeIn","fadeOut","firstStartTime","sampleInstanceLookup","sampleFutureDataLookup","spawnSample","scrubbed","spawnDelay","initAvg","initCount","avg","avgCnt","onPlay","sampleUUID","handleSampleFinished","spawnTime","preloadWindow","timeoutId","firstSample","handleRepeat","sampleFutureData","finallyDispose","isActive","timeToFirstSample","_elementParamsToDataSmartMode","_elementParamsToDataDumbMode","createElementSpawnSystem","getElements","stopElementByUuid","getElementsWithElementId","stopElementByElementId","emit","stopAllElements","seen","setOneshotVolume","playElement","forEachElement","createSocketElementSnapshot","repeatLength","firstParams","elementInstances","createParamsSnapshot","elementMessage","prevInstance","instances","nextParams","nextStartTime","nextSample","timeToStopOrNextSample","elementChunksToUuids","elements","flatMap","chunks","sampleToData","tupleToVector3","playlist_entry_pk","manually_triggered","urlSystem","socketSystem","last_connect","ws","backoff","onMessageRecord","_state","onStateChange","WebSocket","onclose","onNamedMessage","onopen","send","reconnect","socketMessageLookup","ping","reconnect_to_new_backend","domain_and_port","domain","SocketSystem","effectMap","file","onFileChange","useDefault","loadFile","loadFileFromUrl","_file","rebuildAllEffects","effects","presets","updatePreset","updateFile","buildEffect","reconnectAll","buildEffectAndReconnectAll","connectEffect","trySetParam","effectName","paramName","paramValue","eff","setFileEffectParam","sort","disposeEffect","disposeEffectAndReconnectAll","createAudioEffectSystem","sourceInstantiator","audioElements","sourceNodes","WeakMap","src","fadeScrub","fadeStop","targetVolume","isFinite","ended","Audio","autoplay","crossOrigin","fadeOutHandler","clearFadeoutHandler","source","isReady","shouldPlay","cachedCurrentTime","handleReady","createAsyncAudioSource","handleEnded","pause","createBlobSourceInstantiator","useDefaultEffectFile","setGlobalVolume","setLocalVolume","toggleMute","createAudioSystem","audioEffectSystem","authorizedFetchUrl","checkResponseStatus","checkStatus","authorizedFetchBlob","urlPath","createAuthSystem","controlSystem","sendFull","startElements","pks","pk","startMood","startSamples","startPlaylistEntries","stopAll","stopElements","stopMood","stopPlaylistEntries","stopSamples","ControlSystem","elementSystem","syncSystem","onChangeMood","onChangeSoundset","updateServerTimeOffset","serverTime","setServerTimeOffset","handleFullState","handleCommonState","newUUids","newElementIds","elementChunksToElementIds","getPlayingElements","handlePartialState","fullElements","fullSamples","newElements","newSamples","samples","playingElements","playingSamples","getPlayingSamples","handleStopElementsOnSendFull","handleStopSamplesOnSendFull","handlePlayElements","handlePlaySamples","global_volume","oneshot_volume","soundset_title","soundset_pk","artwork","soundset_artwork","mood_title","mood_pk","spawned","scheduled","stateObj","chunk","elementChunksToData","existing","playingElement","playingSample","SyncSystem","configure","onActive","onInactive","selector","deferred","activate","locked","unlock","closest","button","stopImmediatePropagation","clean","click","createPlayer"],"sourceRoot":""}