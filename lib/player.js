/*! For license information please see player.5ba035dbd133c9dd3750.js.LICENSE.txt */
(()=>{var e={5356:(e,t,n)=>{var a=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],o=[225,556,441,341],r=n(6174);e.exports=function(e){var t=e.createGain();t.channelCountMode="explicit",t.channelCount=2;var n=e.createGain(),s=e.createChannelMerger(2),i=e.createChannelSplitter(2),l=e.createBiquadFilter();l.type="highpass",l.frequency.value=200;var u=e.createGain(),c=e.createGain();t.connect(c),t.connect(u),u.connect(i),s.connect(l),l.connect(n),c.connect(n);for(var d=[],m=[],p=[],f=.8,y=3e3,h=0;h<o.length;h++){var v=e.createBiquadFilter();v.type="allpass",v.frequency.value=o[h],m.push(v),m[h-1]&&m[h-1].connect(v)}for(var g=0;g<o.length;g++){var w=e.createBiquadFilter();w.type="allpass",w.frequency.value=o[g],p.push(w),p[g-1]&&p[g-1].connect(w)}m[m.length-1].connect(s,0,0),p[p.length-1].connect(s,0,1);for(var b=0;b<a.length;b++){var S=r(e);S.delayTime.value=a[b],b<a.length/2?(i.connect(S,0),S.connect(m[0])):(i.connect(S,1),S.connect(p[0])),d.push(S)}return Object.defineProperties(t,{roomSize:{get:function(){return f},set:function(e){f=e,_()}},dampening:{get:function(){return y},set:function(e){y=e,_()}}}),_(),t.connect=n.connect.bind(n),t.disconnect=n.disconnect.bind(n),t.wet=u.gain,t.dry=c.gain,t.combFilters=d,t;function _(){for(var e=0;e<d.length;e++)d[e].resonance.value=f,d[e].dampening.value=y}}},6174:e=>{e.exports=function(e){var t=e.createDelay(1),n=e.createBiquadFilter();n.Q.value=-3.0102999566398125,n.type="lowpass",t.dampening=n.frequency;var a=e.createGain();return t.resonance=a.gain,t.connect(n),n.connect(a),a.connect(t),t.dampening.value=3e3,t.delayTime.value=.1,t.resonance.value=.5,t}},1466:(e,t,n)=>{e.exports=function e(t,n,a){function o(s,i){if(!n[s]){if(!t[s]){if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,(function(e){return o(t[s][1][e]||e)}),u,u.exports,e,t,n,a)}return n[s].exports}for(var r=void 0,s=0;s<a.length;s++)o(a[s]);return o}({1:[function(e,t,a){(function(e){"use strict";var n,a,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var r=0,s=new o(c),i=e.document.createTextNode("");s.observe(i,{characterData:!0}),n=function(){i.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)};else{var l=new e.MessageChannel;l.port1.onmessage=c,n=function(){l.port2.postMessage(0)}}var u=[];function c(){var e,t;a=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}a=!1}t.exports=function(e){1!==u.push(e)||a||n()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var a=e(1);function o(){}var r={},s=["REJECTED"],i=["FULFILLED"],l=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==o&&p(this,e)}function c(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){a((function(){var a;try{a=t(n)}catch(t){return r.reject(e,t)}a===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,a)}))}function m(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var n=!1;function a(t){n||(n=!0,r.reject(e,t))}function o(t){n||(n=!0,r.resolve(e,t))}var s=f((function(){t(o,a)}));"error"===s.status&&a(s.value)}function f(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===i||"function"!=typeof t&&this.state===s)return this;var n=new this.constructor(o);return this.state!==l?d(n,this.state===i?e:t,this.outcome):this.queue.push(new c(n,e,t)),n},c.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){r.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=f(m,t);if("error"===n.status)return r.reject(e,n.value);var a=n.value;if(a)p(e,a);else{e.state=i,e.outcome=t;for(var o=-1,s=e.queue.length;++o<s;)e.queue[o].callFulfilled(t)}return e},r.reject=function(e,t){e.state=s,e.outcome=t;for(var n=-1,a=e.queue.length;++n<a;)e.queue[n].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:r.resolve(new this(o),e)},u.reject=function(e){var t=new this(o);return r.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,a=!1;if(!n)return this.resolve([]);for(var s=new Array(n),i=0,l=-1,u=new this(o);++l<n;)c(e[l],l);return u;function c(e,o){t.resolve(e).then((function(e){s[o]=e,++i!==n||a||(a=!0,r.resolve(u,s))}),(function(e){a||(a=!0,r.reject(u,e))}))}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n,a=e.length,s=!1;if(!a)return this.resolve([]);for(var i=-1,l=new this(o);++i<a;)n=e[i],t.resolve(n).then((function(e){s||(s=!0,r.resolve(l,e))}),(function(e){s||(s=!0,r.reject(l,e))}));return l}},{1:1}],3:[function(e,t,a){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),a=0;a<e.length;a+=1)n.append(e[a]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var s=Promise;function i(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function l(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function u(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d="local-forage-detect-blob-support",m=void 0,p={},f=Object.prototype.toString,y="readonly",h="readwrite";function v(e){for(var t=e.length,n=new ArrayBuffer(t),a=new Uint8Array(n),o=0;o<t;o++)a[o]=e.charCodeAt(o);return n}function g(e){return"boolean"==typeof m?s.resolve(m):function(e){return new s((function(t){var n=e.transaction(d,h),a=r([""]);n.objectStore(d).put(a,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return m=e}))}function w(e){var t=p[e.name],n={};n.promise=new s((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function b(e){var t=p[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function S(e,t){var n=p[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function _(e,t){return new s((function(n,a){if(p[e.name]=p[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);w(e),e.db.close()}var r=[e.name];t&&r.push(e.version);var s=o.open.apply(o,r);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(d)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),a(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),b(e)}}))}function x(e){return _(e,!1)}function E(e){return _(e,!0)}function I(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),a=e.version<e.db.version,o=e.version>e.db.version;if(a&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function D(e){return r([v(atob(e.data))],{type:e.type})}function T(e){return e&&e.__local_forage_encoded_blob}function N(e){var t=this,n=t._initReady().then((function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return l(n,e,e),n}function k(e,t,n,a){void 0===a&&(a=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(a>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return s.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),E(e)})).then((function(){return function(e){w(e);for(var t=p[e.name],n=t.forages,a=0;a<n.length;a++){var o=n[a];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,x(e).then((function(t){return e.db=t,I(e)?E(e):t})).then((function(a){e.db=t.db=a;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=a})).catch((function(t){throw S(e,t),t}))}(e).then((function(){k(e,t,n,a-1)}))})).catch(n);n(o)}}var C={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var a in e)n[a]=e[a];var o=p[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},p[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=N);var r=[];function i(){return s.resolve()}for(var l=0;l<o.forages.length;l++){var u=o.forages[l];u!==t&&r.push(u._initReady().catch(i))}var c=o.forages.slice(0);return s.all(r).then((function(){return n.db=o.db,x(n)})).then((function(e){return n.db=e,I(n,t._defaultConfig.version)?E(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var a=0;a<c.length;a++){var r=c[a];r!==t&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}}))},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,a=new s((function(t,a){n.ready().then((function(){k(n._dbInfo,y,(function(o,r){if(o)return a(o);try{var s=r.objectStore(n._dbInfo.storeName).openCursor(),i=1;s.onsuccess=function(){var n=s.result;if(n){var a=n.value;T(a)&&(a=D(a));var o=e(a,n.key,i++);void 0!==o?t(o):n.continue()}else t()},s.onerror=function(){a(s.error)}}catch(e){a(e)}}))})).catch(a)}));return i(a,t),a},getItem:function(e,t){var n=this;e=u(e);var a=new s((function(t,a){n.ready().then((function(){k(n._dbInfo,y,(function(o,r){if(o)return a(o);try{var s=r.objectStore(n._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),T(e)&&(e=D(e)),t(e)},s.onerror=function(){a(s.error)}}catch(e){a(e)}}))})).catch(a)}));return i(a,t),a},setItem:function(e,t,n){var a=this;e=u(e);var o=new s((function(n,o){var r;a.ready().then((function(){return r=a._dbInfo,"[object Blob]"===f.call(t)?g(r.db).then((function(e){return e?t:(n=t,new s((function(e,t){var a=new FileReader;a.onerror=t,a.onloadend=function(t){var a=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:a,type:n.type})},a.readAsBinaryString(n)})));})):t})).then((function(t){k(a._dbInfo,h,(function(r,s){if(r)return o(r);try{var i=s.objectStore(a._dbInfo.storeName);null===t&&(t=void 0);var l=i.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),n(t)},s.onabort=s.onerror=function(){var e=l.error?l.error:l.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return i(o,n),o},removeItem:function(e,t){var n=this;e=u(e);var a=new s((function(t,a){n.ready().then((function(){k(n._dbInfo,h,(function(o,r){if(o)return a(o);try{var s=r.objectStore(n._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){a(s.error)},r.onabort=function(){var e=s.error?s.error:s.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return i(a,t),a},clear:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){k(t._dbInfo,h,(function(a,o){if(a)return n(a);try{var r=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=r.error?r.error:r.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return i(n,e),n},length:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){k(t._dbInfo,y,(function(a,o){if(a)return n(a);try{var r=o.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return i(n,e),n},key:function(e,t){var n=this,a=new s((function(t,a){e<0?t(null):n.ready().then((function(){k(n._dbInfo,y,(function(o,r){if(o)return a(o);try{var s=r.objectStore(n._dbInfo.storeName),i=!1,l=s.openKeyCursor();l.onsuccess=function(){var n=l.result;n?0===e||i?t(n.key):(i=!0,n.advance(e)):t(null)},l.onerror=function(){a(l.error)}}catch(e){a(e)}}))})).catch(a)}));return i(a,t),a},keys:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){k(t._dbInfo,y,(function(a,o){if(a)return n(a);try{var r=o.objectStore(t._dbInfo.storeName).openKeyCursor(),s=[];r.onsuccess=function(){var t=r.result;t?(s.push(t.key),t.continue()):e(s)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))})).catch(n)}));return i(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var a,r=this;if(e.name){var l=e.name===n.name&&r._dbInfo.db?s.resolve(r._dbInfo.db):x(e).then((function(t){var n=p[e.name],a=n.forages;n.db=t;for(var o=0;o<a.length;o++)a[o]._dbInfo.db=t;return t}));a=e.storeName?l.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;w(e);var a=p[e.name],r=a.forages;t.close();for(var i=0;i<r.length;i++){var l=r[i];l._dbInfo.db=null,l._dbInfo.version=n}return new s((function(t,a){var r=o.open(e.name,n);r.onerror=function(e){r.result.close(),a(e)},r.onupgradeneeded=function(){r.result.deleteObjectStore(e.storeName)},r.onsuccess=function(){var e=r.result;e.close(),t(e)}})).then((function(e){a.db=e;for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=e,b(n._dbInfo)}})).catch((function(t){throw(S(e,t)||s.resolve()).catch((function(){})),t}))}})):l.then((function(t){w(e);var n=p[e.name],a=n.forages;t.close();for(var r=0;r<a.length;r++)a[r]._dbInfo.db=null;return new s((function(t,n){var a=o.deleteDatabase(e.name);a.onerror=function(){var e=a.result;e&&e.close(),n(a.error)},a.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},a.onsuccess=function(){var e=a.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<a.length;t++)b(a[t]._dbInfo)})).catch((function(t){throw(S(e,t)||s.resolve()).catch((function(){})),t}))}))}else a=s.reject("Invalid arguments");return i(a,t),a}};var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,M="__lfsc__:",R=M.length,A="arbf",F="blob",O="si08",z="ui08",$="uic8",V="si16",G="si32",j="ur16",B="ui32",q="fl32",U="fl64",H=R+A.length,W=Object.prototype.toString;function J(e){var t,n,a,o,r,s=.75*e.length,i=e.length,l=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),c=new Uint8Array(u);for(t=0;t<i;t+=4)n=P.indexOf(e[t]),a=P.indexOf(e[t+1]),o=P.indexOf(e[t+2]),r=P.indexOf(e[t+3]),c[l++]=n<<2|a>>4,c[l++]=(15&a)<<4|o>>2,c[l++]=(3&o)<<6|63&r;return u}function Q(e){var t,n=new Uint8Array(e),a="";for(t=0;t<n.length;t+=3)a+=P[n[t]>>2],a+=P[(3&n[t])<<4|n[t+1]>>4],a+=P[(15&n[t+1])<<2|n[t+2]>>6],a+=P[63&n[t+2]];return n.length%3==2?a=a.substring(0,a.length-1)+"=":n.length%3==1&&(a=a.substring(0,a.length-2)+"=="),a}var K={serialize:function(e,t){var n="";if(e&&(n=W.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===W.call(e.buffer))){var a,o=M;e instanceof ArrayBuffer?(a=e,o+=A):(a=e.buffer,"[object Int8Array]"===n?o+=O:"[object Uint8Array]"===n?o+=z:"[object Uint8ClampedArray]"===n?o+=$:"[object Int16Array]"===n?o+=V:"[object Uint16Array]"===n?o+=j:"[object Int32Array]"===n?o+=G:"[object Uint32Array]"===n?o+=B:"[object Float32Array]"===n?o+=q:"[object Float64Array]"===n?o+=U:t(new Error("Failed to get type for BinaryArray"))),t(o+Q(a))}else if("[object Blob]"===n){var r=new FileReader;r.onload=function(){var n="~~local_forage_type~"+e.type+"~"+Q(this.result);t("__lfsc__:blob"+n)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,R)!==M)return JSON.parse(e);var t,n=e.substring(H),a=e.substring(R,H);if(a===F&&L.test(n)){var o=n.match(L);t=o[1],n=n.substring(o[0].length)}var s=J(n);switch(a){case A:return s;case F:return r([s],{type:t});case O:return new Int8Array(s);case z:return new Uint8Array(s);case $:return new Uint8ClampedArray(s);case V:return new Int16Array(s);case j:return new Uint16Array(s);case G:return new Int32Array(s);case B:return new Uint32Array(s);case q:return new Float32Array(s);case U:return new Float64Array(s);default:throw new Error("Unkown type: "+a)}},stringToBuffer:J,bufferToString:Q};function X(e,t,n,a){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,a)}function Y(e,t,n,a,o,r){e.executeSql(n,a,o,(function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,i){i.rows.length?r(e,s):X(e,t,(function(){e.executeSql(n,a,o,r)}),r)}),r):r(e,s)}),r)}function Z(e,t,n,a){var o=this;e=u(e);var r=new s((function(r,s){o.ready().then((function(){void 0===t&&(t=null);var i=t,l=o._dbInfo;l.serializer.serialize(t,(function(t,u){u?s(u):l.db.transaction((function(n){Y(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){r(i)}),(function(e,t){s(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(a>0)return void r(Z.apply(o,[e,i,n,a-1]));s(t)}}))}))})).catch(s)}));return i(r,n),r}function ee(e){return new s((function(t,n){e.transaction((function(a){a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,a){for(var o=[],r=0;r<a.rows.length;r++)o.push(a.rows.item(r).name);t({db:e,storeNames:o})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var te={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var a in e)n[a]="string"!=typeof e[a]?e[a].toString():e[a];var o=new s((function(e,a){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return a(e)}n.db.transaction((function(o){X(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){a(t)}))}),a)}));return n.serializer=K,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,a=new s((function(t,a){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Y(n,o,"SELECT * FROM "+o.storeName,[],(function(n,a){for(var r=a.rows,s=r.length,i=0;i<s;i++){var l=r.item(i),u=l.value;if(u&&(u=o.serializer.deserialize(u)),void 0!==(u=e(u,l.key,i+1)))return void t(u)}t()}),(function(e,t){a(t)}))}))})).catch(a)}));return i(a,t),a},getItem:function(e,t){var n=this;e=u(e);var a=new s((function(t,a){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Y(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var a=n.rows.length?n.rows.item(0).value:null;a&&(a=o.serializer.deserialize(a)),t(a)}),(function(e,t){a(t)}))}))})).catch(a)}));return i(a,t),a},setItem:function(e,t,n){return Z.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=u(e);var a=new s((function(t,a){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Y(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){a(t)}))}))})).catch(a)}));return i(a,t),a},clear:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var a=t._dbInfo;a.db.transaction((function(t){Y(t,a,"DELETE FROM "+a.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return i(n,e),n},length:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var a=t._dbInfo;a.db.transaction((function(t){Y(t,a,"SELECT COUNT(key) as c FROM "+a.storeName,[],(function(t,n){var a=n.rows.item(0).c;e(a)}),(function(e,t){n(t)}))}))})).catch(n)}));return i(n,e),n},key:function(e,t){var n=this,a=new s((function(t,a){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){Y(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var a=n.rows.length?n.rows.item(0).key:null;t(a)}),(function(e,t){a(t)}))}))})).catch(a)}));return i(a,t),a},keys:function(e){var t=this,n=new s((function(e,n){t.ready().then((function(){var a=t._dbInfo;a.db.transaction((function(t){Y(t,a,"SELECT key FROM "+a.storeName,[],(function(t,n){for(var a=[],o=0;o<n.rows.length;o++)a.push(n.rows.item(o).key);e(a)}),(function(e,t){n(t)}))}))})).catch(n)}));return i(n,e),n},dropInstance:function(e,t){t=c.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var a,o=this;return i(a=e.name?new s((function(t){var a;a=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:a,storeNames:[e.storeName]}):t(ee(a))})).then((function(e){return new s((function(t,n){e.db.transaction((function(a){function o(e){return new s((function(t,n){a.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var r=[],i=0,l=e.storeNames.length;i<l;i++)r.push(o(e.storeNames[i]));s.all(r).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):s.reject("Invalid arguments"),t),a}};function ne(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function ae(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var oe={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=ne(e,this._defaultConfig),ae()?(this._dbInfo=t,t.serializer=K,s.resolve()):s.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,a=n.ready().then((function(){for(var t=n._dbInfo,a=t.keyPrefix,o=a.length,r=localStorage.length,s=1,i=0;i<r;i++){var l=localStorage.key(i);if(0===l.indexOf(a)){var u=localStorage.getItem(l);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,l.substring(o),s++)))return u}}}));return i(a,t),a},getItem:function(e,t){var n=this;e=u(e);var a=n.ready().then((function(){var t=n._dbInfo,a=localStorage.getItem(t.keyPrefix+e);return a&&(a=t.serializer.deserialize(a)),a}));return i(a,t),a},setItem:function(e,t,n){var a=this;e=u(e);var o=a.ready().then((function(){void 0===t&&(t=null);var n=t;return new s((function(o,r){var s=a._dbInfo;s.serializer.serialize(t,(function(t,a){if(a)r(a);else try{localStorage.setItem(s.keyPrefix+e,t),o(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return i(o,n),o},removeItem:function(e,t){var n=this;e=u(e);var a=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return i(a,t),a},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var a=localStorage.key(n);0===a.indexOf(e)&&localStorage.removeItem(a)}}));return i(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return i(t,e),t},key:function(e,t){var n=this,a=n.ready().then((function(){var t,a=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(a.keyPrefix.length)),t}));return i(a,t),a},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,a=[],o=0;o<n;o++){var r=localStorage.key(o);0===r.indexOf(e.keyPrefix)&&a.push(r.substring(e.keyPrefix.length))}return a}));return i(n,e),n},dropInstance:function(e,t){if(t=c.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var a,o=this;return i(a=e.name?new s((function(t){e.storeName?t(ne(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):s.reject("Invalid arguments"),t),a}},re=function(e,t){for(var n=e.length,a=0;a<n;){if((o=e[a])===(r=t)||"number"==typeof o&&"number"==typeof r&&isNaN(o)&&isNaN(r))return!0;a++}var o,r;return!1},se=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ie={},le={},ue={INDEXEDDB:C,WEBSQL:te,LOCALSTORAGE:oe},ce=[ue.INDEXEDDB._driver,ue.WEBSQL._driver,ue.LOCALSTORAGE._driver],de=["dropInstance"],me=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(de),pe={description:"",driver:ce.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function fe(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ye(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(se(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var he=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ue)if(ue.hasOwnProperty(n)){var a=ue[n],o=a._driver;this[n]=o,ie[o]||this.defineDriver(a)}this._defaultConfig=ye({},pe),this._config=ye({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":a(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var a=new s((function(t,n){try{var a=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var r=me.concat("_initStorage"),l=0,u=r.length;l<u;l++){var c=r[l];if((!re(de,c)||e[c])&&"function"!=typeof e[c])return void n(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=s.reject(t);return i(n,arguments[arguments.length-1]),n}},n=0,a=de.length;n<a;n++){var o=de[n];e[o]||(e[o]=t(o))}}();var d=function(n){ie[a]&&console.info("Redefining LocalForage driver: "+a),ie[a]=e,le[a]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return l(a,t,n),a},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var a=ie[e]?s.resolve(ie[e]):s.reject(new Error("Driver not found."));return l(a,t,n),a},e.prototype.getSerializer=function(e){var t=s.resolve(K);return l(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return l(n,e,e),n},e.prototype.setDriver=function(e,t,n){var a=this;se(e)||(e=[e]);var o=this._getSupportedDrivers(e);function r(){a._config.driver=a.driver()}function i(e){return a._extend(e),r(),a._ready=a._initStorage(a._config),a._ready}var u=null!==this._driverSet?this._driverSet.catch((function(){return s.resolve()})):s.resolve();return this._driverSet=u.then((function(){var e=o[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then((function(e){a._driver=e._driver,r(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,a._dbInfo=null,a._ready=null,a.getDriver(o).then(i).catch(n)}r();var l=new Error("No available storage method found.");return a._driverSet=s.reject(l),a._driverSet}()}}(o)}))})).catch((function(){r();var e=new Error("No available storage method found.");return a._driverSet=s.reject(e),a._driverSet})),l(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!le[e]},e.prototype._extend=function(e){ye(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,a=e.length;n<a;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=me.length;e<t;e++)fe(this,me[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=he},{3:3}]},{},[4])(4)},729:function(e,t,n){var a,o;void 0===(o="function"==typeof(a=function(e){"use strict";var t,n,a={template:"[%t] %l:",levelFormatter:function(e){return e.toUpperCase()},nameFormatter:function(e){return e||"root"},timestampFormatter:function(e){return e.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},o={},r={reg:function(e){if(!e||!e.getLogger)throw new TypeError("Argument is not a root logger");t=e},apply:function(e,n){if(!e||!e.setLevel)throw new TypeError("Argument is not a logger");var r=e.methodFactory,s=e.name||"",i=o[s]||o[""]||a;return o[s]||(e.methodFactory=function(e,t,n){var a=r(e,t,n),i=o[n]||o[""],l=-1!==i.template.indexOf("%t"),u=-1!==i.template.indexOf("%l"),c=-1!==i.template.indexOf("%n");return function(){for(var t="",r=arguments.length,d=Array(r),m=0;m<r;m++)d[m]=arguments[m];if(s||!o[n]){var p=i.timestampFormatter(new Date),f=i.levelFormatter(e),y=i.nameFormatter(n);i.format?t+=i.format(f,y,p):(t+=i.template,l&&(t=t.replace(/%t/,p)),u&&(t=t.replace(/%l/,f)),c&&(t=t.replace(/%n/,y))),d.length&&"string"==typeof d[0]?d[0]=t+" "+d[0]:d.unshift(t)}a.apply(void 0,d)}}),(n=n||{}).template&&(n.format=void 0),o[s]=function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(t in arguments[n])Object.prototype.hasOwnProperty.call(arguments[n],t)&&(e[t]=arguments[n][t]);return e}({},i,n),e.setLevel(e.getLevel()),t||e.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),e}};return e&&(n=e.prefix,r.noConflict=function(){return e.prefix===r&&(e.prefix=n),r}),r})?a.call(t,n,t,e):a)||(e.exports=o)},831:function(e,t,n){var a,o;!function(r,s){"use strict";void 0===(o="function"==typeof(a=function(){var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"];function o(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function r(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(a){return"debug"===a&&(a="log"),typeof console!==t&&("trace"===a&&n?r:void 0!==console[a]?o(console,a):void 0!==console.log?o(console,"log"):e)}function i(t,n){for(var o=0;o<a.length;o++){var r=a[o];this[r]=o<t?e:this.methodFactory(r,t,n)}this.log=this.debug}function l(e,n,a){return function(){typeof console!==t&&(i.call(this,n,a),this[e].apply(this,arguments))}}function u(e,t,n){return s(e)||l.apply(this,arguments)}function c(e,n,o){var r,s=this;n=null==n?"WARN":n;var l="loglevel";function c(){var e;if(typeof window!==t&&l){try{e=window.localStorage[l]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,a=n.indexOf(encodeURIComponent(l)+"=");-1!==a&&(e=/^([^;]+)/.exec(n.slice(a))[1])}catch(e){}return void 0===s.levels[e]&&(e=void 0),e}}"string"==typeof e?l+=":"+e:"symbol"==typeof e&&(l=void 0),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=o||u,s.getLevel=function(){return r},s.setLevel=function(n,o){if("string"==typeof n&&void 0!==s.levels[n.toUpperCase()]&&(n=s.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(r=n,!1!==o&&function(e){var n=(a[e]||"silent").toUpperCase();if(typeof window!==t&&l){try{return void(window.localStorage[l]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"="+n+";"}catch(e){}}}(n),i.call(s,n,e),typeof console===t&&n<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){n=e,c()||s.setLevel(e,!1)},s.resetLevel=function(){s.setLevel(n,!1),function(){if(typeof window!==t&&l){try{return void window.localStorage.removeItem(l)}catch(e){}try{window.document.cookie=encodeURIComponent(l)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var d=c();null==d&&(d=n),s.setLevel(d,!1)}var d=new c,m={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=m[e];return t||(t=m[e]=new c(e,d.getLevel(),d.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=p),d},d.getLoggers=function(){return m},d.default=d,d})?a.call(t,n,t,e):a)||(e.exports=o)}()}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=()=>{throw new Error("cannot create element directly from params - running player in dumb mode")};window.__dumbStubs={elementParamsToPlaylistData:e,elementParamsToSpatialData:e};const t=()=>{const e=[];return{_items:e,addItem:t=>-1===e.indexOf(t)&&(e.push(t),!0),removeItem:t=>{const n=e.indexOf(t);return n>-1&&(e.splice(n,1),!0)},clearItems:()=>e.length=0,getItems:()=>e}};function a(){const e=t(),n=t();return{_listeners:e._items,_listenersOneshot:n._items,invoke:function(t){e.getItems().forEach((e=>e(t))),n.getItems().forEach((e=>e(t))),n.clearItems()},addListener:t=>e.addItem(t),addListenerOneshot:e=>n.addItem(e),removeListener:t=>e.removeItem(t),removeListenerOneshot:e=>n.removeItem(e)}}const o={displayName:"Volume",type:"number",default:1,max:10},r={detune:{displayName:"Detune",type:"number",default:0,min:-153600,max:153600,step:1},frequency:{displayName:"Frequency",type:"number",default:350,min:0,max:24e3,step:100},resonance:{displayName:"Resonance",type:"number",default:.5},gain:{displayName:"Shelf Gain",type:"number",default:0,min:-1541.273681640625,max:1541.273681640625}};let s=0;const i=(e,t=`My ${e} effect ${++s}`)=>Object.entries(l[e].parameters).reduce(((e,[t,n])=>({...e,[t]:JSON.parse(JSON.stringify(n.default))})),{name:t,type:e,output:"Global Volume"}),l={analyser:{displayName:"Analyser",parameters:{fftSize:{displayName:"fftSize",options:{32:"32",64:"64",128:"128",256:"256",512:"512",1024:"1024",2048:"2048",4096:"4096",8192:"8192",16384:"16384",32768:"32768"},type:"select",default:"128"},maxDecibels:{displayName:"maxDecibels",max:0,min:-100,step:1,type:"number",default:-30},minDecibels:{displayName:"minDecibels",max:0,min:-100,step:1,type:"number",default:-100},smoothingTimeConstant:{displayName:"smoothingTimeConstant",type:"number",default:.8}}},compressor:{displayName:"Compressor",parameters:{attack:{displayName:"attack",step:.001,type:"number",default:.003},knee:{displayName:"knee",max:40,min:0,step:1,type:"number",default:30},ratio:{displayName:"ratio",max:20,min:1,step:1,type:"number",default:12},release:{displayName:"release",type:"number",default:.25},threshold:{displayName:"threshold",max:0,min:-100,step:1,type:"number",default:-24}}},convolver:{displayName:"Convolver",parameters:{url:{displayName:"URL",type:"string",default:"https://dl.dropboxusercontent.com/s/sjzu2078lg4bpwh/3000CStreetGarageStairwell.wav?dl=0"}}},delay:{displayName:"Delay",parameters:{falloff:{displayName:"Falloff",type:"number",default:.5},duration:{displayName:"Duration",type:"number",default:.5,max:1}}},send:{displayName:"Send",parameters:{wetness:{displayName:"Wetness",type:"number",default:.5},dryOutput:{displayName:"Dry Output",type:"audioReceive",default:"Global Volume"}}},volume:{displayName:"Volume",parameters:{volume:o,fadeDuration:{displayName:"Fade Duration",type:"number",default:1,min:0,max:5}}},spatial:{displayName:"Spatial",parameters:{position:{displayName:"Position",type:"vector3",default:{x:0,y:0,z:0}},speed:{displayName:"Speed",default:0,type:"number",max:1e3},panningModel:{displayName:"Panning Model",type:"select",default:"HRTF",options:{"Head Related TF":"HRTF","Equal Power":"equalpower"}},distanceModel:{displayName:"Distance Model",type:"select",default:"inverse",options:{Inverse:"inverse",Exponential:"exponential",Linear:"linear"}},minDistance:{displayName:"Min Distance",type:"number",default:0,max:1e3},maxDistance:{displayName:"Max Distance",type:"number",default:100,max:1e3},rolloff:{displayName:"Rolloff",type:"number",default:.5,max:100}}},filter:{displayName:"Filter",parameters:{...r,filterType:{displayName:"Filter Type",type:"select",default:"lowpass",options:{"Low Pass":"lowpass","High Pass":"highpass","Band Pass":"bandpass","All Pass":"allpass","Low Shelf":"lowshelf","High Shelf":"highshelf",Peaking:"peaking",Notch:"notch"}}}},reverb:{displayName:"Reverb",parameters:{duration:{displayName:"Duration",type:"number",default:1,max:5},preDelay:{displayName:"Pre Delay",type:"number",default:.03,max:1},attack:{displayName:"Attack",step:.001,type:"number",default:.001},decay:{displayName:"Decay",type:"number",default:.1,max:1},lpCutoff:{...r.frequency,displayName:"LP Cutoff",default:2e3},lpResonance:{displayName:"LP Resonance",type:"number",default:.2,max:1},hpCutoff:{...r.frequency,displayName:"HP Cutoff",default:500},hpResonance:{displayName:"HP Resonance",type:"number",default:.1,max:1}}},freeverb:{displayName:"Freeverb",parameters:{roomSize:{displayName:"Room Size",type:"number",default:.9,max:1},dampening:{displayName:"Dampening",type:"number",default:6e3,step:20,max:2e4},preDelay:{displayName:"Predelay",type:"number",default:.01,max:1},lpFrequency:{...r.frequency,displayName:"LP Cutoff",default:2e3},hpFrequency:{...r.frequency,displayName:"HP Cutoff",default:600},lpResonance:{...r.resonance,displayName:"LP Resonance"},hpResonance:{...r.resonance,displayName:"HP Resonance"},gain:{...o,displayName:"Gain",default:.2}}}},u=(e,t=e)=>({input:e,output:t,connect:e=>t.connect(e.input),disconnectAll:()=>{e.disconnect(),t.disconnect()}});var c=n(831),d=n.n(c),m=n(729),p=n.n(m);let f=0;const y=()=>f,h=e=>(e||Date.now())-f,v=h;var g;null!==(g=window.syrinscape)&&void 0!==g||(window.syrinscape={_r:(()=>{const e={};return new Proxy({},{get:(t,n,a)=>e[n],set:(t,n,a,o)=>(e[n]=a,!0)})})()});const w=window.syrinscape;var b;p().reg(d()),p().apply(d(),{template:"[%t] %l (%n):",timestampFormatter:function(e){return new Date(v(e.getTime())).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")}}),null!==(b=w.log)&&void 0!==b||(w.log={...d(),allSetLevel:(e,t=!0)=>{Object.values(d().getLoggers()).forEach((n=>n.setLevel(e,t)))},allResetLevel:()=>{Object.values(d().getLoggers()).forEach((e=>e.resetLevel()))}});const S=w.log,_="https://storage.syrinscape.com/",x="http://browser-storage.syrinscape.com/",E=new URL(x);E.hostname="browser-storage-media.syrinscape.com";const I=E.toString(),D=e=>{try{let t=new URL(e);e.startsWith(_)&&(t.protocol=E.protocol,t.port=E.port,t.hostname=E.hostname,t.search="",e=t.toString())}catch(t){e=`${x}${encodeURIComponent(e)}`}return e},T=(e="database")=>{let t=caches.open(e);return{getItem:async e=>{const n=await t,a=await n.match(new Request(D(e)));return a?a.blob():null},setItem:async(e,n)=>{const a=await t;await a.put(new Request(D(e)),new Response(n,{headers:{"Content-Length":n.size.toString()}}))},removeItem:async e=>{const n=await t;await n.delete(new Request(D(e)))},clear:async()=>{await t,await caches.delete(e),t=caches.open(e)},getKeys:async()=>{const e=await t;return(await e.keys()).map((e=>{return(t=e.url).startsWith(x)?t=decodeURIComponent(t.substring(x.length)):t.startsWith(I)&&(t=decodeURIComponent(t.substring(I.length)),t=`${_}${t}`),t;}))}}};var N=n(1466),k=n.n(N);const C=S.getLogger("storageDatabase"),P=(e="database")=>{let t;return"indexedDB"in self?(C.info(`Using IndexedDB for cache database: ${e}`),t=((e="database")=>{const t=k().createInstance({name:e,driver:k().INDEXEDDB,version:1}),n=e=>{if(e)throw new Error(`localForage error: ${e}`)};return{getItem:async e=>await t.getItem(D(e),n),setItem:async(e,a)=>await t.setItem(D(e),a,n),removeItem:async e=>await t.removeItem(D(e),n),clear:t.clear,getKeys:t.keys}})(e),"caches"in self&&T(e).clear()):(C.info(`Using Cache API for storage database: ${e}`),t=T(e)),t},L=P(),M=()=>{const e=URL.createObjectURL(new Blob),[t]=e.toString().split("/").reverse();return URL.revokeObjectURL(e),t};var R;const A=S.getLogger("config"),F=1.5;null!==(R=w.config)&&void 0!==R||(w.config=(()=>{var e,t,n,a,o,r,s;A.info("createConfig()");const i=new URLSearchParams(location.search);let l,u,c=()=>{if(void 0===u)throw Error("Unable to access config. Call 'await config.init()' first.")},d={},m=(e,t="")=>{c();let n=d[`${u}.${e}`];return void 0===n?t:n},p=(e,t)=>(c(),d[`${u}.${e}`]=t,t),f=async(e,t="")=>{c();let n,a=v(),o=await L.getItem(`config.${u}.${e}`);return null!==o?n=JSON.parse(await new Response(o).text()):(n=t,await L.setItem(`config.${u}.${e}`,new Blob([JSON.stringify(null!=n?n:"")]))),a(),p(e,n)},y=async(e,t,n=!0)=>{c();let a=v(),o=await f(e);p(e,t);const r=await L.setItem(`config.${u}.${e}`,new Blob([JSON.stringify(null!=t?t:"")]));return n&&o!==t&&(A.info(`Config changed for key: '${e}' from: '${o}' to: '${t}'`),document.dispatchEvent(new CustomEvent("syrinscape.updateConfig",{detail:{[e]:t}}))),a(),r};const h=[],v=()=>{let e,t=new Promise((t=>e=t));return h.push(t),()=>{e(),h.splice(h.indexOf(t),1)}},g={httpProtocol:null!==(e=i.get("httpProtocol"))&&void 0!==e?e:"https",httpHostname:null!==(t=i.get("httpHostname"))&&void 0!==t?t:"syrinscape.com",httpPort:null!==(n=i.get("httpPort"))&&void 0!==n?n:"443",wsProtocol:null!==(a=i.get("wsProtocol"))&&void 0!==a?a:"https".replace("http","ws"),wsHostname:null!==(o=i.get("wsHostname"))&&void 0!==o?o:"syrinscape.com",wsPort:null!==(r=i.get("wsPort"))&&void 0!==r?r:"443",postMessageToken:M(),postMessageWindow:null!==(s=window.opener)&&void 0!==s?s:window.parent!==window?window.parent:null,init:async(e="default",t={})=>{var n;u=null!==(n=null!=e?e:u)&&void 0!==n?n:"default";const a=v(),o={authenticated:await f("authenticated"),displayName:await f("displayName"),sessionId:await f("sessionId"),token:await f("token"),lastLocalVolume:await f("lastLocalVolume",1),localVolume:await f("localVolume",1),visualisationFramerate:await f("visualisationFramerate",30)};await Promise.all(Object.entries(t).map((([e,t])=>y(e,t,!1))));let r=`${g.httpProtocol}://app.${g.httpHostname}/config/`,s={headers:{Accept:"application/json",Authorization:`Token ${await f("token")}`}},i=await fetch(r,s);if(i.ok){let e=await i.json();g.wsHostname=e.hostname,await y("authenticated",e.authenticated,!1),await y("displayName",e.display_name,!1),await y("sessionId",e.session_id,!1),await y("token",e.token,!1);const t=Object.keys(o).reduce(((e,t)=>{let n=m(t);return n!==o[t]&&(e[t]=n),e}),{});A.info("Changed config:",t),document.dispatchEvent(new CustomEvent("syrinscape.updateConfig",{detail:t}))}else A.warn(`HTTP ${i.status}: Unable to get config.`);a()},sync:async()=>{await Promise.allSettled(h)},get audioContext(){return null!=l||(l=new AudioContext),l},set audioContext(e){if(void 0!==l)throw Error("An audio context already exists, and cannot be reassigned.");l=e},get authenticated(){return m("authenticated")},get deviceName(){return A.warn("deviceName is deprecated. Use displayName instead."),g.displayName},get displayName(){return m("displayName")},get lastLocalVolume(){return m("lastLocalVolume")},set lastLocalVolume(e){if(0!==(e=Number(e))){if(Number.isNaN(e)||e<0||e>F)throw Error(`Invalid lastLocalVolume: '${e}'`);y("lastLocalVolume",e)}},get localVolume(){return m("localVolume")},set localVolume(e){if(e=Number(e),Number.isNaN(e)||e<0||e>F)throw Error(`Invalid localVolume: '${e}'`);y("localVolume",e)},get sessionId(){return m("sessionId")},set sessionId(e){y("sessionId",e)},get token(){return m("token")},set token(e){e!==g.token&&g.init(u,{token:e})},get visualisationFramerate(){return m("visualisationFramerate")},set visualisationFramerate(e){if(e=Number(e),Number.isNaN(e)||e<=0)throw Error(`Invalid visualisationFramerate: ${e}`);y("visualisationFramerate",e)}};return g})());const O=w.config,z=O,$=e=>0!==e,V=(e={})=>{(e=Object.assign(i("analyser"),e)).isDestination&&(e.output=void 0);const t=new AnalyserNode(z.audioContext,e);let n,a,o,r;const s={params:e,setParam:{minDecibels:e=>t.minDecibels=e,maxDecibels:e=>t.maxDecibels=e,smoothingTimeConstant:e=>t.smoothingTimeConstant=e,fftSize:e=>t.fftSize=e},...u(t),getData:()=>({...s.getFrequencyData(),...s.getTimeDomainData()}),getFrequencyData:()=>{const e=new Uint8Array(t.frequencyBinCount);return t.getByteFrequencyData(e),o={frequencyData:e,frequencyBinCount:t.frequencyBinCount},o},getTimeDomainData:()=>{const e=new Float32Array(t.fftSize);return t.getFloatTimeDomainData(e),r={timeDomainData:e,fftSize:t.fftSize},r},get isActive(){return(null==o?void 0:o.frequencyData.some($))||(null==r?void 0:r.timeDomainData.some($))},get lastData(){return{...o,...r}},lastFrequencyData:o,lastTimeDomainData:r,startVisualisation:e=>{e&&(a=e);const o=()=>{n=requestAnimationFrame(o);const e=new Uint8Array(t.frequencyBinCount),r=new Float32Array(t.fftSize);t.getByteFrequencyData(e),t.getFloatTimeDomainData(r),a({frequencyData:e,timeDomainData:r,fftSize:t.fftSize,frequencyBinCount:t.frequencyBinCount})};requestAnimationFrame(o)},stopVisualisation:()=>{cancelAnimationFrame(n),n=0}};return s};class G{constructor(e,t){this.data=t,this.id=e,this.next=null,this.prev=null}}class j{constructor(e=1/0){this._size=0,this.positions=new Map,this.head=null,this.tail=null,this.limit=e}get size(){return this._size}set size(e){this._size=e,this._size>this.limit&&this.removeExcessNodes()}get(e){const t=this.positions.get(e);if(t){const e=this.moveToHead(t);return e?e.data:null}return null}remove(e){if(!this.head)return null;const t=this.positions.get(e);if(!t)return null;const n=t.prev,a=t.next;return n&&a?(n.next=a,a.prev=n,this.positions.delete(e),this.size--,t):n&&!a?(n.next=null,this.tail=n,this.positions.delete(e),this.size--,t):!n&&a?(a.prev=null,this.head=a,this.positions.delete(e),this.size--,t):n||a?null:(this.head=null,this.tail=null,this.positions.delete(e),this.size--,t)}has(e){return!!this.positions.has(e)}keys(){return Array.from(this.positions.keys())}moveToHead(e){const t=this.remove(e.id);return t?this.addNodeToHead(t.id,t.data):null}addNodeToHead(e,t){if(this.positions.has(e))return this.moveToHead(this.positions.get(e));if(this.head){let n=this.head;const a=new G(e,t);return a.next=n,a.prev=null,n.prev=a,this.head=a,this.positions.set(e,a),this.size++,a}{const n=new G(e,t);return this.head=n,this.tail||(this.tail=n),this.positions.set(e,n),this.size++,n}}removeExcessNodes(){const e=this.size-this.limit;this.removeNodes(e)}removeNodes(e=1){for(let t=0;t<e;t++)this.removeTailNode()}removeTailNode(){if(!this.tail)return null;let e=this.tail,t=this.tail;return this.positions.delete(t.id),this.size--,t=t.prev,t?t.next=null:this.head=null,this.tail=t,e}}const B=S.getLogger("lruCache");function q(){const e=new j(1/0);let t=!1;const n=e=>{t!==e&&e&&B.debug("Set LRU cache dirty."),t=e};return{get isDirty(){return t},setDirty:n,cache:e,get:function(t){return e.get(D(t))||null},set:function(t,a){return n(!0),e.addNodeToHead(D(t),a),!0},removeByCount:function(t){return n(!0),e.removeNodes(t),!0},removeByKey:function(t){return n(!0),e.remove(D(t))},removeOne:function(){return n(!0),e.removeTailNode()},has:function(t){return e.has(D(t))},size:function(){return e.size},keys:function(){return e.keys()},clear:function(){n(!0);const t=e.limit;e.limit=0,e.size=0,e.limit=t},toJSON:function(){if(0===e.size)return JSON.stringify([]);const t=[];let n=e.tail;for(;n;)t.push({id:n.id,data:n.data}),n=n.prev;return JSON.stringify(t)}}}const U=q;function H(e,t=2){if(0===e)return"0 Bytes";const n=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,a)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][a]}const W=(e,t,n=Math.random)=>e+(t-e)*n(),J=(Math.PI,Math.PI,e=>.001*e),Q=e=>1e3*e;var K,X,Y=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),Z=(K=["",""],X=["",""],Object.freeze(Object.defineProperties(K,{raw:{value:Object.freeze(X)}})));function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}const te=function(){function e(){for(var t=this,n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return ee(this,e),this.tag=function(e){for(var n=arguments.length,a=Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return"function"==typeof e?t.interimTag.bind(t,e):"string"==typeof e?t.transformEndResult(e):(e=e.map(t.transformString.bind(t)),t.transformEndResult(e.reduce(t.processSubstitutions.bind(t,a))))},a.length>0&&Array.isArray(a[0])&&(a=a[0]),this.transformers=a.map((function(e){return"function"==typeof e?e():e})),this.tag}return Y(e,[{key:"interimTag",value:function(e,t){for(var n=arguments.length,a=Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];return this.tag(Z,e.apply(void 0,[t].concat(a)))}},{key:"processSubstitutions",value:function(e,t,n){var a=this.transformSubstitution(e.shift(),t);return"".concat(t,a,n)}},{key:"transformString",value:function(e){return this.transformers.reduce((function(e,t){return t.onString?t.onString(e):e}),e)}},{key:"transformSubstitution",value:function(e,t){return this.transformers.reduce((function(e,n){return n.onSubstitution?n.onSubstitution(e,t):e}),e)}},{key:"transformEndResult",value:function(e){return this.transformers.reduce((function(e,t){return t.onEndResult?t.onEndResult(e):e}),e)}}]),e}();var ne={separator:"",conjunction:"",serial:!1};const ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne;return{onSubstitution:function(t,n){if(Array.isArray(t)){var a=t.length,o=e.separator,r=e.conjunction,s=e.serial,i=n.match(/(\n?[^\S\n]+)$/);if(t=i?t.join(o+i[1]):t.join(o+" "),r&&a>1){var l=t.lastIndexOf(o);t=t.slice(0,l)+(s?o:"")+" "+r+t.slice(l+1)}}return t}}};function oe(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}const re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initial";return{onEndResult:function(t){if("initial"===e){var n=t.match(/^[^\S\n]*(?=\S)/gm),a=n&&Math.min.apply(Math,oe(n.map((function(e){return e.length}))));if(a){var o=new RegExp("^.{"+a+"}","gm");return t.replace(o,"")}return t}if("all"===e)return t.replace(/^[^\S\n]+/gm,"");throw new Error("Unknown type: "+e)}}},se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{onEndResult:function(t){if(""===e)return t.trim();if("start"===(e=e.toLowerCase())||"left"===e)return t.replace(/^\s*/,"");if("end"===e||"right"===e)return t.replace(/\s*$/,"");throw new Error("Side not supported: "+e)}}};new te(ae({separator:","}),re,se),new te(ae({separator:",",conjunction:"and"}),re,se),new te(ae({separator:",",conjunction:"or"}),re,se);const ie=function(e){return{onSubstitution:function(t,n){if(null==e||"string"!=typeof e)throw new Error("You need to specify a string character to split by.");return"string"==typeof t&&t.includes(e)&&(t=t.split(e)),t}}};var le=function(e){return null!=e&&!Number.isNaN(e)&&"boolean"!=typeof e};const ue=new te(ie("\n"),(function(){return{onSubstitution:function(e){return Array.isArray(e)?e.filter(le):le(e)?e:""}}}),ae,re,se),ce=function(e,t){return{onSubstitution:function(n,a){if(null==e||null==t)throw new Error("replaceSubstitutionTransformer requires at least 2 arguments.");return null==n?n:n.toString().replace(e,t)}}};new te(ie("\n"),ae,re,se,ce(/&/g,"&amp;"),ce(/</g,"&lt;"),ce(/>/g,"&gt;"),ce(/"/g,"&quot;"),ce(/'/g,"&#x27;"),ce(/`/g,"&#x60;"));const de=function(e,t){return{onEndResult:function(n){if(null==e||null==t)throw new Error("replaceResultTransformer requires at least 2 arguments.");return n.replace(e,t)}}},me=new te(de(/(?:\n(?:\s*))+/g," "),se);new te(de(/(?:\n\s*)/g,""),se),new te(ae({separator:","}),de(/(?:\s+)/g," "),se),new te(ae({separator:",",conjunction:"or"}),de(/(?:\s+)/g," "),se),new te(ae({separator:",",conjunction:"and"}),de(/(?:\s+)/g," "),se),new te(ae,re,se),new te(ae,de(/(?:\s+)/g," "),se),new te(re,se),new te(re("all"),se);const pe=S.getLogger("compositeDatabase"),fe=5e7;var ye,he;const ve=S.getLogger("blobDatabase");null!==(ye=(he=w._r).blobDatabase)&&void 0!==ye||(he.blobDatabase=(({fetchMethod:e}={})=>{ve.info("createBlobDatabase()"),null!=e||(e=window.fetch),navigator.storage&&(navigator.storage.persist&&navigator.storage.persist().then((function(e){e?ve.info("Storage is persistent. Will not be cleared except by explicit user action."):ve.info("Storage is temporary. May be cleared by the UA under storage pressure.")})),(async()=>{if(navigator.storage.estimate){const e=await navigator.storage.estimate();ve.info(`Storage limit: ${H(e.quota)}`),ve.info(me`
					Storage used: ${H(e.usage)}
					(${(e.usage/e.quota*100).toFixed(2)}%)
				`)}})());const t=P("blob-cache"),n=((e,t=!0)=>{const n=t?async()=>{}:async()=>console.warn("'get' database is immutable");return{getItem:n,setItem:n,clear:n,removeItem:n,getKeys:()=>{n();const e=[];return new Promise((t=>t(e)))},...e}})({getItem:async t=>{o._onFetch(t);const n=await e(t);if(200!==n.status)throw new Error(`bad response: ${n}`);return await n.blob()}},!0),a=(e=>{const t=async t=>{await Promise.all(e.map(t))},n=async(t,n,a)=>{const o=e.slice(n,a).map(t);await Promise.all(o)};let a;const o="lruCacheBackup",r=async e=>{var t;let n;if(null===(t=navigator.storage)||void 0===t?void 0:t.estimate){const t=await navigator.storage.estimate();if(n=e+(t.usage-t.quota),n<0)return;let o=0,r=0;for(;o<n;){const e=a.removeOne();if(!e){pe.debug("Nothing left in LRU cache to remove.");break}pe.debug(`Removed LRU item: ${e.id}`),await s.removeItem(e.id),o+=e.data.size,r+=1}r>0&&pe.warn(ue`
					Removed ${r} LRU items from cache database to free ${H(o)}.
						storage limit: ${H(t.quota)}
						storage used: ${me`
							${H(t.usage)}
							(${(t.usage/t.quota*100).toFixed(2)}%)
						`}
				`)}},s={getItem:async t=>{for(let o=0;o<e.length;o++){const s=await e[o].getItem(t);if(s)return n((async e=>{await r(fe),await e.setItem(t,s),a.set(t,{size:s.size,timestamp:h()})}),0,o),s}return null},setItem:(e,t)=>{throw new Error("Not implemented.")},removeItem:async e=>{await t((async t=>await t.removeItem(e))),a.removeByKey(e)},clear:async()=>{await t((e=>e.clear())),a.clear()},getKeys:async()=>{const e=new Set;return await t((async t=>(await t.getKeys()).forEach((t=>e.add(t))))),Array.from(e)}};return(async()=>{a=await(async()=>{const t=await e[0].getItem(o);return null===t?(pe.info("Create new LRU cache."),U()):(pe.info("Restore LRU cache from backup."),function(e){const t=q();return JSON.parse(e).forEach((e=>{t.set(e.id,e.data)})),t}(await new Response(t).text()))})(),(async()=>{const e=a.keys(),t=(await s.getKeys()).filter((t=>t!==o&&!e.includes(t)));t.forEach((async e=>{const t=await s.getItem(e);a.set(e,{size:t.size,timestamp:h()}),pe.debug(ue`
					Restored item found in cache database but missing from LRU cache.
						key: ${e}
				`)})),t.length&&pe.info(me`
					Restored ${t.length} items found in cache database but missing from
					LRU cache.
				`)})(),pe.info("Call backupLruCache() every 5 seconds."),window.setInterval((async()=>{if(a.isDirty){const t=e[0],n=new Blob([a.toJSON()]);await r(fe),pe.debug(`LRU cache is dirty. Backup. Size: ${a.size} items`),await t.setItem(o,n),a.setDirty(!1)}}),5e3)})(),s})([t,n]),o={getBlob:e=>a.getItem(e),_onFetch:e=>{},_localDatabase:t,_remoteDatabase:n,_compositeDatabase:a};return o})());const ge=w._r.blobDatabase,we=(e={})=>{e=Object.assign(i("send"),e);const t=z.audioContext.createGain(),n=z.audioContext.createGain(),a=z.audioContext.createGain(),o={params:e,...u(t,n),connectFromMap:t=>a.connect(t[e.dryOutput].input),setWet:e=>{n.gain.value=e,a.gain.value=1-e},getWet:()=>n.gain.value,setParam:{wetness:e=>o.setWet(e)},_input:t,_wet:n,_dry:a};return t.connect(n),t.connect(a),o.setWet(e.wetness),o},be=(e={})=>{e=Object.assign(i("spatial"),e);const t=new PannerNode(z.audioContext,{panningModel:e.panningModel,distanceModel:e.distanceModel,rolloffFactor:e.rolloff,refDistance:e.minDistance,maxDistance:e.maxDistance}),n={params:e,...u(t),setPosition:e=>{t.positionX.value=e.x||0,t.positionY.value=e.y||0,t.positionZ.value=e.z||0},getPosition:()=>({x:t.positionX.value,y:t.positionY.value,z:t.positionZ.value}),setVelocity:function(e,n){t.positionX.linearRampToValueAtTime(t.positionX.value+e.x*n,z.audioContext.currentTime+n),t.positionY.linearRampToValueAtTime(t.positionY.value+e.y*n,z.audioContext.currentTime+n),t.positionZ.linearRampToValueAtTime(t.positionZ.value+e.z*n,z.audioContext.currentTime+n)},setParam:{position:e=>n.setPosition(e)},node:t};return n.setPosition(e.position),n},Se=e=>new Promise((t=>setTimeout(t,e))),_e=(e,t)=>({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z}),xe=e=>Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),Ee=(e,t)=>({x:e.x*t,y:e.y*t,z:e.z*t}),Ie=S.getLogger("audioEffectSystem"),De=(e,t,n)=>e+(t-e)*n,Te={linear:e=>e,easeIn:e=>1-Math.cos(e*Math.PI*.5),easeOut:e=>Math.sin(e*Math.PI*.5)},Ne=(e={})=>{var t;(e=Object.assign(i("volume"),e)).isDestination&&(e.output=void 0);const n=new GainNode(z.audioContext,{gain:e.volume}),a=new URLSearchParams(location.search),o=Number(null!==(t=a.get("dbRangeVolumeEffect"))&&void 0!==t?t:37.5),r=e=>{const t=e*o-o;return t==-o?0:Math.pow(10,t/20)};return{params:e,...u(n),get value(){return e=n.gain.value,1-20*Math.log10(e)/-o;},set value(e){n.gain.cancelScheduledValues(z.audioContext.currentTime),n.gain.value=r(e)},fadeToValue:async(t,a=e.fadeDuration,o)=>{((e,t,n,a,o)=>{null!=o||(o="easeOut"),0===a&&(a=.001);const r=[],s=e.value,i=Te[o];for(let e=0;e<32;e++){const n=i(e/31);r.push(De(s,t,n))}e.cancelScheduledValues(n);try{e.setValueCurveAtTime(r,n,a)}catch(e){if(!/AudioParam.setValueCurveAtTime: Can't add events during a curve event/.test(e.message))throw e;Ie.error(e)}})(n.gain,r(t),z.audioContext.currentTime,a,o),await Se(1e3*a)},setParam:{volume:e=>n.gain.value=e,fadeDuration:t=>e.fadeDuration=t}}};class ke{constructor(e){this.name="effect",this.context=e,this.input=this.context.createGain(),this.effect=null,this.bypassed=!1,this.output=this.context.createGain(),this.setup(),this.wireUp()}setup(){this.effect=this.context.createGain()}wireUp(){this.input.connect(this.effect),this.effect.connect(this.output)}connect(e){this.output.connect(e)}}class Ce{constructor(e,t=1){this.context=e,this.output=this.context.createGain(),this.output.gain.value=t,this.partials=[],this.velocity=0,this.gain=t,this._attack=0,this._decay=.001,this._sustain=this.output.gain.value,this._release=.001}on(e){this.velocity=e/127,this.start(this.context.currentTime)}off(e){return this.stop(this.context.currentTime)}start(e){this.output.gain.value=0,this.output.gain.setValueAtTime(0,e),this.output.gain.setTargetAtTime(1,e,this.attack+1e-5),this.output.gain.setTargetAtTime(this.sustain*this.velocity,e+this.attack,this.decay)}stop(e){this.sustain=this.output.gain.value,this.output.gain.cancelScheduledValues(e),this.output.gain.setValueAtTime(this.sustain,e),this.output.gain.setTargetAtTime(0,e,this.release+1e-5)}set attack(e){this._attack=e}get attack(){return this._attack}set decay(e){this._decay=e}get decay(){return this._decay}set sustain(e){this.gain=e,this._sustain}get sustain(){return this.gain}set release(e){this._release=e}get release(){return this._release}connect(e){this.output.connect(e)}}class Pe extends class{constructor(e,t="sawtooth",n=.1){this.context=e,this.type=t,this.value=-1,this.gain=n,this.output=this.context.createGain(),this.partials=[],this.output.gain.value=this.gain,this.ampEnvelope=new Ce(this.context),this.ampEnvelope.connect(this.output)}init(){const e=this.context.createOscillator();e.type=this.type,e.connect(this.ampEnvelope.output),e.start(this.context.currentTime),this.partials.push(e)}on(e){this.value=e.value,this.partials.forEach((t=>{t.frequency.value=e.frequency})),this.ampEnvelope.on(e.velocity||e)}off(e){this.ampEnvelope.off(e),this.partials.forEach((e=>{e.stop(this.context.currentTime+4*this.ampEnvelope.release)}))}connect(e){this.output.connect(e)}set detune(e){this.partials.forEach((t=>t.detune.value=e))}set attack(e){this.ampEnvelope.attack=e}get attack(){return this.ampEnvelope.attack}set decay(e){this.ampEnvelope.decay=e}get decay(){return this.ampEnvelope.decay}set sustain(e){this.ampEnvelope.sustain=e}get sustain(){return this.ampEnvelope.sustain}set release(e){this.ampEnvelope.release=e}get release(){return this.ampEnvelope.release}}{constructor(e,t){super(e,t),this._length=2}get length(){return this._length||2}set length(e){this._length=e}init(){const e=new Float32Array(this.length*this.context.sampleRate),t=new Float32Array(this.length*this.context.sampleRate);for(let n=0;n<this.length*this.context.sampleRate;n++)e[n]=1-2*Math.random(),t[n]=1-2*Math.random();const n=this.context.createBuffer(2,this.length*this.context.sampleRate,this.context.sampleRate);n.copyToChannel(e,0),n.copyToChannel(t,1);const a=this.context.createBufferSource();a.buffer=n,a.loop=!0,a.loopStart=0,a.loopEnd=2,a.start(this.context.currentTime),a.connect(this.ampEnvelope.output),this.partials.push(a)}on(e){this.value=e.value,this.ampEnvelope.on(e.velocity||e)}}class Le extends ke{constructor(e,t="lowpass",n=1e3,a=.9){super(e),this.name="filter",this.effect.frequency.value=n,this.effect.Q.value=a,this.effect.type=t}setup(){this.effect=this.context.createBiquadFilter(),this.effect.connect(this.output),this.wireUp()}}class Me extends ke{constructor(e){super(e),this.name="AdvancedReverb"}setup({duration:e,preDelay:t,attack:n,decay:a}={}){null!=e||(e=1),null!=t||(t=.03),null!=n||(n=.001),null!=a||(a=.1),this.effect=this.context.createConvolver(),this.duration=e,this.attack=n,this.decay=a,this.release=e,this.preDelay=this.context.createDelay(e),this.preDelay.delayTime.setValueAtTime(t,this.context.currentTime),this.multitap=[];for(let t=2;t>0;t--)this.multitap.push(this.context.createDelay(e));this.multitap.map(((e,n)=>{this.multitap[n+1]&&e.connect(this.multitap[n+1]),e.delayTime.setValueAtTime(.001+n*(t/2),this.context.currentTime)})),this.multitapGain=this.context.createGain(),this.multitap[this.multitap.length-1].connect(this.multitapGain),this.multitapGain.gain.value=.2,this.multitapGain.connect(this.output),this.wet=this.context.createGain(),this.wet.gain.value=1,this.input.connect(this.wet),this.wet.connect(this.preDelay),this.wet.connect(this.multitap[0]),this.preDelay.connect(this.effect),this.effect.connect(this.output)}renderTail({lpCutoff:e,lpResonance:t,hpCutoff:n,hpResonance:a}={}){null!=e||(e=2e3),null!=t||(t=.2),null!=n||(n=500),null!=a||(a=.1);const o=new OfflineAudioContext(2,this.context.sampleRate*this.duration,this.context.sampleRate);o.oncomplete=e=>this.effect.buffer=e.renderedBuffer;const r=new Pe(o,1),s=new Le(o,"lowpass",e,t),i=new Le(o,"highpass",n,a);r.init(),r.connect(i.input),i.connect(s.input),s.connect(o.destination),r.attack=this.attack,r.decay=this.decay,r.release=this.release,o.startRendering(),r.on({frequency:500,velocity:1}),setTimeout((()=>r.off()),20)}set decayTime(e){const t=e/3;this.duration=e,this.attack=0,this.decay=0,this.release=t,this.renderTail()}}var Re=n(5356),Ae=n.n(Re);const Fe={volume:Ne,analyser:V,compressor:(e={})=>{(e=Object.assign(i("compressor"),e)).isDestination&&(e.output=void 0);const t=new DynamicsCompressorNode(z.audioContext,e);return{params:e,setParam:{},...u(t)}},convolver:async(e={})=>{e=Object.assign(i("convolver"),e);const t=await ge.getBlob(e.url),n=await t.arrayBuffer(),a=await z.audioContext.decodeAudioData(n),o=z.audioContext.createConvolver();return o.buffer=a,{...u(o),params:e,setParam:{}}},send:we,delay:e=>{e=Object.assign(i("delay"),e);const t=z.audioContext.createDelay(l.delay.parameters.duration.max);t.delayTime.value=e.duration;const n=z.audioContext.createGain();return n.gain.value=e.falloff,t.connect(n),n.connect(t),{params:e,...u(n,t),setParam:{duration:e=>t.delayTime.value=e,falloff:e=>n.gain.value=e}}},spatial:be,filter:e=>{e=Object.assign(i("filter"),e);const t=z.audioContext.createBiquadFilter();t.type=e.filterType,t.Q.value=e.resonance,t.detune.value=e.detune,t.gain.value=e.gain,t.frequency.value=e.frequency;const n=z.audioContext.createGain(),a=z.audioContext.createGain();return n.connect(t),t.connect(a),{params:e,...u(n,a),setParam:{filterType:e=>t.type=e,resonance:e=>t.Q.value=e,detune:e=>t.detune.value=e,gain:e=>t.gain.value=e,frequency:e=>t.frequency.value=e}}},reverb:e=>{e=Object.assign(i("reverb"),e);const t=new Me(z.audioContext);return t.setup({...e}),t.renderTail({...e}),{params:e,...u(t.input,t.output),setParam:{}}},freeverb:e=>{e=Object.assign(i("freeverb"),e);const t=z.audioContext.createDelay(l.freeverb.parameters.preDelay.max);t.delayTime.value=e.preDelay;const n=Ae()(z.audioContext);n.wet.value=1,n.dry.value=0,n.roomSize=e.roomSize,n.dampening=e.dampening;const a=z.audioContext.createBiquadFilter();a.type="highpass",a.frequency.value=e.hpFrequency,a.Q.value=e.hpResonance;const o=z.audioContext.createBiquadFilter();o.type="lowpass",o.frequency.value=e.lpFrequency,o.Q.value=e.lpResonance;const r=z.audioContext.createGain();return r.gain.value=e.gain,t.connect(n),n.connect(a),a.connect(o),o.connect(r),{params:e,...u(t,r),setParam:{preDelay:e=>t.delayTime.value=e,dampening:e=>n.dampening=e,roomSize:e=>n.roomSize=e,hpFrequency:e=>a.frequency.value=e,hpResonance:e=>a.Q.value=e,lpFrequency:e=>o.frequency.value=e,lpResonance:e=>o.Q.value=e,gain:e=>r.gain.value=e}}}},Oe=S.getLogger("urlSystem"),ze=()=>{const e=e=>e?`:${e}`:"";return{replaceLocalDomainAndPort:t=>{const n=t.replace(RegExp("://[^/]*(localhost|lvh.me)[^/]+"),`://${z.httpHostname}${e(z.httpPort)}`);return n!==t&&Oe.debug(`replaceLocalDomainAndPort(): ${t} => ${n}`),n},createUrlHttp:(t,n="")=>`${z.httpProtocol}://${(e=>e?`${e}.`:"")(n)}${z.httpHostname}${e(z.httpPort)}/${t}`,createUrlWs:t=>`${z.wsProtocol}://${z.wsHostname}${e(z.wsPort)}/${t}`}};ze();let $e,Ve=1e3/60,Ge=S.getLogger("strictTimeout"),je=1,Be=new Map,qe=()=>{Be.forEach(((e,t)=>{let{start:n,end:a,callback:o}=e,r=(new Date).getTime();if(n<r&&(Be.delete(t),void 0===a||a>r-5e3))try{o()}catch(n){Ge.error(`Error while executing strict timer ${t}`,n,e)}})),0===Be.size?Je():void 0!==$e&&($e=window.setTimeout(qe,Ve))},Ue=e=>{Be.delete(e)},He=(e,t,n)=>{void 0===$e&&We();let a=(new Date).getTime()+t,o=n?a+n:void 0,r=je++;return Be.set(r,{start:a,end:o,callback:e}),r},We=()=>{void 0===$e&&($e=window.setTimeout(qe,Ve))},Je=()=>{$e=void 0,window.clearTimeout($e)};const Qe=S.getLogger("audioSystem"),Ke=e=>{const t={};return{getOrUndefined:e=>t[e],getOrCreate:n=>(t[n]||(t[n]=e(n)),t[n])}};var Xe,Ye;const Ze=S.getLogger("postMessageSystem");null!==(Xe=(Ye=w._r).postMessageSystem)&&void 0!==Xe||(Ye.postMessageSystem=(()=>{Ze.info("createPostMessageSystem()");const e=Ke(a),t=a();window.addEventListener("message",(n=>{var a;let{message:o,params:r,token:s}=n.data;if(s!==z.postMessageToken)return;let i={message:o,params:r};t.invoke(i),null===(a=e.getOrUndefined(i.message))||void 0===a||a.invoke(i)}));const n={onMessage:t=>e.getOrCreate(t),onAnyMessage:t,sendMessage:(e,t)=>{if(!z.postMessageWindow)return;let n={message:e,params:t,token:z.postMessageToken};z.postMessageWindow.postMessage(n,"*")}};return n.onMessage("syrinscape.setToken").addListener((e=>{z.token=e.params.token})),n})());const et=w._r.postMessageSystem;var tt,nt,at;const ot=S.getLogger("eventSystem");class rt{constructor(e,t){this.listeners=[],t&&this.listeners.push(t),this.eventName=`syrinscape.${e}`}addListener(e){return this.listeners.push(e),document.addEventListener(this.eventName,e),()=>{document.removeEventListener(this.eventName,e)}}delete(){this.listeners.forEach((e=>{document.removeEventListener(this.eventName,e)})),delete st[this.eventName]}dispatch(e){const t=new CustomEvent(this.eventName,{detail:null!=e?e:null});document.dispatchEvent(t),et.sendMessage("syrinscape.dispatchEvent",{eventName:this.eventName,eventDetail:e})}}null!==(tt=w.events)&&void 0!==tt||(w.events={});const st=w.events;null!==(nt=(at=w._r).eventSystem)&&void 0!==nt||(at.eventSystem=(()=>{ot.info("createEventSystem()"),et.onMessage("syrinscape.dispatchEvent").addListener((e=>{const t=new CustomEvent(e.params.eventName,{detail:e.params.eventDetail||null});document.dispatchEvent(t)}));let e=e=>(void 0===st[e]&&(st[e]=new rt(e)),st[e]);return{add:(t,n)=>{const a=e(t);return void 0!==n?a.addListener(n):()=>{}},delete:e=>{st[e]&&st[e].delete()},dispatch:(t,n)=>{e(t).dispatch(n)}}})());const it=w._r.eventSystem;it.add("updateConfig"),it.add("setGlobalVolume"),it.add("setLocalVolume");const lt=S.getLogger("audioSystem");Error,Error,Error;class ut extends Error{constructor(e){super(),this.name="StatusError",this.message=`request returned a ${e} status`}}Error;const ct=S.getLogger("controlSystem"),dt=e=>JSON.parse(JSON.stringify(e)),mt=(e,t)=>parseFloat(t)||e,pt=e=>mt(0,e),ft=e=>mt(1,e),yt=e=>1e3*pt(e),ht=e=>{const t=yt(e.min_wait),n=yt(e.max_wait),a=e.playlist_order,o=((e,t)=>e<0&&t<0&&Math.abs(t-e)<.001)(t,n);return{order:a,loop:o,repeat:o||(e=>"oneshot"!==e.type&&("random"===e.playlist_order||!1!==e.repeat_playlist))(e),sampleDelayMin:t,sampleDelayMax:n,sampleDelayPos:e.allow_samples_to_overlap?"start":"end",elementDelayMin:yt(e.min_start_delay),elementDelayMax:yt(e.max_start_delay),sampleParamsList:e.playlist?e.playlist.map(gt):[]}},vt=e=>{var t;if(null!==(t=e.position_samples)&&void 0!==t||(e.position_samples=!0),e.position_samples)return{minDist:pt(e.min_distance),maxDist:pt(e.max_distance),minAngle:pt(e.min_angle),maxAngle:pt(e.max_angle),speed:pt(e.speed)}},gt=e=>{return{spatializable:(t=e.is_3d,!0,!0===t||!1!==t&&true),name:e.name,duration:yt(e.len),url:e.url,sampleId:bt(e.s_id||e.id),minGain:ft(e.min_gain),maxGain:ft(e.max_gain)};},wt=e=>e&&Number(e.replace("e_","")),bt=e=>e&&Number(e.replace("s_","")),St=(e,t)=>[...e.getRaw()].filter((([e,n])=>n.elementId===t)),_t=(e,t)=>[...e.getRaw()].filter((([e,n])=>n.sampleId===t)),xt=__dumbStubs;it.add("startElement");const Et=S.getLogger("elementSpawnSystem");let It=0,Dt=0,Tt=0;const Nt=()=>{const e=new Map,t=a();return{getRaw:()=>e,get:()=>e,update:()=>t.invoke(e),onUpdate:t,mutate:n=>{n(e),t.invoke(e)},tryMutate:n=>{n(e)&&t.invoke(e)}}},kt=({prefix:e}={})=>{e=e||Math.random().toFixed(8);let t=0;return{nextId:()=>`${e}-${t++}`}},Ct=S.getLogger("sampleSpawnSystem");it.add("startSample");it.add("stopSample");const Pt=({audioSystem:e,uuidSystem:t})=>{t=t||kt();const n=Nt(),o=(({audioSystem:e,uuidSystem:t,sampleMap:n})=>{const{effectSystem:o}=e;t=null!=t?t:kt();const r={spawnSampleFromParams:({params:e,startTime:n,wetOut:a,dryOut:o})=>{const s={...e,volume:W(e.minGain,e.maxGain),uuid:t.nextId(),startTime:null!=n?n:v()};return r.spawnSampleFromData({data:s,wetOut:a,dryOut:o})},spawnSampleFromData:({data:r,wetOut:s,dryOut:i,fadeOptions:l})=>{var u,c,d,m,p;const f=o.preset(r.presetName);null!=s||(s=o.effect(null==f?void 0:f.effect)),"Off"===r.presetName&&(s=void 0),null!=i||(i=o.globalVolume);const{spatialData:h,volume:g,startTime:b}=r;let S,_;if(null!==(u=r.uuid)&&void 0!==u||(r.uuid=t.nextId()),h){const e=null!==(c=null==f?void 0:f.drySpatializer)&&void 0!==c?c:o.defaultPreset.drySpatializer;_=be(e),_.connect(i),i=_}if(h&&s){const e=null!==(d=null==f?void 0:f.wetSpatializer)&&void 0!==d?d:o.defaultPreset.wetSpatializer;S=be(e),S.connect(s),S.setPosition({x:0,y:0,z:xe(h.position)}),s=S}let x=i;if(s){const e=we();e._wet.connect(s.input),e._dry.connect(i.input);const t=null!==(m=null==f?void 0:f.wetGain)&&void 0!==m?m:o.defaultPreset.wetGain,n=null!==(p=null==f?void 0:f.dryGain)&&void 0!==p?p:o.defaultPreset.dryGain;e._wet.gain.value=t,e._dry.gain.value=n,x=e}const E=e.createAudioSource(r.url,x,l,g);let I;const D={...r,alive:!0,isPlaying:!1,audioSource:E,onDispose:a(),dispose:async()=>{var e;if(D.alive){if(Ct.debug(ue`
						sampleInstance.dispose():
							name: ${D.name}
							uuid: ${D.uuid}
							src: ${r.url}
					`),Ue(I),D.alive=!1,E.onDispose.removeListener(D.dispose),E.isAlive){const e=D.startTime+D.duration;let t=v();it.dispatch("stopSample",{elementId:D.elementId,playlistEntryId:D.playlistEntryId,sampleId:D.sampleId,timeToStop:Math.min(Math.max(e-t,0),3e3)||0}),await E.stop(),t=v(),_t(n,D.sampleId).some((([,e])=>e.uuid!==D.uuid&&e.startTime<=t&&t<e.startTime+e.duration&&e.elementId===D.elementId&&e.playlistEntryId===D.playlistEntryId))||it.dispatch("stopSample",{elementId:D.elementId,playlistEntryId:D.playlistEntryId,sampleId:D.sampleId,timeToStop:0})}null==S||S.disconnectAll(),null==_||_.disconnectAll(),n.mutate((e=>e.delete(r.uuid))),0===n.getRaw().size&&(null===(e=w.visualisation)||void 0===e||e.stop()),D.onDispose.invoke()}else Ct.warn(ue`
							sampleInstance.dispose(): Already dead! Can only dispose once!
								name: ${D.name}
								uuid: ${D.uuid}
								src: ${r.url}
						`)}};E.onDispose.addListener(D.dispose);const T=e=>{var t;if(Ct.debug(ue`
					startSample():
						name: ${D.name}
						uuid: ${D.uuid}
						src: ${r.url}
				`),window.Sentry){const e=v();window.Sentry.addBreadcrumb({type:"debug",message:"startSample()",level:"info",data:{...r,clientTime:Date.now(),endTime:r.startTime+r.duration,getServerTime:e,startTimeServerTimeDelta:r.startTime-e,clientTimeServerTimeDelta:Date.now()-e,getServerTimeOffset:y()}})}if(h){let t=r.duration/1e3,n=h.position;const{velocity:a}=h;if(void 0!==e&&(n=_e(n,Ee(a,e)),t-=e),_.setPosition(n),_.setVelocity(a,t),void 0!==S){const e=z.audioContext.currentTime;((e,t,n,a,o,r=10)=>{const s=new Array(r);for(let e=0;e<r;e++){const a=_e(t,Ee(n,o*(e/(r-1))));s[e]=xe(a)}e.setValueCurveAtTime(s,a,o)})(S.node.positionZ,n,a,e,t)}}null===(t=w.visualisation)||void 0===t||t.start(),E.play(e),D.isPlaying=!0,n.update(),r.elementId&&!r.manuallyTriggered?document.dispatchEvent(new CustomEvent("syrinscape.internalStartElementSample",{detail:r})):it.dispatch("startSample",{elementId:r.elementId,playlistEntryId:r.playlistEntryId,sampleId:r.sampleId,timeToStop:r.startTime+r.duration-v()})},N=v();return window.Sentry&&window.Sentry.addBreadcrumb({type:"debug",message:"spawnSampleFromData()",level:"info",data:{...r,clientTime:Date.now(),endTime:r.startTime+r.duration,getServerTime:N,startTimeServerTimeDelta:r.startTime-N,clientTimeServerTimeDelta:Date.now()-N,getServerTimeOffset:y()}}),b<=N-5e3?(Ct.debug(ue`
					spawnSampleFromData(): Already in progress. Scrub ${J(N-b)} seconds.
						name: ${r.name}
						uuid: ${r.uuid}
				`),T(J(N-b))):b<=N?(Ct.debug(ue`
					spawnSampleFromData(): Start with no scrubbing.
						name: ${r.name}
						uuid: ${r.uuid}
				`),T()):(I=He(T,b-N,r.duration),Ct.debug(ue`
					spawnSampleFromData(): Schedule start in ${J(b-N)} seconds.
						name: ${r.name}
						uuid: ${r.uuid}
						startHandle: ${I}
				`)),n.mutate((e=>e.set(r.uuid,D))),D}};return r})({audioSystem:e,uuidSystem:t,sampleMap:n}),r={map:n,getSamples:()=>n.getRaw(),getSamplesWithSampleId:e=>_t(n,e),...o,removeSample:e=>n.get().get(e).dispose(),getStopWait:e=>{const t=v();let n;return r.getSamplesWithSampleId(e).filter((([,e])=>e.startTime<=t&&t<e.startTime+e.duration)).forEach((([,e])=>{const t=e.startTime+e.duration;(!n||t>n)&&(n=t)})),Math.min(Math.max(n-t,0),3e3)||0},stopPlaylistEntryByPlaylistEntryId:e=>{[...r.getSamples().values()].filter((t=>t.playlistEntryId===e)).forEach((e=>e.dispose()))},stopDirectSampleBySampleId:e=>{r.getSamplesWithSampleId(e).forEach((([,e])=>{e.elementId||e.playlistEntryId||e.dispose()}))},stopSampleBySampleUuid:e=>{n.getRaw().get(e).dispose()},stopAllSamples:()=>Promise.all([...n.getRaw()].map((([,e])=>e.dispose()))),playSample:e=>r.spawnSampleFromParams({params:gt(e)}),playSampleAtTime:(e,t)=>r.spawnSampleFromParams({params:gt(e),startTime:t}),playSampleWithReverb:(e,t="Cave",n)=>r.spawnSampleFromParams({params:{...gt(e),presetName:t},startTime:n}),stopSample:({id:e})=>r.stopDirectSampleBySampleId(Number(e))};return r};it.add("setElementVolume"),it.add("startElementSample"),it.add("stopElement");const Lt=({authSystem:e,audioSystem:t,sampleSystem:n,uuidSystem:o})=>{o=o||kt(),n=n||Pt({audioSystem:t,uuidSystem:o});const r=Nt(),s=(({elementMap:e})=>{const t=new Map;return{elementVolumeMap:t,setElementIdVolume:(n,a)=>{t.get(n)!==a&&(t.set(n,a),St(e,n).forEach((([,e])=>e.setVolume(a))),it.dispatch("setElementVolume",{elementId:n,volume:a}))}}})({elementMap:r}),i=(({audioSystem:e})=>{const{effectSystem:t}=e;let n=1;const o=a();return{onChange:o,setVolume:e=>{n=e,o.invoke(n)},createOneshotVolume:(e,a,r,s)=>{const i=Ne(),l=Ne();i.value=n,l.value=n,e.connect(i),a.connect(l),i.connect(s),r?(l.connect(r),r.connect(t.globalVolume)):l.connect(t.globalVolume);const u=e=>{i.fadeToValue(e),l.fadeToValue(e)};return o.addListener(u),()=>o.removeListener(u)}}})({audioSystem:t}),l=(({}={})=>{const e=new Map,t=t=>{if(e.has(t))return e.get(t);const n=[];return e.set(t,n),n},n={onPlayedSamplesChanged:a(),playedSamplesMap:e,createPlaylist:e=>{let{playedSamples:a}=e;const{elementId:o,playlistParams:r,type:s,randomSeed:i}=e,{sampleParamsList:l,order:u}=r;if(l.length<=1)return l;const c=void 0===i?Math.random:((e=1)=>(0===e&&(e=1),()=>{const t=1e4*Math.sin(e++);return t-Math.floor(t)}))(i);if("random"===u)return((e,t)=>{const n=new Array(12);for(let e=0;e<n.length;e++)n[e]=((e,t=Math.random)=>e[Math.floor(t()*e.length)])(l,c);return n})();if(null!=a||(a=t(o)),a.length>=l.length){const e=a[a.length-1];n.clearPlayedSamples(o),n.appendPlayedSamples(o,e)}let d=[...l];const m=a.length>0?a[a.length-1]:void 0;if("shuffle"===u)((e,t=Math.random)=>{for(let n=e.length-1;n>0;n--){const a=Math.floor(t()*(n+1)),o=e[n];e[n]=e[a],e[a]=o}})(d,c),d[0].sampleId===m&&d.push(d.shift());else if(m){const e=(d.indexOf(d.find((e=>e.sampleId===m)))+1)%d.length;d=((e,t)=>{const n=[];for(let a=0;a<e.length;a++){const o=(a+t)%e.length;n.push(e[o])}return n})(d,e)}return"oneshot"===s&&(d=d.filter((e=>!a.includes(e.sampleId))),d.splice(1),n.appendPlayedSamples(o,d[0].sampleId)),d},clearPlayedSamples:a=>{t(a).length=0,n.onPlayedSamplesChanged.invoke(e)},clearAllPlayedSamples:()=>{e.clear(),n.onPlayedSamplesChanged.invoke(e)},appendPlayedSamples:(a,o)=>{const r=t(a);r.includes(o)||r.push(o),n.onPlayedSamplesChanged.invoke(e)}};return n})(),u=(({authSystem:e,audioSystem:t,sampleSystem:n,uuidSystem:a,elementMap:o,playlistSystem:r,oneshotSystem:s,elementVolumeSystem:i})=>{const{effectSystem:l}=t,u=async t=>{const n=await e.authorizedFetchPath("online/frontend-api/element-params-to-data/",{method:"POST",body:JSON.stringify(t)});if(200!==n.status)throw new Error(`bad response: ${n.status}`);return await n.json()};let c=!1;const d={analyseElements:c,init:({analyse:e=!1}={})=>{Et.info(`Analyse elements: ${e}`),c=e},dataToRepeatParams:e=>{const t=e.playlistData.sampleDataList[e.playlistData.sampleDataList.length-1];let n=t.startTime;"end"===e.playlistParams.sampleDelayPos&&(n+=t.duration);const a=(({uuid:e,playlistData:t,...n})=>dt(n))(e);return a.playlistParams.firstSampleDelay=!0,a.playlistParams.useElementDelay=!1,a.playedSamples=e.playlistData.sampleDataList.map((e=>e.sampleId)),a.startTime=n,a},paramsToData:async e=>{(e=dt(e)).playlistParams.sampleParamsPlaylist=r.createPlaylist(e);const t=await u(e);let{startTime:n,playlistData:a}=t;if(void 0!==n){const e=a.sampleDataList[a.sampleDataList.length-1];e.startTime+e.duration-(v()-n)<0&&(console.warn("next start time cannot be earlier than playlist duration. consider reducing delay between samples"),n=void 0)}return null!=n||(n=v()),a.sampleDataList.forEach((e=>e.startTime+=n)),t},spawnElementFromParams:async e=>{const t=await d.paramsToData(e);return d.spawnElementFromData(t)},spawnElementFromData:(e,t=!1)=>{var a;const u=v(),m={...e,alive:!0};let p=0===w.player.elementSystem.getElementsWithElementId(m.elementId).length&&e.playlistData.sampleDataList.some((e=>!e.manuallyTriggered));c&&(m.analyser=V());let f=l.preset(e.presetName);void 0===f&&(Et.warn(ue`
					Unknown effect spawning element, fallback to 'Off'.
					effect:
						name: ${e.presetName}
					element:
						title: ${m.title}
						id: ${m.elementId}
						uuid: ${m.uuid}
				`),f=l.preset("Off"));const y=Ne(),h=Ne();if(m.setVolume=e=>{y.fadeToValue(e),h.fadeToValue(e)},void 0!==m.volume&&i.setElementIdVolume(m.elementId,m.volume),i.elementVolumeMap.has(m.elementId)){const e=i.elementVolumeMap.get(m.elementId);y.value=e,h.value=e}const g="Off"===e.presetName?Ne():l.effect(f.effect);let b;"oneshot"===e.type?b=s.createOneshotVolume(y,h,m.analyser,g):(y.connect(g),m.analyser?(h.connect(m.analyser),m.analyser.connect(l.globalVolume)):h.connect(l.globalVolume));const S=e.crossfade?{fadeIn:e.crossfade,fadeOut:e.crossfade}:void 0;let _;if(m.sampleInstanceLookup=new Map,m.sampleFutureDataLookup=new Map,m.playlistData.sampleDataList.forEach((e=>{(!_||e.startTime<_)&&(_=e.startTime);const a=()=>{if(t&&e.startTime<u){const t=(v()-e.startTime)/1e3;Et.info(ue`
							spawn sample:
								scheduled samples: ${m.sampleFutureDataLookup.size}
								scrubbed seconds: ${t}
							sample:
								name: ${e.name}
								uuid: ${e.uuid},
							element:
								title: ${m.title}
								id: ${m.elementId}
								uuid: ${m.uuid}
						`)}else{It+=1;let t=(v()-e.startTime)/1e3;Dt=function(e,t=0,n=0){if(!e||!e[Symbol.iterator])throw Error("must pass an iterable sequence");let a=t,o=n;for(let t of e)o+=1,a=a*((o-1)/o)+t/o;return a}([t],Dt,It),Tt=Math.max(t,Tt),Et.info(ue`
							spawn sample:
								scheduled samples: ${m.sampleFutureDataLookup.size}
								spawned samples: ${It}
								delay: ${t}
								avg delay: ${Dt}
								max delay: ${Tt}
							sample:
								name: ${e.name}
								uuid: ${e.uuid}
							element:
								title: ${m.title}
								id: ${m.elementId}
								uuid: ${m.uuid}
						`)}e.elementId=m.elementId,m.sampleFutureDataLookup.delete(e.uuid);const a=n.spawnSampleFromData({fadeOptions:S,data:e,wetOut:y,dryOut:h});a.audioSource.onPlay.addListener((()=>r.appendPlayedSamples(m.elementId,a.sampleId))),a.onDispose.addListener((()=>((e,t)=>{e.sampleInstanceLookup.delete(t),e.alive&&0===e.sampleInstanceLookup.size&&0===e.sampleFutureDataLookup.size&&(null==e||e.dispose())})(m,a.uuid))),m.sampleInstanceLookup.set(a.uuid,a)},o=e.startTime-1e4;o>u?(m.sampleFutureDataLookup.set(e.uuid,{...e,timeoutId:He(a,o-u,1e4+e.duration)}),Et.debug(ue`
						Delay spawning sample for ${(o-u)/1e3} seconds.
							scheduledSamples: ${m.sampleFutureDataLookup.size}
							spawnedSamples: ${It}
						sample:
							name: ${e.name}
							uuid: ${e.uuid}
						element:
							title: ${m.title}
							id: ${m.elementId}
							uuid: ${m.uuid}
					`)):a()})),Et.debug(ue`
				spawnElementFromData():
					scheduled samples: ${m.sampleFutureDataLookup.size}
					spawned samples: ${m.sampleInstanceLookup.size}
				element:
					title: ${e.title}
					id: ${e.elementId}
					uuid: ${e.uuid}
			`),null===(a=m.playlistParams)||void 0===a?void 0:a.repeat){const e=m.playlistData.sampleDataList[0];m.sampleInstanceLookup.get(e.uuid).audioSource.onPlay.addListener((()=>(e=>{if(!e.alive)return;const t=d.dataToRepeatParams(e);d.spawnElementFromParams(t)})(m)))}return m.dispose=async()=>{if(!m.alive)return void Et.warn(ue`
						element.dispose(): Already dead! Can only dispose once!
							title: ${m.title}
							id: ${m.elementId}
							uuid: ${m.uuid}
					`);Et.debug(ue`
					element.dispose():
						title: ${m.title}
						id: ${m.elementId}
						uuid: ${m.uuid}
				`),m.alive=!1,null==b||b(),m.sampleFutureDataLookup.forEach((e=>{Ue(e.timeoutId)})),m.sampleFutureDataLookup.clear(),await Promise.all([...m.sampleInstanceLookup].map((([,e])=>e.dispose())));const t=()=>{var n,a;(null===(n=m.analyser)||void 0===n?void 0:n.isActive)?(Et.debug(ue`
							element.finallyDispose(): Visualisation still active. Delay.
								title: ${m.title}
								id: ${m.elementId}
								uuid: ${m.uuid}
						`),setTimeout(t,100)):(y.disconnectAll(),h.disconnectAll(),null===(a=m.analyser)||void 0===a||a.disconnectAll(),o.mutate((t=>t.delete(e.uuid))))};t()},o.mutate((t=>t.set(e.uuid,m))),p&&it.dispatch("startElement",{elementId:m.elementId,timeToFirstSample:Math.max(_-u,0)}),m},_elementParamsToDataSmartMode:e=>({...e,uuid:a.nextId(),playlistData:(0,xt.elementParamsToPlaylistData)(e,a)}),_elementParamsToDataDumbMode:u};return d})({authSystem:e,audioSystem:t,sampleSystem:n,uuidSystem:o,elementMap:r,playlistSystem:l,oneshotSystem:i,elementVolumeSystem:s}),c={...u,...s,playlistSystem:l,oneshotSystem:i,getElements:()=>r.getRaw(),map:r,stopElementByUuid:e=>r.mutate((t=>t.get(e).dispose())),getElementsWithElementId:e=>St(r,e).filter((([e,t])=>t.playlistData.sampleDataList.some((e=>!e.manuallyTriggered)))),getStopWait:e=>{let t,n=v();return c.getElementsWithElementId(e).forEach((([e,a])=>{let o=a.playlistData.sampleDataList.find((e=>e.startTime<=n&&e.startTime+e.duration>n));o&&(!t||o.startTime+o.duration<t)&&(t=o.startTime+o.duration)})),Math.min(Math.max(t-n,0),3e3)||0},stopElementByElementId:(e,t=!0)=>{St(r,e).forEach((([,e])=>e.dispose())),t&&it.dispatch("stopElement",{elementId:e,timeToStop:c.getStopWait(e)})},stopAllElements:()=>{let e=new Set;return Promise.all([...r.getRaw()].map((([,t])=>(e.has(t.elementId)||(e.add(t.elementId),it.dispatch("stopElement",{elementId:t.elementId,timeToStop:c.getStopWait(t.elementId)})),t.dispose()))))},setElementIdVolume:(e,t)=>s.setElementIdVolume(e,t),setOneshotVolume:e=>i.setVolume(e),playElement:e=>{return c.spawnElementFromParams({title:(t=e).name,playlistParams:ht(t),type:(n=t.type,n||"sfx"),presetName:t.reverb_preset,elementId:wt(t.id),spatialParams:vt(t)});},forEachElement:e=>r.get().forEach(e),createParamsSnapshot:async(e,t=3)=>{let n=await u.paramsToData(e);const a=[n];for(let e=0;e<t;e++){const e=u.dataToRepeatParams(n);n=await u.paramsToData(e),a.push(n)}return a}};return document.addEventListener("syrinscape.internalStartElementSample",(e=>{let t,n=e.detail,a=n.startTime+n.duration-v();c.getElementsWithElementId(n.elementId).forEach((([e,a])=>{let o=a.playlistData.sampleDataList.find((e=>e.startTime>n.startTime&&e.uuid!==n.uuid));o&&(!t||o.startTime<t)&&(t=o.startTime)})),n.timeToStopOrNextSample=t?t-v():a,it.dispatch("startSample",{elementId:n.elementId,playlistEntryId:n.playlistEntryId,timeToStop:a,timeToStopOrNextSample:n.timeToStopOrNextSample})})),c},Mt=S.getLogger("socketSystem"),Rt=(e={})=>Object.values(e).flatMap((e=>Object.keys(e.chunks))),At=e=>({uuid:e.uuid,name:e.name,sampleId:e.id,volume:e.volume,startTime:1e3*e.start,duration:1e3*(e.end-e.start),presetName:e.reverb,spatializable:!!e.position,spatialData:e.position&&{position:Ft(e.position),velocity:Ft(e.velocity)},url:e.url,playlistEntryId:e.playlist_entry_pk,manuallyTriggered:!!e.manually_triggered}),Ft=e=>({x:e[0],y:e[1],z:e[2]});it.add("startMood"),it.add("stopMood");const Ot=S.getLogger("syncSystem");var zt;it.add("playerActive"),it.add("playerInactive");const $t=S.getLogger("player");null!==(zt=w.player)&&void 0!==zt||(w.player=(()=>{$t.info("createPlayer()");const e=ze(),t=(({urlSystem:e,logLevel:t})=>{let n,o,r=0,s="Idle";const i=Ke(a),l={get state(){return s},set state(e){s=e,l.onStateChange.invoke(s)},connect:async()=>new Promise(((t,a)=>{l.state="Connecting";const s=e.createUrlWs("ws-web-player/websocket");o=new WebSocket(s),o.onclose=()=>{l.state="Idle",r=Math.min(Math.max(2*r,500),6e4),r-=Math.min(Date.now()-n,r)||0,Mt.info(`Connection closed. Reconnect in ${J(r)} seconds.`),setTimeout(l.connect,r),n=void 0},o.onerror=e=>{a(),"Error"!==l.state&&(l.state="Error"),l.onError.invoke(e),o.close()},o.onmessage=e=>{"Active"!==l.state&&(l.state="Active");const t=JSON.parse(e.data);Mt.debug("<<< Socket Message Received:",t),l.onMessage.invoke(t),l.onNamedMessage(t.message).invoke(t.params)},o.onopen=e=>{t(),n=Date.now(),l.send({message:"register",session_id:z.sessionId,token:z.token})}})),onMessage:a(),onNamedMessage:i.getOrCreate,reconnect:()=>{void 0!==o?(Mt.info("reconnect()"),r=0,o.close()):Mt.info("reconnect() called before connect()")},send:e=>{Mt.debug(">>> Socket Message Sent:",e),o.send(JSON.stringify(e))},onError:a(),onStateChange:a()},u={ping:e=>l.send({message:"ping",params:e}),error:e=>Mt.error(e.message),reconnect_to_new_backend:({subdomain:t,domain_and_port:n})=>{const[a,o]=n.split(":");z.wsHostname=`${t}.${a}`,o&&(z.wsPort=o),Mt.info(me`
				Reconnect to new backend: ${e.createUrlWs("ws-web-player/websocket")}
			`),l.reconnect()}};return Object.entries(u).forEach((([e,t])=>l.onNamedMessage(e).addListener(t))),it.add("updateConfig",(e=>{(e.detail.sessionId||e.detail.token)&&l.reconnect()})),l})({urlSystem:e}),n=function({urlSystem:e}={}){e=e||ze();const t=(()=>{const e={};let t=null;const n={onFileChange:a(),init:async(e=!0)=>{e?await n.loadFile({effects:[{name:"Alley ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/0vz8w5byepxv8k4/Sweep%20samples_Alley2nd%20try_dc.wav?dl=0"},{fftSize:256,isDestination:!0,maxDecibels:-30,minDecibels:-100,name:"Analyser",smoothingTimeConstant:.8,type:"analyser"},{name:"Arena ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/ov18hhpdpe98yyr/Sweep%20samples_Arena_dc.wav?dl=0"},{name:"Auditorium ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/5oqio2hvvag7sou/Sweep%20samples_Auditorium_dc.wav?dl=0"},{name:"Bathroom ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/x32s6651nwnyvbb/BathroomSweep-96000-24-M-10.0s_dc.zwav.wav?dl=0"},{name:"Carpetted Hallway ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/f0zbljvpkl9iaba/Sweep%20samples_Carpetted%20Hallway_dc.wav?dl=0"},{name:"Cave",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/fmv48mbfvagf9gk/Room_capture_Cave_01_dc.wav?dl=0"},{name:"Cave ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/ey33w5dnkdklz7d/Sweep%20samples_Cave_dc.wav?dl=0"},{name:"City ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/fds6qyegx4dmcum/Room_capture_City_02_dc.wav?dl=0"},{attack:.003,knee:30,name:"Compressor",output:"Analyser",ratio:12,release:.25,threshold:-24,type:"compressor"},{name:"Concert Hall",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/cz4rpyxx4dqdacp/Room_capture_Concert%20hall_03_dc.wav?dl=0"},{name:"Concert Hall ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/22vly35tb4e5nsp/Sweep%20samples_Concert%20Hall_dc.wav?dl=0"},{name:"Crazed ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/32i3gbl2ac5ixra/Sweep%20samples_Crazed_dc.wav?dl=0"},{name:"Dazed ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/f4betvklj5uk6e8/Sweep%20samples_Dazed_dc.wav?dl=0"},{dryOutput:"Global Volume",name:"Dry Long",output:"Concert Hall",type:"send",wetness:.5},{dryOutput:"Global Volume",name:"Dry Short",output:"Concert Hall",type:"send",wetness:.2},{name:"Flooded Cavern ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/q5k8hfimlka8u3m/Sweep%20samples_Flooded%20Cavern_dc.wav?dl=0"},{name:"Forest ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/3sh05lsoffimjsb/Room_capture_Forest_05_fix_dc.wav?dl=0"},{fadeDuration:1,name:"Global Volume",output:"Local Volume",type:"volume",volume:1},{name:"Hallway ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/fkk8zxram928imu/Room_capture_Hallway_05_dc.wav?dl=0"},{name:"Hanger ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/cafxgkmm38nq9n3/Sweep%20samples_Hanger_dc.wav?dl=0"},{fadeDuration:1,name:"Local Volume",output:"Compressor",type:"volume",volume:1},{dampening:6e3,gain:.2,hpFrequency:600,hpResonance:.5,lpFrequency:2e3,lpResonance:.5,name:"Long Reverb",output:"Global Volume",preDelay:.01,roomSize:.9,type:"freeverb"},{name:"Metal Room ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/8df9jkybo5j5j8t/Room_capture_Metal%20room_06_dc.wav?dl=0"},{name:"Mountains ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/b8hgw5uimhb9efv/Room_capture_Mountains_07_dc.wav?dl=0"},{name:"Padded Cell ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/oqrk3ied4b71yiy/Sweep%20samples_Padded%20Cell_dc.wav?dl=0"},{name:"Parking lot ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/qpuxz6ujbgxumeu/Room_capture_Parking%20lot_08_dc.wav?dl=0"},{name:"Plains ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/x9r8r4cyyuaja7d/Room_capture_Plain_09_dc.wav?dl=0"},{name:"Poisoned ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/vrlkoo9xnc294ao/Sweep%20samples_Poisoned_dc.wav?dl=0"},{name:"Quarry ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/zw2hfyk7reichz9/Sweep%20samples_Quarry_dc.wav?dl=0"},{name:"Sewer pipe ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/ltj5zfi1avlmovp/Room_capture_Sewer_10_dc.wav?dl=0"},{duration:.2,falloff:.4,name:"Simple Delay",output:"Global Volume",type:"delay"},{name:"Soft furnished room ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/bf8b9jy0jhbnqft/Sweep%20samples_Soft%20furnished%20room_dc.wav?dl=0"},{name:"Stairwell",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/sjzu2078lg4bpwh/3000CStreetGarageStairwell.wav?dl=0"},{name:"Stone Corridor ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/c8ky9offetjl7ld/Sweep%20samples_Stone%20corridor_dc.wav?dl=0"},{name:"Stone Dungeon ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/vrhznwahzoc2sno/Room_capture_Stone%20Dungeon_11_dc.wav?dl=0"},{name:"Stone room ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/u3zxtfmav475pyu/Sweep%20samples_Stone%20room_dc.wav?dl=0"},{name:"Through a heavy door ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/3iru4ke6t90t8o2/Sweep%20samples_Through%20a%20heavy%20door_dc.wav?dl=0"},{name:"Through a light door ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/opbkl2qp9foncm4/Sweep%20samples_Through%20a%20light%20door_dc.wav?dl=0"},{name:"Underwater ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/wqd1hhrscm717s2/Room_capture_Underwater_12_dc.wav?dl=0"},{name:"Vanilla room ss",output:"Global Volume",type:"convolver",url:"https://dl.dropboxusercontent.com/s/51px3ofee71ob75/Sweep%20samples_Vanila%20room_dc.wav?dl=0"},{dryOutput:"Global Volume",name:"Wet Effect",output:"Simple Delay",type:"send",wetness:.7},{dryOutput:"Global Volume",name:"Wet Long",output:"Long Reverb",type:"send",wetness:1},{dryOutput:"Global Volume",name:"Wet Short",output:"Stairwell",type:"send",wetness:.75}],presets:{Alley:{dryGain:2,drySpatializer:{distanceModel:"exponential",maxDistance:30,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:1,speed:0,type:"spatial"},effect:"Alley ss",name:"Alley",wetSpatializer:{distanceModel:"exponential",maxDistance:50,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.5,speed:0,type:"spatial"}},Arena:{dryGain:1,drySpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:1,speed:0,type:"spatial"},effect:"Arena ss",name:"Arena",wetGain:.1,wetSpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.4,speed:0,type:"spatial"}},Auditorium:{dryGain:1,effect:"Auditorium ss",name:"Auditorium",wetGain:.1},Bathroom:{effect:"Bathroom ss",name:"Bathroom"},"Carpetted Hallway":{dryGain:1,effect:"Carpetted Hallway ss",name:"Carpetted Hallway",wetGain:.4},Cave:{effect:"Cave",name:"Cave"},City:{effect:"City ss",name:"City"},"Concert Hall":{dryGain:.5,effect:"Concert Hall ss",name:"Concert Hall",wetGain:1},Crazed:{dryGain:1,effect:"Crazed ss",name:"Crazed",wetGain:.3},Dazed:{dryGain:1,effect:"Dazed ss",name:"Dazed",wetGain:.1},Default:{dryGain:1,drySpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"My spatial effect 2",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:1,speed:0,type:"spatial"},effect:"Global Volume",isFixed:!0,name:"Default",wetGain:1,wetSpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"My spatial effect 1",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.4,speed:0,type:"spatial"}},"Flooded Cavern":{dryGain:1,effect:"Flooded Cavern ss",name:"Flooded Cavern",wetGain:.5},Forest:{effect:"Forest ss",name:"Forest"},Hallway:{effect:"Hallway ss",name:"Hallway"},Hangar:{dryGain:1,effect:"Hanger ss",name:"Hangar",wetGain:.15,wetSpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.8,speed:0,type:"spatial"}},"Metal Room":{effect:"Metal Room ss",name:"Metal Room"},Mountains:{effect:"Mountains ss",name:"Mountains",wetSpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.8,speed:0,type:"spatial"}},Off:{effect:"Global Volume",name:"Off"},"Padded Cell":{dryGain:1,effect:"Padded Cell ss",name:"Padded Cell",wetGain:.2},"Parking lot":{dryGain:1,effect:"Parking lot ss",name:"Parking lot",wetGain:.3},Plain:{effect:"Plains ss",name:"Plain"},Poisoned:{dryGain:1,effect:"Poisoned ss",name:"Poisoned",wetGain:.5,wetSpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.5,speed:0,type:"spatial"}},Quarry:{effect:"Quarry ss",name:"Quarry"},"Sewer pipe":{effect:"Sewer pipe ss",name:"Sewer pipe"},"Soft furnished room":{effect:"Soft furnished room ss",name:"Soft furnished room"},"Stone Corridor":{dryGain:1,effect:"Stone Corridor ss",name:"Stone Corridor",wetGain:.3},"Stone Dungeon":{effect:"Stone Dungeon ss",name:"Stone Dungeon",wetGain:6.33},"Stone room":{dryGain:1,effect:"Stone room ss",name:"Stone room",wetGain:.4},"Through a heavy door":{dryGain:0,effect:"Through a heavy door ss",name:"Through a heavy door",wetGain:.5,wetSpatializer:{distanceModel:"exponential",maxDistance:100,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.7,speed:0,type:"spatial"}},"Through a light door":{dryGain:.1,effect:"Through a light door ss",name:"Through a light door",wetGain:.47,wetSpatializer:{distanceModel:"inverse",maxDistance:100,minDistance:1,name:"Wet Spatializer",output:"Global Volume",panningModel:"HRTF",position:{x:0,y:0,z:0},rolloff:.7,speed:0,type:"spatial"}},Underwater:{dryGain:1,effect:"Underwater ss",name:"Underwater",wetGain:.3},"Vanilla room":{dryGain:1,effect:"Vanilla room ss",name:"Vanilla room",wetGain:.5}},timestamp:1672719228481.26}):await n.loadFileFromUrl("")},loadFile:async e=>{t=e,await n.rebuildAllEffects(t.effects)},loadFileFromUrl:async e=>{const t=await fetch(e),a=await t.json();await n.loadFile(a)},get analyser(){return e.Analyser},get defaultPreset(){return t.presets.Default},get globalVolume(){return e["Global Volume"]},get localVolume(){return e["Local Volume"]},preset:e=>t.presets[e],effect:t=>e[t],updatePreset:e=>{t.presets[e.name]=e,n.updateFile()},rebuildAllEffects:async e=>{n.disconnectAll(),await Promise.all(e.map(n.buildEffect)),n.reconnectAll()},buildEffect:async t=>{var n;null===(n=e[t.name])||void 0===n||n.disconnectAll();const a=await Fe[t.type](t);e[t.name]=a},buildEffectAndReconnectAll:async e=>{await n.buildEffect(e),n.reconnectAll()},connectEffect:t=>{var n;if(t.params.output){if(!e[t.params.output])throw new Error(`Audio effect not found: ${t.params.output}`);t.connect(e[t.params.output]),null===(n=t.connectFromMap)||void 0===n||n.call(t,e)}else t.output.connect(z.audioContext.destination)},reconnectAll:()=>{Object.values(e).forEach(n.connectEffect),n.updateFile()},trySetParam:(n,a,o)=>{var r;return!!(null===(r=e[n])||void 0===r?void 0:r.setParam[a])&&(e[n].setParam[a](o),t=((e,t,n,a)=>{const o={...e,effects:[...e.effects]},r=o.effects.find((e=>e.name===t)),s=o.effects.indexOf(r);return o.effects[s]={...r,[n]:a},o})(t,n,a,o),t.timestamp=v(),!0)},updateFile:()=>{t.effects=Object.values(e).map((e=>e.params)),t.effects.sort(((e,t)=>e.name>t.name?1:-1)),t.timestamp=v(),n.onFileChange.invoke(t)},disconnectAll:()=>{Object.keys(e).forEach(n.disposeEffect)},disposeEffect:t=>{e[t].disconnectAll(),delete e[t]},disposeEffectAndReconnectAll:e=>{n.disposeEffect(e),n.reconnectAll()}};return n})(),n=(({effectSystem:e})=>{const t=[],n=new WeakMap;return{createAudioSource:(o,r=e.globalVolume,{fadeIn:s,fadeOut:i,fadeScrub:l,fadeStop:u}={},c)=>{let d;if(null!=s||(s=.03),null!=i||(i=.03),null!=l||(l=3),null!=u||(u=3),isFinite(c)||(c=1),t.length){d=t.shift();let e=0;for(;d.ended&&e<t.length;)e+=1,t.push(d),d=t.shift()}else d=new Audio,d.autoplay=!1,d.crossOrigin="anonymous",n.set(d,z.audioContext.createMediaElementSource(d));const m=Ne();let p=!0;const f=a(),y=a();let h;const v=()=>h&&Ue(h),g=(e=>{let t=!1,n=!1,a=0;return{...e,handleReady:()=>{t=!0,n&&e.play(a)},play:o=>{n=!0,a=o,t&&e.play(o)}}})({isAlive:p,onPlay:f,onDispose:y,play:async(e=0)=>{const t=await ge.getBlob(o);d.src=URL.createObjectURL(t),d.currentTime=e,m.value=0,d.addEventListener("ended",b),await d.play(),f.invoke(),h=He((async()=>await m.fadeToValue(0,i,"easeIn")),1e3*(d.duration-i)),e?await m.fadeToValue(c,l,"easeIn"):await m.fadeToValue(c,s,"easeIn")},stop:async()=>{p?(Qe.debug(ue`
						audioSource.stop():
							fadeStop: ${u}
							el.src: ${d.src}
							src: ${o}
					`),v(),await m.fadeToValue(0,u),await w()):Qe.debug(ue`
							audioSource.stop(): Already dead! Cannot stop when dead! This is probably a bug.
								el.src: ${d.src}
								src: ${o}
						`)}}),w=async()=>{p?(Qe.debug(ue`
					audioSource.dispose():
						el.src: ${d.src}
						src: ${o}
				`),p=!1,v(),await Se(1e3),m.disconnectAll(),n.get(d).disconnect(),d.currentTime=0,d.pause(),URL.revokeObjectURL(d.src),d.removeEventListener("ended",b),t.push(d),y.invoke()):Qe.debug(ue`
						audioSource.dispose(): Already dead! Can only dispose once!
							el.src: ${d.src}
							src: ${o}
					`)},b=()=>{p?w():Qe.debug(ue`
						audioSource.handleEnded(): Already dead! Can only handle ended once!
							el.src: ${d.src}
							src: ${o}
					`)};return(async()=>{n.get(d).connect(m.input),m.connect(r),g.handleReady()})(),g}}})({effectSystem:t});return{effectSystem:t,effect:t.effect,init:async(e=!0)=>{await t.init(e)},setGlobalVolume:e=>{if(e=Number(e),Number.isNaN(e)||e<0||e>F)throw Error(`Invalid localVolume: '${e}'`);lt.info(`Set global volume: ${e}`),t.globalVolume.fadeToValue(e),it.dispatch("setGlobalVolume",e)},setLocalVolume:e=>{if(e=Number(e),Number.isNaN(e)||e<0||e>F)throw Error(`Invalid localVolume: '${e}'`);lt.info(`Set local volume: ${e}`),O.localVolume=e,t.localVolume.fadeToValue(e),it.dispatch("setLocalVolume",e)},createAudioSource:(t,a,o,r)=>(t=e.replaceLocalDomainAndPort(t),n.createAudioSource(t,a,o,r)),toggleMute(){0===O.localVolume?this.setLocalVolume(O.lastLocalVolume):(O.lastLocalVolume=O.localVolume,this.setLocalVolume(0))}}}({urlSystem:e}),o=n.effectSystem,r=function({urlSystem:e}={}){e=e||ze();const t={authorizedFetchUrl:async(e,t={},n=!0)=>{t.headers={...t.headers,Authorization:`Token ${z.token}`};const a=await fetch(e,t);return n&&function(e){if(e.status>=400)throw new ut(e.status)}(a),a},authorizedFetchBlob:async(e,n={},a=!0)=>{const o=await t.authorizedFetchUrl(e,n,a);return await o.blob()},authorizedFetchPath:async(n,a={})=>{const o=e.createUrlHttp(n);return t.authorizedFetchUrl(o,a)}};return t}({urlSystem:e}),s=(({authSystem:e,socketSystem:t})=>{const n=()=>{t.send({message:"send_full"})},a=e=>{t.send({message:"set_global_volume",params:{volume:e}})},o=e=>{t.send({message:"set_oneshot_volume",params:{volume:e}})},r=async t=>(t.length>1&&ct.warn(me`
				startElements(): Starting ${t.length} elements. This makes a new request for
				each element. Consider refactoring.
			`),await Promise.all(t.map((t=>{e.authorizedFetchPath(`online/frontend-api/elements/${t}/play/`)})))),s=async t=>await e.authorizedFetchPath(`online/frontend-api/moods/${t}/play/`),i=async t=>(t.length>1&&ct.warn(me`
				startSamples(): Starting ${t.length} samples. This makes a new request for
				each sample. Consider refactoring.
			`),await Promise.all(t.map((t=>{e.authorizedFetchPath(`online/frontend-api/samples/${t}/play/`)})))),l=async t=>(t.length>1&&ct.warn(me`
				startPlaylistEntries(): Starting ${t.length} playlist entries. This makes a new request for
				each element. Consider refactoring.
			`),await Promise.all(t.map((t=>{e.authorizedFetchPath(`online/frontend-api/playlists/${t}/play/`)})))),u=async()=>await e.authorizedFetchPath("online/frontend-api/stop-all/"),c=async t=>(t.length>1&&ct.warn(me`
				stopElements(): Stopping ${t.length} elements. This makes a new request for
				each element. Consider refactoring.
			`),await Promise.all(t.map((t=>{e.authorizedFetchPath(`online/frontend-api/elements/${t}/stop/`)})))),d=async t=>await e.authorizedFetchPath(`online/frontend-api/moods/${t}/stop/`),m=async t=>(t.length>1&&ct.warn(me`
				stopPlaylistEntries(): Stopping ${t.length} elements. This makes a new request
				for each playlist entries. Consider refactoring.
			`),await Promise.all(t.map((t=>{e.authorizedFetchPath(`online/frontend-api/playlists/${t}/stop/`)})))),p=async t=>(t.length>1&&ct.warn(me`
				stopSamples(): Stopping ${t.length} samples. This makes a new request for
				each sample. Consider refactoring.
			`),await Promise.all(t.map((t=>{e.authorizedFetchPath(`online/frontend-api/samples/${t}/stop/`)}))));return et.onMessage("syrinscape.sendFull").addListener((e=>n())),et.onMessage("syrinscape.setGlobalVolume").addListener((e=>a(e.params.volume))),et.onMessage("syrinscape.setOneshotVolume").addListener((e=>o(e.params.number))),et.onMessage("syrinscape.startElements").addListener((e=>r(e.params.pks))),et.onMessage("syrinscape.startMood").addListener((e=>s(e.params.pk))),et.onMessage("syrinscape.startPlaylistEntries").addListener((e=>l(e.params.pks))),et.onMessage("syrinscape.startSamples").addListener((e=>i(e.params.pks))),et.onMessage("syrinscape.stopAll").addListener((e=>u())),et.onMessage("syrinscape.stopElements").addListener((e=>c(e.params.pks))),et.onMessage("syrinscape.stopMood").addListener((e=>d(e.params.pk))),et.onMessage("syrinscape.stopPlaylistEntries").addListener((e=>m(e.params.pks))),et.onMessage("syrinscape.stopSamples").addListener((e=>p(e.params.pks))),{sendFull:n,setGlobalVolume:a,setOneshotVolume:o,startElements:r,startMood:s,startPlaylistEntries:l,startSamples:i,stopAll:u,stopElements:c,stopMood:d,stopPlaylistEntries:m,stopSamples:p}})({authSystem:r,socketSystem:t}),i=kt(),l=Pt({audioSystem:n,uuidSystem:i}),u=Lt({authSystem:r,audioSystem:n,sampleSystem:l,uuidSystem:i}),c=(({elementSystem:e,sampleSystem:t,socketSystem:n,audioSystem:o})=>{const r={onChangeMood:a(),onChangeSoundset:a()},s=e=>{(e=>{f=Date.now()-e})(1e3*e);const t=J(y());t>0?Ot.info(`Local time is ahead of server time by ${t} seconds.`):t<0&&Ot.info(`Local time is behind of server time by ${-t} seconds.`)};n.onNamedMessage("registered").addListener((e=>{z.sessionId=e.session_id,z.token=e.token}));const i=e=>{0===y()&&s(e.timestamp),u(e,!0,!0)};n.onNamedMessage("send_full").addListener(i),n.onNamedMessage("send_full_element").addListener((t=>{0===y()&&s(t.timestamp);const n=Rt(t.elements),a=((e={})=>Object.keys(e).map((e=>parseInt(e,10))))(t.elements);h().filter((e=>a.includes(e.elementId)&&!n.includes(e.uuid))).forEach((t=>e.stopElementByUuid(t.uuid))),l(t)}));const l=e=>{u(e,!1,!1)};n.onNamedMessage("send_partial").addListener(l);const u=(t,n=!1,a=!1)=>{const s=t.elements,i=t.samples,l=h(),u=g();n&&d(s,l),a&&p(i,u),c(s,l,n),m(i,u),t.global_volume&&o.setGlobalVolume(t.global_volume),t.oneshot_volume&&e.setOneshotVolume(t.oneshot_volume),t.soundset_title&&(Ot.info(ue`
				Current soundset:
					title: ${t.soundset_title}
					id: ${t.soundset_pk}
			`),r.onChangeSoundset.invoke({artwork:t.soundset_artwork,title:t.soundset_title,pk:t.soundset_pk})),t.mood_title?(Ot.info(ue`
				Current mood:
					title: ${t.mood_title}
					id: ${t.mood_pk}
			`),r.onChangeMood.invoke({title:t.mood_title,pk:t.mood_pk}),it.dispatch("startMood",{moodId:t.mood_pk,moodTitle:t.mood_title})):null===t.mood_title&&it.dispatch("stopMood");let f=0,w=0;if(e.forEachElement((e=>{f+=e.sampleInstanceLookup.size,w+=e.sampleFutureDataLookup.size})),Ot.debug(ue`
			handleCommonState():
				active samples: ${f}
				scheduled samples: ${w}
		`),window.Sentry){const{elements:e,...n}=t;window.Sentry.addBreadcrumb({type:"debug",message:"handleCommonState()",level:"info",data:{...n,elements:JSON.stringify(e),serverTime:1e3*t.timestamp,clientTime:Date.now(),clientTimeServerTimeDelta:Date.now()-v(),serverTimeOffset:Date.now()-1e3*t.timestamp,getServerTimeOffset:y()}})}},c=(t,n,a)=>{void 0!==t&&(Object.entries(t).filter((([e,t])=>void 0!==t.volume&&0===Object.values(t.chunks).length)).forEach((([t,n])=>e.setElementIdVolume(Number(t),n.volume))),((e={})=>Object.entries(e).flatMap((([e,t])=>Object.entries(t.chunks||{}).map((([n,a])=>({uuid:n,crossfade:t.crossfade,volume:t.volume,elementId:Number(e),type:t.type,title:t.title,playlistData:{sampleDataList:a.map(At)},presetName:t.reverb}))))))(t).filter((({uuid:e})=>{const a=n.some((t=>t.uuid===e));return a&&Ot.debug(ue`
						handlePlayElements(): Element is already playing. This is probably a bug!
							uuid: ${e}
						`,"newElements:",t,"playingElements:",n),!a})).sort(((e,t)=>e.playlistData.sampleDataList[0].startTime>t.playlistData.sampleDataList[0].startTime?1:-1)).forEach((t=>e.spawnElementFromData(t,a))))},d=(t,n)=>n.filter((e=>!Rt(t).some((t=>t===e.uuid)))).forEach((({uuid:t})=>e.stopElementByUuid(t))),m=(e,n)=>{e&&Object.values(e).filter((({uuid:t})=>{const a=n.some((e=>e.uuid===t));return a&&Ot.debug(ue`
						handlePlaySamples(): Sample is already playing. This is probably a bug!
							uuid: ${t}
						`,"newSamples:",e,"playingSamples:",n),!a})).sort(((e,t)=>e.start>t.start?1:-1)).forEach((e=>{var n;const a={...e,sampleId:e.id,duration:Q(e.end-e.start),spatializable:!1,startTime:null!==(n=Q(e.start))&&void 0!==n?n:v()};t.spawnSampleFromData({data:a})}))},p=(e,n)=>n.filter((t=>!Object.keys(e).some((e=>t.elementId&&e===t.uuid)))).forEach((({uuid:e})=>{t.stopSampleBySampleUuid(e)}));n.onNamedMessage("stop_elements").addListener((({pks:t})=>{t.forEach((t=>e.stopElementByElementId(t)))})),n.onNamedMessage("stop_playlist_entries").addListener((({pks:e})=>{e.forEach((e=>t.stopPlaylistEntryByPlaylistEntryId(e)))})),n.onNamedMessage("stop_samples").addListener((({pks:e})=>{e.forEach((e=>t.stopDirectSampleBySampleId(e)))})),n.onNamedMessage("stop_all").addListener((()=>{e.stopAllElements(),t.stopAllSamples()})),n.onNamedMessage("set_global_volume").addListener((({volume:e})=>{o.setGlobalVolume(e)})),n.onNamedMessage("set_oneshot_volume").addListener((({volume:t})=>{e.setOneshotVolume(t)})),n.onNamedMessage("set_element_volume").addListener((({pk:t,volume:n})=>{e.setElementIdVolume(t,n)}));const h=()=>[...e.getElements().values()],g=()=>[...t.getSamples().values()].filter((e=>!e.elementId&&!e.playlistEntryId));return{events:r,handleFullState:i,handlePartialState:l}})({audioSystem:n,elementSystem:u,sampleSystem:l,socketSystem:t});return{postMessageSystem:et,urlSystem:e,socketSystem:t,audioSystem:n,audioEffectSystem:o,controlSystem:s,sampleSystem:l,elementSystem:u,syncSystem:c,init:async({configure:e,context:a="default",initialConfig:o={},onActive:r,onInactive:s,selector:i="body"}={})=>{let l=[];await z.init(a,o),"function"==typeof e&&await e();const u=async()=>{var e;await(async()=>{await n.init(),n.setLocalVolume(z.localVolume),await t.connect()})(),$t.info("Player is active."),null===(e=w.visualisation)||void 0===e||e.init()};if("suspended"!==z.audioContext.state)await u(),"function"==typeof r&&(r(),it.dispatch("playerActive"));else{let e=!0;$t.warn("Player is inactive."),"function"==typeof s&&(s(),it.dispatch("playerInactive"));const t=async t=>{null!==t.target.closest(i)&&(t.button&&0!==t.button||(l.push(t.target),t.preventDefault(),t.stopImmediatePropagation(),e&&(e=!1,await z.audioContext.resume(),await u(),n(),"function"==typeof r&&(r(),it.dispatch("playerActive")))))},n=()=>{document.removeEventListener("click",t,!0),setTimeout((()=>{for(;l.length>0;){let e=l.pop();$t.info("Executing deferred click for",e),e.click()}}),0)};document.addEventListener("click",t,!0)}}}})()),w.player})()})();
//# sourceMappingURL=player.5ba035dbd133c9dd3750.js.map
